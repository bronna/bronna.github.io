var Lb=Object.defineProperty;var Ob=Object.getPrototypeOf;var Gb=Reflect.get;var uf=o=>{throw TypeError(o)};var Nb=(o,e,i)=>e in o?Lb(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i;var ja=(o,e,i)=>Nb(o,typeof e!="symbol"?e+"":e,i),hf=(o,e,i)=>e.has(o)||uf("Cannot "+i);var It=(o,e,i)=>(hf(o,e,"read from private field"),i?i.call(o):e.get(o)),qi=(o,e,i)=>e.has(o)?uf("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,i);var Ps=(o,e,i)=>(hf(o,e,"access private method"),i);var df=(o,e,i)=>Gb(Ob(o),i,e);import{c as tt,a as Le,t as Hn}from"./CR_3py8g.js";import{a as di,o as Uh}from"./Dk5IxytF.js";import{g as ff,w as wr,d as Nl,r as zb}from"./VZ_jJvjc.js";import{G as ii,p as Ca,u as wt,H as ln,n as zt,C as Nt,v as or,D as Fh,T as qe,K as Jl,c as Lh,h as Ip,B as nn,q as Bp,o as Oh,F as Af,l as us,m as Aa,a as Hb,b as Vb,d as jb,w as qb,j as Wb,x as Kb,L as Vr,s as Yb}from"./CKjjvfn1.js";import{b as Xb,c as Xu,d as Sp,V as ie,B as Mt,M as Lt,L as Ea,e as na,F as tr,f as Rt,g as Yn,h as Jb,i as Zb,D as kp,j as Tn,k as vi,l as sr,m as lt,I as Zl,n as $l,O as Mi,o as ec,p as $b,q as e0,r as bn,s as xa,t as ir,N as wn,u as t0,v as jc,w as ia,x as Dp,y as Oi,z as n0,E as hi,G as Tp,H as Re,J as Mp,K as xi,Q as i0,U as Pp,X as pn,P as Qp,Y as rr,Z as Ia,_ as r0,$ as o0,a0 as s0,a1 as Rp,C as Ju,a2 as vn,a3 as a0,a4 as l0,a5 as c0,a6 as pa,a7 as u0,a8 as h0,a9 as zl,aa as Co,ab as ga,ac as pf,ad as gf,ae as mf,af as gn,ag as Xr,ah as d0,ai as f0,aj as A0,ak as Up,al as ni,am as Fp,an as p0,ao as g0,ap as m0,aq as v0,ar as b0,as as w0,at as y0,au as _0,av as C0,aw as Ui,ax as zn,ay as fn,az as Kr,aA as E0,aB as Zu,aC as es,aD as Eo,aE as vf,aF as x0,aG as Ba,aH as Hl,aI as bf,aJ as I0,aK as B0,aL as qc,aM as Lp,aN as tc,aO as nc,aP as ic,aQ as Tl,aR as ra,aS as hs,aT as ri,aU as nr,S as Op,aV as Vl,aW as ma,aX as Gh,aY as rc,aZ as Nh,a_ as S0,a$ as Gi,b0 as zh,b1 as cs,b2 as $u,b3 as k0,b4 as oc,b5 as Hh,b6 as Di,b7 as ts,b8 as D0,b9 as _r,ba as sc,bb as Gp,bc as ns,bd as T0,be as M0,bf as P0,bg as Np,bh as zp,R as Hp,bi as Vp,bj as Q0,bk as R0,bl as li,bm as Wn,bn as qa,bo as Qs,bp as oa,bq as xn,br as jp,bs as Jo,bt as sa,bu as Wc,bv as U0,bw as wf,bx as F0,by as eh,bz as qp,bA as L0,bB as O0,bC as Vh,bD as Wp,W as G0,bE as N0,bF as Kc,bG as z0,bH as H0,bI as V0,bJ as j0,bK as q0,bL as W0}from"./wwKeP0Ca.js";import{aM as Kp,aX as Do,aY as Cr,A as st,m as Ae,B as ze,v as H,D as at,N as rn,E as In,O as Ti,x as Qe,z as ht,b as Et,C as Yc,F as Wa,G as Ka,u as K0,T as vr}from"./CVuNfkzf.js";import{i as En,c as bi}from"./DlPLwntU.js";import{a as z,b as Vn,p as er,s as yt,r as xt,c as cn}from"./DWvpJWiV.js";import{s as ut}from"./B29C6zgS.js";import{e as Y0}from"./sB8_Elye.js";import{a as X0}from"./BelD7lMf.js";import{d as yf,s as _f}from"./BWPhJSfu.js";import{s as Cf}from"./CWSgjiR8.js";import{b as Xc}from"./Dt6cWVIg.js";import{c as J0}from"./Cpj98o6Y.js";import{t as Z0}from"./fgMBUPYp.js";function on(o,e,i,a){var n=o.__styles??(o.__styles={});n[e]!==i&&(n[e]=i,i==null?o.style.removeProperty(e):o.style.setProperty(e,i,""))}const z2=(o="pointer",e="auto",i=void 0)=>{let a=!1;const n=wr(!1),t=()=>{n.set(!0)},r=()=>{n.set(!1)};if(typeof window>"u")return{hovering:n,onPointerEnter:t,onPointerLeave:r};const s=i??document.body;let l=typeof o=="string"?o:ff(o);typeof o!="string"&&ii(o,h=>{l=h,a&&(s.style.cursor=h)});let c=typeof e=="string"?e:ff(e);return typeof e!="string"&&ii(e,h=>{c=h,a||(s.style.cursor=h)}),ii(n,h=>{a=h,a?s.style.cursor=l:s.style.cursor=c}),di(()=>{s.style.cursor=c}),{hovering:n,onPointerEnter:t,onPointerLeave:r}};function Ef(o,e){if(e===Xb)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===Xu||e===Sp){let i=o.getIndex();if(i===null){const r=[],s=o.getAttribute("position");if(s!==void 0){for(let l=0;l<s.count;l++)r.push(l);o.setIndex(r),i=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const a=i.count-2,n=[];if(e===Xu)for(let r=1;r<=a;r++)n.push(i.getX(0)),n.push(i.getX(r)),n.push(i.getX(r+1));else for(let r=0;r<a;r++)r%2===0?(n.push(i.getX(r)),n.push(i.getX(r+1)),n.push(i.getX(r+2))):(n.push(i.getX(r+2)),n.push(i.getX(r+1)),n.push(i.getX(r)));n.length/3!==a&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const t=o.clone();return t.setIndex(n),t.clearGroups(),t}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}function jh(o,e=Math.PI/3){const i=Math.cos(e),a=(1+1e-10)*100,n=[new ie,new ie,new ie],t=new ie,r=new ie,s=new ie,l=new ie;function c(b){const v=~~(b.x*a),y=~~(b.y*a),E=~~(b.z*a);return`${v},${y},${E}`}const h=o.index?o.toNonIndexed():o,d=h.attributes.position,f={};for(let b=0,v=d.count/3;b<v;b++){const y=3*b,E=n[0].fromBufferAttribute(d,y+0),_=n[1].fromBufferAttribute(d,y+1),C=n[2].fromBufferAttribute(d,y+2);t.subVectors(C,_),r.subVectors(E,_);const x=new ie().crossVectors(t,r).normalize();for(let B=0;B<3;B++){const I=n[B],k=c(I);k in f||(f[k]=[]),f[k].push(x)}}const p=new Float32Array(d.count*3),m=new Mt(p,3,!1);for(let b=0,v=d.count/3;b<v;b++){const y=3*b,E=n[0].fromBufferAttribute(d,y+0),_=n[1].fromBufferAttribute(d,y+1),C=n[2].fromBufferAttribute(d,y+2);t.subVectors(C,_),r.subVectors(E,_),s.crossVectors(t,r).normalize();for(let x=0;x<3;x++){const B=n[x],I=c(B),k=f[I];l.set(0,0,0);for(let P=0,D=k.length;P<D;P++){const U=k[P];s.dot(U)>i&&l.add(U)}l.normalize(),m.setXYZ(y+x,l.x,l.y,l.z)}}return h.setAttribute("normal",m),h}class $0 extends Ea{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new rw(i)}),this.register(function(i){return new ow(i)}),this.register(function(i){return new Aw(i)}),this.register(function(i){return new pw(i)}),this.register(function(i){return new gw(i)}),this.register(function(i){return new aw(i)}),this.register(function(i){return new lw(i)}),this.register(function(i){return new cw(i)}),this.register(function(i){return new uw(i)}),this.register(function(i){return new iw(i)}),this.register(function(i){return new hw(i)}),this.register(function(i){return new sw(i)}),this.register(function(i){return new fw(i)}),this.register(function(i){return new dw(i)}),this.register(function(i){return new tw(i)}),this.register(function(i){return new mw(i)}),this.register(function(i){return new vw(i)})}load(e,i,a,n){const t=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const c=na.extractUrlBase(e);r=na.resolveURL(c,this.path)}else r=na.extractUrlBase(e);this.manager.itemStart(e);const s=function(c){n?n(c):console.error(c),t.manager.itemError(e),t.manager.itemEnd(e)},l=new tr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{t.parse(c,r,function(h){i(h),t.manager.itemEnd(e)},s)}catch(h){s(h)}},a,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,a,n){let t;const r={},s={},l=new TextDecoder;if(typeof e=="string")t=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Yp){try{r[Dt.KHR_BINARY_GLTF]=new bw(e)}catch(d){n&&n(d);return}t=JSON.parse(r[Dt.KHR_BINARY_GLTF].content)}else t=JSON.parse(l.decode(e));else t=e;if(t.asset===void 0||t.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Mw(t,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),s[d.name]=d,r[d.name]=!0}if(t.extensionsUsed)for(let h=0;h<t.extensionsUsed.length;++h){const d=t.extensionsUsed[h],f=t.extensionsRequired||[];switch(d){case Dt.KHR_MATERIALS_UNLIT:r[d]=new nw;break;case Dt.KHR_DRACO_MESH_COMPRESSION:r[d]=new ww(t,this.dracoLoader);break;case Dt.KHR_TEXTURE_TRANSFORM:r[d]=new yw;break;case Dt.KHR_MESH_QUANTIZATION:r[d]=new _w;break;default:f.indexOf(d)>=0&&s[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(r),c.setPlugins(s),c.parse(a,n)}parseAsync(e,i){const a=this;return new Promise(function(n,t){a.parse(e,i,n,t)})}}function ew(){let o={};return{get:function(e){return o[e]},add:function(e,i){o[e]=i},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const Dt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class tw{constructor(e){this.parser=e,this.name=Dt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let a=0,n=i.length;a<n;a++){const t=i[a];t.extensions&&t.extensions[this.name]&&t.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,t.extensions[this.name].light)}}_loadLight(e){const i=this.parser,a="light:"+e;let n=i.cache.get(a);if(n)return n;const t=i.json,l=((t.extensions&&t.extensions[this.name]||{}).lights||[])[e];let c;const h=new Rt(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],Yn);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new kp(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Zb(h),c.distance=d;break;case"spot":c=new Jb(h),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),mr(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=i.createUniqueName(l.name||"light_"+e),n=Promise.resolve(c),i.cache.add(a,n),n}getDependency(e,i){if(e==="light")return this._loadLight(i)}createNodeAttachment(e){const i=this,a=this.parser,t=a.json.nodes[e],s=(t.extensions&&t.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(l){return a._getNodeRef(i.cache,s,l)})}}class nw{constructor(){this.name=Dt.KHR_MATERIALS_UNLIT}getMaterialType(){return Tn}extendParams(e,i,a){const n=[];e.color=new Rt(1,1,1),e.opacity=1;const t=i.pbrMetallicRoughness;if(t){if(Array.isArray(t.baseColorFactor)){const r=t.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],Yn),e.opacity=r[3]}t.baseColorTexture!==void 0&&n.push(a.assignTexture(e,"map",t.baseColorTexture,vi))}return Promise.all(n)}}class iw{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=n.extensions[this.name].emissiveStrength;return t!==void 0&&(i.emissiveIntensity=t),Promise.resolve()}}class rw{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const a=this.parser,n=a.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=[],r=n.extensions[this.name];if(r.clearcoatFactor!==void 0&&(i.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&t.push(a.assignTexture(i,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&t.push(a.assignTexture(i,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(t.push(a.assignTexture(i,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const s=r.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new lt(s,s)}return Promise.all(t)}}class ow{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=n.extensions[this.name];return i.dispersion=t.dispersion!==void 0?t.dispersion:0,Promise.resolve()}}class sw{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const a=this.parser,n=a.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=[],r=n.extensions[this.name];return r.iridescenceFactor!==void 0&&(i.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&t.push(a.assignTexture(i,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(i.iridescenceIOR=r.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&t.push(a.assignTexture(i,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(t)}}class aw{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_SHEEN}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const a=this.parser,n=a.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=[];i.sheenColor=new Rt(0,0,0),i.sheenRoughness=0,i.sheen=1;const r=n.extensions[this.name];if(r.sheenColorFactor!==void 0){const s=r.sheenColorFactor;i.sheenColor.setRGB(s[0],s[1],s[2],Yn)}return r.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&t.push(a.assignTexture(i,"sheenColorMap",r.sheenColorTexture,vi)),r.sheenRoughnessTexture!==void 0&&t.push(a.assignTexture(i,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(t)}}class lw{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const a=this.parser,n=a.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=[],r=n.extensions[this.name];return r.transmissionFactor!==void 0&&(i.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&t.push(a.assignTexture(i,"transmissionMap",r.transmissionTexture)),Promise.all(t)}}class cw{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_VOLUME}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const a=this.parser,n=a.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=[],r=n.extensions[this.name];i.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&t.push(a.assignTexture(i,"thicknessMap",r.thicknessTexture)),i.attenuationDistance=r.attenuationDistance||1/0;const s=r.attenuationColor||[1,1,1];return i.attenuationColor=new Rt().setRGB(s[0],s[1],s[2],Yn),Promise.all(t)}}class uw{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_IOR}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=n.extensions[this.name];return i.ior=t.ior!==void 0?t.ior:1.5,Promise.resolve()}}class hw{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const a=this.parser,n=a.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=[],r=n.extensions[this.name];i.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&t.push(a.assignTexture(i,"specularIntensityMap",r.specularTexture));const s=r.specularColorFactor||[1,1,1];return i.specularColor=new Rt().setRGB(s[0],s[1],s[2],Yn),r.specularColorTexture!==void 0&&t.push(a.assignTexture(i,"specularColorMap",r.specularColorTexture,vi)),Promise.all(t)}}class dw{constructor(e){this.parser=e,this.name=Dt.EXT_MATERIALS_BUMP}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const a=this.parser,n=a.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=[],r=n.extensions[this.name];return i.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&t.push(a.assignTexture(i,"bumpMap",r.bumpTexture)),Promise.all(t)}}class fw{constructor(e){this.parser=e,this.name=Dt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:sr}extendMaterialParams(e,i){const a=this.parser,n=a.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const t=[],r=n.extensions[this.name];return r.anisotropyStrength!==void 0&&(i.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(i.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&t.push(a.assignTexture(i,"anisotropyMap",r.anisotropyTexture)),Promise.all(t)}}class Aw{constructor(e){this.parser=e,this.name=Dt.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,a=i.json,n=a.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const t=n.extensions[this.name],r=i.options.ktx2Loader;if(!r){if(a.extensionsRequired&&a.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,t.source,r)}}class pw{constructor(e){this.parser=e,this.name=Dt.EXT_TEXTURE_WEBP}loadTexture(e){const i=this.name,a=this.parser,n=a.json,t=n.textures[e];if(!t.extensions||!t.extensions[i])return null;const r=t.extensions[i],s=n.images[r.source];let l=a.textureLoader;if(s.uri){const c=a.options.manager.getHandler(s.uri);c!==null&&(l=c)}return a.loadTextureImage(e,r.source,l)}}class gw{constructor(e){this.parser=e,this.name=Dt.EXT_TEXTURE_AVIF}loadTexture(e){const i=this.name,a=this.parser,n=a.json,t=n.textures[e];if(!t.extensions||!t.extensions[i])return null;const r=t.extensions[i],s=n.images[r.source];let l=a.textureLoader;if(s.uri){const c=a.options.manager.getHandler(s.uri);c!==null&&(l=c)}return a.loadTextureImage(e,r.source,l)}}class mw{constructor(e){this.name=Dt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,a=i.bufferViews[e];if(a.extensions&&a.extensions[this.name]){const n=a.extensions[this.name],t=this.parser.getDependency("buffer",n.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return t.then(function(s){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,d=n.byteStride,f=new Uint8Array(s,l,c);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(h,d,f,n.mode,n.filter).then(function(p){return p.buffer}):r.ready.then(function(){const p=new ArrayBuffer(h*d);return r.decodeGltfBuffer(new Uint8Array(p),h,d,f,n.mode,n.filter),p})})}else return null}}class vw{constructor(e){this.name=Dt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const i=this.parser.json,a=i.nodes[e];if(!a.extensions||!a.extensions[this.name]||a.mesh===void 0)return null;const n=i.meshes[a.mesh];for(const c of n.primitives)if(c.mode!==Ei.TRIANGLES&&c.mode!==Ei.TRIANGLE_STRIP&&c.mode!==Ei.TRIANGLE_FAN&&c.mode!==void 0)return null;const r=a.extensions[this.name].attributes,s=[],l={};for(const c in r)s.push(this.parser.getDependency("accessor",r[c]).then(h=>(l[c]=h,l[c])));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then(c=>{const h=c.pop(),d=h.isGroup?h.children:[h],f=c[0].count,p=[];for(const m of d){const b=new Lt,v=new ie,y=new vn,E=new ie(1,1,1),_=new Zl(m.geometry,m.material,f);for(let C=0;C<f;C++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,C),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,C),l.SCALE&&E.fromBufferAttribute(l.SCALE,C),_.setMatrixAt(C,b.compose(v,y,E));for(const C in l)if(C==="_COLOR_0"){const x=l[C];_.instanceColor=new $l(x.array,x.itemSize,x.normalized)}else C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&m.geometry.setAttribute(C,l[C]);Mi.prototype.copy.call(_,m),this.parser.assignFinalMaterial(_),p.push(_)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}}const Yp="glTF",Rs=12,xf={JSON:1313821514,BIN:5130562};class bw{constructor(e){this.name=Dt.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,Rs),a=new TextDecoder;if(this.header={magic:a.decode(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Yp)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Rs,t=new DataView(e,Rs);let r=0;for(;r<n;){const s=t.getUint32(r,!0);r+=4;const l=t.getUint32(r,!0);if(r+=4,l===xf.JSON){const c=new Uint8Array(e,Rs+r,s);this.content=a.decode(c)}else if(l===xf.BIN){const c=Rs+r;this.body=e.slice(c,c+s)}r+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ww{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Dt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const a=this.json,n=this.dracoLoader,t=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,s={},l={},c={};for(const h in r){const d=th[h]||h.toLowerCase();s[d]=r[h]}for(const h in e.attributes){const d=th[h]||h.toLowerCase();if(r[h]!==void 0){const f=a.accessors[e.attributes[h]],p=ss[f.componentType];c[d]=p.name,l[d]=f.normalized===!0}}return i.getDependency("bufferView",t).then(function(h){return new Promise(function(d,f){n.decodeDracoFile(h,function(p){for(const m in p.attributes){const b=p.attributes[m],v=l[m];v!==void 0&&(b.normalized=v)}d(p)},s,c,Yn,f)})})}}class yw{constructor(){this.name=Dt.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(i.texCoord===void 0||i.texCoord===e.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.texCoord!==void 0&&(e.channel=i.texCoord),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class _w{constructor(){this.name=Dt.KHR_MESH_QUANTIZATION}}class Xp extends d0{constructor(e,i,a,n){super(e,i,a,n)}copySampleValue_(e){const i=this.resultBuffer,a=this.sampleValues,n=this.valueSize,t=e*n*3+n;for(let r=0;r!==n;r++)i[r]=a[t+r];return i}interpolate_(e,i,a,n){const t=this.resultBuffer,r=this.sampleValues,s=this.valueSize,l=s*2,c=s*3,h=n-i,d=(a-i)/h,f=d*d,p=f*d,m=e*c,b=m-c,v=-2*p+3*f,y=p-f,E=1-v,_=y-f+d;for(let C=0;C!==s;C++){const x=r[b+C+s],B=r[b+C+l]*h,I=r[m+C+s],k=r[m+C]*h;t[C]=E*x+_*B+v*I+y*k}return t}}const Cw=new vn;class Ew extends Xp{interpolate_(e,i,a,n){const t=super.interpolate_(e,i,a,n);return Cw.fromArray(t).normalize().toArray(t),t}}const Ei={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ss={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},If={9728:wn,9729:bn,9984:a0,9985:l0,9986:c0,9987:xa},Bf={33071:pa,33648:u0,10497:ir},Jc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},th={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Fr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},xw={CUBICSPLINE:void 0,LINEAR:Rp,STEP:h0},Zc={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Iw(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new Dp({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:zl})),o.DefaultMaterial}function co(o,e,i){for(const a in i.extensions)o[a]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[a]=i.extensions[a])}function mr(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Bw(o,e,i){let a=!1,n=!1,t=!1;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(d.POSITION!==void 0&&(a=!0),d.NORMAL!==void 0&&(n=!0),d.COLOR_0!==void 0&&(t=!0),a&&n&&t)break}if(!a&&!n&&!t)return Promise.resolve(o);const r=[],s=[],l=[];for(let c=0,h=e.length;c<h;c++){const d=e[c];if(a){const f=d.POSITION!==void 0?i.getDependency("accessor",d.POSITION):o.attributes.position;r.push(f)}if(n){const f=d.NORMAL!==void 0?i.getDependency("accessor",d.NORMAL):o.attributes.normal;s.push(f)}if(t){const f=d.COLOR_0!==void 0?i.getDependency("accessor",d.COLOR_0):o.attributes.color;l.push(f)}}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(l)]).then(function(c){const h=c[0],d=c[1],f=c[2];return a&&(o.morphAttributes.position=h),n&&(o.morphAttributes.normal=d),t&&(o.morphAttributes.color=f),o.morphTargetsRelative=!0,o})}function Sw(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let i=0,a=e.weights.length;i<a;i++)o.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(o.morphTargetInfluences.length===i.length){o.morphTargetDictionary={};for(let a=0,n=i.length;a<n;a++)o.morphTargetDictionary[i[a]]=a}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function kw(o){let e;const i=o.extensions&&o.extensions[Dt.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+$c(i.attributes):e=o.indices+":"+$c(o.attributes)+":"+o.mode,o.targets!==void 0)for(let a=0,n=o.targets.length;a<n;a++)e+=":"+$c(o.targets[a]);return e}function $c(o){let e="";const i=Object.keys(o).sort();for(let a=0,n=i.length;a<n;a++)e+=i[a]+":"+o[i[a]]+";";return e}function nh(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Dw(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":o.search(/\.ktx2($|\?)/i)>0||o.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Tw=new Lt;class Mw{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new ew,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let a=!1,n=-1,t=!1,r=-1;if(typeof navigator<"u"){const s=navigator.userAgent;a=/^((?!chrome|android).)*safari/i.test(s)===!0;const l=s.match(/Version\/(\d+)/);n=a&&l?parseInt(l[1],10):-1,t=s.indexOf("Firefox")>-1,r=t?s.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||a&&n<17||t&&r<98?this.textureLoader=new ec(this.options.manager):this.textureLoader=new $b(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new tr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const a=this,n=this.json,t=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([a.getDependencies("scene"),a.getDependencies("animation"),a.getDependencies("camera")])}).then(function(r){const s={scene:r[0][n.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:n.asset,parser:a,userData:{}};return co(t,s,n),mr(s,n),Promise.all(a._invokeAll(function(l){return l.afterRoot&&l.afterRoot(s)})).then(function(){for(const l of s.scenes)l.updateMatrixWorld();e(s)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],a=this.json.meshes||[];for(let n=0,t=i.length;n<t;n++){const r=i[n].joints;for(let s=0,l=r.length;s<l;s++)e[r[s]].isBone=!0}for(let n=0,t=e.length;n<t;n++){const r=e[n];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(a[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,a){if(e.refs[i]<=1)return a;const n=a.clone(),t=(r,s)=>{const l=this.associations.get(r);l!=null&&this.associations.set(s,l);for(const[c,h]of r.children.entries())t(h,s.children[c])};return t(a,n),n.name+="_instance_"+e.uses[i]++,n}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let a=0;a<i.length;a++){const n=e(i[a]);if(n)return n}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const a=[];for(let n=0;n<i.length;n++){const t=e(i[n]);t&&a.push(t)}return a}getDependency(e,i){const a=e+":"+i;let n=this.cache.get(a);if(!n){switch(e){case"scene":n=this.loadScene(i);break;case"node":n=this._invokeOne(function(t){return t.loadNode&&t.loadNode(i)});break;case"mesh":n=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(i)});break;case"accessor":n=this.loadAccessor(i);break;case"bufferView":n=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(i)});break;case"buffer":n=this.loadBuffer(i);break;case"material":n=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(i)});break;case"texture":n=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(i)});break;case"skin":n=this.loadSkin(i);break;case"animation":n=this._invokeOne(function(t){return t.loadAnimation&&t.loadAnimation(i)});break;case"camera":n=this.loadCamera(i);break;default:if(n=this._invokeOne(function(t){return t!=this&&t.getDependency&&t.getDependency(e,i)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(a,n)}return n}getDependencies(e){let i=this.cache.get(e);if(!i){const a=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(n.map(function(t,r){return a.getDependency(e,r)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],a=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Dt.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(t,r){a.load(na.resolveURL(i.uri,n.path),t,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(a){const n=i.byteLength||0,t=i.byteOffset||0;return a.slice(t,t+n)})}loadAccessor(e){const i=this,a=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const r=Jc[n.type],s=ss[n.componentType],l=n.normalized===!0,c=new s(n.count*r);return Promise.resolve(new Mt(c,r,l))}const t=[];return n.bufferView!==void 0?t.push(this.getDependency("bufferView",n.bufferView)):t.push(null),n.sparse!==void 0&&(t.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(t).then(function(r){const s=r[0],l=Jc[n.type],c=ss[n.componentType],h=c.BYTES_PER_ELEMENT,d=h*l,f=n.byteOffset||0,p=n.bufferView!==void 0?a.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let b,v;if(p&&p!==d){const y=Math.floor(f/p),E="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+y+":"+n.count;let _=i.cache.get(E);_||(b=new c(s,y*p,n.count*p/h),_=new e0(b,p/h),i.cache.add(E,_)),v=new Co(_,l,f%p/h,m)}else s===null?b=new c(n.count*l):b=new c(s,f,n.count*l),v=new Mt(b,l,m);if(n.sparse!==void 0){const y=Jc.SCALAR,E=ss[n.sparse.indices.componentType],_=n.sparse.indices.byteOffset||0,C=n.sparse.values.byteOffset||0,x=new E(r[1],_,n.sparse.count*y),B=new c(r[2],C,n.sparse.count*l);s!==null&&(v=new Mt(v.array.slice(),v.itemSize,v.normalized)),v.normalized=!1;for(let I=0,k=x.length;I<k;I++){const P=x[I];if(v.setX(P,B[I*l]),l>=2&&v.setY(P,B[I*l+1]),l>=3&&v.setZ(P,B[I*l+2]),l>=4&&v.setW(P,B[I*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}v.normalized=m}return v})}loadTexture(e){const i=this.json,a=this.options,t=i.textures[e].source,r=i.images[t];let s=this.textureLoader;if(r.uri){const l=a.manager.getHandler(r.uri);l!==null&&(s=l)}return this.loadTextureImage(e,t,s)}loadTextureImage(e,i,a){const n=this,t=this.json,r=t.textures[e],s=t.images[i],l=(s.uri||s.bufferView)+":"+r.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(i,a).then(function(h){h.flipY=!1,h.name=r.name||s.name||"",h.name===""&&typeof s.uri=="string"&&s.uri.startsWith("data:image/")===!1&&(h.name=s.uri);const f=(t.samplers||{})[r.sampler]||{};return h.magFilter=If[f.magFilter]||bn,h.minFilter=If[f.minFilter]||xa,h.wrapS=Bf[f.wrapS]||ir,h.wrapT=Bf[f.wrapT]||ir,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==wn&&h.minFilter!==bn,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,i){const a=this,n=this.json,t=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const r=n.images[e],s=self.URL||self.webkitURL;let l=r.uri||"",c=!1;if(r.bufferView!==void 0)l=a.getDependency("bufferView",r.bufferView).then(function(d){c=!0;const f=new Blob([d],{type:r.mimeType});return l=s.createObjectURL(f),l});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(d){return new Promise(function(f,p){let m=f;i.isImageBitmapLoader===!0&&(m=function(b){const v=new ga(b);v.needsUpdate=!0,f(v)}),i.load(na.resolveURL(d,t.path),m,void 0,p)})}).then(function(d){return c===!0&&s.revokeObjectURL(l),mr(d,r),d.userData.mimeType=r.mimeType||Dw(r.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=h,h}assignTexture(e,i,a,n){const t=this;return this.getDependency("texture",a.index).then(function(r){if(!r)return null;if(a.texCoord!==void 0&&a.texCoord>0&&(r=r.clone(),r.channel=a.texCoord),t.extensions[Dt.KHR_TEXTURE_TRANSFORM]){const s=a.extensions!==void 0?a.extensions[Dt.KHR_TEXTURE_TRANSFORM]:void 0;if(s){const l=t.associations.get(r);r=t.extensions[Dt.KHR_TEXTURE_TRANSFORM].extendTexture(r,s),t.associations.set(r,l)}}return n!==void 0&&(r.colorSpace=n),e[i]=r,r})}assignFinalMaterial(e){const i=e.geometry;let a=e.material;const n=i.attributes.tangent===void 0,t=i.attributes.color!==void 0,r=i.attributes.normal===void 0;if(e.isPoints){const s="PointsMaterial:"+a.uuid;let l=this.cache.get(s);l||(l=new t0,jc.prototype.copy.call(l,a),l.color.copy(a.color),l.map=a.map,l.sizeAttenuation=!1,this.cache.add(s,l)),a=l}else if(e.isLine){const s="LineBasicMaterial:"+a.uuid;let l=this.cache.get(s);l||(l=new ia,jc.prototype.copy.call(l,a),l.color.copy(a.color),l.map=a.map,this.cache.add(s,l)),a=l}if(n||t||r){let s="ClonedMaterial:"+a.uuid+":";n&&(s+="derivative-tangents:"),t&&(s+="vertex-colors:"),r&&(s+="flat-shading:");let l=this.cache.get(s);l||(l=a.clone(),t&&(l.vertexColors=!0),r&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(s,l),this.associations.set(l,this.associations.get(a))),a=l}e.material=a}getMaterialType(){return Dp}loadMaterial(e){const i=this,a=this.json,n=this.extensions,t=a.materials[e];let r;const s={},l=t.extensions||{},c=[];if(l[Dt.KHR_MATERIALS_UNLIT]){const d=n[Dt.KHR_MATERIALS_UNLIT];r=d.getMaterialType(),c.push(d.extendParams(s,t,i))}else{const d=t.pbrMetallicRoughness||{};if(s.color=new Rt(1,1,1),s.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;s.color.setRGB(f[0],f[1],f[2],Yn),s.opacity=f[3]}d.baseColorTexture!==void 0&&c.push(i.assignTexture(s,"map",d.baseColorTexture,vi)),s.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,s.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(i.assignTexture(s,"metalnessMap",d.metallicRoughnessTexture)),c.push(i.assignTexture(s,"roughnessMap",d.metallicRoughnessTexture))),r=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,s)})))}t.doubleSided===!0&&(s.side=Oi);const h=t.alphaMode||Zc.OPAQUE;if(h===Zc.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,h===Zc.MASK&&(s.alphaTest=t.alphaCutoff!==void 0?t.alphaCutoff:.5)),t.normalTexture!==void 0&&r!==Tn&&(c.push(i.assignTexture(s,"normalMap",t.normalTexture)),s.normalScale=new lt(1,1),t.normalTexture.scale!==void 0)){const d=t.normalTexture.scale;s.normalScale.set(d,d)}if(t.occlusionTexture!==void 0&&r!==Tn&&(c.push(i.assignTexture(s,"aoMap",t.occlusionTexture)),t.occlusionTexture.strength!==void 0&&(s.aoMapIntensity=t.occlusionTexture.strength)),t.emissiveFactor!==void 0&&r!==Tn){const d=t.emissiveFactor;s.emissive=new Rt().setRGB(d[0],d[1],d[2],Yn)}return t.emissiveTexture!==void 0&&r!==Tn&&c.push(i.assignTexture(s,"emissiveMap",t.emissiveTexture,vi)),Promise.all(c).then(function(){const d=new r(s);return t.name&&(d.name=t.name),mr(d,t),i.associations.set(d,{materials:e}),t.extensions&&co(n,d,t),d})}createUniqueName(e){const i=n0.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){const i=this,a=this.extensions,n=this.primitiveCache;function t(s){return a[Dt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(s,i).then(function(l){return Sf(l,s,i)})}const r=[];for(let s=0,l=e.length;s<l;s++){const c=e[s],h=kw(c),d=n[h];if(d)r.push(d.promise);else{let f;c.extensions&&c.extensions[Dt.KHR_DRACO_MESH_COMPRESSION]?f=t(c):f=Sf(new hi,c,i),n[h]={primitive:c,promise:f},r.push(f)}}return Promise.all(r)}loadMesh(e){const i=this,a=this.json,n=this.extensions,t=a.meshes[e],r=t.primitives,s=[];for(let l=0,c=r.length;l<c;l++){const h=r[l].material===void 0?Iw(this.cache):this.getDependency("material",r[l].material);s.push(h)}return s.push(i.loadGeometries(r)),Promise.all(s).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],d=[];for(let p=0,m=h.length;p<m;p++){const b=h[p],v=r[p];let y;const E=c[p];if(v.mode===Ei.TRIANGLES||v.mode===Ei.TRIANGLE_STRIP||v.mode===Ei.TRIANGLE_FAN||v.mode===void 0)y=t.isSkinnedMesh===!0?new Tp(b,E):new Re(b,E),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),v.mode===Ei.TRIANGLE_STRIP?y.geometry=Ef(y.geometry,Sp):v.mode===Ei.TRIANGLE_FAN&&(y.geometry=Ef(y.geometry,Xu));else if(v.mode===Ei.LINES)y=new Mp(b,E);else if(v.mode===Ei.LINE_STRIP)y=new xi(b,E);else if(v.mode===Ei.LINE_LOOP)y=new i0(b,E);else if(v.mode===Ei.POINTS)y=new Pp(b,E);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&Sw(y,t),y.name=i.createUniqueName(t.name||"mesh_"+e),mr(y,t),v.extensions&&co(n,y,v),i.assignFinalMaterial(y),d.push(y)}for(let p=0,m=d.length;p<m;p++)i.associations.set(d[p],{meshes:e,primitives:p});if(d.length===1)return t.extensions&&co(n,d[0],t),d[0];const f=new pn;t.extensions&&co(n,f,t),i.associations.set(f,{meshes:e});for(let p=0,m=d.length;p<m;p++)f.add(d[p]);return f})}loadCamera(e){let i;const a=this.json.cameras[e],n=a[a.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return a.type==="perspective"?i=new Qp(rr.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):a.type==="orthographic"&&(i=new Ia(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),a.name&&(i.name=this.createUniqueName(a.name)),mr(i,a),Promise.resolve(i)}loadSkin(e){const i=this.json.skins[e],a=[];for(let n=0,t=i.joints.length;n<t;n++)a.push(this._loadNodeShallow(i.joints[n]));return i.inverseBindMatrices!==void 0?a.push(this.getDependency("accessor",i.inverseBindMatrices)):a.push(null),Promise.all(a).then(function(n){const t=n.pop(),r=n,s=[],l=[];for(let c=0,h=r.length;c<h;c++){const d=r[c];if(d){s.push(d);const f=new Lt;t!==null&&f.fromArray(t.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[c])}return new r0(s,l)})}loadAnimation(e){const i=this.json,a=this,n=i.animations[e],t=n.name?n.name:"animation_"+e,r=[],s=[],l=[],c=[],h=[];for(let d=0,f=n.channels.length;d<f;d++){const p=n.channels[d],m=n.samplers[p.sampler],b=p.target,v=b.node,y=n.parameters!==void 0?n.parameters[m.input]:m.input,E=n.parameters!==void 0?n.parameters[m.output]:m.output;b.node!==void 0&&(r.push(this.getDependency("node",v)),s.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",E)),c.push(m),h.push(b))}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(d){const f=d[0],p=d[1],m=d[2],b=d[3],v=d[4],y=[];for(let E=0,_=f.length;E<_;E++){const C=f[E],x=p[E],B=m[E],I=b[E],k=v[E];if(C===void 0)continue;C.updateMatrix&&C.updateMatrix();const P=a._createAnimationTracks(C,x,B,I,k);if(P)for(let D=0;D<P.length;D++)y.push(P[D])}return new o0(t,void 0,y)})}createNodeMesh(e){const i=this.json,a=this,n=i.nodes[e];return n.mesh===void 0?null:a.getDependency("mesh",n.mesh).then(function(t){const r=a._getNodeRef(a.meshCache,n.mesh,t);return n.weights!==void 0&&r.traverse(function(s){if(s.isMesh)for(let l=0,c=n.weights.length;l<c;l++)s.morphTargetInfluences[l]=n.weights[l]}),r})}loadNode(e){const i=this.json,a=this,n=i.nodes[e],t=a._loadNodeShallow(e),r=[],s=n.children||[];for(let c=0,h=s.length;c<h;c++)r.push(a.getDependency("node",s[c]));const l=n.skin===void 0?Promise.resolve(null):a.getDependency("skin",n.skin);return Promise.all([t,Promise.all(r),l]).then(function(c){const h=c[0],d=c[1],f=c[2];f!==null&&h.traverse(function(p){p.isSkinnedMesh&&p.bind(f,Tw)});for(let p=0,m=d.length;p<m;p++)h.add(d[p]);return h})}_loadNodeShallow(e){const i=this.json,a=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const t=i.nodes[e],r=t.name?n.createUniqueName(t.name):"",s=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&s.push(l),t.camera!==void 0&&s.push(n.getDependency("camera",t.camera).then(function(c){return n._getNodeRef(n.cameraCache,t.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){s.push(c)}),this.nodeCache[e]=Promise.all(s).then(function(c){let h;if(t.isBone===!0?h=new s0:c.length>1?h=new pn:c.length===1?h=c[0]:h=new Mi,h!==c[0])for(let d=0,f=c.length;d<f;d++)h.add(c[d]);if(t.name&&(h.userData.name=t.name,h.name=r),mr(h,t),t.extensions&&co(a,h,t),t.matrix!==void 0){const d=new Lt;d.fromArray(t.matrix),h.applyMatrix4(d)}else t.translation!==void 0&&h.position.fromArray(t.translation),t.rotation!==void 0&&h.quaternion.fromArray(t.rotation),t.scale!==void 0&&h.scale.fromArray(t.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const i=this.extensions,a=this.json.scenes[e],n=this,t=new pn;a.name&&(t.name=n.createUniqueName(a.name)),mr(t,a),a.extensions&&co(i,t,a);const r=a.nodes||[],s=[];for(let l=0,c=r.length;l<c;l++)s.push(n.getDependency("node",r[l]));return Promise.all(s).then(function(l){for(let h=0,d=l.length;h<d;h++)t.add(l[h]);const c=h=>{const d=new Map;for(const[f,p]of n.associations)(f instanceof jc||f instanceof ga)&&d.set(f,p);return h.traverse(f=>{const p=n.associations.get(f);p!=null&&d.set(f,p)}),d};return n.associations=c(t),t})}_createAnimationTracks(e,i,a,n,t){const r=[],s=e.name?e.name:e.uuid,l=[];Fr[t.path]===Fr.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(s);let c;switch(Fr[t.path]){case Fr.weights:c=gf;break;case Fr.rotation:c=mf;break;case Fr.translation:case Fr.scale:c=pf;break;default:switch(a.itemSize){case 1:c=gf;break;case 2:case 3:default:c=pf;break}break}const h=n.interpolation!==void 0?xw[n.interpolation]:Rp,d=this._getArrayFromAccessor(a);for(let f=0,p=l.length;f<p;f++){const m=new c(l[f]+"."+Fr[t.path],i.array,d,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),r.push(m)}return r}_getArrayFromAccessor(e){let i=e.array;if(e.normalized){const a=nh(i.constructor),n=new Float32Array(i.length);for(let t=0,r=i.length;t<r;t++)n[t]=i[t]*a;i=n}return i}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(a){const n=this instanceof mf?Ew:Xp;return new n(this.times,this.values,this.getValueSize()/3,a)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Pw(o,e,i){const a=e.attributes,n=new gn;if(a.POSITION!==void 0){const s=i.json.accessors[a.POSITION],l=s.min,c=s.max;if(l!==void 0&&c!==void 0){if(n.set(new ie(l[0],l[1],l[2]),new ie(c[0],c[1],c[2])),s.normalized){const h=nh(ss[s.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const t=e.targets;if(t!==void 0){const s=new ie,l=new ie;for(let c=0,h=t.length;c<h;c++){const d=t[c];if(d.POSITION!==void 0){const f=i.json.accessors[d.POSITION],p=f.min,m=f.max;if(p!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),f.normalized){const b=nh(ss[f.componentType]);l.multiplyScalar(b)}s.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(s)}o.boundingBox=n;const r=new Xr;n.getCenter(r.center),r.radius=n.min.distanceTo(n.max)/2,o.boundingSphere=r}function Sf(o,e,i){const a=e.attributes,n=[];function t(r,s){return i.getDependency("accessor",r).then(function(l){o.setAttribute(s,l)})}for(const r in a){const s=th[r]||r.toLowerCase();s in o.attributes||n.push(t(a[r],s))}if(e.indices!==void 0&&!o.index){const r=i.getDependency("accessor",e.indices).then(function(s){o.setIndex(s)});n.push(r)}return Ju.workingColorSpace!==Yn&&"COLOR_0"in a&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ju.workingColorSpace}" not supported.`),mr(o,e),Pw(o,e,i),Promise.all(n).then(function(){return e.targets!==void 0?Bw(o,e.targets,i):o})}const Qw=o=>{const e={nodes:{},materials:{}};return o&&o.traverse(i=>{i.name&&(e.nodes[i.name]=i),i.material&&!e.materials[i.material.name]&&(e.materials[i.material.name]=i.material)}),e};function Rw(o,e){const i=typeof o=="string"?e:o,a=Ca($0,{extend(r){i!=null&&i.dracoLoader&&r.setDRACOLoader(i.dracoLoader),i!=null&&i.meshoptDecoder&&r.setMeshoptDecoder(i.meshoptDecoder),i!=null&&i.ktx2Loader&&r.setKTX2Loader(i.ktx2Loader)}}),n=r=>a.load(r,{transform(s){return{...s,...Qw(s.scene)}}}),t=typeof o=="string"?o:void 0;return t?n(t):{load:n}}const eu=new WeakMap;class Uw extends Ea{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,a,n){const t=new tr(this.manager);t.setPath(this.path),t.setResponseType("arraybuffer"),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials),t.load(e,r=>{this.parse(r,i,n)},a,n)}parse(e,i,a=()=>{}){this.decodeDracoFile(e,i,null,null,vi,a).catch(a)}decodeDracoFile(e,i,a,n,t=Yn,r=()=>{}){const s={attributeIDs:a||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!a,vertexColorSpace:t};return this.decodeGeometry(e,s).then(i).catch(r)}decodeGeometry(e,i){const a=JSON.stringify(i);if(eu.has(e)){const l=eu.get(e);if(l.key===a)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const t=this.workerNextTaskID++,r=e.byteLength,s=this._getWorker(t,r).then(l=>(n=l,new Promise((c,h)=>{n._callbacks[t]={resolve:c,reject:h},n.postMessage({type:"decode",id:t,taskConfig:i,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return s.catch(()=>!0).then(()=>{n&&t&&this._releaseTask(n,t)}),eu.set(e,{key:a,promise:s}),s}_createGeometry(e){const i=new hi;e.index&&i.setIndex(new Mt(e.index.array,1));for(let a=0;a<e.attributes.length;a++){const n=e.attributes[a],t=n.name,r=n.array,s=n.itemSize,l=new Mt(r,s);t==="color"&&(this._assignVertexColorSpace(l,n.vertexColorSpace),l.normalized=!(r instanceof Float32Array)),i.setAttribute(t,l)}return i}_assignVertexColorSpace(e,i){if(i!==vi)return;const a=new Rt;for(let n=0,t=e.count;n<t;n++)a.fromBufferAttribute(e,n),Ju.toWorkingColorSpace(a,vi),e.setXYZ(n,a.r,a.g,a.b)}_loadLibrary(e,i){const a=new tr(this.manager);return a.setPath(this.decoderPath),a.setResponseType(i),a.setWithCredentials(this.withCredentials),new Promise((n,t)=>{a.load(e,n,void 0,t)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return e?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(a=>{const n=a[0];e||(this.decoderConfig.wasmBinary=a[1]);const t=Fw.toString(),r=["/* draco decoder */",n,"","/* worker */",t.substring(t.indexOf("{")+1,t.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(t){const r=t.data;switch(r.type){case"decode":n._callbacks[r.id].resolve(r);break;case"error":n._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,t){return n._taskLoad>t._taskLoad?-1:1});const a=this.workerPool[this.workerPool.length-1];return a._taskCosts[e]=i,a._taskLoad+=i,a})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Fw(){let o,e;onmessage=function(r){const s=r.data;switch(s.type){case"init":o=s.decoderConfig,e=new Promise(function(h){o.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(o)});break;case"decode":const l=s.buffer,c=s.taskConfig;e.then(h=>{const d=h.draco,f=new d.Decoder;try{const p=i(d,f,new Int8Array(l),c),m=p.attributes.map(b=>b.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:s.id,error:p.message})}finally{d.destroy(f)}});break}};function i(r,s,l,c){const h=c.attributeIDs,d=c.attributeTypes;let f,p;const m=s.GetEncodedGeometryType(l);if(m===r.TRIANGULAR_MESH)f=new r.Mesh,p=s.DecodeArrayToMesh(l,l.byteLength,f);else if(m===r.POINT_CLOUD)f=new r.PointCloud,p=s.DecodeArrayToPointCloud(l,l.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const b={index:null,attributes:[]};for(const v in h){const y=self[d[v]];let E,_;if(c.useUniqueIDs)_=h[v],E=s.GetAttributeByUniqueId(f,_);else{if(_=s.GetAttributeId(f,r[h[v]]),_===-1)continue;E=s.GetAttribute(f,_)}const C=n(r,s,f,v,y,E);v==="color"&&(C.vertexColorSpace=c.vertexColorSpace),b.attributes.push(C)}return m===r.TRIANGULAR_MESH&&(b.index=a(r,s,f)),r.destroy(f),b}function a(r,s,l){const h=l.num_faces()*3,d=h*4,f=r._malloc(d);s.GetTrianglesUInt32Array(l,d,f);const p=new Uint32Array(r.HEAPF32.buffer,f,h).slice();return r._free(f),{array:p,itemSize:1}}function n(r,s,l,c,h,d){const f=d.num_components(),m=l.num_points()*f,b=m*h.BYTES_PER_ELEMENT,v=t(r,h),y=r._malloc(b);s.GetAttributeDataArrayForAllPoints(l,d,v,b,y);const E=new h(r.HEAPF32.buffer,y,m).slice();return r._free(y),{name:c,array:E,itemSize:f}}function t(r,s){switch(s){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}const Lw="https://www.gstatic.com/draco/versioned/decoders/1.4.3/",kf={},H2=(o=Lw)=>{const e=kf[o];if(e)return e;const i=new Uw().setDecoderPath(o);return kf[o]=i,i};var Ow=function(){var o="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),a=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n=WebAssembly.validate(i)?e:o,t,r=WebAssembly.instantiate(s(n),{}).then(function(y){t=y.instance,t.exports.__wasm_call_ctors()});function s(y){for(var E=new Uint8Array(y.length),_=0;_<y.length;++_){var C=y.charCodeAt(_);E[_]=C>96?C-97:C>64?C-39:C+4}for(var x=0,_=0;_<y.length;++_)E[x++]=E[_]<60?a[E[_]]:(E[_]-60)*64+E[++_];return E.buffer.slice(0,x)}function l(y,E,_,C,x,B){var I=t.exports.sbrk,k=_+3&-4,P=I(k*C),D=I(x.length),U=new Uint8Array(t.exports.memory.buffer);U.set(x,D);var S=y(P,_,C,D,x.length);if(S==0&&B&&B(P,k,C),E.set(U.subarray(P,P+_*C)),I(P-I(0)),S!=0)throw new Error("Malformed buffer data: "+S)}var c={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],f=0;function p(y){var E={object:new Worker(y),pending:0,requests:{}};return E.object.onmessage=function(_){var C=_.data;E.pending-=C.count,E.requests[C.id][C.action](C.value),delete E.requests[C.id]},E}function m(y){for(var E="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(s(n))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+v.toString(),_=new Blob([E],{type:"text/javascript"}),C=URL.createObjectURL(_),x=0;x<y;++x)d[x]=p(C);URL.revokeObjectURL(C)}function b(y,E,_,C,x){for(var B=d[0],I=1;I<d.length;++I)d[I].pending<B.pending&&(B=d[I]);return new Promise(function(k,P){var D=new Uint8Array(_),U=f++;B.pending+=y,B.requests[U]={resolve:k,reject:P},B.object.postMessage({id:U,count:y,size:E,source:D,mode:C,filter:x},[D.buffer])})}function v(y){r.then(function(){var E=y.data;try{var _=new Uint8Array(E.count*E.size);l(t.exports[E.mode],_,E.count,E.size,E.source,t.exports[E.filter]),self.postMessage({id:E.id,count:E.count,action:"resolve",value:_},[_.buffer])}catch(C){self.postMessage({id:E.id,count:E.count,action:"reject",value:C})}})}return{ready:r,supported:!0,useWorkers:function(y){m(y)},decodeVertexBuffer:function(y,E,_,C,x){l(t.exports.meshopt_decodeVertexBuffer,y,E,_,C,t.exports[c[x]])},decodeIndexBuffer:function(y,E,_,C){l(t.exports.meshopt_decodeIndexBuffer,y,E,_,C)},decodeIndexSequence:function(y,E,_,C){l(t.exports.meshopt_decodeIndexSequence,y,E,_,C)},decodeGltfBuffer:function(y,E,_,C,x,B){l(t.exports[h[x]],y,E,_,C,t.exports[c[B]])},decodeGltfBufferAsync:function(y,E,_,C,x){return d.length>0?b(y,E,_,h[C],c[x]):r.then(function(){var B=new Uint8Array(y*E);return l(t.exports[h[C]],B,y,E,_,t.exports[c[x]]),B})}}}();const V2=()=>Ow;class Gw{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0,this.workerCreator=null}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const a=this.workersResolve[e];if(a&&a(i),this.queue.length){const{resolve:n,msg:t,transfer:r}=this.queue.shift();this.workersResolve[e]=n,this.workers[e].postMessage(t,r)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(a=>{const n=this._getIdleWorker();n!==-1?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=a,this.workers[n].postMessage(e,i)):this.queue.push({resolve:a,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Nw=0,Df=2,zw=1,Tf=2,Hw=0,Vw=1,jw=10,qw=0,Jp=9,Zp=15,$p=16,eg=22,tg=37,ng=43,ig=76,rg=83,og=97,sg=100,ag=103,lg=109,cg=165,ug=166,qh=1000066e3;class Ww{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Us{constructor(e,i,a,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+i,a),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const i=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,i}_skip(e){return this._offset+=e,this}_scan(e,i){i===void 0&&(i=0);const a=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==i&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+a,n)}}const ei=[171,75,84,88,32,50,48,187,13,10,26,10];function Mf(o){return new TextDecoder().decode(o)}function Kw(o){const e=new Uint8Array(o.buffer,o.byteOffset,ei.length);if(e[0]!==ei[0]||e[1]!==ei[1]||e[2]!==ei[2]||e[3]!==ei[3]||e[4]!==ei[4]||e[5]!==ei[5]||e[6]!==ei[6]||e[7]!==ei[7]||e[8]!==ei[8]||e[9]!==ei[9]||e[10]!==ei[10]||e[11]!==ei[11])throw new Error("Missing KTX 2.0 identifier.");const i=new Ww,a=17*Uint32Array.BYTES_PER_ELEMENT,n=new Us(o,ei.length,a,!0);i.vkFormat=n._nextUint32(),i.typeSize=n._nextUint32(),i.pixelWidth=n._nextUint32(),i.pixelHeight=n._nextUint32(),i.pixelDepth=n._nextUint32(),i.layerCount=n._nextUint32(),i.faceCount=n._nextUint32();const t=n._nextUint32();i.supercompressionScheme=n._nextUint32();const r=n._nextUint32(),s=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),h=n._nextUint64(),d=n._nextUint64(),f=new Us(o,ei.length+a,3*t*8,!0);for(let q=0;q<t;q++)i.levels.push({levelData:new Uint8Array(o.buffer,o.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const p=new Us(o,r,s,!0),m={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},b=(m.descriptorBlockSize/4-6)/4;for(let q=0;q<b;q++){const Z={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Z.channelType?(Z.sampleLower=p._nextInt32(),Z.sampleUpper=p._nextInt32()):(Z.sampleLower=p._nextUint32(),Z.sampleUpper=p._nextUint32()),m.samples[q]=Z}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(m);const v=new Us(o,l,c,!0);for(;v._offset<c;){const q=v._nextUint32(),Z=v._scan(q),Y=Mf(Z);if(i.keyValue[Y]=v._nextUint8Array(q-Z.byteLength-1),Y.match(/^ktx/i)){const j=Mf(i.keyValue[Y]);i.keyValue[Y]=j.substring(0,j.lastIndexOf("\0"))}v._skip(q%4?4-q%4:0)}if(d<=0)return i;const y=new Us(o,h,d,!0),E=y._nextUint16(),_=y._nextUint16(),C=y._nextUint32(),x=y._nextUint32(),B=y._nextUint32(),I=y._nextUint32(),k=[];for(let q=0;q<t;q++)k.push({imageFlags:y._nextUint32(),rgbSliceByteOffset:y._nextUint32(),rgbSliceByteLength:y._nextUint32(),alphaSliceByteOffset:y._nextUint32(),alphaSliceByteLength:y._nextUint32()});const P=h+y._offset,D=P+C,U=D+x,S=U+B,R=new Uint8Array(o.buffer,o.byteOffset+P,C),Q=new Uint8Array(o.buffer,o.byteOffset+D,x),O=new Uint8Array(o.buffer,o.byteOffset+U,B),G=new Uint8Array(o.buffer,o.byteOffset+S,I);return i.globalData={endpointCount:E,selectorCount:_,imageDescs:k,endpointsData:R,selectorsData:Q,tablesData:O,extendedData:G},i}let tu,pr,ih;const nu={env:{emscripten_notify_memory_growth:function(o){ih=new Uint8Array(pr.exports.memory.buffer)}}};class Yw{init(){return tu||(tu=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Pf).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,nu)).then(this._init):WebAssembly.instantiate(Buffer.from(Pf,"base64"),nu).then(this._init),tu)}_init(e){pr=e.instance,nu.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!pr)throw new Error("ZSTDDecoder: Await .init() before decoding.");const a=e.byteLength,n=pr.exports.malloc(a);ih.set(e,n),i=i||Number(pr.exports.ZSTD_findDecompressedSize(n,a));const t=pr.exports.malloc(i),r=pr.exports.ZSTD_decompress(t,i,n,a),s=ih.slice(t,t+r);return pr.exports.free(n),pr.exports.free(t),s}}const Pf="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Xw="display-p3",Jw="display-p3-linear",iu=new WeakMap;let ru=0,ou;class Ii extends Ea{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Gw,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new tr(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),a=new tr(this.manager);a.setPath(this.transcoderPath),a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials);const n=a.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,n]).then(([t,r])=>{const s=Ii.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Ii.EngineFormat),"let _EngineType = "+JSON.stringify(Ii.EngineType),"let _TranscoderFormat = "+JSON.stringify(Ii.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Ii.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=r,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),c})}),ru>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),ru++}return this.transcoderPending}load(e,i,a,n){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const t=new tr(this.manager);t.setResponseType("arraybuffer"),t.setWithCredentials(this.withCredentials),t.load(e,r=>{this.parse(r,i,n)},a,n)}parse(e,i,a){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(iu.has(e))return iu.get(e).promise.then(i).catch(a);this._createTexture(e).then(n=>i?i(n):null).catch(a)}_createTextureFrom(e,i){const{type:a,error:n,data:{faces:t,width:r,height:s,format:l,type:c,dfdFlags:h}}=e;if(a==="error")return Promise.reject(n);let d;if(i.faceCount===6)d=new f0(t,l,c);else{const f=t[0].mipmaps;d=i.layerCount>1?new A0(f,r,s,i.layerCount,l,c):new Up(f,r,s,l,c)}return d.minFilter=t[0].mipmaps.length===1?bn:xa,d.magFilter=bn,d.generateMipmaps=!1,d.needsUpdate=!0,d.colorSpace=hg(i),d.premultiplyAlpha=!!(h&zw),d}async _createTexture(e,i={}){const a=Kw(new Uint8Array(e)),n=a.vkFormat===qh&&a.dataFormatDescriptor[0].colorModel===167;if(!(a.vkFormat===qw||n&&!this.workerConfig.astcHDRSupported))return $w(a);const r=i,s=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e])).then(l=>this._createTextureFrom(l.data,a));return iu.set(e,{promise:s}),s}dispose(){this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),ru--}}Ii.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2};Ii.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25};Ii.EngineFormat={RGBAFormat:ni,RGBA_ASTC_4x4_Format:Fp,RGB_BPTC_UNSIGNED_Format:p0,RGBA_BPTC_Format:g0,RGBA_ETC2_EAC_Format:m0,RGBA_PVRTC_4BPPV1_Format:v0,RGBA_S3TC_DXT5_Format:b0,RGB_ETC1_Format:w0,RGB_ETC2_Format:y0,RGB_PVRTC_4BPPV1_Format:_0,RGBA_S3TC_DXT1_Format:C0};Ii.EngineType={UnsignedByteType:Ui,HalfFloatType:zn,FloatType:fn};Ii.BasisWorker=function(){let o,e,i;const a=_EngineFormat,n=_EngineType,t=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(m){const b=m.data;switch(b.type){case"init":o=b.config,s(b.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:v,buffers:y,width:E,height:_,hasAlpha:C,format:x,type:B,dfdFlags:I}=l(b.buffer);self.postMessage({type:"transcode",id:b.id,data:{faces:v,width:E,height:_,hasAlpha:C,format:x,type:B,dfdFlags:I}},y)}catch(v){console.error(v),self.postMessage({type:"error",id:b.id,error:v.message})}});break}});function s(m){e=new Promise(b=>{i={wasmBinary:m,onRuntimeInitialized:b},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(m){const b=new i.KTX2File(new Uint8Array(m));function v(){b.close(),b.delete()}if(!b.isValid())throw v(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let y;if(b.isUASTC())y=r.UASTC;else if(b.isETC1S())y=r.ETC1S;else if(b.isHDR())y=r.UASTC_HDR;else throw new Error("THREE.KTX2Loader: Unknown Basis encoding");const E=b.getWidth(),_=b.getHeight(),C=b.getLayers()||1,x=b.getLevels(),B=b.getFaces(),I=b.getHasAlpha(),k=b.getDFDFlags(),{transcoderFormat:P,engineFormat:D,engineType:U}=d(y,E,_,I);if(!E||!_||!x)throw v(),new Error("THREE.KTX2Loader:	Invalid texture");if(!b.startTranscoding())throw v(),new Error("THREE.KTX2Loader: .startTranscoding failed");const S=[],R=[];for(let Q=0;Q<B;Q++){const O=[];for(let G=0;G<x;G++){const q=[];let Z,Y;for(let L=0;L<C;L++){const N=b.getImageLevelInfo(G,L,Q);Q===0&&G===0&&L===0&&(N.origWidth%4!==0||N.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),x>1?(Z=N.origWidth,Y=N.origHeight):(Z=N.width,Y=N.height);let V=new Uint8Array(b.getImageTranscodedSizeInBytes(G,L,0,P));const J=b.transcodeImage(V,G,L,Q,P,0,-1,-1);if(U===n.HalfFloatType&&(V=new Uint16Array(V.buffer,V.byteOffset,V.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!J)throw v(),new Error("THREE.KTX2Loader: .transcodeImage failed.");q.push(V)}const j=p(q);O.push({data:j,width:Z,height:Y}),R.push(j.buffer)}S.push({mipmaps:O,width:E,height:_,format:D,type:U})}return v(),{faces:S,buffers:R,width:E,height:_,hasAlpha:I,dfdFlags:k,format:D,type:U}}const c=[{if:"astcSupported",basisFormat:[r.UASTC],transcoderFormat:[t.ASTC_4x4,t.ASTC_4x4],engineFormat:[a.RGBA_ASTC_4x4_Format,a.RGBA_ASTC_4x4_Format],engineType:[n.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[t.BC7_M5,t.BC7_M5],engineFormat:[a.RGBA_BPTC_Format,a.RGBA_BPTC_Format],engineType:[n.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[t.BC1,t.BC3],engineFormat:[a.RGBA_S3TC_DXT1_Format,a.RGBA_S3TC_DXT5_Format],engineType:[n.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[t.ETC1,t.ETC2],engineFormat:[a.RGB_ETC2_Format,a.RGBA_ETC2_EAC_Format],engineType:[n.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[t.ETC1],engineFormat:[a.RGB_ETC1_Format],engineType:[n.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[t.PVRTC1_4_RGB,t.PVRTC1_4_RGBA],engineFormat:[a.RGB_PVRTC_4BPPV1_Format,a.RGBA_PVRTC_4BPPV1_Format],engineType:[n.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[r.UASTC_HDR],transcoderFormat:[t.BC6H],engineFormat:[a.RGB_BPTC_UNSIGNED_Format],engineType:[n.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[t.RGBA32,t.RGBA32],engineFormat:[a.RGBAFormat,a.RGBAFormat],engineType:[n.UnsignedByteType,n.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[r.UASTC_HDR],transcoderFormat:[t.RGBA_HALF],engineFormat:[a.RGBAFormat],engineType:[n.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],h={[r.ETC1S]:c.filter(m=>m.basisFormat.includes(r.ETC1S)).sort((m,b)=>m.priorityUASTC-b.priorityUASTC),[r.UASTC]:c.filter(m=>m.basisFormat.includes(r.UASTC)).sort((m,b)=>m.priorityUASTC-b.priorityUASTC),[r.UASTC_HDR]:c.filter(m=>m.basisFormat.includes(r.UASTC_HDR)).sort((m,b)=>m.priorityHDR-b.priorityHDR)};function d(m,b,v,y){const E=h[m];for(let _=0;_<E.length;_++){const C=E[_];if(C.if&&!o[C.if]||!C.basisFormat.includes(m)||y&&C.transcoderFormat.length<2||C.needsPowerOfTwo&&!(f(b)&&f(v)))continue;const x=C.transcoderFormat[y?1:0],B=C.engineFormat[y?1:0],I=C.engineType[0];return{transcoderFormat:x,engineFormat:B,engineType:I}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}function f(m){return m<=2?!0:(m&m-1)===0&&m!==0}function p(m){if(m.length===1)return m[0];let b=0;for(let E=0;E<m.length;E++){const _=m[E];b+=_.byteLength}const v=new Uint8Array(b);let y=0;for(let E=0;E<m.length;E++){const _=m[E];v.set(_,y),y+=_.byteLength}return v}};const Zw=new Set([ni,es,Eo]),su={[lg]:ni,[og]:ni,[tg]:ni,[ng]:ni,[ag]:es,[rg]:es,[$p]:es,[eg]:es,[sg]:Eo,[ig]:Eo,[Zp]:Eo,[Jp]:Eo,[qh]:Fp,[ug]:vf,[cg]:vf},au={[lg]:fn,[og]:zn,[tg]:Ui,[ng]:Ui,[ag]:fn,[rg]:zn,[$p]:Ui,[eg]:Ui,[sg]:fn,[ig]:zn,[Zp]:Ui,[Jp]:Ui,[qh]:zn,[ug]:Ui,[cg]:Ui};async function $w(o){const{vkFormat:e}=o;if(su[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;o.supercompressionScheme===Df&&(ou||(ou=new Promise(async t=>{const r=new Yw;await r.init(),t(r)})),i=await ou);const a=[];for(let t=0;t<o.levels.length;t++){const r=Math.max(1,o.pixelWidth>>t),s=Math.max(1,o.pixelHeight>>t),l=o.pixelDepth?Math.max(1,o.pixelDepth>>t):0,c=o.levels[t];let h;if(o.supercompressionScheme===Nw)h=c.levelData;else if(o.supercompressionScheme===Df)h=i.decode(c.levelData,c.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let d;au[e]===fn?d=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):au[e]===zn?d=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):d=h,a.push({data:d,width:r,height:s,depth:l})}let n;if(Zw.has(su[e]))n=o.pixelDepth===0?new Kr(a[0].data,o.pixelWidth,o.pixelHeight):new E0(a[0].data,o.pixelWidth,o.pixelHeight,o.pixelDepth);else{if(o.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new Up(a,o.pixelWidth,o.pixelHeight),n.minFilter=a.length===1?bn:xa,n.magFilter=bn}return n.mipmaps=a,n.type=au[e],n.format=su[e],n.colorSpace=hg(o),n.needsUpdate=!0,Promise.resolve(n)}function hg(o){const e=o.dataFormatDescriptor[0];return e.colorPrimaries===Vw?e.transferFunction===Tf?vi:Yn:e.colorPrimaries===jw?e.transferFunction===Tf?Xw:Jw:e.colorPrimaries===Hw?Zu:(console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),Zu)}const Qf={},j2=o=>{const e=Qf[o];if(e)return e;const{renderer:i}=wt(),a=new Ii;return a.setTranscoderPath(o),a.detectSupport(i),Qf[o]=a,a},Rf=o=>!!(o!=null&&o.isObject3D),ey=o=>!!(o!=null&&o.subscribe)&&typeof o.subscribe=="function";function q2(o,e){const i=ey(o)?o:wr(void 0),a=ln(Rf(o)?o:Rf(e)?e:void 0),n=Nl([a,i],([c,h])=>c??(h==null?void 0:h.scene)),t=ln({}),r=new x0(void 0);ii([i,n],async([c,h])=>{if(!c||!c.animations.length||!h)return;await Kp();const d=c.animations.reduce((f,p)=>{const m=r.clipAction(p,h);return{...f,[p.name]:m}},{});return t.set(d),()=>{Object.values(d).forEach(f=>{const p=f;p.stop(),r.uncacheClip(p.getClip())})}});const{start:s,stop:l}=zt(c=>{r.update(c)},{autoStart:!1});return ii(t,c=>{Object.keys(c).length?s():l()}),{gltf:i,root:a,mixer:r,actions:t}}const uo=o=>({subscribe:o.subscribe,get current(){return o.current}});let aa=0;const Wh=ln(!1),ac=ln(!1),Kh=ln(void 0),Yh=ln(0),Xh=ln(0),dg=ln([]),Jh=ln(0),{onStart:lu,onLoad:cu,onError:uu}=Ba;Ba.onStart=(o,e,i)=>{lu==null||lu(o,e,i),ac.set(!0),Kh.set(o),Yh.set(e),Xh.set(i);const a=(e-aa)/(i-aa);Jh.set(a),a===1&&Wh.set(!0)};Ba.onLoad=()=>{cu==null||cu(),ac.set(!1)};Ba.onError=o=>{uu==null||uu(o),dg.update(e=>[...e,o])};Ba.onProgress=(o,e,i)=>{e===i&&(aa=i),ac.set(!0),Kh.set(o),Yh.set(e),Xh.set(i);const a=(e-aa)/(i-aa)||1;Jh.set(a),a===1&&Wh.set(!0)};const ty={active:uo(ac),item:uo(Kh),loaded:uo(Yh),total:uo(Xh),errors:uo(dg),progress:uo(Jh),finishedOnce:uo(Wh)},W2=()=>ty,fg=(o,e)=>{const i=Ca(ec,e),{renderer:a}=wt();return i.load(o,{...e,transform:n=>{var t;return n.colorSpace=a.outputColorSpace,n.needsUpdate=!0,((t=e==null?void 0:e.transform)==null?void 0:t.call(e,n))??n}})},K2=({depth:o=!1,size:e,...i}={})=>{const a=new Hl(1,1,i);if(e===void 0){const{dpr:n,size:t}=wt();ii([n,t],([r,{width:s,height:l}])=>{a.setSize(r*s,r*l)})}else{const n=Math.max(e.width??1,a.width),t=Math.max(e.height??1,a.height);a.setSize(n,t)}if(o===!0)a.depthTexture=new bf(a.width,a.height);else if(Nt(o,"DepthTexture"))a.depthTexture=o;else if(o!==!1){const n=Math.max(o.width??1,1),t=Math.max(o.height??1,1);a.depthTexture=new bf(n,t)}return di(()=>{a.dispose()}),a},Uf=["clusterBottom","clusterRight","clusterLeft","clusterTop","leftBumper","rightBumper","leftTrigger","rightTrigger","select","start","leftStickButton","rightStickButton","directionalTop","directionalBottom","directionalLeft","directionalRight","center"],Ff=["trigger","squeeze","touchpadButton","thumbstickButton","clusterBottom","clusterTop"],ny=["leftStick","rightStick"],iy=["touchpad","thumbstick"],sn=(o,e)=>{const i=(n,t)=>{if(!(e in o)||!(n in o[e]))return;const r=o[e][n].indexOf(t);r>-1&&o[e][n].splice(r,1)};return{pressed:!1,touched:!1,value:0,on:(n,t)=>{var r;return(r=o[e])[n]??(r[n]=[]),o[e][n].push(t),()=>i(n,t)},off:i}},jl=(o,e)=>{const i=(n,t)=>{if(!(e in o)||!(n in o[e]))return;const r=o[e][n].indexOf(t);r>-1&&o[e][n].splice(r,1)};return{x:0,y:0,on:(n,t)=>{var r;return(r=o[e])[n]??(r[n]=[]),o[e][n].push(t),()=>i(n,t)},off:i}},ry=(o,e)=>{const i=(n,t)=>{if(!o[n])return;const r=o[n].indexOf(t);r>-1&&o[n].splice(r,1)};return{on:(n,t)=>(o[n]??(o[n]=[]),o[n].push(t),()=>i(n,t)),off:i,connected:ln(!1),raw:null,trigger:sn(e,0),squeeze:sn(e,1),touchpadButton:sn(e,2),thumbstickButton:sn(e,3),clusterBottom:sn(e,4),clusterTop:sn(e,5),touchpad:jl(e,6),thumbstick:jl(e,7)}},oy=(o,e)=>{const i=(n,t)=>{if(!o[n])return;const r=o[n].indexOf(t);r>-1&&o[n].splice(r,1)};return{on:(n,t)=>(o[n]??(o[n]=[]),o[n].push(t),()=>i(n,t)),off:i,connected:ln(!1),raw:null,clusterBottom:sn(e,0),clusterRight:sn(e,1),clusterLeft:sn(e,2),clusterTop:sn(e,3),leftBumper:sn(e,4),rightBumper:sn(e,5),leftTrigger:sn(e,6),rightTrigger:sn(e,7),select:sn(e,8),start:sn(e,9),leftStickButton:sn(e,10),rightStickButton:sn(e,11),directionalTop:sn(e,12),directionalBottom:sn(e,13),directionalLeft:sn(e,14),directionalRight:sn(e,15),center:sn(e,16),leftStick:jl(e,17),rightStick:jl(e,18)}},Lf=(o,e,i,a,n)=>{var c,h,d,f,p,m,b,v,y,E,_,C,x,B;const t=e.touched,r=e.pressed,s=e.value;e.touched=(n==null?void 0:n.touched)??!1,e.pressed=(n==null?void 0:n.pressed)??!1;const l=e.value=(n==null?void 0:n.value)??0;!t&&e.touched?((c=i.touchstart)==null||c.forEach(I=>I({type:"touchstart",target:o,value:l})),(h=a.touchstart)==null||h.forEach(I=>I({type:"touchstart",target:o,value:l}))):t&&!e.touched&&((d=i.touch)==null||d.forEach(I=>I({type:"touch",target:o,value:l})),(f=a.touch)==null||f.forEach(I=>I({type:"touch",target:o,value:l})),(p=i.touchend)==null||p.forEach(I=>I({type:"touchend",target:o,value:l})),(m=a.touchend)==null||m.forEach(I=>I({type:"touchend",target:o,value:l}))),!r&&e.pressed?((b=i.down)==null||b.forEach(I=>I({type:"down",target:o,value:l})),(v=a.down)==null||v.forEach(I=>I({type:"down",target:o,value:l}))):r&&!e.pressed&&((y=i.press)==null||y.forEach(I=>I({type:"press",target:o,value:l})),(E=a.press)==null||E.forEach(I=>I({type:"press",target:o,value:l})),(_=i.up)==null||_.forEach(I=>I({type:"up",target:o,value:l})),(C=a.up)==null||C.forEach(I=>I({type:"up",target:o,value:l}))),s!==e.value&&((x=i.change)==null||x.forEach(I=>I({type:"change",target:o,value:l})),(B=a.change)==null||B.forEach(I=>I({type:"change",target:o,value:l})))},Ya=(o,e,i,a,n,t=0,r=0)=>{var d,f;const s=e.x,l=e.y,c=Math.abs(t)<n?0:t,h=Math.abs(r)<n?0:r;e.x=c,e.y=h,(s!==c||l!==h)&&((d=i.change)==null||d.forEach(p=>p({type:"change",target:o,value:{x:c,y:h}})),(f=a.change)==null||f.forEach(p=>p({type:"change",target:o,value:{x:c,y:h}})))};function Y2(o={}){const{axisDeadzone:e=.05}=o,i={},a=[];if("xr"in o){for(let f=0;f<Ff.length+iy.length;f+=1)a.push({});const n=ry(i,a),{xr:t}=wt().renderer,r=()=>{var f;(f=t.getSession())==null||f.inputSources.forEach(p=>{if(p.handedness!==o.hand)return;n.raw=p.gamepad??null;const{buttons:m=[],axes:b=[]}=n.raw??{};Ff.forEach((v,y)=>Lf(v,n[v],i,a[y],m[y])),Ya("touchpad",n.touchpad,i,a[6],e,b[0],b[1]),Ya("thumbstick",n.thumbstick,i,a[7],e,b[2],b[3])})},{start:s,stop:l}=zt(r,{autoStart:!1,autoInvalidate:!1}),c=f=>{if(f.data.handedness!==o.hand)return;const p=f.data.gamepad;p&&(n.raw=p,n.connected.set(!0),s())},h=f=>{f.data.handedness===o.hand&&(n.raw=null,n.connected.set(!1),l())},d=t.getSession();d&&d.inputSources.forEach(f=>{if(f.handedness!==o.hand)return;const p=f.gamepad;p&&(n.raw=p,n.connected.set(!0),s())});for(const f of[0,1]){const p=t.getController(f);p.addEventListener("connected",c),p.addEventListener("disconnected",h)}return di(()=>{for(const f of[0,1]){const p=t.getController(f);p.removeEventListener("connected",c),p.removeEventListener("disconnected",h)}}),n}else{for(let d=0;d<Uf.length+ny.length;d+=1)a.push({});const{index:n=0}=o,t=oy(i,a),r=()=>{const d=navigator.getGamepads()[n];t.raw=d;const{buttons:f=[],axes:p=[]}=d??{};Uf.forEach((m,b)=>Lf(m,t[m],i,a[b],f[b])),Ya("leftStick",t.leftStick,i,a[17],e,p[0],p[1]),Ya("rightStick",t.rightStick,i,a[18],e,p[2],p[3])},{start:s,stop:l}=zt(r,{autoStart:!1,autoInvalidate:!1}),c=d=>{var p;const{id:f}=d.gamepad;f===((p=t.raw)==null?void 0:p.id)&&(t.raw=null,t.connected.set(!1),l())},h=()=>{const d=navigator.getGamepads()[n];d&&(t.raw=d,t.connected.set(!0),s())};return h(),window.addEventListener("gamepadconnected",h),window.addEventListener("gamepaddisconnected",c),di(()=>{window.removeEventListener("gamepadconnected",h),window.removeEventListener("gamepaddisconnected",c)}),t}}const X2=(o=1,e=!1)=>({stencilRef:o,stencilWrite:!0,stencilFunc:e?I0:B0,stencilFail:qc,stencilZFail:qc,stencilZPass:qc}),Xa=new ie,Fs=new ie,Of=new ie,J2=o=>{const e=ln({width:0,height:0,factor:0,distance:0}),{camera:i,size:a,renderStage:n,scheduler:t}=wt(),r=(s,l,c)=>{e.update(h=>{const{width:d,height:f}=s;if(Array.isArray(o)?Xa.fromArray(o):o!==void 0&&Xa.copy(o),h.distance=c,Nt(l,"OrthographicCamera"))h.width=d/l.zoom,h.height=f/l.zoom,h.factor=1;else if(Nt(l,"PerspectiveCamera")){const p=l.fov*Math.PI/180,m=2*Math.tan(p/2)*c,b=m*(d/f);h.width=b,h.height=m,h.factor=d/b}return h})};return zt(()=>{if(i.current.getWorldPosition(Fs),!Fs.equals(Of)){const s=Fs.distanceTo(Xa);r(a.current,i.current,s),Of.copy(Fs)}},{autoInvalidate:!1,stage:t.createStage(Symbol("viewport-stage"),{before:n})}),ii([i,a],([s,l])=>{const c=s.getWorldPosition(Fs).distanceTo(Xa);r(l,s,c)}),e},Ja=new Xr,Gf=new Lt,Nf=new Lp,hu=new ie,Z2=function(o,e){if(this.geometry.boundingSphere===null&&this.geometry.computeBoundingSphere(),Ja.copy(this.geometry.boundingSphere??Ja),Ja.applyMatrix4(this.matrixWorld),!o.ray.intersectsSphere(Ja)||(Gf.copy(this.matrixWorld).invert(),Nf.copy(o.ray).applyMatrix4(Gf),this.geometry.boundingBox!==null&&Nf.intersectBox(this.geometry.boundingBox,hu)===null))return;const i=hu.distanceTo(o.ray.origin),a=hu.clone();e.push({distance:i,point:a,object:this})},lc=Symbol("THRELTE_SUSPENSE_CONTEXT_IDENTIFIER"),sy=o=>{const e=ln(new Set),i=ln(new Map),a=wr(!1),n=()=>{e.current.size===0&&i.current.size===0&&a.set(!0)},t=wr((o==null?void 0:o.final)??!1),r=p=>{e.update(m=>(m.add(p),m))},s=p=>{e.update(m=>(m.delete(p),m))},l=(p,m)=>{i.update(b=>(b.set(p,m),b))},c=p=>{i.update(m=>(m.delete(p),m))},h=Nl([e,i,t,a],([p,m,b,v])=>b&&v?!1:m.size>0?!0:p.size>0),d={suspend(p){r(p),p.catch(m=>{l(p,m)}).finally(()=>{s(p),n()})},onComponentDestroy(p){s(p),c(p),n()},suspended:h},f=Nl(i,p=>Array.from(p.values()));return Do(lc,d),{promises:e,suspended:h,errors:f,setFinal:p=>t.set(p??!1)}},Er=()=>{const o=Cr(lc),e=new Set,i=n=>(o&&(o.suspend(n),e.add(n)),n),a={suspended:Nl((o==null?void 0:o.suspended)??zb(!1),n=>n)};return di(()=>{if(o){for(const n of e)o.onComponentDestroy(n);e.clear()}}),Object.assign(i,a)};var ay=Hn("<!> <!>",1);function $2(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(I,"$parent",i);let t=z(e,"dataUrl",3,""),r=z(e,"animation",3,""),s=z(e,"loop",3,!0),l=z(e,"autoplay",3,!0),c=z(e,"fps",3,10),h=z(e,"filter",3,"nearest"),d=z(e,"alphaTest",3,.1),f=z(e,"delay",3,0),p=z(e,"transparent",3,!0),m=z(e,"flipX",3,!1),b=z(e,"startFrame",3,0),v=z(e,"endFrame",3,void 0),y=z(e,"rows",3,1),E=z(e,"columns",3,void 0),_=z(e,"totalFrames",3,0),C=z(e,"is",7),x=z(e,"ref",15),B=xt(e,["$$slots","$$events","$$legacy","textureUrl","dataUrl","animation","loop","autoplay","fps","filter","alphaTest","delay","transparent","flipX","startFrame","endFrame","rows","columns","totalFrames","is","ref","onload","onstart","onend","onloop"]);const I=or(),k=["forward","reverse"],P=he=>{const te=k.includes(he);return te||console.warn(`frame tag direction: "${he}" is not supported.${t()!=""?`
source dataURL: ${t()}`:`
texture URL: ${e.textureUrl}`}`),te};let D=0,U=b(),S=0,R=m()?-1:1,Q=0,O=0,G=Ti(void 0),q,Z=[],Y="forward",j,L={w:0,h:0},N=Qe(()=>1e3/c()),V=Qe(()=>n()!==void 0&&Nt(n(),"Mesh"));Ae(()=>{C(C()??(H(V)?new Tn:new tc))});const J=Er(),X=J(fg(e.textureUrl,{transform:he=>(he.matrixAutoUpdate=!1,he.generateMipmaps=!1,he.premultiplyAlpha=!1,he.wrapS=he.wrapT=ir,he.magFilter=he.minFilter=h()==="nearest"?wn:bn,he)})),$=J(t()?Ca(tr).load(t(),{transform:he=>{if(typeof he=="string")try{return JSON.parse(he)}catch{return}}}):Fh(new Promise(he=>{const te=X.subscribe(Ee=>{Ee&&(te(),he(ne(Ee)))})}))),ne=he=>{const{width:te,height:Ee}=he.image,pe=E()??_();S=_();const Ce=te/pe,ge=Ee/y(),Je={frames:{},meta:{app:"",image:"",format:"",frameTags:[],version:"1.0",size:{w:te,h:Ee},scale:1}};for(let de=0;de<S;de+=1){const xe=Math.floor(de/pe),Oe=de%pe*Ce,it=xe*ge;Je.frames[`${de}`]={frame:{x:Oe,y:it,w:Ce,h:ge},spriteSourceSize:{x:0,y:0,w:Ce,h:ge},sourceSize:{w:Ce,h:ge}}}return Je},se=he=>{var de,xe;const te=L.w/Q,Ee=L.h/O,pe=1/te,Ce=1/Ee,ge=R>0?pe*(he.x/Q):pe*(he.x/O)-H(G).repeat.x,Je=Math.abs(1-Ce)-Ce*(he.y/O);(de=H(G))==null||de.offset.set(ge,Je),(xe=H(G))==null||xe.updateMatrix()},_e=he=>{var te;q&&(j=q==null?void 0:q.meta.frameTags.find(Ee=>Ee.name===he),Y="forward",j!=null&&j.direction&&(Y=P(j==null?void 0:j.direction)?j.direction:"forward"),U=Y==="forward"?(j==null?void 0:j.from)??0:(j==null?void 0:j.to)??S-1,se(q.frames[Z[U]].frame),(te=e.onstart)==null||te.call(e))};let be=!1;const oe=async()=>{be=!0,await Promise.all([X,$]),be&&(D=performance.now()-f(),We())},ue=()=>{be=!1,Te()},{start:We,stop:Te}=zt(()=>{var xe,Ie;if(!q)return;const he=performance.now(),te=he-D,Ee=Z[U],{frame:pe,duration:Ce}=q.frames[Ee],ge=Ce??H(N);if(te<=ge)return;D=he-te%ge;const Je=Y==="forward"?(j==null?void 0:j.from)??b()??0:(j==null?void 0:j.to)??v()??S-1,de=Y==="forward"?(j==null?void 0:j.to)??v()??S-1:(j==null?void 0:j.from)??b()??0;switch(se(pe),Y){case"forward":U+=1;break;case"reverse":U-=1;break}(Y==="forward"&&U>de||Y==="reverse"&&U<de)&&(U=Je,s()?(xe=e.onloop)==null||xe.call(e):(ue(),(Ie=e.onend)==null||Ie.call(e)))},{autoStart:!1});ii([X,$],([he,te])=>{var pe;if(he===void 0||te===void 0)return;rn(G,er(he.clone())),q=te,Z=Object.keys(q.frames),S=Z.length,L=q.meta.size;const{sourceSize:Ee}=Object.values(q.frames)[0];Q=Ee.w,O=Ee.h,H(G).repeat.set(1*R/(L.w/Q),1/(L.h/O)),_e(r()),(pe=e.onload)==null||pe.call(e),l()&&oe()}),Ae(()=>{_e(r()),l()&&oe()});var Se=tt(),Be=ze(Se);{var Ue=he=>{var te=ay(),Ee=ze(te);qe(Ee,yt({get is(){return C()},get map(){return H(G)},toneMapped:!1,side:Oi,shadowSide:Oi,get transparent(){return p()},get alphaTest(){return d()}},()=>B,{get ref(){return x()},set ref(Ce){x(Ce)}}));var pe=In(Ee,2);bi(pe,()=>qe.MeshDepthMaterial,(Ce,ge)=>{ge(Ce,{attach:"customDepthMaterial",depthPacking:nc,get map(){return H(G)},get alphaTest(){return d()}})}),Le(he,te)},ke=he=>{var te=tt(),Ee=ze(te);{var pe=Ce=>{qe(Ce,yt({get is(){return C()},get map(){return H(G)},toneMapped:!1,get transparent(){return p()},get alphaTest(){return d()}},()=>B,{get ref(){return x()},set ref(ge){x(ge)}}))};En(Ee,Ce=>{H(G)&&Ce(pe)},!0)}Le(he,te)};En(Be,he=>{H(G)&&H(V)?he(Ue):he(ke,!1)})}Le(o,Se);var He=at({play:oe,pause:ue});return a(),He}var ly=Hn("<!> <!> <!>",1);function eB(o,e){st(e,!0);let i=z(e,"thresholdAngle",3,1),a=z(e,"color",3,"#ffffff"),n=z(e,"ref",15),t=xt(e,["$$slots","$$events","$$legacy","thresholdAngle","color","ref","children"]);const r=Jl(or()),s=Qe(()=>{if(!Nt(r.current,"Mesh"))throw new Error("Edges: component must be a child of a Mesh");return r.current.geometry}),l=new Mp;qe(o,yt({is:l},()=>t,{get ref(){return n()},set ref(c){n(c)},children:(c,h)=>{var d=ly(),f=ze(d),p=Qe(()=>[H(s),i()]);bi(f,()=>qe.EdgesGeometry,(v,y)=>{y(v,{get args(){return H(p)}})});var m=In(f,2);bi(m,()=>qe.LineBasicMaterial,(v,y)=>{y(v,{get color(){return a()}})});var b=In(m,2);ut(b,()=>e.children??ht,()=>({ref:l})),Le(c,d)},$$slots:{default:!0}})),at()}const cy=`
#include <common>
#include <logdepthbuf_pars_vertex>
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    #include <logdepthbuf_vertex>
}`,zf=`
#include <logdepthbuf_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4(0.0,0.0,0.0,0.0);
}`,uy=`
#include <common>
#include <logdepthbuf_pars_vertex>

void main() {
  vec2 center = vec2(0., 1.);
  float rotation = 0.0;
  
  // This is somewhat arbitrary, but it seems to work well
  // Need to figure out how to derive this dynamically if it even matters
  float size = 0.03;

  vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  vec2 scale = vec2(
    length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) ),
    length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) )
  );

  bool isPerspective = isPerspectiveMatrix( projectionMatrix );
  if ( isPerspective ) scale *= - mvPosition.z;

  vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
  rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
  mvPosition.xy += rotatedPosition;

  gl_Position = projectionMatrix * mvPosition;
  #include <logdepthbuf_vertex>
}`,So=new ie,cc=new ie,hy=new ie,dy=new lt,fy=(o,e,i)=>{const a=So.setFromMatrixPosition(o.matrixWorld);a.project(e);const n=i.width/2,t=i.height/2;return[a.x*n+n,-(a.y*t)+t]},Ay=(o,e)=>{const i=So.setFromMatrixPosition(o.matrixWorld),a=cc.setFromMatrixPosition(e.matrixWorld),n=i.sub(a),t=e.getWorldDirection(hy);return n.angleTo(t)>Math.PI/2},py=(o,e,i,a)=>{const n=So.setFromMatrixPosition(o.matrixWorld),t=cc.copy(So);t.project(e),i.setFromCamera(dy.set(t.x,t.y),e);const r=i.intersectObjects(a,!0);if(r.length){const s=r[0].distance;return n.distanceTo(i.ray.origin)<s}return!0},gy=(o,e)=>{if(Nt(e,"OrthographicCamera"))return e.zoom;if(Nt(e,"PerspectiveCamera")){const i=So.setFromMatrixPosition(o.matrixWorld),a=cc.setFromMatrixPosition(e.matrixWorld),n=e.fov*Math.PI/180,t=i.distanceTo(a);return 1/(2*Math.tan(n/2)*t)}else return 1},my=(o,e,i)=>{const a=So.setFromMatrixPosition(o.matrixWorld),n=cc.setFromMatrixPosition(e.matrixWorld),t=a.distanceTo(n),r=(i[1]-i[0])/(e.far-e.near),s=i[1]-r*e.far;return Math.round(r*t+s)},Dn=o=>Math.abs(o)<1e-10?0:o,Ag=(o,e,i="")=>{const{elements:a}=o;return`${i}matrix3d(
    ${Dn(e[0]*a[0])},${Dn(e[1]*a[1])},${Dn(e[2]*a[2])},${Dn(e[3]*a[3])},
    ${Dn(e[4]*a[4])},${Dn(e[5]*a[5])},${Dn(e[6]*a[6])},${Dn(e[7]*a[7])},
    ${Dn(e[8]*a[8])},${Dn(e[9]*a[9])},${Dn(e[10]*a[10])},${Dn(e[11]*a[11])},
    ${Dn(e[12]*a[12])},${Dn(e[13]*a[13])},${Dn(e[14]*a[14])},${Dn(e[15]*a[15])}
  )`},vy=(o=>e=>Ag(e,o))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),by=(o=>(e,i)=>Ag(e,o(i),"translate(-50%,-50%)"))(o=>[1/o,1/o,1/o,1,-1/o,-1/o,-1/o,-1,1/o,1/o,1/o,1,1,1,1,1]),wy=(o,e,i)=>{if(Nt(o,"OrthographicCamera"))return 1;if(Nt(o,"PerspectiveCamera")){const{width:a,height:n}=i,t=o.getWorldPosition(So).distanceTo(e),r=o.fov*Math.PI/180,l=2*Math.tan(r/2)*t*(a/n);return a/l}throw new Error("getViewportFactor needs a Perspective or Orthographic Camera")};let Za=!1,ql=0,Hf="",Vf="",jf="";const qf=(o,e)=>{ql===1&&!Za?(Hf=o.style.zIndex,Vf=o.style.position,jf=o.style.pointerEvents,o.style.zIndex=`${Math.floor(e/2)}`,o.style.position="absolute",o.style.pointerEvents="none",Za=!0):ql===0&&Za&&(o.style.zIndex=Hf,o.style.position=Vf,o.style.pointerEvents=jf,Za=!1)};var yy=Hn("<!> <!>",1),_y=Hn("<div><div><div><!></div></div></div>"),Cy=Hn("<div><!></div>"),Ey=Hn("<!> <!>",1);function tB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(P,"$size",i),t=()=>cn(I,"$camera",i),r=()=>cn(Se,"$suspended",i);let s=z(e,"autoRender",3,!0),l=z(e,"eps",3,.001),c=z(e,"center",3,!1),h=z(e,"fullscreen",3,!1),d=z(e,"sprite",3,!1),f=z(e,"transform",3,!1),p=z(e,"occlude",3,!1),m=z(e,"castShadow",3,!1),b=z(e,"receiveShadow",3,!1),v=z(e,"zIndexRange",19,()=>[16777271,0]),y=z(e,"calculatePosition",3,fy),E=z(e,"as",3,"div"),_=z(e,"pointerEvents",3,"auto"),C=z(e,"ref",15),x=z(e,"visible",15),B=xt(e,["$$slots","$$events","$$legacy","autoRender","eps","center","fullscreen","portal","distanceFactor","sprite","transform","occlude","castShadow","receiveShadow","material","geometry","zIndexRange","calculatePosition","as","wrapperClass","pointerEvents","ref","visible","children"]);x(!0);const{camera:I,scene:k,size:P,dom:D,canvas:U,renderStage:S}=wt(),R=new pn;let Q=document.createElement(E()),O=0,G=[0,0],q=Ti(void 0),Z=Ti(void 0),Y=!1;const j=new Re,L=new ic;let N=Qe(()=>p()&&p()!=="blending"||Array.isArray(p())&&p().length>0),V=new Lt,J=Qe(()=>n().width),X=Qe(()=>n().height),$=Qe(()=>H(J)/2),ne=Qe(()=>H(X)/2),se=Qe(()=>t().projectionMatrix.elements[5]*H(ne)),_e=Qe(()=>wy(t(),new ie,n()));Ae(()=>{e.wrapperClass&&(Q.className=e.wrapperClass)}),Ae(()=>(p()==="blending"&&(ql+=1,qf(U,v()[0])),()=>{ql-=1,qf(U,v()[0])}));const be=()=>{I.current.updateMatrixWorld(),R.updateWorldMatrix(!0,!1);const he=f()?G:y()(R,I.current,n());if(f()||Math.abs(O-I.current.zoom)>l()||Math.abs(G[0]-he[0])>l()||Math.abs(G[1]-he[1])>l()){const te=Ay(R,I.current);let Ee=!1;H(N)&&(Array.isArray(p())?Ee=p():p()!=="blending"&&(Ee=[k]));const pe=x();if(Ee){const Je=py(R,I.current,L,Ee);x(Je&&!te)}else x(!te);pe!==x()&&(e.onvisibilitychange?e.onvisibilitychange(x()):Q.style.display=x()?"block":"none");const Ce=Math.floor(v()[0]/2),ge=p()?H(N)?[v()[0],Ce]:[Ce-1,0]:v();if(Q.style.zIndex=`${my(R,I.current,ge)}`,f()&&H(q)&&H(Z)){const{isOrthographicCamera:Je,top:de,left:xe,bottom:Ie,right:Oe}=I.current,it=vy(I.current.matrixWorldInverse),pt=Je?`scale(${H(se)})translate(${Dn(-(Oe+xe)/2)}px,${Dn((de+Ie)/2)}px)`:`translateZ(${H(se)}px)`;d()?(V.copy(I.current.matrixWorldInverse).transpose().copyPosition(V).scale(R.scale),V.elements[3]=V.elements[7]=V.elements[11]=0,V.elements[15]=1):V.copy(R.matrixWorld),Q.style.width=`${H(J)}px`,Q.style.height=`${H(X)}px`,Q.style.perspective=Je?"":`${H(se)}px`,H(q).style.transform=`${pt}${it}translate(${H($)}px,${H(ne)}px)`,H(Z).style.transform=by(V,1/((e.distanceFactor||10)/400))}else{const Je=e.distanceFactor===void 0?1:gy(R,I.current)*e.distanceFactor;Q.style.transform=`translate3d(${he[0]}px,${he[1]}px,0) scale(${Je})`}G=he,O=I.current.zoom}if(!H(N)&&!Y)if(f()&&H(q)){const te=H(q).children[0];if(te!=null&&te.clientWidth&&(te!=null&&te.clientHeight)){const{isOrthographicCamera:Ee}=I.current;if(Ee||e.geometry){const{scale:pe}=B;pe&&(Array.isArray(pe)?j.scale.set(1/pe[0],1/pe[1],1/pe[2]):j.scale.setScalar(1/pe))}else{const pe=(e.distanceFactor??10)/400,Ce=te.clientWidth*pe,ge=te.clientHeight*pe;j.scale.set(Ce,ge,1)}Y=!0}}else{const te=Q.children[0];if(te!=null&&te.clientWidth&&(te!=null&&te.clientHeight)){const Ee=1/H(_e),pe=te.clientWidth*Ee,Ce=te.clientHeight*Ee;j.scale.set(pe,Ce,1),Y=!0}j.lookAt(I.current.position)}},{start:oe,stop:ue}=zt(be,{autoStart:!1,autoInvalidate:!1,stage:S});Et(()=>{if(s())return oe(),()=>{ue()}});let We=Qe(()=>(k.updateMatrixWorld(),y()(R,t(),n())));const Te=he=>{const te=e.portal??D;if(!te){console.warn("<HTML>: target is undefined.");return}return te.append(he),{destroy:()=>he.remove()}},{suspended:Se}=Er();var Be=Ey(),Ue=ze(Be);qe(Ue,yt({is:R},()=>B,{get ref(){return C()},set ref(he){C(he)},children:(he,te)=>{var Ee=tt(),pe=ze(Ee);{var Ce=ge=>{qe(ge,{is:j,get castShadow(){return m()},get receiveShadow(){return b()},children:(Je,de)=>{var xe=yy(),Ie=ze(xe);{var Oe=we=>{qe(we,{get is(){return e.geometry}})},it=we=>{var ot=tt(),$e=ze(ot);bi($e,()=>qe.PlaneGeometry,(dt,gt)=>{gt(dt,{})}),Le(we,ot)};En(Ie,we=>{e.geometry?we(Oe):we(it,!1)})}var pt=In(Ie,2);{var Pe=we=>{qe(we,{get is(){return e.material}})},Ze=we=>{var ot=tt(),$e=ze(ot);{var dt=ce=>{var Ke=tt(),un=ze(Ke);bi(un,()=>qe.ShaderMaterial,(et,Ge)=>{Ge(et,{side:Oi,vertexShader:uy,fragmentShader:zf})}),Le(ce,Ke)},gt=ce=>{var Ke=tt(),un=ze(Ke);bi(un,()=>qe.ShaderMaterial,(et,Ge)=>{Ge(et,{side:Oi,vertexShader:cy,fragmentShader:zf})}),Le(ce,Ke)};En($e,ce=>{f()?ce(gt,!1):ce(dt)},!0)}Le(we,ot)};En(pt,we=>{e.material?we(Pe):we(Ze,!1)})}Le(Je,xe)},$$slots:{default:!0}})};En(pe,ge=>{p()&&!H(N)&&ge(Ce)})}Le(he,Ee)},$$slots:{default:!0}}));var ke=In(Ue,2);Y0(ke,E,!1,(he,te)=>{X0(he,Je=>Te==null?void 0:Te(Je)),Xc(he,Je=>Q=Je,()=>Q),on(he,"position","absolute"),on(he,"top","0"),on(he,"left","0"),Yc(()=>{on(he,"pointer-events",f()?"none":void 0),on(he,"overflow",f()?"hidden":void 0),on(he,"transform",f()?void 0:`translate3d(${H(We)[0]}px,${H(We)[1]}px,0)`),on(he,"transform-origin",f()?void 0:"0 0"),on(he,"display",r()?"none":void 0)});var Ee=tt(),pe=ze(Ee);{var Ce=Je=>{var de=_y();on(de,"position","absolute"),on(de,"top","0"),on(de,"left","0"),on(de,"transform-style","preserve-3d"),on(de,"pointer-events","none");var xe=Wa(de);on(xe,"position","absolute");var Ie=Wa(xe),Oe=Wa(Ie);ut(Oe,()=>e.children??ht,()=>({render:be,startRendering:oe,stopRendering:ue})),Ka(Ie),Ka(xe),Xc(xe,it=>rn(Z,it),()=>H(Z)),Ka(de),Xc(de,it=>rn(q,it),()=>H(q)),Yc(()=>{on(de,"width",`${H(J)}px`),on(de,"height",`${H(X)}px`),on(xe,"pointer-events",_()),Cf(Ie,yf(e.class)),_f(Ie,"style",e.style)}),Le(Je,de)},ge=Je=>{var de=Cy(),xe=Wa(de);ut(xe,()=>e.children??ht,()=>({render:be,startRendering:oe,stopRendering:ue})),Ka(de),Yc(()=>{_f(de,"style",e.style),Cf(de,yf(e.class)),on(de,"position","absolute"),on(de,"transform",c()?"translate3d(-50%,-50%,0)":"none"),on(de,"top",h()?`${-H(X)/2}px`:void 0),on(de,"left",h()?`${-H(J)/2}px`:void 0),on(de,"width",h()?`${H(J)}px`:void 0),on(de,"height",h()?`${H(X)}px`:void 0)}),Le(Je,de)};En(pe,Je=>{f()?Je(Ce):Je(ge,!1)})}Le(te,Ee)}),Le(o,Be);var He=at({render:be,startRendering:oe,stopRendering:ue});return a(),He}function nB(o,e){st(e,!0);const{renderStage:i,renderer:a,toneMapping:n}=wt();let t=z(e,"autoRender",3,!0),r=z(e,"stage",3,i),s=z(e,"ref",15),l=xt(e,["$$slots","$$events","$$legacy","autoRender","toneMapping","stage","ref","children"]);const{scene:c}=Lh(),{camera:h}=Ip(),d=Symbol("threlte-hud-render-stage");Ae(()=>{if(t())return r().createTask(d,()=>{const{autoClear:f}=a;a.autoClear=!1,a.toneMapping=e.toneMapping??n.current,a.clearDepth(),a.render(c,h.current),a.autoClear=f,a.toneMapping=n.current}),()=>r().removeTask(d)}),qe(o,yt({is:c,attach:!1},()=>l,{get ref(){return s()},set ref(f){s(f)},children:(f,p)=>{var m=tt(),b=ze(m);ut(b,()=>e.children??ht,()=>({ref:c})),Le(f,m)},$$slots:{default:!0}})),at()}function iB(o,e){st(e,!0);let i=z(e,"speed",3,1),a=z(e,"floatIntensity",3,1),n=z(e,"floatingRange",19,()=>[-.1,.1]),t=z(e,"rotationSpeed",3,0),r=z(e,"rotationIntensity",3,0),s=z(e,"seed",19,()=>1e4*Math.random()),l=z(e,"ref",15),c=xt(e,["$$slots","$$events","$$legacy","speed","floatIntensity","floatingRange","rotationSpeed","rotationIntensity","seed","ref","children"]);const h=new pn,d=new pn;let f=s();const p=rr.mapLinear;let m=Qe(()=>Array.isArray(i())?i():[i(),i(),i()]),b=Qe(()=>Array.isArray(a())?a():[a(),a(),a()]),v=Qe(()=>n().length===3?n():[[0,0],n(),[0,0]]),y=Qe(()=>Array.isArray(t())?t():[t(),t(),t()]),E=Qe(()=>Array.isArray(r())?r():[r(),r(),r()]);zt(_=>{f+=_,d.position.x=p(Math.sin(f/4*H(m)[0])/10,-.1,.1,...H(v)[0])*H(b)[0],d.position.y=p(Math.sin(f/4*H(m)[1])/10,-.1,.1,...H(v)[1])*H(b)[1],d.position.z=p(Math.sin(f/4*H(m)[2])/10,-.1,.1,...H(v)[2])*H(b)[2],d.rotation.x=Math.cos(f/4*H(y)[0])/8*H(E)[0],d.rotation.y=Math.sin(f/4*H(y)[1])/8*H(E)[1],d.rotation.z=Math.sin(f/4*H(y)[2])/20*H(E)[2],d.updateMatrix()}),qe(o,yt({is:h},()=>c,{get ref(){return l()},set ref(_){l(_)},children:(_,C)=>{qe(_,{is:d,matrixAutoUpdate:!1,children:(x,B)=>{var I=tt(),k=ze(I);ut(k,()=>e.children??ht,()=>({ref:d})),Le(x,I)},$$slots:{default:!0}})},$$slots:{default:!0}})),at()}function rB(o,e){st(e,!0);let i=z(e,"gltf",15),a=z(e,"scene",15),n=z(e,"animations",15),t=z(e,"asset",15),r=z(e,"cameras",15),s=z(e,"scenes",15),l=z(e,"userData",15),c=z(e,"parser",15),h=z(e,"materials",15),d=z(e,"nodes",15),f=xt(e,["$$slots","$$events","$$legacy","url","dracoLoader","meshoptDecoder","ktx2Loader","gltf","scene","animations","asset","cameras","scenes","userData","parser","materials","nodes","onload","onunload","onerror","children"]);const p=Rw({dracoLoader:e.dracoLoader,meshoptDecoder:e.meshoptDecoder,ktx2Loader:e.ktx2Loader}),m=x=>{var B,I;i()&&((B=e.onunload)==null||B.call(e)),i(x),a(x.scene),n(x.animations),t(x.asset),r(x.cameras),s(x.scenes),l(x.userData),c(x.parser),h(x.materials),d(x.nodes),(I=e.onload)==null||I.call(e,i())},b=x=>{var B;i(void 0),a(void 0),n(void 0),t(void 0),r(void 0),s(void 0),l(void 0),c(void 0),d(void 0),h(void 0),(B=e.onerror)==null||B.call(e,x)},v=Er(),y=async x=>{try{const B=await v(p.load(x));m(B)}catch(B){b(B)}};Ae(()=>{y(e.url)});var E=tt(),_=ze(E);{var C=x=>{qe(x,yt({get is(){return a()}},()=>f,{children:(B,I)=>{var k=tt(),P=ze(k);ut(P,()=>e.children??ht,()=>({ref:a()})),Le(B,k)},$$slots:{default:!0}}))};En(_,x=>{a()&&x(C)})}Le(o,E),at()}var xy=Object.defineProperty,Iy=(o,e,i)=>e in o?xy(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i,Gt=(o,e,i)=>Iy(o,typeof e!="symbol"?e+"":e,i);const pg=(o,e)=>{const[i,a]=e.split("-");return Object.assign(o.style,{left:a==="left"?"0":a==="center"?"50%":"",right:a==="right"?"0":"",top:i==="top"?"0":i==="bottom"?"":"50%",bottom:i==="bottom"?"0":"",transform:`${a==="center"?"translateX(-50%)":""} ${i==="center"?"translateY(-50%)":""}`}),e},By=({placement:o,size:e,offset:i,id:a,className:n})=>{const t=document.createElement("div"),{top:r,left:s,right:l,bottom:c}=i;return Object.assign(t.style,{id:a,position:"absolute",zIndex:"1000",height:`${e}px`,width:`${e}px`,margin:`${r}px ${l}px ${c}px ${s}px`,borderRadius:"100%"}),pg(t,o),a&&(t.id=a),n&&(t.className=n),t},Sy=o=>{const e=typeof o=="string"?document.querySelector(o):o;if(!e)throw Error("Invalid DOM element");return e};function rh(o,e,i){return Math.max(e,Math.min(i,o))}const ky=[["x",0,3],["y",1,4],["z",2,5]],Wf=new ie;function Kf({isSphere:o},e,i){o&&(Wf.set(0,0,1).applyQuaternion(i.quaternion),ky.forEach(([a,n,t])=>{const r=Wf[a];let s=e[n],l=s.userData.opacity;s.material.opacity=rh(r>=0?l:l/2,0,1),s=e[t],l=s.userData.opacity,s.material.opacity=rh(r>=0?l/2:l,0,1)}))}const Dy=(o,e,i=10)=>Math.abs(o.clientX-e.x)<i&&Math.abs(o.clientY-e.y)<i,Yf=new ic,Xf=new lt,Jf=(o,e,i,a)=>{Xf.set((o.clientX-e.left)/e.width*2-1,-((o.clientY-e.top)/e.height)*2+1),Yf.setFromCamera(Xf,i);const n=Yf.intersectObjects(a,!1),t=n.length?n[0]:null;return!t||!t.object.visible?null:t},du=1e-6,Ty=2*Math.PI,gg=["x","y","z"],va=[...gg,"nx","ny","nz"],My=["x","z","y","nx","nz","ny"],Py=["z","x","y","nz","nx","ny"],oh="Right",Ml="Top",sh="Front",ah="Left",Pl="Bottom",lh="Back",Qy=[oh,Ml,sh,ah,Pl,lh].map(o=>o.toLocaleLowerCase()),mg=1.3,Zf=(o,e=!0)=>{const{material:i,userData:a}=o,{color:n,opacity:t}=e?a.hover:a;i.color.set(n),i.opacity=t},ho=o=>JSON.parse(JSON.stringify(o)),Ry=o=>{const e=o.type||"sphere",i=e==="sphere",a=o.resolution||i?64:128,n=Mi.DEFAULT_UP,t=n.z===1,r=n.x===1,{container:s}=o;o.container=void 0,o=JSON.parse(JSON.stringify(o)),o.container=s;const l=t?My:r?Py:va;Qy.forEach((f,p)=>{o[f]&&(o[l[p]]=o[f])});const c={enabled:!0,color:16777215,opacity:1,scale:.7,labelColor:2236962,line:!1,border:{size:0,color:14540253},hover:{color:i?16777215:9688043,labelColor:2236962,opacity:1,scale:.7,border:{size:0,color:14540253}}},h={line:!1,scale:i?.45:.7,hover:{scale:i?.5:.7}},d={type:e,container:document.body,size:128,placement:"top-right",resolution:a,lineWidth:4,radius:i?1:.2,smoothness:18,animated:!0,speed:1,background:{enabled:!0,color:i?16777215:14739180,opacity:i?0:1,hover:{color:i?16777215:14739180,opacity:i?.2:1}},font:{family:"sans-serif",weight:900},offset:{top:10,left:10,bottom:10,right:10},corners:{enabled:!i,color:i?15915362:16777215,opacity:1,scale:i?.15:.2,radius:1,smoothness:18,hover:{color:i?16777215:9688043,opacity:1,scale:i?.2:.225}},edges:{enabled:!i,color:i?15915362:16777215,opacity:i?1:0,radius:i?1:.125,smoothness:18,scale:i?.15:1,hover:{color:i?16777215:9688043,opacity:1,scale:i?.2:1}},x:{...ho(c),...i?{label:"X",color:16725587,line:!0}:{label:r?Ml:oh}},y:{...ho(c),...i?{label:"Y",color:9100032,line:!0}:{label:t||r?sh:Ml}},z:{...ho(c),...i?{label:"Z",color:2920447,line:!0}:{label:t?Ml:r?oh:sh}},nx:{...ho(h),label:i?"":r?Pl:ah},ny:{...ho(h),label:i?"":t||r?lh:Pl},nz:{...ho(h),label:i?"":t?Pl:r?ah:lh}};return ch(o,d),gg.forEach(f=>ch(o[`n${f}`],ho(o[f]))),{...o,isSphere:i}};function ch(o,...e){if(o instanceof HTMLElement||typeof o!="object"||o===null)return o;for(const i of e)for(const a in i)a!=="container"&&a in i&&(o[a]===void 0?o[a]=i[a]:typeof i[a]=="object"&&!Array.isArray(i[a])&&(o[a]=ch(o[a]||{},i[a])));return o}const Uy=(o,e=2)=>{const i=new Rt,a=e*2,{isSphere:n,resolution:t,radius:r,font:s,corners:l,edges:c}=o,h=va.map(I=>({...o[I],radius:r}));n&&l.enabled&&h.push(l),n&&c.enabled&&h.push(c);const d=document.createElement("canvas"),f=d.getContext("2d");d.width=t*2+a*2,d.height=t*h.length+a*h.length;const[p,m]=x(h,t,s);h.forEach(({radius:I,label:k,color:P,labelColor:D,border:U,hover:{color:S,labelColor:R,border:Q}},O)=>{const G=t*O+O*a+e;C(e,G,e,t,I,k,U,P,D),C(t+e*3,G,e,t,I,k,Q??U,S??P,R??D)});const b=h.length,v=e/(t*2),y=e/(t*6),E=1/b,_=new ma(d);return _.repeat.set(.5-2*v,E-2*y),_.offset.set(v,1-y),Object.assign(_,{colorSpace:vi,wrapS:ir,wrapT:ir,userData:{offsetX:v,offsetY:y,cellHeight:E}}),_;function C(I,k,P,D,U,S,R,Q,O){if(U=U*(D/2),Q!=null&&Q!==""&&(G(),f.fillStyle=i.set(Q).getStyle(),f.fill()),R&&R.size){const q=R.size*D/2;I+=q,k+=q,D-=R.size*D,U=Math.max(0,U-q),G(),f.strokeStyle=i.set(R.color).getStyle(),f.lineWidth=R.size*D,f.stroke()}S&&B(f,I+D/2,k+(D+P)/2,S,i.set(O).getStyle());function G(){f.beginPath(),f.moveTo(I+U,k),f.lineTo(I+D-U,k),f.arcTo(I+D,k,I+D,k+U,U),f.lineTo(I+D,k+D-U),f.arcTo(I+D,k+D,I+D-U,k+D,U),f.lineTo(I+U,k+D),f.arcTo(I,k+D,I,k+D-U,U),f.lineTo(I,k+U),f.arcTo(I,k,I+U,k,U),f.closePath()}}function x(I,k,P){const D=[...I].sort((j,L)=>{var N,V;return(((N=j.label)==null?void 0:N.length)||0)-(((V=L.label)==null?void 0:V.length)||0)}).pop().label,{family:U,weight:S}=P,R=n?Math.sqrt(Math.pow(k*.7,2)/2):k;let Q=R,O=0,G=0;do{f.font=`${S} ${Q}px ${U}`;const j=f.measureText(D);O=j.width,G=j.fontBoundingBoxDescent,Q--}while(O>R&&Q>0);const q=R/G,Z=Math.min(R/O,q),Y=Math.floor(Q*Z);return[`${S} ${Y}px ${U}`,q]}function B(I,k,P,D,U){I.font=p,I.textAlign="center",I.textBaseline="middle",I.fillStyle=U,I.fillText(D,k,P+(n?m:0))}},Fy=(o,e)=>o.offset.x=(e?.5:0)+o.userData.offsetX,Zh=(o,e)=>{const{offset:i,userData:{offsetY:a,cellHeight:n}}=o;i.y=1-(e+1)*n+a};function $h(o,e,i=2,a=2){const n=i/2-o,t=a/2-o,r=o/i,s=(i-o)/i,l=o/a,c=(a-o)/a,h=[n,t,0,-n,t,0,-n,-t,0,n,-t,0],d=[s,c,r,c,r,l,s,l],f=[3*(e+1)+3,3*(e+1)+4,e+4,e+5,2*(e+1)+4,2,1,2*(e+1)+3,3,4*(e+1)+3,4,0],p=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11].map(B=>f[B]);let m,b,v,y,E,_,C,x;for(let B=0;B<4;B++){y=B<1||B>2?n:-n,E=B<2?t:-t,_=B<1||B>2?s:r,C=B<2?c:l;for(let I=0;I<=e;I++)m=Math.PI/2*(B+I/e),b=Math.cos(m),v=Math.sin(m),h.push(y+o*b,E+o*v,0),d.push(_+r*b,C+l*v),I<e&&(x=(e+1)*B+I+4,p.push(B,x,x+1))}return new hi().setIndex(new Mt(new Uint32Array(p),1)).setAttribute("position",new Mt(new Float32Array(h),3)).setAttribute("uv",new Mt(new Float32Array(d),2))}const Ly=(o,e)=>{const i=new ie,{isSphere:a,radius:n,smoothness:t}=o,r=$h(n,t);return va.map((s,l)=>{const c=l<3,h=va[l],d=l?e.clone():e;Zh(d,l);const{enabled:f,scale:p,opacity:m,hover:b}=o[h],v={map:d,opacity:m,transparent:!0},y=a?new Gh(new tc(v)):new Re(r,new Tn(v)),E=c?h:h[1];return y.position[E]=(c?1:-1)*(a?mg:1),a||y.lookAt(i.copy(y.position).multiplyScalar(1.7)),y.scale.setScalar(p),y.renderOrder=1,y.visible=f,y.userData={scale:p,opacity:m,hover:b},y})},Oy=(o,e)=>{const{isSphere:i,corners:a}=o;if(!a.enabled)return[];const{color:n,opacity:t,scale:r,radius:s,smoothness:l,hover:c}=a,h=i?null:$h(s,l),d={transparent:!0,opacity:t},f=[1,1,1,-1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1].map(m=>m*.85),p=new ie;return Array(f.length/3).fill(0).map((m,b)=>{if(i){const E=e.clone();Zh(E,6),d.map=E}else d.color=n;const v=i?new Gh(new tc(d)):new Re(h,new Tn(d)),y=b*3;return v.position.set(f[y],f[y+1],f[y+2]),i&&v.position.normalize().multiplyScalar(1.7),v.scale.setScalar(r),v.lookAt(p.copy(v.position).multiplyScalar(2)),v.renderOrder=1,v.userData={color:n,opacity:t,scale:r,hover:c},v})},Gy=(o,e,i)=>{const{isSphere:a,edges:n}=o;if(!n.enabled)return[];const{color:t,opacity:r,scale:s,hover:l,radius:c,smoothness:h}=n,d=a?null:$h(c,h,1.2,.25),f={transparent:!0,opacity:r},p=[0,1,1,0,-1,1,1,0,1,-1,0,1,0,1,-1,0,-1,-1,1,0,-1,-1,0,-1,1,1,0,1,-1,0,-1,1,0,-1,-1,0].map(v=>v*.925),m=new ie,b=new ie(0,1,0);return Array(p.length/3).fill(0).map((v,y)=>{if(a){const C=e.clone();Zh(C,i),f.map=C}else f.color=t;const E=a?new Gh(new tc(f)):new Re(d,new Tn(f)),_=y*3;return E.position.set(p[_],p[_+1],p[_+2]),a&&E.position.normalize().multiplyScalar(1.7),E.scale.setScalar(s),E.up.copy(b),E.lookAt(m.copy(E.position).multiplyScalar(2)),!a&&!E.position.y&&(E.rotation.z=Math.PI/2),E.renderOrder=1,E.userData={color:t,opacity:r,scale:s,hover:l},E})};function Ny(o,e=!1){const i=o[0].index!==null,a=new Set(Object.keys(o[0].attributes)),n=new Set(Object.keys(o[0].morphAttributes)),t={},r={},s=o[0].morphTargetsRelative,l=new hi;let c=0;for(let h=0;h<o.length;++h){const d=o[h];let f=0;if(i!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in d.attributes){if(!a.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;t[p]===void 0&&(t[p]=[]),t[p].push(d.attributes[p]),f++}if(f!==a.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(s!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in d.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;r[p]===void 0&&(r[p]=[]),r[p].push(d.morphAttributes[p])}if(e){let p;if(i)p=d.index.count;else if(d.attributes.position!==void 0)p=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,h),c+=p}}if(i){let h=0;const d=[];for(let f=0;f<o.length;++f){const p=o[f].index;for(let m=0;m<p.count;++m)d.push(p.getX(m)+h);h+=o[f].attributes.position.count}l.setIndex(d)}for(const h in t){const d=$f(t[h]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,d)}for(const h in r){const d=r[h][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let f=0;f<d;++f){const p=[];for(let b=0;b<r[h].length;++b)p.push(r[h][b][f]);const m=$f(p);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(m)}}return l}function $f(o){let e,i,a,n=-1,t=0;for(let c=0;c<o.length;++c){const h=o[c];if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=h.itemSize),i!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(a===void 0&&(a=h.normalized),a!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(n===-1&&(n=h.gpuType),n!==h.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;t+=h.count*i}const r=new e(t),s=new Mt(r,i,a);let l=0;for(let c=0;c<o.length;++c){const h=o[c];if(h.isInterleavedBufferAttribute){const d=l/i;for(let f=0,p=h.count;f<p;f++)for(let m=0;m<i;m++){const b=h.getComponent(f,m);s.setComponent(f+d,m,b)}}else r.set(h.array,l);l+=h.count*i}return n!==void 0&&(s.gpuType=n),s}const zy=(o,e)=>{const{isSphere:i,background:{enabled:a,color:n,opacity:t,hover:r}}=e;let s;const l=new Tn({color:n,side:rc,opacity:t,transparent:!0,depthWrite:!1});if(!a)return null;if(i)s=new Re(new Nh(1.8,64,64),l);else{let c;o.forEach(h=>{const d=h.scale.x;h.scale.setScalar(.9),h.updateMatrix();const f=h.geometry.clone();f.applyMatrix4(h.matrix),c=c?Ny([c,f]):f,h.scale.setScalar(d)}),s=new Re(c,l)}return s.userData={color:n,opacity:t,hover:r},s},eA=new gn,$a=new ie;let vg=class extends zh{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],i=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],a=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(a),this.setAttribute("position",new cs(e,3)),this.setAttribute("uv",new cs(i,2))}applyMatrix4(e){const i=this.attributes.instanceStart,a=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),a.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const a=new $u(i,6,1);return this.setAttribute("instanceStart",new Co(a,3,0)),this.setAttribute("instanceEnd",new Co(a,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const a=new $u(i,6,1);return this.setAttribute("instanceColorStart",new Co(a,3,0)),this.setAttribute("instanceColorEnd",new Co(a,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new k0(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new gn);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),eA.setFromBufferAttribute(i),this.boundingBox.union(eA))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const a=this.boundingSphere.center;this.boundingBox.getCenter(a);let n=0;for(let t=0,r=e.count;t<r;t++)$a.fromBufferAttribute(e,t),n=Math.max(n,a.distanceToSquared($a)),$a.fromBufferAttribute(i,t),n=Math.max(n,a.distanceToSquared($a));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};Tl.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new lt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ra.line={uniforms:hs.merge([Tl.common,Tl.fog,Tl.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};let ed=class extends Gi{constructor(e){super({type:"LineMaterial",uniforms:hs.clone(ra.line.uniforms),vertexShader:ra.line.vertexShader,fragmentShader:ra.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}};const fu=new ri,tA=new ie,nA=new ie,Un=new ri,Fn=new ri,Wi=new ri,Au=new ie,pu=new Lt,Nn=new nr,iA=new ie,el=new gn,tl=new Xr,Ki=new ri;let $i,xo;function rA(o,e,i){return Ki.set(0,0,-e,1).applyMatrix4(o.projectionMatrix),Ki.multiplyScalar(1/Ki.w),Ki.x=xo/i.width,Ki.y=xo/i.height,Ki.applyMatrix4(o.projectionMatrixInverse),Ki.multiplyScalar(1/Ki.w),Math.abs(Math.max(Ki.x,Ki.y))}function Hy(o,e){const i=o.matrixWorld,a=o.geometry,n=a.attributes.instanceStart,t=a.attributes.instanceEnd,r=Math.min(a.instanceCount,n.count);for(let s=0,l=r;s<l;s++){Nn.start.fromBufferAttribute(n,s),Nn.end.fromBufferAttribute(t,s),Nn.applyMatrix4(i);const c=new ie,h=new ie;$i.distanceSqToSegment(Nn.start,Nn.end,h,c),h.distanceTo(c)<xo*.5&&e.push({point:h,pointOnLine:c,distance:$i.origin.distanceTo(h),object:o,face:null,faceIndex:s,uv:null,uv1:null})}}function Vy(o,e,i){const a=e.projectionMatrix,n=o.material.resolution,t=o.matrixWorld,r=o.geometry,s=r.attributes.instanceStart,l=r.attributes.instanceEnd,c=Math.min(r.instanceCount,s.count),h=-e.near;$i.at(1,Wi),Wi.w=1,Wi.applyMatrix4(e.matrixWorldInverse),Wi.applyMatrix4(a),Wi.multiplyScalar(1/Wi.w),Wi.x*=n.x/2,Wi.y*=n.y/2,Wi.z=0,Au.copy(Wi),pu.multiplyMatrices(e.matrixWorldInverse,t);for(let d=0,f=c;d<f;d++){if(Un.fromBufferAttribute(s,d),Fn.fromBufferAttribute(l,d),Un.w=1,Fn.w=1,Un.applyMatrix4(pu),Fn.applyMatrix4(pu),Un.z>h&&Fn.z>h)continue;if(Un.z>h){const y=Un.z-Fn.z,E=(Un.z-h)/y;Un.lerp(Fn,E)}else if(Fn.z>h){const y=Fn.z-Un.z,E=(Fn.z-h)/y;Fn.lerp(Un,E)}Un.applyMatrix4(a),Fn.applyMatrix4(a),Un.multiplyScalar(1/Un.w),Fn.multiplyScalar(1/Fn.w),Un.x*=n.x/2,Un.y*=n.y/2,Fn.x*=n.x/2,Fn.y*=n.y/2,Nn.start.copy(Un),Nn.start.z=0,Nn.end.copy(Fn),Nn.end.z=0;const p=Nn.closestPointToPointParameter(Au,!0);Nn.at(p,iA);const m=rr.lerp(Un.z,Fn.z,p),b=m>=-1&&m<=1,v=Au.distanceTo(iA)<xo*.5;if(b&&v){Nn.start.fromBufferAttribute(s,d),Nn.end.fromBufferAttribute(l,d),Nn.start.applyMatrix4(t),Nn.end.applyMatrix4(t);const y=new ie,E=new ie;$i.distanceSqToSegment(Nn.start,Nn.end,E,y),i.push({point:E,pointOnLine:y,distance:$i.origin.distanceTo(E),object:o,face:null,faceIndex:d,uv:null,uv1:null})}}}let jy=class extends Re{constructor(e=new vg,i=new ed({color:Math.random()*16777215})){super(e,i),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,a=e.attributes.instanceEnd,n=new Float32Array(2*i.count);for(let r=0,s=0,l=i.count;r<l;r++,s+=2)tA.fromBufferAttribute(i,r),nA.fromBufferAttribute(a,r),n[s]=s===0?0:n[s-1],n[s+1]=n[s]+tA.distanceTo(nA);const t=new $u(n,2,1);return e.setAttribute("instanceDistanceStart",new Co(t,1,0)),e.setAttribute("instanceDistanceEnd",new Co(t,1,1)),this}raycast(e,i){const a=this.material.worldUnits,n=e.camera;n===null&&!a&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const t=e.params.Line2!==void 0&&e.params.Line2.threshold||0;$i=e.ray;const r=this.matrixWorld,s=this.geometry,l=this.material;xo=l.linewidth+t,s.boundingSphere===null&&s.computeBoundingSphere(),tl.copy(s.boundingSphere).applyMatrix4(r);let c;if(a)c=xo*.5;else{const d=Math.max(n.near,tl.distanceToPoint($i.origin));c=rA(n,d,l.resolution)}if(tl.radius+=c,$i.intersectsSphere(tl)===!1)return;s.boundingBox===null&&s.computeBoundingBox(),el.copy(s.boundingBox).applyMatrix4(r);let h;if(a)h=xo*.5;else{const d=Math.max(n.near,el.distanceToPoint($i.origin));h=rA(n,d,l.resolution)}el.expandByScalar(h),$i.intersectsBox(el)!==!1&&(a?Hy(this,i):Vy(this,n,i))}onBeforeRender(e){const i=this.material.uniforms;i&&i.resolution&&(e.getViewport(fu),this.material.uniforms.resolution.value.set(fu.z,fu.w))}};class bg extends vg{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const i=e.length-3,a=new Float32Array(2*i);for(let n=0;n<i;n+=3)a[2*n]=e[n],a[2*n+1]=e[n+1],a[2*n+2]=e[n+2],a[2*n+3]=e[n+3],a[2*n+4]=e[n+4],a[2*n+5]=e[n+5];return super.setPositions(a),this}setColors(e){const i=e.length-3,a=new Float32Array(2*i);for(let n=0;n<i;n+=3)a[2*n]=e[n],a[2*n+1]=e[n+1],a[2*n+2]=e[n+2],a[2*n+3]=e[n+3],a[2*n+4]=e[n+4],a[2*n+5]=e[n+5];return super.setColors(a),this}setFromPoints(e){const i=e.length-1,a=new Float32Array(6*i);for(let n=0;n<i;n++)a[6*n]=e[n].x,a[6*n+1]=e[n].y,a[6*n+2]=e[n].z||0,a[6*n+3]=e[n+1].x,a[6*n+4]=e[n+1].y,a[6*n+5]=e[n+1].z||0;return super.setPositions(a),this}fromLine(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}}let qy=class extends jy{constructor(e=new bg,i=new ed({color:Math.random()*16777215})){super(e,i),this.isLine2=!0,this.type="Line2"}};const Wy=o=>{const e=new Rt,i=[],a=[],{isSphere:n}=o;if(va.forEach((s,l)=>{const{enabled:c,line:h,scale:d,color:f}=o[s];if(!c||!h)return;const p=l<3?1:-1,m=(n?mg-d/2:.975)*p;i.push(s.includes("x")?m:0,s.includes("y")?m:0,s.includes("z")?m:0,0,0,0);const b=e.set(f).toArray();a.push(...b,...b)}),!i.length)return null;const t=new bg().setPositions(i).setColors(a),r=new ed({linewidth:o.lineWidth,vertexColors:!0,resolution:new lt(window.innerWidth,window.innerHeight)});return new qy(t,r).computeLineDistances()},Ky=o=>{const{corners:e,edges:i}=o,a=[],n=Uy(o),t=Ly(o,n);a.push(...t),e.enabled&&a.push(...Oy(o,n)),i.enabled&&a.push(...Gy(o,n,e.enabled?7:6));const r=zy(t,o),s=Wy(o);return[a,r,s]},Ls=(o,e=!0)=>{const{material:i,userData:a}=o,{opacity:n,color:t,scale:r}=e?a.hover:a;o.scale.setScalar(r),i.opacity=n,i.map?Fy(i.map,e):i.color.set(t)},Go=new Lt,oA=new Vl,Yy=new lt,fo=new ie,sA=new ri;let aA=class extends Mi{constructor(e,i,a={}){super(),Gt(this,"enabled",!0),Gt(this,"camera"),Gt(this,"renderer"),Gt(this,"options"),Gt(this,"target",new ie),Gt(this,"animated",!0),Gt(this,"speed",1),Gt(this,"animating",!1),Gt(this,"_options"),Gt(this,"_intersections"),Gt(this,"_background",null),Gt(this,"_viewport",[0,0,0,0]),Gt(this,"_originalViewport",[0,0,0,0]),Gt(this,"_originalScissor",[0,0,0,0]),Gt(this,"_scene"),Gt(this,"_camera"),Gt(this,"_container"),Gt(this,"_domElement"),Gt(this,"_domRect"),Gt(this,"_dragging",!1),Gt(this,"_distance",0),Gt(this,"_clock",new S0),Gt(this,"_targetQuaternion",new vn),Gt(this,"_quaternionStart",new vn),Gt(this,"_quaternionEnd",new vn),Gt(this,"_pointerStart",new lt),Gt(this,"_focus",null),Gt(this,"_placement"),Gt(this,"_controls"),Gt(this,"_controlsListeners"),this.camera=e,this.renderer=i,this._scene=new Op().add(this),this.set(a)}get placement(){return this._placement}set placement(e){this._placement=pg(this._domElement,e),this.domUpdate()}set(e={}){this.dispose(),this.options=e,this._options=Ry(e),this._camera=this._options.isSphere?new Ia(-1.8,1.8,1.8,-1.8,5,10):new Qp(26,1,5,10),this._camera.position.set(0,0,7);const[i,a,n]=Ky(this._options);a&&this.add(a),n&&this.add(n),this.add(...i),this._background=a,this._intersections=i;const{container:t,animated:r,speed:s}=this._options;return this.animated=r,this.speed=s,this._container=t?Sy(t):document.body,this._domElement=By(this._options),this._domElement.onpointerdown=l=>this._onPointerDown(l),this._domElement.onpointermove=l=>this._onPointerMove(l),this._domElement.onpointerleave=()=>this._onPointerLeave(),this._container.appendChild(this._domElement),this._controls&&this.attachControls(this._controls),this.update(),this._updateOrientation(!0),this}render(){this.animating&&this._animate();const{renderer:e,_viewport:i}=this,a=e.getScissorTest(),n=e.autoClear;return e.autoClear=!1,e.setViewport(...i),a&&e.setScissor(...i),e.clear(!1,!0,!1),e.render(this._scene,this._camera),e.setViewport(...this._originalViewport),a&&e.setScissor(...this._originalScissor),e.autoClear=n,this}domUpdate(){this._domRect=this._domElement.getBoundingClientRect();const e=this.renderer,i=this._domRect,a=e.domElement.getBoundingClientRect();return this._viewport.splice(0,4,i.left-a.left,e.domElement.clientHeight-(i.top-a.top+i.height),i.width,i.height),e.getViewport(sA).toArray(this._originalViewport),e.getScissorTest()&&e.getScissor(sA).toArray(this._originalScissor),this}cameraUpdate(){return this._updateOrientation(),this}update(e=!0){return e&&this._controls&&this._controls.update(),this.domUpdate().cameraUpdate()}attachControls(e){return this.detachControls(),this.target=e.target,this._controlsListeners={start:()=>e.enabled=!1,end:()=>e.enabled=!0,change:()=>this.update(!1)},this.addEventListener("start",this._controlsListeners.start),this.addEventListener("end",this._controlsListeners.end),e.addEventListener("change",this._controlsListeners.change),this._controls=e,this}detachControls(){if(!(!this._controlsListeners||!this._controls))return this.target=new ie().copy(this._controls.target),this.removeEventListener("start",this._controlsListeners.start),this.removeEventListener("end",this._controlsListeners.end),this._controls.removeEventListener("change",this._controlsListeners.change),this._controlsListeners=void 0,this._controls=void 0,this}dispose(){var e;this.detachControls(),this.children.forEach(i=>{var a,n,t,r;this.remove(i);const s=i;(a=s.material)==null||a.dispose(),(t=(n=s.material)==null?void 0:n.map)==null||t.dispose(),(r=s.geometry)==null||r.dispose()}),(e=this._domElement)==null||e.remove()}_updateOrientation(e=!0){e&&(this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld()),Kf(this._options,this._intersections,this.camera)}_animate(){const{position:e,quaternion:i}=this.camera;if(e.set(0,0,1),!this.animated){e.applyQuaternion(this._quaternionEnd).multiplyScalar(this._distance).add(this.target),i.copy(this._targetQuaternion),this._updateOrientation(),this.animating=!1,this.dispatchEvent({type:"change"}),this.dispatchEvent({type:"end"});return}this._controls&&(this._controls.enabled=!1);const a=this._clock.getDelta()*Ty*this.speed;this._quaternionStart.rotateTowards(this._quaternionEnd,a),e.applyQuaternion(this._quaternionStart).multiplyScalar(this._distance).add(this.target),i.rotateTowards(this._targetQuaternion,a),this._updateOrientation(),requestAnimationFrame(()=>this.dispatchEvent({type:"change"})),this._quaternionStart.angleTo(this._quaternionEnd)<du&&(this._controls&&(this._controls.enabled=!0),this.animating=!1,this.dispatchEvent({type:"end"}))}_setOrientation(e){const i=this.camera,a=this.target;fo.copy(e).multiplyScalar(this._distance),Go.setPosition(fo).lookAt(fo,this.position,this.up),this._targetQuaternion.setFromRotationMatrix(Go),fo.add(a),Go.lookAt(fo,a,this.up),this._quaternionEnd.setFromRotationMatrix(Go),Go.setPosition(i.position).lookAt(i.position,a,this.up),this._quaternionStart.setFromRotationMatrix(Go),this.animating=!0,this._clock.start(),this.dispatchEvent({type:"start"})}_onPointerDown(e){if(!this.enabled)return;const i=l=>{if(!this._dragging){if(Dy(l,this._pointerStart))return;this._dragging=!0}const c=Yy.set(l.clientX,l.clientY).sub(this._pointerStart).multiplyScalar(1/this._domRect.width*Math.PI),h=this.coordinateConversion(fo.subVectors(this.camera.position,this.target)),d=oA.setFromVector3(h);d.theta=r-c.x,d.phi=rh(s-c.y,du,Math.PI-du),this.coordinateConversion(this.camera.position.setFromSpherical(d),!0).add(this.target),this.camera.lookAt(this.target),this.quaternion.copy(this.camera.quaternion).invert(),this._updateOrientation(!1),this.dispatchEvent({type:"change"})},a=()=>{if(document.removeEventListener("pointermove",i,!1),document.removeEventListener("pointerup",a,!1),!this._dragging)return this._handleClick(e);this._focus&&(Ls(this._focus,!1),this._focus=null),this._dragging=!1,this.dispatchEvent({type:"end"})};if(this.animating)return;e.preventDefault(),this._pointerStart.set(e.clientX,e.clientY);const n=this.coordinateConversion(fo.subVectors(this.camera.position,this.target)),t=oA.setFromVector3(n),r=t.theta,s=t.phi;this._distance=t.radius,document.addEventListener("pointermove",i,!1),document.addEventListener("pointerup",a,!1),this.dispatchEvent({type:"start"})}coordinateConversion(e,i=!1){const{x:a,y:n,z:t}=e,r=Mi.DEFAULT_UP;return r.x===1?i?e.set(n,t,a):e.set(t,a,n):r.z===1?i?e.set(t,a,n):e.set(n,t,a):e}_onPointerMove(e){!this.enabled||this._dragging||(this._background&&Zf(this._background,!0),this._handleHover(e))}_onPointerLeave(){!this.enabled||this._dragging||(this._background&&Zf(this._background,!1),this._focus&&Ls(this._focus,!1),this._domElement.style.cursor="")}_handleClick(e){const i=Jf(e,this._domRect,this._camera,this._intersections);this._focus&&(Ls(this._focus,!1),this._focus=null),i&&(this._setOrientation(i.object.position),this.dispatchEvent({type:"change"}))}_handleHover(e){const i=Jf(e,this._domRect,this._camera,this._intersections),a=(i==null?void 0:i.object)||null;this._focus!==a&&(this._domElement.style.cursor=a?"pointer":"",this._focus&&Ls(this._focus,!1),(this._focus=a)?Ls(a,!0):Kf(this._options,this._intersections,this.camera))}};const lA={type:"change"},td={type:"start"},wg={type:"end"},nl=new Lp,cA=new oc,Xy=Math.cos(70*rr.DEG2RAD),Cn=new ie,ci=2*Math.PI,qt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},gu=1e-6;let yg=class extends Hh{constructor(e,i=null){super(e,i),this.state=qt.NONE,this.target=new ie,this.cursor=new ie,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Di.ROTATE,MIDDLE:Di.DOLLY,RIGHT:Di.PAN},this.touches={ONE:ts.ROTATE,TWO:ts.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ie,this._lastQuaternion=new vn,this._lastTargetPosition=new ie,this._quat=new vn().setFromUnitVectors(e.up,new ie(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Vl,this._sphericalDelta=new Vl,this._scale=1,this._panOffset=new ie,this._rotateStart=new lt,this._rotateEnd=new lt,this._rotateDelta=new lt,this._panStart=new lt,this._panEnd=new lt,this._panDelta=new lt,this._dollyStart=new lt,this._dollyEnd=new lt,this._dollyDelta=new lt,this._dollyDirection=new ie,this._mouse=new lt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Zy.bind(this),this._onPointerDown=Jy.bind(this),this._onPointerUp=$y.bind(this),this._onContextMenu=s1.bind(this),this._onMouseWheel=n1.bind(this),this._onKeyDown=i1.bind(this),this._onTouchStart=r1.bind(this),this._onTouchMove=o1.bind(this),this._onMouseDown=e1.bind(this),this._onMouseMove=t1.bind(this),this._interceptControlDown=a1.bind(this),this._interceptControlUp=l1.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(lA),this.update(),this.state=qt.NONE}update(e=null){const i=this.object.position;Cn.copy(i).sub(this.target),Cn.applyQuaternion(this._quat),this._spherical.setFromVector3(Cn),this.autoRotate&&this.state===qt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let a=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(a)&&isFinite(n)&&(a<-Math.PI?a+=ci:a>Math.PI&&(a-=ci),n<-Math.PI?n+=ci:n>Math.PI&&(n-=ci),a<=n?this._spherical.theta=Math.max(a,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(a+n)/2?Math.max(a,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let t=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),t=r!=this._spherical.radius}if(Cn.setFromSpherical(this._spherical),Cn.applyQuaternion(this._quatInverse),i.copy(this.target).add(Cn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const s=Cn.length();r=this._clampDistance(s*this._scale);const l=s-r;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),t=!!l}else if(this.object.isOrthographicCamera){const s=new ie(this._mouse.x,this._mouse.y,0);s.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),t=l!==this.object.zoom;const c=new ie(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(s),this.object.updateMatrixWorld(),r=Cn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(nl.origin.copy(this.object.position),nl.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(nl.direction))<Xy?this.object.lookAt(this.target):(cA.setFromNormalAndCoplanarPoint(this.object.up,this.target),nl.intersectPlane(cA,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),t=!0)}return this._scale=1,this._performCursorZoom=!1,t||this._lastPosition.distanceToSquared(this.object.position)>gu||8*(1-this._lastQuaternion.dot(this.object.quaternion))>gu||this._lastTargetPosition.distanceToSquared(this.target)>gu?(this.dispatchEvent(lA),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?ci/60*this.autoRotateSpeed*e:ci/60/60*this.autoRotateSpeed}_getZoomScale(e){const i=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*i)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,i){Cn.setFromMatrixColumn(i,0),Cn.multiplyScalar(-e),this._panOffset.add(Cn)}_panUp(e,i){this.screenSpacePanning===!0?Cn.setFromMatrixColumn(i,1):(Cn.setFromMatrixColumn(i,0),Cn.crossVectors(this.object.up,Cn)),Cn.multiplyScalar(e),this._panOffset.add(Cn)}_pan(e,i){const a=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;Cn.copy(n).sub(this.target);let t=Cn.length();t*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*t/a.clientHeight,this.object.matrix),this._panUp(2*i*t/a.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/a.clientWidth,this.object.matrix),this._panUp(i*(this.object.top-this.object.bottom)/this.object.zoom/a.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,i){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const a=this.domElement.getBoundingClientRect(),n=e-a.left,t=i-a.top,r=a.width,s=a.height;this._mouse.x=n/r*2-1,this._mouse.y=-(t/s)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(ci*this._rotateDelta.x/i.clientHeight),this._rotateUp(ci*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let i=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),i=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),i=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),i=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),i=!0;break}i&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),a=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this._rotateStart.set(a,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),a=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this._panStart.set(a,n)}}_handleTouchStartDolly(e){const i=this._getSecondPointerPosition(e),a=e.pageX-i.x,n=e.pageY-i.y,t=Math.sqrt(a*a+n*n);this._dollyStart.set(0,t)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const a=this._getSecondPointerPosition(e),n=.5*(e.pageX+a.x),t=.5*(e.pageY+a.y);this._rotateEnd.set(n,t)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(ci*this._rotateDelta.x/i.clientHeight),this._rotateUp(ci*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),a=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this._panEnd.set(a,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const i=this._getSecondPointerPosition(e),a=e.pageX-i.x,n=e.pageY-i.y,t=Math.sqrt(a*a+n*n);this._dollyEnd.set(0,t),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(e.pageX+i.x)*.5,s=(e.pageY+i.y)*.5;this._updateZoomParameters(r,s)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId){this._pointers.splice(i,1);return}}_isTrackingPointer(e){for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId)return!0;return!1}_trackPointer(e){let i=this._pointerPositions[e.pointerId];i===void 0&&(i=new lt,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const i=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[i]}_customWheelEvent(e){const i=e.deltaMode,a={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(i){case 1:a.deltaY*=16;break;case 2:a.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(a.deltaY*=10),a}};function Jy(o){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(o.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(o)&&(this._addPointer(o),o.pointerType==="touch"?this._onTouchStart(o):this._onMouseDown(o)))}function Zy(o){this.enabled!==!1&&(o.pointerType==="touch"?this._onTouchMove(o):this._onMouseMove(o))}function $y(o){switch(this._removePointer(o),this._pointers.length){case 0:this.domElement.releasePointerCapture(o.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(wg),this.state=qt.NONE;break;case 1:const e=this._pointers[0],i=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:i.x,pageY:i.y});break}}function e1(o){let e;switch(o.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Di.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(o),this.state=qt.DOLLY;break;case Di.ROTATE:if(o.ctrlKey||o.metaKey||o.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(o),this.state=qt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(o),this.state=qt.ROTATE}break;case Di.PAN:if(o.ctrlKey||o.metaKey||o.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(o),this.state=qt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(o),this.state=qt.PAN}break;default:this.state=qt.NONE}this.state!==qt.NONE&&this.dispatchEvent(td)}function t1(o){switch(this.state){case qt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(o);break;case qt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(o);break;case qt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(o);break}}function n1(o){this.enabled===!1||this.enableZoom===!1||this.state!==qt.NONE||(o.preventDefault(),this.dispatchEvent(td),this._handleMouseWheel(this._customWheelEvent(o)),this.dispatchEvent(wg))}function i1(o){this.enabled!==!1&&this._handleKeyDown(o)}function r1(o){switch(this._trackPointer(o),this._pointers.length){case 1:switch(this.touches.ONE){case ts.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(o),this.state=qt.TOUCH_ROTATE;break;case ts.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(o),this.state=qt.TOUCH_PAN;break;default:this.state=qt.NONE}break;case 2:switch(this.touches.TWO){case ts.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(o),this.state=qt.TOUCH_DOLLY_PAN;break;case ts.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(o),this.state=qt.TOUCH_DOLLY_ROTATE;break;default:this.state=qt.NONE}break;default:this.state=qt.NONE}this.state!==qt.NONE&&this.dispatchEvent(td)}function o1(o){switch(this._trackPointer(o),this.state){case qt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(o),this.update();break;case qt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(o),this.update();break;case qt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(o),this.update();break;case qt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(o),this.update();break;default:this.state=qt.NONE}}function s1(o){this.enabled!==!1&&o.preventDefault()}function a1(o){o.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function l1(o){o.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const mu={type:"change"},nd={type:"start"},id={type:"end"},uA=1e-6,Ft={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},il=new lt,Lr=new lt,c1=new ie,rl=new ie,vu=new ie,No=new vn,hA=new ie,ol=new ie,bu=new ie,sl=new ie;let _g=class extends Hh{constructor(e,i=null){super(e,i),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Di.ROTATE,MIDDLE:Di.DOLLY,RIGHT:Di.PAN},this.target=new ie,this.state=Ft.NONE,this.keyState=Ft.NONE,this._lastPosition=new ie,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new ie,this._movePrev=new lt,this._moveCurr=new lt,this._lastAxis=new ie,this._zoomStart=new lt,this._zoomEnd=new lt,this._panStart=new lt,this._panEnd=new lt,this._pointers=[],this._pointerPositions={},this._onPointerMove=h1.bind(this),this._onPointerDown=u1.bind(this),this._onPointerUp=d1.bind(this),this._onPointerCancel=f1.bind(this),this._onContextMenu=w1.bind(this),this._onMouseWheel=b1.bind(this),this._onKeyDown=p1.bind(this),this._onKeyUp=A1.bind(this),this._onTouchStart=y1.bind(this),this._onTouchMove=_1.bind(this),this._onTouchEnd=C1.bind(this),this._onMouseDown=g1.bind(this),this._onMouseMove=m1.bind(this),this._onMouseUp=v1.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,i!==null&&(this.connect(i),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),i=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-i.clientLeft,this.screen.top=e.top+window.pageYOffset-i.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>uA&&(this.dispatchEvent(mu),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>uA||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(mu),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Ft.NONE,this.keyState=Ft.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(mu),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Lr.copy(this._panEnd).sub(this._panStart),Lr.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,i=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Lr.x*=e,Lr.y*=i}Lr.multiplyScalar(this._eye.length()*this.panSpeed),rl.copy(this._eye).cross(this.object.up).setLength(Lr.x),rl.add(c1.copy(this.object.up).setLength(Lr.y)),this.object.position.add(rl),this.target.add(rl),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Lr.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){sl.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=sl.length();e?(this._eye.copy(this.object.position).sub(this.target),hA.copy(this._eye).normalize(),ol.copy(this.object.up).normalize(),bu.crossVectors(ol,hA).normalize(),ol.setLength(this._moveCurr.y-this._movePrev.y),bu.setLength(this._moveCurr.x-this._movePrev.x),sl.copy(ol.add(bu)),vu.crossVectors(sl,this._eye).normalize(),e*=this.rotateSpeed,No.setFromAxisAngle(vu,e),this._eye.applyQuaternion(No),this.object.up.applyQuaternion(No),this._lastAxis.copy(vu),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),No.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(No),this.object.up.applyQuaternion(No)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Ft.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=rr.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=rr.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,i){return il.set((e-this.screen.left)/this.screen.width,(i-this.screen.top)/this.screen.height),il}_getMouseOnCircle(e,i){return il.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-i))/this.screen.width),il}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i].pointerId==e.pointerId){this._pointers.splice(i,1);return}}_trackPointer(e){let i=this._pointerPositions[e.pointerId];i===void 0&&(i=new lt,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const i=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[i.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}};function u1(o){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(o.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(o),o.pointerType==="touch"?this._onTouchStart(o):this._onMouseDown(o))}function h1(o){this.enabled!==!1&&(o.pointerType==="touch"?this._onTouchMove(o):this._onMouseMove(o))}function d1(o){this.enabled!==!1&&(o.pointerType==="touch"?this._onTouchEnd(o):this._onMouseUp(),this._removePointer(o),this._pointers.length===0&&(this.domElement.releasePointerCapture(o.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function f1(o){this._removePointer(o)}function A1(){this.enabled!==!1&&(this.keyState=Ft.NONE,window.addEventListener("keydown",this._onKeyDown))}function p1(o){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Ft.NONE&&(o.code===this.keys[Ft.ROTATE]&&!this.noRotate?this.keyState=Ft.ROTATE:o.code===this.keys[Ft.ZOOM]&&!this.noZoom?this.keyState=Ft.ZOOM:o.code===this.keys[Ft.PAN]&&!this.noPan&&(this.keyState=Ft.PAN)))}function g1(o){let e;switch(o.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Di.DOLLY:this.state=Ft.ZOOM;break;case Di.ROTATE:this.state=Ft.ROTATE;break;case Di.PAN:this.state=Ft.PAN;break;default:this.state=Ft.NONE}const i=this.keyState!==Ft.NONE?this.keyState:this.state;i===Ft.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(o.pageX,o.pageY)),this._movePrev.copy(this._moveCurr)):i===Ft.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(o.pageX,o.pageY)),this._zoomEnd.copy(this._zoomStart)):i===Ft.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(o.pageX,o.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(nd)}function m1(o){const e=this.keyState!==Ft.NONE?this.keyState:this.state;e===Ft.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(o.pageX,o.pageY))):e===Ft.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(o.pageX,o.pageY)):e===Ft.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(o.pageX,o.pageY))}function v1(){this.state=Ft.NONE,this.dispatchEvent(id)}function b1(o){if(this.enabled!==!1&&this.noZoom!==!0){switch(o.preventDefault(),o.deltaMode){case 2:this._zoomStart.y-=o.deltaY*.025;break;case 1:this._zoomStart.y-=o.deltaY*.01;break;default:this._zoomStart.y-=o.deltaY*25e-5;break}this.dispatchEvent(nd),this.dispatchEvent(id)}}function w1(o){this.enabled!==!1&&o.preventDefault()}function y1(o){switch(this._trackPointer(o),this._pointers.length){case 1:this.state=Ft.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Ft.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,i=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+i*i);const a=(this._pointers[0].pageX+this._pointers[1].pageX)/2,n=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(a,n)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(nd)}function _1(o){switch(this._trackPointer(o),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(o.pageX,o.pageY));break;default:const e=this._getSecondPointerPosition(o),i=o.pageX-e.x,a=o.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(i*i+a*a);const n=(o.pageX+e.x)/2,t=(o.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(n,t));break}}function C1(o){switch(this._pointers.length){case 0:this.state=Ft.NONE;break;case 1:this.state=Ft.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(o.pageX,o.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Ft.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==o.pointerId){const i=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(i.x,i.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(id)}function dB(o,e){var E;st(e,!0);const[i,a]=Vn(),n=()=>cn(l,"$parent",i),t=()=>cn(c,"$camera",i);let r=z(e,"ref",15),s=xt(e,["$$slots","$$events","$$legacy","controls","renderTask","ref","onstart","onchange","onend"]);const l=or(),{camera:c,renderer:h,dom:d,autoRenderTask:f,shouldRender:p,size:m,invalidate:b}=wt();r(new aA(c.current,h));const v=new ri,y=Qe(()=>e.controls??n());zt(((E=e.renderTask)==null?void 0:E.key)??Symbol("threlte-extras-gizmo-render"),()=>{if(p()){const _=h.toneMapping;h.getViewport(v),h.toneMapping=D0,r().render(),h.setViewport(v),h.toneMapping=_}},{autoInvalidate:!1,...e.renderTask??{after:f}}),Ae(()=>{r(r().camera=t(),!0)}),Et(()=>{if(H(y))if(H(y)instanceof yg||H(y)instanceof _g){r(r().target=H(y).target,!0);const _=()=>{r().update(!1)};return H(y).addEventListener("change",_),()=>H(y).removeEventListener("change",_)}else{const _=()=>{"getTarget"in H(y)&&typeof H(y).getTarget=="function"&&(H(y).getTarget(r().target),r().update())},C=()=>{H(y).setPosition(...c.current.position.toArray())};return r().addEventListener("change",C),H(y).addEventListener("update",_),()=>{r().removeEventListener("change",C),H(y).removeEventListener("update",_)}}}),Et(()=>{const _=C=>{var x;H(y).enabled=!1,(x=e.onstart)==null||x.call(e,C)};return r().addEventListener("start",_),()=>r().removeEventListener("start",_)}),Et(()=>{const _=C=>{var x;b(),(x=e.onchange)==null||x.call(e,C)};return r().addEventListener("change",_),()=>r().removeEventListener("change",_)}),Et(()=>{const _=C=>{var x;H(y).enabled=!0,(x=e.onend)==null||x.call(e,C)};return r().addEventListener("end",_),()=>r().removeEventListener("end",_)}),Ae(()=>{d&&(r().dispose(),r(new aA(c.current,h,{container:d,placement:"bottom-left",size:86,...s})),b())}),nn(()=>[m],()=>{r().update(),b()}),Et(()=>()=>r().dispose()),at(),a()}const E1={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},x1={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var I1=Hn("<!> <!> <!>",1);function fB(o,e){st(e,!0);let i=z(e,"opacity",3,1),a=z(e,"width",3,1),n=z(e,"height",3,1),t=z(e,"blur",3,1),r=z(e,"far",3,10),s=z(e,"smooth",3,!0),l=z(e,"resolution",3,512),c=z(e,"frames",3,1/0),h=z(e,"scale",3,10),d=z(e,"color",3,"#000000"),f=z(e,"depthWrite",3,!1),p=z(e,"ref",15),m=xt(e,["$$slots","$$events","$$legacy","opacity","width","height","blur","far","smooth","resolution","frames","scale","color","depthWrite","ref","children"]);const{scene:b,renderer:v}=wt(),y=new pn,E=Qe(()=>a()*(Array.isArray(h())?h()[0]:h()||1)),_=Qe(()=>n()*(Array.isArray(h())?h()[1]:h()||1)),C=Qe(()=>{const Y=new Hl(l(),l());return Y.texture.generateMipmaps=!1,Y.texture.colorSpace=v.outputColorSpace,Y}),x=Qe(()=>{const Y=new Hl(l(),l());return Y.texture.generateMipmaps=!1,Y}),B=Qe(()=>new _r(H(E),H(_)).rotateX(Math.PI/2)),I=Qe(()=>new Re(H(B))),k=Qe(()=>{const Y=new sc({depthTest:!1,depthWrite:!1});return Y.onBeforeCompile=j=>{j.uniforms={...j.uniforms,uColor:{value:new Rt(d()).convertSRGBToLinear()}},j.fragmentShader=`uniform vec3 uColor;
${j.fragmentShader}`,j.fragmentShader=j.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( uColor, ( 1.0 - fragCoordZ ) * 1.0 );"),j.fragmentShader=j.fragmentShader.replace("vec4(vec3(1.0-fragCoordZ),opacity);","vec4(uColor,(1.0-fragCoordZ)*1.0);")},Y}),P=new Gi({...E1,depthTest:!1}),D=new Gi({...x1,depthTest:!1}),U=Qe(()=>new Ia(-H(E)/2,H(E)/2,H(_)/2,-H(_)/2,0,r()));Ae(()=>H(U).updateProjectionMatrix());const S=Qe(()=>new Tn({map:H(C).texture,transparent:!0,opacity:i(),depthWrite:f()})),R=Y=>{H(I).visible=!0,H(I).material=P,P.uniforms.tDiffuse.value=H(C).texture,P.uniforms.h.value=Y*1/256,v.setRenderTarget(H(x)),v.render(H(I),H(U)),H(I).material=D,D.uniforms.tDiffuse.value=H(x).texture,D.uniforms.v.value=Y*1/256,v.setRenderTarget(H(C)),v.render(H(I),H(U)),H(I).visible=!1},Q=()=>{const Y=b.background;b.background=null;const j=b.overrideMaterial;b.overrideMaterial=H(k);const L=v.getClearAlpha();v.setClearAlpha(0),v.setRenderTarget(H(C)),v.render(b,H(U)),b.overrideMaterial=j,R(t()),s()&&R(t()*.4),v.setRenderTarget(null),b.background=Y,v.setClearAlpha(L)},O=()=>{Q()},G=zt(()=>{Q()},{autoStart:!1});let q=0;const Z=zt(()=>{Q(),q+=1,q>=c()&&Z.stop()},{autoStart:!1});return Ae(()=>{c()===Number.POSITIVE_INFINITY?G.start():q<c()&&Z.start()}),di(()=>{H(C).dispose(),H(x).dispose(),H(B).dispose(),H(k).dispose(),P.dispose(),D.dispose(),H(S).dispose()}),qe(o,yt({is:y},()=>m,{get ref(){return p()},set ref(Y){p(Y)},children:(Y,j)=>{var L=tt(),N=ze(L);bi(N,()=>qe.Group,(V,J)=>{J(V,{"rotation.x":Math.PI/2,children:(X,$)=>{var ne=I1(),se=ze(ne);bi(se,()=>qe.Mesh,(oe,ue)=>{ue(oe,{"scale.y":-1,"rotation.x":-Math.PI/2,get material(){return H(S)},get geometry(){return H(B)}})});var _e=In(se,2);qe(_e,{get is(){return H(U)},manual:!0});var be=In(_e,2);ut(be,()=>e.children??ht,()=>({ref:y})),Le(X,ne)},$$slots:{default:!0}})}),Le(Y,L)},$$slots:{default:!0}})),at({refresh:O})}class Cg extends Gp{constructor(e){super(e),this.type=zn}parse(e){const r=function(k,P){switch(k){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(P||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(P||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(P||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(P||""))}},h=`
`,d=function(k,P,D){P=P||1024;let S=k.pos,R=-1,Q=0,O="",G=String.fromCharCode.apply(null,new Uint16Array(k.subarray(S,S+128)));for(;0>(R=G.indexOf(h))&&Q<P&&S<k.byteLength;)O+=G,Q+=G.length,S+=128,G+=String.fromCharCode.apply(null,new Uint16Array(k.subarray(S,S+128)));return-1<R?(k.pos+=Q+R+1,O+G.slice(0,R)):!1},f=function(k){const P=/^#\?(\S+)/,D=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,S=/^\s*FORMAT=(\S+)\s*$/,R=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,Q={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let O,G;for((k.pos>=k.byteLength||!(O=d(k)))&&r(1,"no header found"),(G=O.match(P))||r(3,"bad initial token"),Q.valid|=1,Q.programtype=G[1],Q.string+=O+`
`;O=d(k),O!==!1;){if(Q.string+=O+`
`,O.charAt(0)==="#"){Q.comments+=O+`
`;continue}if((G=O.match(D))&&(Q.gamma=parseFloat(G[1])),(G=O.match(U))&&(Q.exposure=parseFloat(G[1])),(G=O.match(S))&&(Q.valid|=2,Q.format=G[1]),(G=O.match(R))&&(Q.valid|=4,Q.height=parseInt(G[1],10),Q.width=parseInt(G[2],10)),Q.valid&2&&Q.valid&4)break}return Q.valid&2||r(3,"missing format specifier"),Q.valid&4||r(3,"missing image size specifier"),Q},p=function(k,P,D){const U=P;if(U<8||U>32767||k[0]!==2||k[1]!==2||k[2]&128)return new Uint8Array(k);U!==(k[2]<<8|k[3])&&r(3,"wrong scanline width");const S=new Uint8Array(4*P*D);S.length||r(4,"unable to allocate buffer space");let R=0,Q=0;const O=4*U,G=new Uint8Array(4),q=new Uint8Array(O);let Z=D;for(;Z>0&&Q<k.byteLength;){Q+4>k.byteLength&&r(1),G[0]=k[Q++],G[1]=k[Q++],G[2]=k[Q++],G[3]=k[Q++],(G[0]!=2||G[1]!=2||(G[2]<<8|G[3])!=U)&&r(3,"bad rgbe scanline format");let Y=0,j;for(;Y<O&&Q<k.byteLength;){j=k[Q++];const N=j>128;if(N&&(j-=128),(j===0||Y+j>O)&&r(3,"bad scanline data"),N){const V=k[Q++];for(let J=0;J<j;J++)q[Y++]=V}else q.set(k.subarray(Q,Q+j),Y),Y+=j,Q+=j}const L=U;for(let N=0;N<L;N++){let V=0;S[R]=q[N+V],V+=U,S[R+1]=q[N+V],V+=U,S[R+2]=q[N+V],V+=U,S[R+3]=q[N+V],R+=4}Z--}return S},m=function(k,P,D,U){const S=k[P+3],R=Math.pow(2,S-128)/255;D[U+0]=k[P+0]*R,D[U+1]=k[P+1]*R,D[U+2]=k[P+2]*R,D[U+3]=1},b=function(k,P,D,U){const S=k[P+3],R=Math.pow(2,S-128)/255;D[U+0]=ns.toHalfFloat(Math.min(k[P+0]*R,65504)),D[U+1]=ns.toHalfFloat(Math.min(k[P+1]*R,65504)),D[U+2]=ns.toHalfFloat(Math.min(k[P+2]*R,65504)),D[U+3]=ns.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const y=f(v),E=y.width,_=y.height,C=p(v.subarray(v.pos),E,_);let x,B,I;switch(this.type){case fn:I=C.length/4;const k=new Float32Array(I*4);for(let D=0;D<I;D++)m(C,D*4,k,D*4);x=k,B=fn;break;case zn:I=C.length/4;const P=new Uint16Array(I*4);for(let D=0;D<I;D++)b(C,D*4,P,D*4);x=P,B=zn;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:E,height:_,data:x,header:y.string,gamma:y.gamma,exposure:y.exposure,type:B}}setDataType(e){return this.type=e,this}load(e,i,a,n){function t(r,s){switch(r.type){case fn:case zn:r.colorSpace=Yn,r.minFilter=bn,r.magFilter=bn,r.generateMipmaps=!1,r.flipY=!0;break}i&&i(r,s)}return super.load(e,t,a,n)}}class B1 extends Ea{constructor(e){super(e),this.hdrLoader=new Cg,this.type=zn}load(e,i,a,n){const t=new T0;switch(t.type=this.type,t.type){case fn:t.colorSpace=Yn,t.minFilter=bn,t.magFilter=bn,t.generateMipmaps=!1;break;case zn:t.colorSpace=Yn,t.minFilter=bn,t.magFilter=bn,t.generateMipmaps=!1;break}const r=this;let s=0;function l(c,h,d,f){new tr(r.manager).setPath(r.path).setResponseType("arraybuffer").setWithCredentials(r.withCredentials).load(e[c],function(p){s++;const m=r.hdrLoader.parse(p);if(m){if(m.data!==void 0){const b=new Kr(m.data,m.width,m.height);b.type=t.type,b.colorSpace=t.colorSpace,b.format=t.format,b.minFilter=t.minFilter,b.magFilter=t.magFilter,b.generateMipmaps=t.generateMipmaps,t.images[c]=b}s===6&&(t.needsUpdate=!0,h&&h(t))}},d,f)}for(let c=0;c<e.length;c++)l(c,i,a,n);return t}setDataType(e){return this.type=e,this.hdrLoader.setDataType(e),this}}const rd=o=>{const{invalidate:e}=wt();nn(()=>[o.scene],([n])=>{const{background:t,environment:r}=n;return()=>{n.background=t,n.environment=r}});let i=Ti(void 0),a=Ti(void 0);nn(()=>[o.scene],([n])=>{rn(i,er(n.background)),rn(a,er(n.environment))}),Et(()=>{if(!(o.texture===void 0||!o.isBackground))return o.scene.background=o.texture,e(),()=>{H(i)!==void 0&&(o.scene.background=H(i),e())}}),Et(()=>{if(o.texture!==void 0)return o.scene.environment=o.texture,e(),()=>{H(a)!==void 0&&(o.scene.environment=H(a),e())}})},Or={};function AB(o,e){st(e,!0);const i=wt();let a=z(e,"isBackground",3,!1),n=z(e,"scene",19,()=>i.scene),t=z(e,"texture",15);const r=Bp(),s=Er();rd({get scene(){return n()},get isBackground(){return a()},get texture(){return t()}});const l=Qe(()=>{var d;return(d=e.urls)==null?void 0:d[0]}),c=Qe(()=>{var d;return((d=H(l))==null?void 0:d.endsWith("hdr"))??!1}),h=Qe(()=>{if(e.urls!==void 0)return H(c)?(Or.hdr??(Or.hdr=new B1),Or.hdr):(Or.tex??(Or.tex=new M0),Or.tex)});Et(()=>{if(e.urls===void 0||H(h)===void 0)return;const d=s(r.remember(()=>H(h).loadAsync(e.urls),e.urls));return d.then(f=>{t(f)}),()=>{d.then(f=>{f.dispose()})}}),at()}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Bi=Uint8Array,is=Uint16Array,S1=Int32Array,Eg=new Bi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xg=new Bi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),k1=new Bi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ig=function(o,e){for(var i=new is(31),a=0;a<31;++a)i[a]=e+=1<<o[a-1];for(var n=new S1(i[30]),a=1;a<30;++a)for(var t=i[a];t<i[a+1];++t)n[t]=t-i[a]<<5|a;return{b:i,r:n}},Bg=Ig(Eg,2),Sg=Bg.b,D1=Bg.r;Sg[28]=258,D1[258]=28;var T1=Ig(xg,0),M1=T1.b,uh=new is(32768);for(var Jt=0;Jt<32768;++Jt){var Gr=(Jt&43690)>>1|(Jt&21845)<<1;Gr=(Gr&52428)>>2|(Gr&13107)<<2,Gr=(Gr&61680)>>4|(Gr&3855)<<4,uh[Jt]=((Gr&65280)>>8|(Gr&255)<<8)>>1}var la=function(o,e,i){for(var a=o.length,n=0,t=new is(e);n<a;++n)o[n]&&++t[o[n]-1];var r=new is(e);for(n=1;n<e;++n)r[n]=r[n-1]+t[n-1]<<1;var s;if(i){s=new is(1<<e);var l=15-e;for(n=0;n<a;++n)if(o[n])for(var c=n<<4|o[n],h=e-o[n],d=r[o[n]-1]++<<h,f=d|(1<<h)-1;d<=f;++d)s[uh[d]>>l]=c}else for(s=new is(a),n=0;n<a;++n)o[n]&&(s[n]=uh[r[o[n]-1]++]>>15-o[n]);return s},Sa=new Bi(288);for(var Jt=0;Jt<144;++Jt)Sa[Jt]=8;for(var Jt=144;Jt<256;++Jt)Sa[Jt]=9;for(var Jt=256;Jt<280;++Jt)Sa[Jt]=7;for(var Jt=280;Jt<288;++Jt)Sa[Jt]=8;var kg=new Bi(32);for(var Jt=0;Jt<32;++Jt)kg[Jt]=5;var P1=la(Sa,9,1),Q1=la(kg,5,1),wu=function(o){for(var e=o[0],i=1;i<o.length;++i)o[i]>e&&(e=o[i]);return e},Qi=function(o,e,i){var a=e/8|0;return(o[a]|o[a+1]<<8)>>(e&7)&i},yu=function(o,e){var i=e/8|0;return(o[i]|o[i+1]<<8|o[i+2]<<16)>>(e&7)},R1=function(o){return(o+7)/8|0},U1=function(o,e,i){return(i==null||i>o.length)&&(i=o.length),new Bi(o.subarray(e,i))},F1=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Fi=function(o,e,i){var a=new Error(e||F1[o]);if(a.code=o,Error.captureStackTrace&&Error.captureStackTrace(a,Fi),!i)throw a;return a},L1=function(o,e,i,a){var n=o.length,t=0;if(!n||e.f&&!e.l)return i||new Bi(0);var r=!i,s=r||e.i!=2,l=e.i;r&&(i=new Bi(n*3));var c=function(oe){var ue=i.length;if(oe>ue){var We=new Bi(Math.max(ue*2,oe));We.set(i),i=We}},h=e.f||0,d=e.p||0,f=e.b||0,p=e.l,m=e.d,b=e.m,v=e.n,y=n*8;do{if(!p){h=Qi(o,d,1);var E=Qi(o,d+1,3);if(d+=3,E)if(E==1)p=P1,m=Q1,b=9,v=5;else if(E==2){var B=Qi(o,d,31)+257,I=Qi(o,d+10,15)+4,k=B+Qi(o,d+5,31)+1;d+=14;for(var P=new Bi(k),D=new Bi(19),U=0;U<I;++U)D[k1[U]]=Qi(o,d+U*3,7);d+=I*3;for(var S=wu(D),R=(1<<S)-1,Q=la(D,S,1),U=0;U<k;){var O=Q[Qi(o,d,R)];d+=O&15;var _=O>>4;if(_<16)P[U++]=_;else{var G=0,q=0;for(_==16?(q=3+Qi(o,d,3),d+=2,G=P[U-1]):_==17?(q=3+Qi(o,d,7),d+=3):_==18&&(q=11+Qi(o,d,127),d+=7);q--;)P[U++]=G}}var Z=P.subarray(0,B),Y=P.subarray(B);b=wu(Z),v=wu(Y),p=la(Z,b,1),m=la(Y,v,1)}else Fi(1);else{var _=R1(d)+4,C=o[_-4]|o[_-3]<<8,x=_+C;if(x>n){l&&Fi(0);break}s&&c(f+C),i.set(o.subarray(_,x),f),e.b=f+=C,e.p=d=x*8,e.f=h;continue}if(d>y){l&&Fi(0);break}}s&&c(f+131072);for(var j=(1<<b)-1,L=(1<<v)-1,N=d;;N=d){var G=p[yu(o,d)&j],V=G>>4;if(d+=G&15,d>y){l&&Fi(0);break}if(G||Fi(2),V<256)i[f++]=V;else if(V==256){N=d,p=null;break}else{var J=V-254;if(V>264){var U=V-257,X=Eg[U];J=Qi(o,d,(1<<X)-1)+Sg[U],d+=X}var $=m[yu(o,d)&L],ne=$>>4;$||Fi(3),d+=$&15;var Y=M1[ne];if(ne>3){var X=xg[ne];Y+=yu(o,d)&(1<<X)-1,d+=X}if(d>y){l&&Fi(0);break}s&&c(f+131072);var se=f+J;if(f<Y){var _e=t-Y,be=Math.min(Y,se);for(_e+f<0&&Fi(3);f<be;++f)i[f]=a[_e+f]}for(;f<se;++f)i[f]=i[f-Y]}}e.l=p,e.p=N,e.b=f,e.f=h,p&&(h=1,e.m=b,e.d=m,e.n=v)}while(!h);return f!=i.length&&r?U1(i,0,f):i.subarray(0,f)},O1=new Bi(0),G1=function(o,e){return((o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31)&&Fi(6,"invalid zlib data"),(o[1]>>5&1)==1&&Fi(6,"invalid zlib data: "+(o[1]&32?"need":"unexpected")+" dictionary"),(o[1]>>3&4)+2};function al(o,e){return L1(o.subarray(G1(o),-4),{i:2},e,e)}var N1=typeof TextDecoder<"u"&&new TextDecoder,z1=0;try{N1.decode(O1,{stream:!0}),z1=1}catch{}class H1 extends Gp{constructor(e){super(e),this.type=zn}parse(e){const P=Math.pow(2.7182818,2.2);function D(T,F){let W=0;for(let fe=0;fe<65536;++fe)(fe==0||T[fe>>3]&1<<(fe&7))&&(F[W++]=fe);const ee=W-1;for(;W<65536;)F[W++]=0;return ee}function U(T){for(let F=0;F<16384;F++)T[F]={},T[F].len=0,T[F].lit=0,T[F].p=null}const S={l:0,c:0,lc:0};function R(T,F,W,ee,fe){for(;W<T;)F=F<<8|we(ee,fe),W+=8;W-=T,S.l=F>>W&(1<<T)-1,S.c=F,S.lc=W}const Q=new Array(59);function O(T){for(let W=0;W<=58;++W)Q[W]=0;for(let W=0;W<65537;++W)Q[T[W]]+=1;let F=0;for(let W=58;W>0;--W){const ee=F+Q[W]>>1;Q[W]=F,F=ee}for(let W=0;W<65537;++W){const ee=T[W];ee>0&&(T[W]=ee|Q[ee]++<<6)}}function G(T,F,W,ee,fe,le){const ae=F;let Me=0,ye=0;for(;ee<=fe;ee++){if(ae.value-F.value>W)return!1;R(6,Me,ye,T,ae);const ve=S.l;if(Me=S.c,ye=S.lc,le[ee]=ve,ve==63){if(ae.value-F.value>W)throw new Error("Something wrong with hufUnpackEncTable");R(8,Me,ye,T,ae);let me=S.l+6;if(Me=S.c,ye=S.lc,ee+me>fe+1)throw new Error("Something wrong with hufUnpackEncTable");for(;me--;)le[ee++]=0;ee--}else if(ve>=59){let me=ve-59+2;if(ee+me>fe+1)throw new Error("Something wrong with hufUnpackEncTable");for(;me--;)le[ee++]=0;ee--}}O(le)}function q(T){return T&63}function Z(T){return T>>6}function Y(T,F,W,ee){for(;F<=W;F++){const fe=Z(T[F]),le=q(T[F]);if(fe>>le)throw new Error("Invalid table entry");if(le>14){const ae=ee[fe>>le-14];if(ae.len)throw new Error("Invalid table entry");if(ae.lit++,ae.p){const Me=ae.p;ae.p=new Array(ae.lit);for(let ye=0;ye<ae.lit-1;++ye)ae.p[ye]=Me[ye]}else ae.p=new Array(1);ae.p[ae.lit-1]=F}else if(le){let ae=0;for(let Me=1<<14-le;Me>0;Me--){const ye=ee[(fe<<14-le)+ae];if(ye.len||ye.p)throw new Error("Invalid table entry");ye.len=le,ye.lit=F,ae++}}}return!0}const j={c:0,lc:0};function L(T,F,W,ee){T=T<<8|we(W,ee),F+=8,j.c=T,j.lc=F}const N={c:0,lc:0};function V(T,F,W,ee,fe,le,ae,Me,ye){if(T==F){ee<8&&(L(W,ee,fe,le),W=j.c,ee=j.lc),ee-=8;let ve=W>>ee;if(ve=new Uint8Array([ve])[0],Me.value+ve>ye)return!1;const me=ae[Me.value-1];for(;ve-- >0;)ae[Me.value++]=me}else if(Me.value<ye)ae[Me.value++]=T;else return!1;N.c=W,N.lc=ee}function J(T){return T&65535}function X(T){const F=J(T);return F>32767?F-65536:F}const $={a:0,b:0};function ne(T,F){const W=X(T),fe=X(F),le=W+(fe&1)+(fe>>1),ae=le,Me=le-fe;$.a=ae,$.b=Me}function se(T,F){const W=J(T),ee=J(F),fe=W-(ee>>1)&65535,le=ee+fe-32768&65535;$.a=le,$.b=fe}function _e(T,F,W,ee,fe,le,ae){const Me=ae<16384,ye=W>fe?fe:W;let ve=1,me,Ne;for(;ve<=ye;)ve<<=1;for(ve>>=1,me=ve,ve>>=1;ve>=1;){Ne=0;const Ye=Ne+le*(fe-me),Ve=le*ve,nt=le*me,je=ee*ve,Xe=ee*me;let ft,St,Vt,hn;for(;Ne<=Ye;Ne+=nt){let Pt=Ne;const bt=Ne+ee*(W-me);for(;Pt<=bt;Pt+=Xe){const Yt=Pt+je,kn=Pt+Ve,$t=kn+je;Me?(ne(T[Pt+F],T[kn+F]),ft=$.a,Vt=$.b,ne(T[Yt+F],T[$t+F]),St=$.a,hn=$.b,ne(ft,St),T[Pt+F]=$.a,T[Yt+F]=$.b,ne(Vt,hn),T[kn+F]=$.a,T[$t+F]=$.b):(se(T[Pt+F],T[kn+F]),ft=$.a,Vt=$.b,se(T[Yt+F],T[$t+F]),St=$.a,hn=$.b,se(ft,St),T[Pt+F]=$.a,T[Yt+F]=$.b,se(Vt,hn),T[kn+F]=$.a,T[$t+F]=$.b)}if(W&ve){const Yt=Pt+Ve;Me?ne(T[Pt+F],T[Yt+F]):se(T[Pt+F],T[Yt+F]),ft=$.a,T[Yt+F]=$.b,T[Pt+F]=ft}}if(fe&ve){let Pt=Ne;const bt=Ne+ee*(W-me);for(;Pt<=bt;Pt+=Xe){const Yt=Pt+je;Me?ne(T[Pt+F],T[Yt+F]):se(T[Pt+F],T[Yt+F]),ft=$.a,T[Yt+F]=$.b,T[Pt+F]=ft}}me=ve,ve>>=1}return Ne}function be(T,F,W,ee,fe,le,ae,Me,ye){let ve=0,me=0;const Ne=ae,Ye=Math.trunc(ee.value+(fe+7)/8);for(;ee.value<Ye;)for(L(ve,me,W,ee),ve=j.c,me=j.lc;me>=14;){const nt=ve>>me-14&16383,je=F[nt];if(je.len)me-=je.len,V(je.lit,le,ve,me,W,ee,Me,ye,Ne),ve=N.c,me=N.lc;else{if(!je.p)throw new Error("hufDecode issues");let Xe;for(Xe=0;Xe<je.lit;Xe++){const ft=q(T[je.p[Xe]]);for(;me<ft&&ee.value<Ye;)L(ve,me,W,ee),ve=j.c,me=j.lc;if(me>=ft&&Z(T[je.p[Xe]])==(ve>>me-ft&(1<<ft)-1)){me-=ft,V(je.p[Xe],le,ve,me,W,ee,Me,ye,Ne),ve=N.c,me=N.lc;break}}if(Xe==je.lit)throw new Error("hufDecode issues")}}const Ve=8-fe&7;for(ve>>=Ve,me-=Ve;me>0;){const nt=F[ve<<14-me&16383];if(nt.len)me-=nt.len,V(nt.lit,le,ve,me,W,ee,Me,ye,Ne),ve=N.c,me=N.lc;else throw new Error("hufDecode issues")}return!0}function oe(T,F,W,ee,fe,le){const ae={value:0},Me=W.value,ye=Ze(F,W),ve=Ze(F,W);W.value+=4;const me=Ze(F,W);if(W.value+=4,ye<0||ye>=65537||ve<0||ve>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Ne=new Array(65537),Ye=new Array(16384);U(Ye);const Ve=ee-(W.value-Me);if(G(T,W,Ve,ye,ve,Ne),me>8*(ee-(W.value-Me)))throw new Error("Something wrong with hufUncompress");Y(Ne,ye,ve,Ye),be(Ne,Ye,T,W,me,ve,le,fe,ae)}function ue(T,F,W){for(let ee=0;ee<W;++ee)F[ee]=T[F[ee]]}function We(T){for(let F=1;F<T.length;F++){const W=T[F-1]+T[F]-128;T[F]=W}}function Te(T,F){let W=0,ee=Math.floor((T.length+1)/2),fe=0;const le=T.length-1;for(;!(fe>le||(F[fe++]=T[W++],fe>le));)F[fe++]=T[ee++]}function Se(T){let F=T.byteLength;const W=new Array;let ee=0;const fe=new DataView(T);for(;F>0;){const le=fe.getInt8(ee++);if(le<0){const ae=-le;F-=ae+1;for(let Me=0;Me<ae;Me++)W.push(fe.getUint8(ee++))}else{const ae=le;F-=2;const Me=fe.getUint8(ee++);for(let ye=0;ye<ae+1;ye++)W.push(Me)}}return W}function Be(T,F,W,ee,fe,le){let ae=new DataView(le.buffer);const Me=W[T.idx[0]].width,ye=W[T.idx[0]].height,ve=3,me=Math.floor(Me/8),Ne=Math.ceil(Me/8),Ye=Math.ceil(ye/8),Ve=Me-(Ne-1)*8,nt=ye-(Ye-1)*8,je={value:0},Xe=new Array(ve),ft=new Array(ve),St=new Array(ve),Vt=new Array(ve),hn=new Array(ve);for(let bt=0;bt<ve;++bt)hn[bt]=F[T.idx[bt]],Xe[bt]=bt<1?0:Xe[bt-1]+Ne*Ye,ft[bt]=new Float32Array(64),St[bt]=new Uint16Array(64),Vt[bt]=new Uint16Array(Ne*64);for(let bt=0;bt<Ye;++bt){let Yt=8;bt==Ye-1&&(Yt=nt);let kn=8;for(let vt=0;vt<Ne;++vt){vt==Ne-1&&(kn=Ve);for(let Ot=0;Ot<ve;++Ot)St[Ot].fill(0),St[Ot][0]=fe[Xe[Ot]++],Ue(je,ee,St[Ot]),ke(St[Ot],ft[Ot]),He(ft[Ot]);he(ft);for(let Ot=0;Ot<ve;++Ot)te(ft[Ot],Vt[Ot],vt*64)}let $t=0;for(let vt=0;vt<ve;++vt){const Ot=W[T.idx[vt]].type;for(let jn=8*bt;jn<8*bt+Yt;++jn){$t=hn[vt][jn];for(let fi=0;fi<me;++fi){const Jn=fi*64+(jn&7)*8;ae.setUint16($t+0*2*Ot,Vt[vt][Jn+0],!0),ae.setUint16($t+1*2*Ot,Vt[vt][Jn+1],!0),ae.setUint16($t+2*2*Ot,Vt[vt][Jn+2],!0),ae.setUint16($t+3*2*Ot,Vt[vt][Jn+3],!0),ae.setUint16($t+4*2*Ot,Vt[vt][Jn+4],!0),ae.setUint16($t+5*2*Ot,Vt[vt][Jn+5],!0),ae.setUint16($t+6*2*Ot,Vt[vt][Jn+6],!0),ae.setUint16($t+7*2*Ot,Vt[vt][Jn+7],!0),$t+=8*2*Ot}}if(me!=Ne)for(let jn=8*bt;jn<8*bt+Yt;++jn){const fi=hn[vt][jn]+8*me*2*Ot,Jn=me*64+(jn&7)*8;for(let Zn=0;Zn<kn;++Zn)ae.setUint16(fi+Zn*2*Ot,Vt[vt][Jn+Zn],!0)}}}const Pt=new Uint16Array(Me);ae=new DataView(le.buffer);for(let bt=0;bt<ve;++bt){W[T.idx[bt]].decoded=!0;const Yt=W[T.idx[bt]].type;if(W[bt].type==2)for(let kn=0;kn<ye;++kn){const $t=hn[bt][kn];for(let vt=0;vt<Me;++vt)Pt[vt]=ae.getUint16($t+vt*2*Yt,!0);for(let vt=0;vt<Me;++vt)ae.setFloat32($t+vt*2*Yt,ce(Pt[vt]),!0)}}}function Ue(T,F,W){let ee,fe=1;for(;fe<64;)ee=F[T.value],ee==65280?fe=64:ee>>8==255?fe+=ee&255:(W[fe]=ee,fe++),T.value++}function ke(T,F){F[0]=ce(T[0]),F[1]=ce(T[1]),F[2]=ce(T[5]),F[3]=ce(T[6]),F[4]=ce(T[14]),F[5]=ce(T[15]),F[6]=ce(T[27]),F[7]=ce(T[28]),F[8]=ce(T[2]),F[9]=ce(T[4]),F[10]=ce(T[7]),F[11]=ce(T[13]),F[12]=ce(T[16]),F[13]=ce(T[26]),F[14]=ce(T[29]),F[15]=ce(T[42]),F[16]=ce(T[3]),F[17]=ce(T[8]),F[18]=ce(T[12]),F[19]=ce(T[17]),F[20]=ce(T[25]),F[21]=ce(T[30]),F[22]=ce(T[41]),F[23]=ce(T[43]),F[24]=ce(T[9]),F[25]=ce(T[11]),F[26]=ce(T[18]),F[27]=ce(T[24]),F[28]=ce(T[31]),F[29]=ce(T[40]),F[30]=ce(T[44]),F[31]=ce(T[53]),F[32]=ce(T[10]),F[33]=ce(T[19]),F[34]=ce(T[23]),F[35]=ce(T[32]),F[36]=ce(T[39]),F[37]=ce(T[45]),F[38]=ce(T[52]),F[39]=ce(T[54]),F[40]=ce(T[20]),F[41]=ce(T[22]),F[42]=ce(T[33]),F[43]=ce(T[38]),F[44]=ce(T[46]),F[45]=ce(T[51]),F[46]=ce(T[55]),F[47]=ce(T[60]),F[48]=ce(T[21]),F[49]=ce(T[34]),F[50]=ce(T[37]),F[51]=ce(T[47]),F[52]=ce(T[50]),F[53]=ce(T[56]),F[54]=ce(T[59]),F[55]=ce(T[61]),F[56]=ce(T[35]),F[57]=ce(T[36]),F[58]=ce(T[48]),F[59]=ce(T[49]),F[60]=ce(T[57]),F[61]=ce(T[58]),F[62]=ce(T[62]),F[63]=ce(T[63])}function He(T){const F=.5*Math.cos(.7853975),W=.5*Math.cos(3.14159/16),ee=.5*Math.cos(3.14159/8),fe=.5*Math.cos(3*3.14159/16),le=.5*Math.cos(5*3.14159/16),ae=.5*Math.cos(3*3.14159/8),Me=.5*Math.cos(7*3.14159/16),ye=new Array(4),ve=new Array(4),me=new Array(4),Ne=new Array(4);for(let Ye=0;Ye<8;++Ye){const Ve=Ye*8;ye[0]=ee*T[Ve+2],ye[1]=ae*T[Ve+2],ye[2]=ee*T[Ve+6],ye[3]=ae*T[Ve+6],ve[0]=W*T[Ve+1]+fe*T[Ve+3]+le*T[Ve+5]+Me*T[Ve+7],ve[1]=fe*T[Ve+1]-Me*T[Ve+3]-W*T[Ve+5]-le*T[Ve+7],ve[2]=le*T[Ve+1]-W*T[Ve+3]+Me*T[Ve+5]+fe*T[Ve+7],ve[3]=Me*T[Ve+1]-le*T[Ve+3]+fe*T[Ve+5]-W*T[Ve+7],me[0]=F*(T[Ve+0]+T[Ve+4]),me[3]=F*(T[Ve+0]-T[Ve+4]),me[1]=ye[0]+ye[3],me[2]=ye[1]-ye[2],Ne[0]=me[0]+me[1],Ne[1]=me[3]+me[2],Ne[2]=me[3]-me[2],Ne[3]=me[0]-me[1],T[Ve+0]=Ne[0]+ve[0],T[Ve+1]=Ne[1]+ve[1],T[Ve+2]=Ne[2]+ve[2],T[Ve+3]=Ne[3]+ve[3],T[Ve+4]=Ne[3]-ve[3],T[Ve+5]=Ne[2]-ve[2],T[Ve+6]=Ne[1]-ve[1],T[Ve+7]=Ne[0]-ve[0]}for(let Ye=0;Ye<8;++Ye)ye[0]=ee*T[16+Ye],ye[1]=ae*T[16+Ye],ye[2]=ee*T[48+Ye],ye[3]=ae*T[48+Ye],ve[0]=W*T[8+Ye]+fe*T[24+Ye]+le*T[40+Ye]+Me*T[56+Ye],ve[1]=fe*T[8+Ye]-Me*T[24+Ye]-W*T[40+Ye]-le*T[56+Ye],ve[2]=le*T[8+Ye]-W*T[24+Ye]+Me*T[40+Ye]+fe*T[56+Ye],ve[3]=Me*T[8+Ye]-le*T[24+Ye]+fe*T[40+Ye]-W*T[56+Ye],me[0]=F*(T[Ye]+T[32+Ye]),me[3]=F*(T[Ye]-T[32+Ye]),me[1]=ye[0]+ye[3],me[2]=ye[1]-ye[2],Ne[0]=me[0]+me[1],Ne[1]=me[3]+me[2],Ne[2]=me[3]-me[2],Ne[3]=me[0]-me[1],T[0+Ye]=Ne[0]+ve[0],T[8+Ye]=Ne[1]+ve[1],T[16+Ye]=Ne[2]+ve[2],T[24+Ye]=Ne[3]+ve[3],T[32+Ye]=Ne[3]-ve[3],T[40+Ye]=Ne[2]-ve[2],T[48+Ye]=Ne[1]-ve[1],T[56+Ye]=Ne[0]-ve[0]}function he(T){for(let F=0;F<64;++F){const W=T[0][F],ee=T[1][F],fe=T[2][F];T[0][F]=W+1.5747*fe,T[1][F]=W-.1873*ee-.4682*fe,T[2][F]=W+1.8556*ee}}function te(T,F,W){for(let ee=0;ee<64;++ee)F[W+ee]=ns.toHalfFloat(Ee(T[ee]))}function Ee(T){return T<=1?Math.sign(T)*Math.pow(Math.abs(T),2.2):Math.sign(T)*Math.pow(P,Math.abs(T)-1)}function pe(T){return new DataView(T.array.buffer,T.offset.value,T.size)}function Ce(T){const F=T.viewer.buffer.slice(T.offset.value,T.offset.value+T.size),W=new Uint8Array(Se(F)),ee=new Uint8Array(W.length);return We(W),Te(W,ee),new DataView(ee.buffer)}function ge(T){const F=T.array.slice(T.offset.value,T.offset.value+T.size),W=al(F),ee=new Uint8Array(W.length);return We(W),Te(W,ee),new DataView(ee.buffer)}function Je(T){const F=T.viewer,W={value:T.offset.value},ee=new Uint16Array(T.columns*T.lines*(T.inputChannels.length*T.type)),fe=new Uint8Array(8192);let le=0;const ae=new Array(T.inputChannels.length);for(let nt=0,je=T.inputChannels.length;nt<je;nt++)ae[nt]={},ae[nt].start=le,ae[nt].end=ae[nt].start,ae[nt].nx=T.columns,ae[nt].ny=T.lines,ae[nt].size=T.type,le+=ae[nt].nx*ae[nt].ny*ae[nt].size;const Me=Ke(F,W),ye=Ke(F,W);if(ye>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Me<=ye)for(let nt=0;nt<ye-Me+1;nt++)fe[nt+Me]=ot(F,W);const ve=new Uint16Array(65536),me=D(fe,ve),Ne=Ze(F,W);oe(T.array,F,W,Ne,ee,le);for(let nt=0;nt<T.inputChannels.length;++nt){const je=ae[nt];for(let Xe=0;Xe<ae[nt].size;++Xe)_e(ee,je.start+Xe,je.nx,je.size,je.ny,je.nx*je.size,me)}ue(ve,ee,le);let Ye=0;const Ve=new Uint8Array(ee.buffer.byteLength);for(let nt=0;nt<T.lines;nt++)for(let je=0;je<T.inputChannels.length;je++){const Xe=ae[je],ft=Xe.nx*Xe.size,St=new Uint8Array(ee.buffer,Xe.end*2,ft*2);Ve.set(St,Ye),Ye+=ft*2,Xe.end+=ft}return new DataView(Ve.buffer)}function de(T){const F=T.array.slice(T.offset.value,T.offset.value+T.size),W=al(F),ee=T.inputChannels.length*T.lines*T.columns*T.totalBytes,fe=new ArrayBuffer(ee),le=new DataView(fe);let ae=0,Me=0;const ye=new Array(4);for(let ve=0;ve<T.lines;ve++)for(let me=0;me<T.inputChannels.length;me++){let Ne=0;switch(T.inputChannels[me].pixelType){case 1:ye[0]=ae,ye[1]=ye[0]+T.columns,ae=ye[1]+T.columns;for(let Ve=0;Ve<T.columns;++Ve){const nt=W[ye[0]++]<<8|W[ye[1]++];Ne+=nt,le.setUint16(Me,Ne,!0),Me+=2}break;case 2:ye[0]=ae,ye[1]=ye[0]+T.columns,ye[2]=ye[1]+T.columns,ae=ye[2]+T.columns;for(let Ve=0;Ve<T.columns;++Ve){const nt=W[ye[0]++]<<24|W[ye[1]++]<<16|W[ye[2]++]<<8;Ne+=nt,le.setUint32(Me,Ne,!0),Me+=4}break}}return le}function xe(T){const F=T.viewer,W={value:T.offset.value},ee=new Uint8Array(T.columns*T.lines*(T.inputChannels.length*T.type*2)),fe={version:$e(F,W),unknownUncompressedSize:$e(F,W),unknownCompressedSize:$e(F,W),acCompressedSize:$e(F,W),dcCompressedSize:$e(F,W),rleCompressedSize:$e(F,W),rleUncompressedSize:$e(F,W),rleRawSize:$e(F,W),totalAcUncompressedCount:$e(F,W),totalDcUncompressedCount:$e(F,W),acCompression:$e(F,W)};if(fe.version<2)throw new Error("EXRLoader.parse: "+wi.compression+" version "+fe.version+" is unsupported");const le=new Array;let ae=Ke(F,W)-2;for(;ae>0;){const je=Ie(F.buffer,W),Xe=ot(F,W),ft=Xe>>2&3,St=(Xe>>4)-1,Vt=new Int8Array([St])[0],hn=ot(F,W);le.push({name:je,index:Vt,type:hn,compression:ft}),ae-=je.length+3}const Me=wi.channels,ye=new Array(T.inputChannels.length);for(let je=0;je<T.inputChannels.length;++je){const Xe=ye[je]={},ft=Me[je];Xe.name=ft.name,Xe.compression=0,Xe.decoded=!1,Xe.type=ft.pixelType,Xe.pLinear=ft.pLinear,Xe.width=T.columns,Xe.height=T.lines}const ve={idx:new Array(3)};for(let je=0;je<T.inputChannels.length;++je){const Xe=ye[je];for(let ft=0;ft<le.length;++ft){const St=le[ft];Xe.name==St.name&&(Xe.compression=St.compression,St.index>=0&&(ve.idx[St.index]=je),Xe.offset=je)}}let me,Ne,Ye;if(fe.acCompressedSize>0)switch(fe.acCompression){case 0:me=new Uint16Array(fe.totalAcUncompressedCount),oe(T.array,F,W,fe.acCompressedSize,me,fe.totalAcUncompressedCount);break;case 1:const je=T.array.slice(W.value,W.value+fe.totalAcUncompressedCount),Xe=al(je);me=new Uint16Array(Xe.buffer),W.value+=fe.totalAcUncompressedCount;break}if(fe.dcCompressedSize>0){const je={array:T.array,offset:W,size:fe.dcCompressedSize};Ne=new Uint16Array(ge(je).buffer),W.value+=fe.dcCompressedSize}if(fe.rleRawSize>0){const je=T.array.slice(W.value,W.value+fe.rleCompressedSize),Xe=al(je);Ye=Se(Xe.buffer),W.value+=fe.rleCompressedSize}let Ve=0;const nt=new Array(ye.length);for(let je=0;je<nt.length;++je)nt[je]=new Array;for(let je=0;je<T.lines;++je)for(let Xe=0;Xe<ye.length;++Xe)nt[Xe].push(Ve),Ve+=ye[Xe].width*T.type*2;Be(ve,nt,ye,me,Ne,ee);for(let je=0;je<ye.length;++je){const Xe=ye[je];if(!Xe.decoded)switch(Xe.compression){case 2:let ft=0,St=0;for(let Vt=0;Vt<T.lines;++Vt){let hn=nt[je][ft];for(let Pt=0;Pt<Xe.width;++Pt){for(let bt=0;bt<2*Xe.type;++bt)ee[hn++]=Ye[St+bt*Xe.width*Xe.height];St++}ft++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(ee.buffer)}function Ie(T,F){const W=new Uint8Array(T);let ee=0;for(;W[F.value+ee]!=0;)ee+=1;const fe=new TextDecoder().decode(W.slice(F.value,F.value+ee));return F.value=F.value+ee+1,fe}function Oe(T,F,W){const ee=new TextDecoder().decode(new Uint8Array(T).slice(F.value,F.value+W));return F.value=F.value+W,ee}function it(T,F){const W=Pe(T,F),ee=Ze(T,F);return[W,ee]}function pt(T,F){const W=Ze(T,F),ee=Ze(T,F);return[W,ee]}function Pe(T,F){const W=T.getInt32(F.value,!0);return F.value=F.value+4,W}function Ze(T,F){const W=T.getUint32(F.value,!0);return F.value=F.value+4,W}function we(T,F){const W=T[F.value];return F.value=F.value+1,W}function ot(T,F){const W=T.getUint8(F.value);return F.value=F.value+1,W}const $e=function(T,F){let W;return"getBigInt64"in DataView.prototype?W=Number(T.getBigInt64(F.value,!0)):W=T.getUint32(F.value+4,!0)+Number(T.getUint32(F.value,!0)<<32),F.value+=8,W};function dt(T,F){const W=T.getFloat32(F.value,!0);return F.value+=4,W}function gt(T,F){return ns.toHalfFloat(dt(T,F))}function ce(T){const F=(T&31744)>>10,W=T&1023;return(T>>15?-1:1)*(F?F===31?W?NaN:1/0:Math.pow(2,F-15)*(1+W/1024):6103515625e-14*(W/1024))}function Ke(T,F){const W=T.getUint16(F.value,!0);return F.value+=2,W}function un(T,F){return ce(Ke(T,F))}function et(T,F,W,ee){const fe=W.value,le=[];for(;W.value<fe+ee-1;){const ae=Ie(F,W),Me=Pe(T,W),ye=ot(T,W);W.value+=3;const ve=Pe(T,W),me=Pe(T,W);le.push({name:ae,pixelType:Me,pLinear:ye,xSampling:ve,ySampling:me})}return W.value+=1,le}function Ge(T,F){const W=dt(T,F),ee=dt(T,F),fe=dt(T,F),le=dt(T,F),ae=dt(T,F),Me=dt(T,F),ye=dt(T,F),ve=dt(T,F);return{redX:W,redY:ee,greenX:fe,greenY:le,blueX:ae,blueY:Me,whiteX:ye,whiteY:ve}}function Bt(T,F){const W=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],ee=ot(T,F);return W[ee]}function mt(T,F){const W=Pe(T,F),ee=Pe(T,F),fe=Pe(T,F),le=Pe(T,F);return{xMin:W,yMin:ee,xMax:fe,yMax:le}}function Fe(T,F){const W=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],ee=ot(T,F);return W[ee]}function rt(T,F){const W=["ENVMAP_LATLONG","ENVMAP_CUBE"],ee=ot(T,F);return W[ee]}function Tt(T,F){const W=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],ee=["ROUND_DOWN","ROUND_UP"],fe=Ze(T,F),le=Ze(T,F),ae=ot(T,F);return{xSize:fe,ySize:le,levelMode:W[ae&15],roundingMode:ee[ae>>4]}}function _t(T,F){const W=dt(T,F),ee=dt(T,F);return[W,ee]}function Ct(T,F){const W=dt(T,F),ee=dt(T,F),fe=dt(T,F);return[W,ee,fe]}function Wt(T,F,W,ee,fe){if(ee==="string"||ee==="stringvector"||ee==="iccProfile")return Oe(F,W,fe);if(ee==="chlist")return et(T,F,W,fe);if(ee==="chromaticities")return Ge(T,W);if(ee==="compression")return Bt(T,W);if(ee==="box2i")return mt(T,W);if(ee==="envmap")return rt(T,W);if(ee==="tiledesc")return Tt(T,W);if(ee==="lineOrder")return Fe(T,W);if(ee==="float")return dt(T,W);if(ee==="v2f")return _t(T,W);if(ee==="v3f")return Ct(T,W);if(ee==="int")return Pe(T,W);if(ee==="rational")return it(T,W);if(ee==="timecode")return pt(T,W);if(ee==="preview")return W.value+=fe,"skipped";W.value+=fe}function Mn(T,F){const W=Math.log2(T);return F=="ROUND_DOWN"?Math.floor(W):Math.ceil(W)}function An(T,F,W){let ee=0;switch(T.levelMode){case"ONE_LEVEL":ee=1;break;case"MIPMAP_LEVELS":ee=Mn(Math.max(F,W),T.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return ee}function mn(T,F,W,ee){const fe=new Array(T);for(let le=0;le<T;le++){const ae=1<<le;let Me=F/ae|0;ee=="ROUND_UP"&&Me*ae<F&&(Me+=1);const ye=Math.max(Me,1);fe[le]=(ye+W-1)/W|0}return fe}function Bn(){const T=this,F=T.offset,W={value:0};for(let ee=0;ee<T.tileCount;ee++){const fe=Pe(T.viewer,F),le=Pe(T.viewer,F);F.value+=8,T.size=Ze(T.viewer,F);const ae=fe*T.blockWidth,Me=le*T.blockHeight;T.columns=ae+T.blockWidth>T.width?T.width-ae:T.blockWidth,T.lines=Me+T.blockHeight>T.height?T.height-Me:T.blockHeight;const ye=T.columns*T.totalBytes,me=T.size<T.lines*ye?T.uncompress(T):pe(T);F.value+=T.size;for(let Ne=0;Ne<T.lines;Ne++){const Ye=Ne*T.columns*T.totalBytes;for(let Ve=0;Ve<T.inputChannels.length;Ve++){const nt=wi.channels[Ve].name,je=T.channelByteOffsets[nt]*T.columns,Xe=T.decodeChannels[nt];if(Xe===void 0)continue;W.value=Ye+je;const ft=(T.height-(1+Me+Ne))*T.outLineWidth;for(let St=0;St<T.columns;St++){const Vt=ft+(St+ae)*T.outputChannels+Xe;T.byteArray[Vt]=T.getter(me,W)}}}}}function Sn(){const T=this,F=T.offset,W={value:0};for(let ee=0;ee<T.height/T.blockHeight;ee++){const fe=Pe(T.viewer,F)-wi.dataWindow.yMin;T.size=Ze(T.viewer,F),T.lines=fe+T.blockHeight>T.height?T.height-fe:T.blockHeight;const le=T.columns*T.totalBytes,Me=T.size<T.lines*le?T.uncompress(T):pe(T);F.value+=T.size;for(let ye=0;ye<T.blockHeight;ye++){const ve=ee*T.blockHeight,me=ye+T.scanOrder(ve);if(me>=T.height)continue;const Ne=ye*le,Ye=(T.height-1-me)*T.outLineWidth;for(let Ve=0;Ve<T.inputChannels.length;Ve++){const nt=wi.channels[Ve].name,je=T.channelByteOffsets[nt]*T.columns,Xe=T.decodeChannels[nt];if(Xe!==void 0){W.value=Ne+je;for(let ft=0;ft<T.columns;ft++){const St=Ye+ft*T.outputChannels+Xe;T.byteArray[St]=T.getter(Me,W)}}}}}}function Ht(T,F,W){const ee={};if(T.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");ee.version=T.getUint8(4);const fe=T.getUint8(5);ee.spec={singleTile:!!(fe&2),longName:!!(fe&4),deepFormat:!!(fe&8),multiPart:!!(fe&16)},W.value=8;let le=!0;for(;le;){const ae=Ie(F,W);if(ae==="")le=!1;else{const Me=Ie(F,W),ye=Ze(T,W),ve=Wt(T,F,W,Me,ye);ve===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${Me}'.`):ee[ae]=ve}}if(fe&-7)throw console.error("THREE.EXRHeader:",ee),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return ee}function Xn(T,F,W,ee,fe){const le={size:0,viewer:F,array:W,offset:ee,width:T.dataWindow.xMax-T.dataWindow.xMin+1,height:T.dataWindow.yMax-T.dataWindow.yMin+1,inputChannels:T.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:Yn};switch(T.compression){case"NO_COMPRESSION":le.blockHeight=1,le.uncompress=pe;break;case"RLE_COMPRESSION":le.blockHeight=1,le.uncompress=Ce;break;case"ZIPS_COMPRESSION":le.blockHeight=1,le.uncompress=ge;break;case"ZIP_COMPRESSION":le.blockHeight=16,le.uncompress=ge;break;case"PIZ_COMPRESSION":le.blockHeight=32,le.uncompress=Je;break;case"PXR24_COMPRESSION":le.blockHeight=16,le.uncompress=de;break;case"DWAA_COMPRESSION":le.blockHeight=32,le.uncompress=xe;break;case"DWAB_COMPRESSION":le.blockHeight=256,le.uncompress=xe;break;default:throw new Error("EXRLoader.parse: "+T.compression+" is unsupported")}const ae={};for(const me of T.channels)switch(me.name){case"Y":case"R":case"G":case"B":case"A":ae[me.name]=!0,le.type=me.pixelType}let Me=!1;if(ae.R&&ae.G&&ae.B)Me=!ae.A,le.outputChannels=4,le.decodeChannels={R:0,G:1,B:2,A:3};else if(ae.Y)le.outputChannels=1,le.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(le.type==1)switch(fe){case fn:le.getter=un;break;case zn:le.getter=Ke;break}else if(le.type==2)switch(fe){case fn:le.getter=dt;break;case zn:le.getter=gt}else throw new Error("EXRLoader.parse: unsupported pixelType "+le.type+" for "+T.compression+".");le.columns=le.width;const ye=le.width*le.height*le.outputChannels;switch(fe){case fn:le.byteArray=new Float32Array(ye),Me&&le.byteArray.fill(1,0,ye);break;case zn:le.byteArray=new Uint16Array(ye),Me&&le.byteArray.fill(15360,0,ye);break;default:console.error("THREE.EXRLoader: unsupported type: ",fe);break}let ve=0;for(const me of T.channels)le.decodeChannels[me.name]!==void 0&&(le.channelByteOffsets[me.name]=ve),ve+=me.pixelType*2;if(le.totalBytes=ve,le.outLineWidth=le.width*le.outputChannels,T.lineOrder==="INCREASING_Y"?le.scanOrder=me=>me:le.scanOrder=me=>le.height-1-me,le.outputChannels==4?(le.format=ni,le.colorSpace=Yn):(le.format=Eo,le.colorSpace=Zu),T.spec.singleTile){le.blockHeight=T.tiles.ySize,le.blockWidth=T.tiles.xSize;const me=An(T.tiles,le.width,le.height),Ne=mn(me,le.width,T.tiles.xSize,T.tiles.roundingMode),Ye=mn(me,le.height,T.tiles.ySize,T.tiles.roundingMode);le.tileCount=Ne[0]*Ye[0];for(let Ve=0;Ve<me;Ve++)for(let nt=0;nt<Ye[Ve];nt++)for(let je=0;je<Ne[Ve];je++)$e(F,ee);le.decode=Bn.bind(le)}else{le.blockWidth=le.width;const me=Math.ceil(le.height/le.blockHeight);for(let Ne=0;Ne<me;Ne++)$e(F,ee);le.decode=Sn.bind(le)}return le}const Jr={value:0},zi=new DataView(e),ps=new Uint8Array(e),wi=Ht(zi,e,Jr),Pn=Xn(wi,zi,ps,Jr,this.type);return Pn.decode(),{header:wi,width:Pn.width,height:Pn.height,data:Pn.byteArray,format:Pn.format,colorSpace:Pn.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,a,n){function t(r,s){r.colorSpace=s.colorSpace,r.minFilter=bn,r.magFilter=bn,r.generateMipmaps=!1,r.flipY=!1,i&&i(r,s)}return super.load(e,t,a,n)}}class V1 extends Re{constructor(e,i,a,n=128){if(i<=0||a<=0||n<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const t=new Nh(a,2*n,n);t.scale(1,1,-1);const r=t.getAttribute("position"),s=new ie;for(let l=0;l<r.count;++l)if(s.fromBufferAttribute(r,l),s.y<0){const c=-i*3/2,h=s.y<c?-i/s.y:1-s.y*s.y/(3*c*c);s.multiplyScalar(h),s.toArray(r.array,3*l)}r.needsUpdate=!0,super(t,new Tn({map:e,depthWrite:!1}))}}const Ci={};function pB(o,e){st(e,!0);const i=wt();let a=z(e,"skybox",15),n=z(e,"texture",15),t=z(e,"ground",3,!1),r=z(e,"isBackground",3,!1),s=z(e,"scene",19,()=>i.scene);const l=Er(),c=Bp();rd({get scene(){return s()},get isBackground(){return r()},get texture(){return n()}});const h=Qe(()=>{var v;return((v=e.url)==null?void 0:v.endsWith("exr"))??!1}),d=Qe(()=>{var v;return((v=e.url)==null?void 0:v.endsWith("hdr"))??!1}),f=Qe(()=>{if(e.url!==void 0)return H(h)?(Ci.exr??(Ci.exr=new H1),Ci.exr):H(d)?(Ci.hdr??(Ci.hdr=new Cg),Ci.hdr):(Ci.tex??(Ci.tex=new ec),Ci.tex)});Et(()=>{if(e.url===void 0||H(f)===void 0)return;const v=l(c.remember(()=>H(f).loadAsync(e.url),[e.url]));return v.then(y=>{y.mapping=P0,n(y)}),()=>{v.then(y=>{y.dispose()})}});var p=tt(),m=ze(p);{var b=v=>{var y=tt();const E=Qe(()=>t()===!0?{}:t());var _=ze(y);{var C=x=>{var B=Qe(()=>[n(),H(E).height??1,H(E).radius??1,H(E).resolution??128]);qe(x,{is:V1,oncreate:()=>()=>{a(void 0)},get args(){return H(B)},get ref(){return a()},set ref(I){a(I)}})};En(_,x=>{n()&&x(C)})}Le(v,y)};En(m,v=>{t()&&v(b)})}Le(o,p),at()}const j1=1,_u=1e3,q1=256,Dg=(o=()=>_u,e=()=>_u,i=()=>q1)=>{const a=new Np(i()),n=new zp(j1,_u,a);return Et(()=>{const t=i();a.setSize(t,t)}),Et(()=>{const t=o();for(const r of n.children)Nt(r,"PerspectiveCamera")&&(r.near=t,r.updateProjectionMatrix())}),Et(()=>{const t=e();for(const r of n.children)Nt(r,"PerspectiveCamera")&&(r.far=t,r.updateProjectionMatrix())}),Et(()=>()=>{a.dispose()}),{camera:n,renderTarget:a}};var W1=Hn("<!> <!>",1);function gB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(_,"$started",i),t=wt();let r=z(e,"far",3,1e3),s=z(e,"frames",3,1/0),l=z(e,"isBackground",3,!1),c=z(e,"near",3,.1),h=z(e,"resolution",3,256),d=z(e,"scene",19,()=>t.scene);const{scene:f}=Lh(),{camera:p,renderTarget:m}=Dg(()=>c(),()=>r(),()=>h());rd({texture:m.texture,get scene(){return d()},get isBackground(){return l()}});const b=()=>{p.update(t.renderer,f)};let v=0;const{start:y,stop:E,started:_}=zt(()=>{var I;v<s()?(b(),v+=1):(E(),(I=e.onupdatestop)==null||I.call(e))},{autoStart:!1}),C=()=>{var I,k;n()&&(E(),(I=e.onupdatestop)==null||I.call(e)),v=0,y(),(k=e.onupdatestart)==null||k.call(e)};nn(()=>[r(),c(),s(),h()],C);var x=Qe(()=>e.visible?void 0:!1);qe(o,{is:f,get attach(){return H(x)},children:(I,k)=>{var P=W1(),D=ze(P);qe(D,{is:p});var U=In(D,2);ut(U,()=>e.children??ht,()=>({camera:p,renderTarget:m,restart:C,update:b})),Le(I,P)},$$slots:{default:!0}});var B=at({camera:p,renderTarget:m,update:b,restart:C});return a(),B}const uc=Number.parseInt(Hp.replace("dev","")),K1=`
varying vec2 vUv;
varying vec2 vPos;
void main () {
  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);
  vUv = uv;
  vPos = position.xy;
}
`,Y1=`
// Majority from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
varying vec2 vUv;
varying vec2 vPos;
uniform vec2 scale;
uniform vec2 imageBounds;
uniform float resolution;
uniform vec3 color;
uniform sampler2D map;
uniform sampler2D colorProccessingTexture;
uniform float radius;
uniform float zoom;
uniform float alphaThreshold;
uniform float alphaSmoothing;
uniform float brightness;
uniform float contrast;
uniform float monochromeStrength;
uniform vec3 monochromeColor;
uniform float negative;
uniform vec3 hsl;
uniform float grayscale;
uniform float opacity;
uniform int colorProcessingEnabled;
uniform int colorProcessingTextureOverride;

#define PI 3.14159265;

vec2 aspect(vec2 size) {
  return size / min(size.x, size.y);
}

// from https://iquilezles.org/articles/distfunctions
float udRoundBox(vec2 p, vec2 b, float r) {
  return length(max(abs(p) - b + r, 0.0)) - r;
}

float hueToRgb(float p, float q, float t) {
  if (t < 0.0f)
    t += 1.0f;
  if (t > 1.0f)
    t -= 1.0f;
  if (t < 1.0f / 6.0f)
    return p + (q - p) * 6.0f * t;
  if (t < 1.0f / 2.0f)
    return q;
  if (t < 2.0f / 3.0f)
    return p + (q - p) * (2.0f / 3.0f - t) * 6.0f;
  return p;
}

vec3 rgbToHsl(vec3 color) {
  float max = max(max(color.r, color.g), color.b);
  float min = min(min(color.r, color.g), color.b);
  float h, s, l = (max + min) / 2.0f;

  if (max == min) {
    h = s = 0.0f;
  } else {
    float d = max - min;
    s = l > 0.5f ? d / (2.0f - max - min) : d / (max + min);
    if (max == color.r) {
      h = (color.g - color.b) / d + (color.g < color.b ? 6.0f : 0.0f);
    } else if (max == color.g) {
      h = (color.b - color.r) / d + 2.0f;
    } else if (max == color.b) {
      h = (color.r - color.g) / d + 4.0f;
    }
    h /= 6.0f;
  }

  return vec3(h, s, l);
}

vec3 hslToRgb(vec3 hsl) {
  float h = hsl.x;
  float s = hsl.y;
  float l = hsl.z;

  float r, g, b;

  if (s == 0.0f) {
    r = g = b = l;
  } else {
    float q = l < 0.5f ? l * (1.0f + s) : l + s - l * s;
    float p = 2.0f * l - q;
    r = hueToRgb(p, q, h + 1.0f / 3.0f);
    g = hueToRgb(p, q, h);
    b = hueToRgb(p, q, h - 1.0f / 3.0f);
  }

  return vec3(r, g, b);
}

vec3 monochrome(float x, vec3 col) {
  return col * exp(4.0 * x - 1.0);
}

void processColors (inout vec4 colors) {
	vec4 strength = vec4(1.0);

	if (colorProcessingTextureOverride == 1) {
		strength = texture2D(colorProccessingTexture, vUv);

		float smoothedAlpha = smoothstep(1.0 - alphaThreshold - alphaSmoothing, 1.0 - alphaThreshold, strength.a + 0.0001);
		colors.a *= smoothedAlpha;

		if (gl_FragColor.a == 0.0) {
			discard;
			return;
		}
	}

	// BRIGHTNESS
	colors.rgb = max(colors.rgb + brightness, 0.0);

	// CONTRAST
  colors.rgb = max(((colors.rgb - 0.5) * max(contrast + 1.0, 0.0)) + 0.5, 0.0);

	// HSL
	vec3 hslColor = rgbToHsl(colors.rgb);
	hslColor.x = mod(hslColor.x + hsl.x * strength.r ,1.0);
	hslColor.y *= (1.0 + hsl.y * strength.g);
	hslColor.z += hsl.z * strength.b;
	colors.rgb = max(hslToRgb(hslColor), vec3(0.0));

	// MONOCHROME
	colors.rgb = mix(colors.rgb, monochrome(hslColor.z, monochromeColor), monochromeStrength);
}

void main() {
  vec2 s = aspect(scale);
  vec2 i = aspect(imageBounds);
  float rs = s.x / s.y;
  float ri = i.x / i.y;
  vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
  vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
  vec2 uv = vUv * s / new + offset;
  vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

  vec2 res = vec2(scale * resolution);
  vec2 halfRes = 0.5 * res;
  float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);
  vec3 a = mix(vec3(1.0, 0.0, 0.0), vec3(0.0, 0.0, 0.0), smoothstep(0.0, 1.0, b));

	gl_FragColor = texture2D(map, zUv) * vec4(color, opacity * a);

	if (colorProcessingEnabled == 1) {
	  processColors(gl_FragColor);
	}

	if (gl_FragColor.a == 0.0) {
	  discard;
	}

  #include <tonemapping_fragment>
  #include <${uc>=154?"colorspace_fragment":"encodings_fragment"}>
	gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(1.0) - gl_FragColor.rgb, negative);
}
`;function mB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(H(k),"$textureStore",i),t=()=>cn(P,"$size",i);let r=z(e,"color",3,"white"),s=z(e,"zoom",3,1),l=z(e,"radius",3,0),c=z(e,"alphaThreshold",3,0),h=z(e,"alphaSmoothing",3,.1),d=z(e,"brightness",3,0),f=z(e,"contrast",3,0),p=z(e,"hue",3,0),m=z(e,"saturation",3,0),b=z(e,"lightness",3,0),v=z(e,"negative",3,!1),y=z(e,"opacity",3,1),E=z(e,"toneMapped",3,!0),_=z(e,"transparent",3,!1),C=z(e,"ref",15),x=xt(e,["$$slots","$$events","$$legacy","color","zoom","radius","alphaThreshold","alphaSmoothing","brightness","contrast","hue","saturation","lightness","negative","opacity","toneMapped","transparent","texture","monochromeColor","monochromeStrength","colorProcessingTexture","side","url","ref","children"]);const B=new Gi;Ae(()=>{e.side&&(B.side=e.side)});const I=Er(),k=Qe(()=>I(e.url?fg(e.url):Fh(Promise.resolve(e.texture))));let{size:P}=wt();const D=or(),U={color:{value:new Rt(r())},scale:{value:new lt},imageBounds:{value:new lt(1,1)},resolution:{value:1024},map:{value:null},zoom:{value:s()},radius:{value:l()},alphaThreshold:{value:c()},alphaSmoothing:{value:h()},brightness:{value:d()},contrast:{value:f()},monochromeColor:{value:new Rt(e.monochromeColor)},monochromeStrength:{value:e.monochromeStrength??0},negative:{value:v()?1:0},opacity:{value:y()},hsl:{value:new ie(0,0,0)},colorProccessingTexture:{value:null},colorProcessingTextureOverride:{value:0},colorProcessingEnabled:{value:1}};Ae(()=>{U.color.value.set(r())}),Ae(()=>{var S,R;U.imageBounds.value.set(((S=n())==null?void 0:S.image.width)??0,((R=n())==null?void 0:R.image.height)??0)}),Ae(()=>{U.resolution.value=Math.max(t().width,t().height)}),Ae(()=>{U.zoom.value=s()}),Ae(()=>{U.radius.value=l()}),Ae(()=>{U.opacity.value=y()}),Ae(()=>{U.alphaThreshold.value=c()}),Ae(()=>{U.alphaSmoothing.value=h()}),Ae(()=>{U.brightness.value=d()}),Ae(()=>{U.contrast.value=f()}),Ae(()=>{U.hsl.value.x=p()}),Ae(()=>{U.hsl.value.z=b()}),Ae(()=>{U.negative.value=v()?1:0}),Ae(()=>{U.map.value=n()??null}),Ae(()=>{U.colorProccessingTexture.value=e.colorProcessingTexture??null}),Ae(()=>{U.colorProcessingTextureOverride.value=e.colorProcessingTexture?1:0}),Ae(()=>{e.monochromeColor!==void 0?(U.monochromeColor.value.set(e.monochromeColor),U.monochromeStrength.value=e.monochromeStrength??1):U.monochromeStrength.value=0}),Ae(()=>{let S=0;const R=(e.monochromeColor?1:0)*(e.monochromeStrength===void 0?1:e.monochromeStrength);for(const Q of[d(),f(),p(),m(),b(),R,e.colorProcessingTexture?1:0])if(Q!==0){S=1;break}U.colorProcessingEnabled.value=S}),zt(()=>{const S=D.current;if(!Nt(S,"Mesh"))return;U.scale.value.set(S.scale.x,S.scale.y);const R=S.geometry;if(R!==void 0&&"parameters"in R){const{width:Q,height:O}=R.parameters;U.scale.value.set(U.scale.value.x*Q,U.scale.value.y*O)}}),qe(o,yt({is:B,uniforms:U,get toneMapped(){return E()},get transparent(){return _()},vertexShader:K1,fragmentShader:Y1},()=>x,{get ref(){return C()},set ref(S){C(S)},children:(S,R)=>{var Q=tt(),O=ze(Q);ut(O,()=>e.children??ht,()=>({ref:B})),Le(S,Q)},$$slots:{default:!0}})),at(),a()}const X1=`
  varying vec3 localPosition;
  varying vec4 worldPosition;

  uniform vec3 worldCamProjPosition;
	uniform vec3 worldPlanePosition;
	uniform float fadeDistance;
	uniform bool infiniteGrid;
	uniform bool followCamera;

	uniform int coord0;
	uniform int coord1;
	uniform int coord2;

	void main() {
		localPosition = vec3(
		  position[coord0],
			position[coord1],
			position[coord2]
		);

		if (infiniteGrid) {
		  localPosition *= 1.0 + fadeDistance;
		}

		worldPosition = modelMatrix * vec4(localPosition, 1.0);
		if (followCamera) {
		  worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
      localPosition = (inverse(modelMatrix) * worldPosition).xyz;
		}

		gl_Position = projectionMatrix * viewMatrix * worldPosition;
	}
`,J1=`
  #define PI 3.141592653589793

	varying vec3 localPosition;
	varying vec4 worldPosition;

	uniform vec3 worldCamProjPosition;
	uniform float cellSize;
	uniform float sectionSize;
	uniform vec3 cellColor;
	uniform vec3 sectionColor;
	uniform float fadeDistance;
	uniform float fadeStrength;
	uniform vec3 fadeOrigin;
	uniform float cellThickness;
	uniform float sectionThickness;
	uniform vec3 backgroundColor;
	uniform float backgroundOpacity;

	uniform bool infiniteGrid;

	uniform int coord0;
	uniform int coord1;
	uniform int coord2;

	// 0 - default; 1 - lines; 2 - circles; 3 - polar
	uniform int gridType;

  // lineGrid coord for lines
	uniform int lineGridCoord;

	// circlegrid max radius
	uniform float circleGridMaxRadius;

	// polar grid dividers
	uniform float polarCellDividers;
	uniform float polarSectionDividers;

	float getSquareGrid(float size, float thickness, vec3 localPos) {
		vec2 coord = localPos.xy / size;

		vec2 grid = abs(fract(coord - 0.5) - 0.5) / fwidth(coord);
		float line = min(grid.x, grid.y) + 1.0 - thickness;

		return 1.0 - min(line, 1.0);
	}

	float getLinesGrid(float size, float thickness, vec3 localPos) {
		float coord = localPos[lineGridCoord] / size;
		float line = abs(fract(coord - 0.5) - 0.5) / fwidth(coord) - thickness * 0.2;

		return 1.0 - min(line, 1.0);
	}

	float getCirclesGrid(float size, float thickness, vec3 localPos) {
		float coord = length(localPos.xy) / size;
		float line = abs(fract(coord - 0.5) - 0.5) / fwidth(coord) - thickness * 0.2;

		if (!infiniteGrid && circleGridMaxRadius > 0. && coord > circleGridMaxRadius + thickness * 0.05) {
		  discard;
		}

		return 1.0 - min(line, 1.0);
	}

	float getPolarGrid(float size, float thickness, float polarDividers, vec3 localPos) {
		float rad = length(localPos.xy) / size;
		vec2 coord = vec2(rad, atan(localPos.x, localPos.y) * polarDividers / PI) ;

		vec2 wrapped = vec2(coord.x, fract(coord.y / (2.0 * polarDividers)) * (2.0 * polarDividers));
		vec2 coordWidth = fwidth(coord);
		vec2 wrappedWidth = fwidth(wrapped);
		vec2 width = (coord.y < -polarDividers * 0.5 || coord.y > polarDividers * 0.5 ? wrappedWidth : coordWidth) * (1.+thickness*0.25);

		// Compute anti-aliased world-space grid lines
		vec2 grid = abs(fract(coord - 0.5) - 0.5) / width;
		float line = min(grid.x, grid.y);

if (!infiniteGrid && circleGridMaxRadius > 0.0 && rad > circleGridMaxRadius + thickness * 0.05) {
		  discard;
		}

		return 1.0 - min(line, 1.0);
	}

	void main() {
		float g1 = 0.0;
		float g2 = 0.0;

		vec3 localPos = vec3(localPosition[coord0], localPosition[coord1], localPosition[coord2]);

		if (gridType == 0) {
			g1 = getSquareGrid(cellSize, cellThickness, localPos);
			g2 = getSquareGrid(sectionSize, sectionThickness, localPos);

		} else if (gridType == 1) {
			g1 = getLinesGrid(cellSize, cellThickness, localPos);
			g2 = getLinesGrid(sectionSize, sectionThickness, localPos);

		} else if (gridType == 2) {
			g1 = getCirclesGrid(cellSize, cellThickness, localPos);
			g2 = getCirclesGrid(sectionSize, sectionThickness, localPos);

		} else if (gridType == 3) {
			g1 = getPolarGrid(cellSize, cellThickness, polarCellDividers, localPos);
			g2 = getPolarGrid(sectionSize, sectionThickness, polarSectionDividers, localPos);
		}

		float dist = distance(fadeOrigin, worldPosition.xyz);
		float d = 1.0 - min(dist / fadeDistance, 1.0);
		float fadeFactor = pow(d, fadeStrength) * 0.95;

		vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

		if (backgroundOpacity > 0.0) {
			float linesAlpha = clamp((g1 + g2) * fadeFactor, 0.0,1.0);
			vec3 finalColor = mix(backgroundColor, color, linesAlpha);
			float blendedAlpha = max(linesAlpha, backgroundOpacity * fadeFactor);
			gl_FragColor = vec4(finalColor, blendedAlpha);

		} else {
			gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
			gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
		}

		if (gl_FragColor.a <= 0.0) {
		  discard;
		}

		#include <tonemapping_fragment>
		#include <${uc<154?"encodings_fragment":"colorspace_fragment"}>
	}
`;var Z1=Hn("<!> <!>",1);function vB(o,e){st(e,!0);let i=z(e,"cellColor",3,"#000000"),a=z(e,"sectionColor",3,"#0000ee"),n=z(e,"cellSize",3,1),t=z(e,"backgroundColor",3,"#dadada"),r=z(e,"backgroundOpacity",3,0),s=z(e,"sectionSize",3,10),l=z(e,"plane",3,"xz"),c=z(e,"gridSize",19,()=>[20,20]),h=z(e,"followCamera",3,!1),d=z(e,"infiniteGrid",3,!1),f=z(e,"fadeDistance",3,100),p=z(e,"fadeStrength",3,1),m=z(e,"fadeOrigin",3,void 0),b=z(e,"cellThickness",3,1),v=z(e,"sectionThickness",3,2),y=z(e,"side",3,Oi),E=z(e,"type",3,"grid"),_=z(e,"axis",3,"x"),C=z(e,"maxRadius",3,0),x=z(e,"cellDividers",3,6),B=z(e,"sectionDividers",3,2),I=z(e,"ref",15),k=xt(e,["$$slots","$$events","$$legacy","cellColor","sectionColor","cellSize","backgroundColor","backgroundOpacity","sectionSize","plane","gridSize","followCamera","infiniteGrid","fadeDistance","fadeStrength","fadeOrigin","cellThickness","sectionThickness","side","type","axis","maxRadius","cellDividers","sectionDividers","ref","children"]);const P=new Re,{invalidate:D,camera:U}=wt(),S=new oc,R=new ie(0,1,0),Q=new ie(0,0,0),O={x:0,y:1,z:2},G={xz:"xzy",xy:"xyz",zy:"zyx"},q={grid:0,lines:1,circular:2,polar:3},Z={cellSize:{value:n()},sectionSize:{value:s()},cellColor:{value:new Rt(i())},sectionColor:{value:new Rt(a())},backgroundColor:{value:new Rt(t())},backgroundOpacity:{value:r()},fadeDistance:{value:f()},fadeStrength:{value:p()},fadeOrigin:{value:new ie},cellThickness:{value:b()},sectionThickness:{value:v()},infiniteGrid:{value:d()},followCamera:{value:h()},coord0:{value:0},coord1:{value:2},coord2:{value:1},gridType:{value:q.grid},lineGridCoord:{value:O[_()]},circleGridMaxRadius:{value:C()},polarCellDividers:{value:x()},polarSectionDividers:{value:B()},worldCamProjPosition:{value:new ie},worldPlanePosition:{value:new ie}};Ae(()=>{const Y=G[l()],j=Y.charAt(0),L=Y.charAt(1),N=Y.charAt(2);Z.coord0.value=O[j],Z.coord1.value=O[L],Z.coord2.value=O[N],D()}),Ae(()=>{Z.cellSize.value=n(),D()}),Ae(()=>{Z.sectionSize.value=s(),D()}),Ae(()=>{Z.cellColor.value.set(i()),D()}),Ae(()=>{Z.sectionColor.value.set(a()),D()}),Ae(()=>{Z.backgroundColor.value.set(t()),D()}),Ae(()=>{Z.backgroundOpacity.value=r(),D()}),Ae(()=>{Z.fadeDistance.value=f(),D()}),Ae(()=>{Z.fadeStrength.value=p(),D()}),Ae(()=>{m()&&(Z.fadeOrigin.value=m(),D())}),Ae(()=>{Z.cellThickness.value=b(),D()}),Ae(()=>{Z.sectionThickness.value=v(),D()}),Ae(()=>{Z.followCamera.value=h(),D()}),Ae(()=>{Z.infiniteGrid.value=d(),D()}),Ae(()=>{switch(E()){case"grid":{Z.gridType.value=q.grid;break}case"lines":{Z.gridType.value=q.lines,Z.lineGridCoord.value=O[_()];break}case"circular":{Z.gridType.value=q.circular,Z.circleGridMaxRadius.value=C();break}case"polar":{Z.gridType.value=q.polar,Z.circleGridMaxRadius.value=C(),Z.polarCellDividers.value=x(),Z.polarSectionDividers.value=B();break}}D()}),zt(()=>{S.setFromNormalAndCoplanarPoint(R,Q).applyMatrix4(P.matrixWorld);const Y=P.material,j=Y.uniforms.worldCamProjPosition,L=Y.uniforms.worldPlanePosition,N=Y.uniforms.fadeOrigin,V=S.projectPoint(U.current.position,j.value);m()||(N.value=V),L.value.set(0,0,0).applyMatrix4(P.matrixWorld)},{autoInvalidate:!1}),qe(o,yt({is:P,frustumCulled:!1},()=>k,{get ref(){return I()},set ref(Y){I(Y)},children:(Y,j)=>{var L=Z1(),N=ze(L);bi(N,()=>qe.ShaderMaterial,($,ne)=>{ne($,{fragmentShader:J1,vertexShader:X1,uniforms:Z,transparent:!0,get side(){return y()}})});var V=In(N,2);{var J=$=>{var ne=tt(),se=ze(ne);ut(se,()=>e.children,()=>({ref:P})),Le($,ne)},X=$=>{var ne=tt(),se=ze(ne),_e=Qe(()=>typeof c()=="number"?[c(),c()]:c());bi(se,()=>qe.PlaneGeometry,(be,oe)=>{oe(be,{get args(){return H(_e)}})}),Le($,ne)};En(V,$=>{e.children?$(J):$(X,!1)})}Le(Y,L)},$$slots:{default:!0}})),at()}function bB(o,e){st(e,!0);let i=z(e,"args",19,()=>[]),a=z(e,"radius",3,.05),n=z(e,"smoothness",3,4),t=z(e,"creaseAngle",3,.4),r=z(e,"steps",3,1),s=z(e,"ref",15),l=xt(e,["$$slots","$$events","$$legacy","args","radius","smoothness","creaseAngle","steps","ref","children"]);const c=1e-5,h=(y,E,_)=>{const C=new Q0,x=_-c;return C.absarc(c,c,c,-Math.PI/2,-Math.PI,!0),C.absarc(c,E-x*2,c,Math.PI,Math.PI/2,!0),C.absarc(y-x*2,E-x*2,c,Math.PI/2,0,!0),C.absarc(y-x*2,c,c,0,-Math.PI/2,!0),C};let d=Qe(()=>i()[0]??1),f=Qe(()=>i()[1]??1),p=Qe(()=>i()[2]??1),m=Qe(()=>h(H(d),H(f),a())),b=Qe(()=>({depth:H(p)-a()*2,bevelEnabled:!0,bevelSegments:n()*2,steps:r(),bevelSize:a()-c,bevelThickness:a(),curveSegments:n()})),v=Qe(()=>new Vp(H(m),H(b)));Ae(()=>{H(v).center(),jh(H(v),t())}),qe(o,yt({get is(){return H(v)}},()=>l,{get ref(){return s()},set ref(y){s(y)},children:(y,E)=>{var _=tt(),C=ze(_);ut(C,()=>e.children??ht,()=>({ref:H(v)})),Le(y,_)},$$slots:{default:!0}})),at()}const Ao=new ic,Kn=new ie,Nr=new ie,tn=new vn,dA={X:new ie(1,0,0),Y:new ie(0,1,0),Z:new ie(0,0,1)},Cu={type:"change"},fA={type:"mouseDown",mode:null},AA={type:"mouseUp",mode:null},pA={type:"objectChange"};class $1 extends Hh{constructor(e,i=null){super(void 0,i);const a=new o_(this);this._root=a;const n=new s_;this._gizmo=n,a.add(n);const t=new a_;this._plane=t,a.add(t);const r=this;function s(_,C){let x=C;Object.defineProperty(r,_,{get:function(){return x!==void 0?x:C},set:function(B){x!==B&&(x=B,t[_]=B,n[_]=B,r.dispatchEvent({type:_+"-changed",value:B}),r.dispatchEvent(Cu))}}),r[_]=C,t[_]=C,n[_]=C}s("camera",e),s("object",void 0),s("enabled",!0),s("axis",null),s("mode","translate"),s("translationSnap",null),s("rotationSnap",null),s("scaleSnap",null),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0),s("minX",-1/0),s("maxX",1/0),s("minY",-1/0),s("maxY",1/0),s("minZ",-1/0),s("maxZ",1/0);const l=new ie,c=new ie,h=new vn,d=new vn,f=new ie,p=new vn,m=new ie,b=new ie,v=new ie,y=0,E=new ie;s("worldPosition",l),s("worldPositionStart",c),s("worldQuaternion",h),s("worldQuaternionStart",d),s("cameraPosition",f),s("cameraQuaternion",p),s("pointStart",m),s("pointEnd",b),s("rotationAxis",v),s("rotationAngle",y),s("eye",E),this._offset=new ie,this._startNorm=new ie,this._endNorm=new ie,this._cameraScale=new ie,this._parentPosition=new ie,this._parentQuaternion=new vn,this._parentQuaternionInv=new vn,this._parentScale=new ie,this._worldScaleStart=new ie,this._worldQuaternionInv=new vn,this._worldScale=new ie,this._positionStart=new ie,this._quaternionStart=new vn,this._scaleStart=new ie,this._getPointer=e_.bind(this),this._onPointerDown=n_.bind(this),this._onPointerHover=t_.bind(this),this._onPointerMove=i_.bind(this),this._onPointerUp=r_.bind(this),i!==null&&this.connect(i)}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Ao.setFromCamera(e,this.camera);const i=Eu(this._gizmo.picker[this.mode],Ao);i?this.axis=i.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Ao.setFromCamera(e,this.camera);const i=Eu(this._plane,Ao,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,fA.mode=this.mode,this.dispatchEvent(fA)}}pointerMove(e){const i=this.axis,a=this.mode,n=this.object;let t=this.space;if(a==="scale"?t="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(t="world"),n===void 0||i===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Ao.setFromCamera(e,this.camera);const r=Eu(this._plane,Ao,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),a==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),t==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),t==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(t==="local"&&(n.position.applyQuaternion(tn.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),t==="world"&&(n.parent&&n.position.add(Kn.setFromMatrixPosition(n.parent.matrixWorld)),i.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(Kn.setFromMatrixPosition(n.parent.matrixWorld)))),n.position.x=Math.max(this.minX,Math.min(this.maxX,n.position.x)),n.position.y=Math.max(this.minY,Math.min(this.maxY,n.position.y)),n.position.z=Math.max(this.minZ,Math.min(this.maxZ,n.position.z));else if(a==="scale"){if(i.search("XYZ")!==-1){let s=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(s*=-1),Nr.set(s,s,s)}else Kn.copy(this.pointStart),Nr.copy(this.pointEnd),Kn.applyQuaternion(this._worldQuaternionInv),Nr.applyQuaternion(this._worldQuaternionInv),Nr.divide(Kn),i.search("X")===-1&&(Nr.x=1),i.search("Y")===-1&&(Nr.y=1),i.search("Z")===-1&&(Nr.z=1);n.scale.copy(this._scaleStart).multiply(Nr),this.scaleSnap&&(i.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(a==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const s=20/this.worldPosition.distanceTo(Kn.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Kn.copy(this.rotationAxis).cross(this.eye))*s):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(dA[i]),Kn.copy(dA[i]),t==="local"&&Kn.applyQuaternion(this.worldQuaternion),Kn.cross(this.eye),Kn.length()===0?l=!0:this.rotationAngle=this._offset.dot(Kn.normalize())*s),(i==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),t==="local"&&i!=="E"&&i!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(tn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(tn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Cu),this.dispatchEvent(pA)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(AA.mode=this.mode,this.dispatchEvent(AA)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Cu),this.dispatchEvent(pA),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Ao}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function e_(o){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:o.button};{const e=this.domElement.getBoundingClientRect();return{x:(o.clientX-e.left)/e.width*2-1,y:-(o.clientY-e.top)/e.height*2+1,button:o.button}}}function t_(o){if(this.enabled)switch(o.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(o));break}}function n_(o){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(o.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(o)),this.pointerDown(this._getPointer(o)))}function i_(o){this.enabled&&this.pointerMove(this._getPointer(o))}function r_(o){this.enabled&&(this.domElement.releasePointerCapture(o.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(o)))}function Eu(o,e,i){const a=e.intersectObject(o,!0);for(let n=0;n<a.length;n++)if(a[n].object.visible||i)return a[n];return!1}const ll=new R0,Kt=new ie(0,1,0),gA=new ie(0,0,0),mA=new Lt,cl=new vn,Ql=new vn,Yi=new ie,vA=new Lt,$s=new ie(1,0,0),_o=new ie(0,1,0),ea=new ie(0,0,1),ul=new ie,Os=new ie,Gs=new ie;class o_ extends Mi{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const i=this.controls;i.object!==void 0&&(i.object.updateMatrixWorld(),i.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):i.object.parent.matrixWorld.decompose(i._parentPosition,i._parentQuaternion,i._parentScale),i.object.matrixWorld.decompose(i.worldPosition,i.worldQuaternion,i._worldScale),i._parentQuaternionInv.copy(i._parentQuaternion).invert(),i._worldQuaternionInv.copy(i.worldQuaternion).invert()),i.camera.updateMatrixWorld(),i.camera.matrixWorld.decompose(i.cameraPosition,i.cameraQuaternion,i._cameraScale),i.camera.isOrthographicCamera?i.camera.getWorldDirection(i.eye).negate():i.eye.copy(i.cameraPosition).sub(i.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class s_ extends Mi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Tn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new ia({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),a=e.clone();a.opacity=.15;const n=i.clone();n.opacity=.5;const t=e.clone();t.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const s=e.clone();s.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const d=e.clone();d.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const b=new li(0,.04,.1,12);b.translate(0,.05,0);const v=new Wn(.08,.08,.08);v.translate(0,.04,0);const y=new hi;y.setAttribute("position",new cs([0,0,0,1,0,0],3));const E=new li(.0075,.0075,.5,3);E.translate(0,.25,0);function _(O,G){const q=new Qs(O,.0075,3,64,G*Math.PI*2);return q.rotateY(Math.PI/2),q.rotateX(Math.PI/2),q}function C(){const O=new hi;return O.setAttribute("position",new cs([0,0,0,1,1,1],3)),O}const x={X:[[new Re(b,t),[.5,0,0],[0,0,-Math.PI/2]],[new Re(b,t),[-.5,0,0],[0,0,Math.PI/2]],[new Re(E,t),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Re(b,r),[0,.5,0]],[new Re(b,r),[0,-.5,0],[Math.PI,0,0]],[new Re(E,r)]],Z:[[new Re(b,s),[0,0,.5],[Math.PI/2,0,0]],[new Re(b,s),[0,0,-.5],[-Math.PI/2,0,0]],[new Re(E,s),null,[Math.PI/2,0,0]]],XYZ:[[new Re(new qa(.1,0),d.clone()),[0,0,0]]],XY:[[new Re(new Wn(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new Re(new Wn(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Re(new Wn(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},B={X:[[new Re(new li(.2,0,.6,4),a),[.3,0,0],[0,0,-Math.PI/2]],[new Re(new li(.2,0,.6,4),a),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Re(new li(.2,0,.6,4),a),[0,.3,0]],[new Re(new li(.2,0,.6,4),a),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Re(new li(.2,0,.6,4),a),[0,0,.3],[Math.PI/2,0,0]],[new Re(new li(.2,0,.6,4),a),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Re(new qa(.2,0),a)]],XY:[[new Re(new Wn(.2,.2,.01),a),[.15,.15,0]]],YZ:[[new Re(new Wn(.2,.2,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Re(new Wn(.2,.2,.01),a),[.15,0,.15],[-Math.PI/2,0,0]]]},I={START:[[new Re(new qa(.01,2),n),null,null,null,"helper"]],END:[[new Re(new qa(.01,2),n),null,null,null,"helper"]],DELTA:[[new xi(C(),n),null,null,null,"helper"]],X:[[new xi(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new xi(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new xi(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},k={XYZE:[[new Re(_(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new Re(_(.5,.5),t)]],Y:[[new Re(_(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new Re(_(.5,.5),s),null,[0,Math.PI/2,0]]],E:[[new Re(_(.75,1),f),null,[0,Math.PI/2,0]]]},P={AXIS:[[new xi(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={XYZE:[[new Re(new Nh(.25,10,8),a)]],X:[[new Re(new Qs(.5,.1,4,24),a),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Re(new Qs(.5,.1,4,24),a),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Re(new Qs(.5,.1,4,24),a),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Re(new Qs(.75,.1,2,24),a)]]},U={X:[[new Re(v,t),[.5,0,0],[0,0,-Math.PI/2]],[new Re(E,t),[0,0,0],[0,0,-Math.PI/2]],[new Re(v,t),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Re(v,r),[0,.5,0]],[new Re(E,r)],[new Re(v,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Re(v,s),[0,0,.5],[Math.PI/2,0,0]],[new Re(E,s),[0,0,0],[Math.PI/2,0,0]],[new Re(v,s),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Re(new Wn(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new Re(new Wn(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Re(new Wn(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Re(new Wn(.1,.1,.1),d.clone())]]},S={X:[[new Re(new li(.2,0,.6,4),a),[.3,0,0],[0,0,-Math.PI/2]],[new Re(new li(.2,0,.6,4),a),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Re(new li(.2,0,.6,4),a),[0,.3,0]],[new Re(new li(.2,0,.6,4),a),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Re(new li(.2,0,.6,4),a),[0,0,.3],[Math.PI/2,0,0]],[new Re(new li(.2,0,.6,4),a),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Re(new Wn(.2,.2,.01),a),[.15,.15,0]]],YZ:[[new Re(new Wn(.2,.2,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Re(new Wn(.2,.2,.01),a),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Re(new Wn(.2,.2,.2),a),[0,0,0]]]},R={X:[[new xi(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new xi(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new xi(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Q(O){const G=new Mi;for(const q in O)for(let Z=O[q].length;Z--;){const Y=O[q][Z][0].clone(),j=O[q][Z][1],L=O[q][Z][2],N=O[q][Z][3],V=O[q][Z][4];Y.name=q,Y.tag=V,j&&Y.position.set(j[0],j[1],j[2]),L&&Y.rotation.set(L[0],L[1],L[2]),N&&Y.scale.set(N[0],N[1],N[2]),Y.updateMatrix();const J=Y.geometry.clone();J.applyMatrix4(Y.matrix),Y.geometry=J,Y.renderOrder=1/0,Y.position.set(0,0,0),Y.rotation.set(0,0,0),Y.scale.set(1,1,1),G.add(Y)}return G}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Q(x)),this.add(this.gizmo.rotate=Q(k)),this.add(this.gizmo.scale=Q(U)),this.add(this.picker.translate=Q(B)),this.add(this.picker.rotate=Q(D)),this.add(this.picker.scale=Q(S)),this.add(this.helper.translate=Q(I)),this.add(this.helper.rotate=Q(P)),this.add(this.helper.scale=Q(R)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const a=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Ql;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let t=0;t<n.length;t++){const r=n[t];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let s;if(this.camera.isOrthographicCamera?s=(this.camera.top-this.camera.bottom)/this.camera.zoom:s=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(s*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(tn.setFromEuler(ll.set(0,0,0)),r.quaternion.copy(a).multiply(tn),Math.abs(Kt.copy($s).applyQuaternion(a).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(tn.setFromEuler(ll.set(0,0,Math.PI/2)),r.quaternion.copy(a).multiply(tn),Math.abs(Kt.copy(_o).applyQuaternion(a).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(tn.setFromEuler(ll.set(0,Math.PI/2,0)),r.quaternion.copy(a).multiply(tn),Math.abs(Kt.copy(ea).applyQuaternion(a).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(tn.setFromEuler(ll.set(0,Math.PI/2,0)),Kt.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(mA.lookAt(gA,Kt,_o)),r.quaternion.multiply(tn),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),Kn.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Kn.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(Kn),r.visible=this.dragging):(r.quaternion.copy(a),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(a),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(Kt.copy($s).applyQuaternion(a).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(Kt.copy(_o).applyQuaternion(a).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(Kt.copy(ea).applyQuaternion(a).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(Kt.copy(ea).applyQuaternion(a).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(Kt.copy($s).applyQuaternion(a).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(Kt.copy(_o).applyQuaternion(a).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(cl.copy(a),Kt.copy(this.eye).applyQuaternion(tn.copy(a).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(mA.lookAt(this.eye,gA,_o)),r.name==="X"&&(tn.setFromAxisAngle($s,Math.atan2(-Kt.y,Kt.z)),tn.multiplyQuaternions(cl,tn),r.quaternion.copy(tn)),r.name==="Y"&&(tn.setFromAxisAngle(_o,Math.atan2(Kt.x,Kt.z)),tn.multiplyQuaternions(cl,tn),r.quaternion.copy(tn)),r.name==="Z"&&(tn.setFromAxisAngle(ea,Math.atan2(Kt.y,Kt.x)),tn.multiplyQuaternions(cl,tn),r.quaternion.copy(tn))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(l){return r.name===l}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(e)}}class a_ extends Re{constructor(){super(new _r(1e5,1e5,2,2),new Tn({visible:!1,wireframe:!0,side:Oi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),ul.copy($s).applyQuaternion(i==="local"?this.worldQuaternion:Ql),Os.copy(_o).applyQuaternion(i==="local"?this.worldQuaternion:Ql),Gs.copy(ea).applyQuaternion(i==="local"?this.worldQuaternion:Ql),Kt.copy(Os),this.mode){case"translate":case"scale":switch(this.axis){case"X":Kt.copy(this.eye).cross(ul),Yi.copy(ul).cross(Kt);break;case"Y":Kt.copy(this.eye).cross(Os),Yi.copy(Os).cross(Kt);break;case"Z":Kt.copy(this.eye).cross(Gs),Yi.copy(Gs).cross(Kt);break;case"XY":Yi.copy(Gs);break;case"YZ":Yi.copy(ul);break;case"XZ":Kt.copy(Gs),Yi.copy(Os);break;case"XYZ":case"E":Yi.set(0,0,0);break}break;case"rotate":default:Yi.set(0,0,0)}Yi.length()===0?this.quaternion.copy(this.cameraQuaternion):(vA.lookAt(Kn.set(0,0,0),Yi,Kt),this.quaternion.setFromRotationMatrix(vA)),super.updateMatrixWorld(e)}}const od=()=>Oh("threlte-controls",{orbitControls:wr(void 0),trackballControls:wr(void 0)});var l_=Hn("<!> <!>",1);function wB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(h,"$camera",i);let t=z(e,"autoPauseOrbitControls",3,!0),r=z(e,"autoPauseTrackballControls",3,!0),s=z(e,"controls",15),l=z(e,"group",15),c=xt(e,["$$slots","$$events","$$legacy","autoPauseOrbitControls","autoPauseTrackballControls","object","controls","group","children"]);const{camera:h,dom:d,invalidate:f,scene:p}=wt(),{orbitControls:m,trackballControls:b}=od();let v=Ti(!1);nn(()=>[m,H(v),t()],([D,U,S])=>{if(!(!D||!D.enabled&&U))return D.enabled=!(U&&S),()=>{D.enabled=!0}}),nn(()=>[b,H(v),r()],([D,U,S])=>{if(!(!D||!D.enabled&&U))return D.enabled=!(U&&S),()=>{D.enabled=!0}});const y=new pn;l(y);const E=new $1(h.current,d);s(E),Ae(()=>{E.camera=n()}),Ae(()=>(E==null||E.attach(e.object??y),()=>E==null?void 0:E.detach()));const _=["enabled","axis","mode","translationSnap","rotationSnap","scaleSnap","space","size","showX","showY","showZ","visible","onmouseDown","onmouseUp","onobjectChange"];let C=Ti(er({})),x=Ti(er({}));Ae(()=>{rn(C,er({})),rn(x,er({})),Object.keys(c).forEach(D=>{Ae(()=>{_.includes(D)?H(C)[D]=c[D]:H(x)[D]=c[D]})})});const B=D=>{var U;f(),E.dragging&&!H(v)?rn(v,!0):!E.dragging&&H(v)&&rn(v,!1),(U=e.onchange)==null||U.call(e,D)};var I=l_(),k=ze(I);qe(k,yt({is:E,onchange:B},()=>H(C),{attach:({ref:D})=>{const U=D.getHelper();return p.add(U),()=>{p.remove(U)}},dispose:!1,oncreate:D=>()=>D.dispose()}));var P=In(k,2);qe(P,yt({is:y},()=>H(x),{children:(D,U)=>{var S=tt(),R=ze(S);{var Q=O=>{var G=tt(),q=ze(G);ut(q,()=>e.children,()=>({ref:y})),Le(O,G)};En(R,O=>{e.children&&O(Q)})}Le(D,S)},$$slots:{default:!0}})),Le(o,I),at(),a()}function yB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(s,"$parent",i);let t=z(e,"ref",15),r=xt(e,["$$slots","$$events","$$legacy","ref","children"]);const s=or(),{dom:l,invalidate:c}=wt();if(!Nt(n(),"Camera"))throw new Error("Parent missing: <OrbitControls> need to be a child of a <Camera>");const h=new yg(n(),l),{orbitControls:d}=od(),{start:f,stop:p}=zt(()=>{h.update()},{autoStart:!1,autoInvalidate:!1});Ae(()=>{e.autoRotate||e.enableDamping?f():p()}),Ae(()=>{const m=b=>{var v;c(),(v=e.onchange)==null||v.call(e,b)};return d.set(h),h.addEventListener("change",m),()=>{d.set(void 0),h.removeEventListener("change",m)}}),qe(o,yt({is:h},()=>r,{get ref(){return t()},set ref(m){t(m)},children:(m,b)=>{var v=tt(),y=ze(v);ut(y,()=>e.children??ht,()=>({ref:h})),Le(m,v)},$$slots:{default:!0}})),at(),a()}function _B(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(s,"$parent",i);let t=z(e,"ref",15),r=xt(e,["$$slots","$$events","$$legacy","ref","children"]);const s=or(),{dom:l,invalidate:c}=wt();if(!Nt(n(),"Camera"))throw new Error("Parent missing: <TrackballControls> need to be a child of a <Camera>");const h=new _g(n(),l),{trackballControls:d}=od();zt(()=>{h.update()},{autoInvalidate:!1}),Et(()=>{const f=p=>{var m;c(),(m=e.onchange)==null||m.call(e,p)};return d.set(h),h.addEventListener("change",f),()=>{d.set(void 0),h.removeEventListener("change",f)}}),qe(o,yt({is:h},()=>r,{get ref(){return t()},set ref(f){t(f)},children:(f,p)=>{var m=tt(),b=ze(m);ut(b,()=>e.children??ht,()=>({ref:h})),Le(f,m)},$$slots:{default:!0}})),at(),a()}const Tg=o=>`threlte-instanced-mesh-${o}`,c_=(o,e)=>{const i={instancedMesh:ln(o),addInstance(a){i.instances.update(n=>(n.push(a),n))},removeInstance(a){i.instances.update(n=>{const t=n.indexOf(a);return t>-1&&n.splice(t,1),n})},instances:ln([])};return Do(Tg(e),i),i},u_=o=>{const e=Cr(Tg(o));if(!e)throw new Error(`No <InstancedMesh> component found for id ${o}`);return e};var h_=Hn("<!> <!> <!>",1);function d_(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(t,"$instances",i),{instances:t}=c_(e.instancedMesh,e.id),r=new Lt,s=new Float32Array(e.limit*16);for(let x=0;x<e.limit;x++)r.identity().toArray(s,x*16);const l=new Float32Array(e.limit*3).fill(1),c=new Lt,h=new Lt,d=new ie,f=new vn,p=new ie;let m=!1;zt(()=>{e.useInstancedMesh(x=>{if(x.updateMatrix(),e.update||!m){x.updateMatrixWorld(),c.copy(x.matrixWorld).invert(),x.instanceColor&&(x.instanceColor.needsUpdate=!0),x.instanceMatrix.needsUpdate=!0;for(let B=0,I=t.current.length;B<I;B++){const k=t.current[B];k.matrixWorld.decompose(d,f,p),h.compose(d,f,p).premultiply(c),h.toArray(s,B*16),k.color.toArray(l,B*3)}m=!0}})}),Ae(()=>{e.useInstancedMesh(x=>{const B=Math.min(e.limit,e.range!==void 0?e.range:e.limit,n().length);x.count=B,Af>=159?(x.instanceMatrix.clearUpdateRanges(),x.instanceMatrix.addUpdateRange(0,B*16)):x.instanceMatrix.updateRange.count=B*16,x.instanceColor&&(Af>=159?(x.instanceColor.clearUpdateRanges(),x.instanceColor.addUpdateRange(0,B*3)):x.instanceColor.updateRange.count=B*3)})});var b=h_(),v=ze(b),y=Qe(()=>s.length/16);bi(v,()=>qe.InstancedBufferAttribute,(x,B)=>{B(x,{attach:"instanceMatrix",get count(){return H(y)},array:s,itemSize:16,usage:oa})});var E=In(v,2),_=Qe(()=>l.length/3);bi(E,()=>qe.InstancedBufferAttribute,(x,B)=>{B(x,{attach:"instanceColor",get count(){return H(_)},array:l,itemSize:3,usage:oa})});var C=In(E,2);ut(C,()=>e.children??ht),Le(o,b),at(),a()}function f_(o,e){st(e,!0);let i=z(e,"id",3,"default"),a=z(e,"limit",3,1e3),n=z(e,"range",3,1e3),t=z(e,"update",3,!0),r=z(e,"ref",15),s=xt(e,["$$slots","$$events","$$legacy","id","limit","range","update","ref","children"]);const l=new Zl(void 0,void 0,0),c=h=>{h(l)};qe(o,yt({is:l,raycast:()=>null,matrixAutoUpdate:!1},()=>s,{get ref(){return r()},set ref(h){r(h)},children:(h,d)=>{d_(h,{instancedMesh:l,get id(){return i()},get limit(){return a()},get range(){return n()},get update(){return t()},useInstancedMesh:c,children:(f,p)=>{var m=tt(),b=ze(m);ut(b,()=>e.children??ht,()=>({ref:l})),Le(f,m)},$$slots:{default:!0}})},$$slots:{default:!0}})),at()}const bA=new Lt,wA=new Lt,hl=[],Ns=new Re;class A_ extends pn{constructor(i,a){super();ja(this,"color");ja(this,"instancedMesh");ja(this,"instances");this.color=new Rt("white"),this.instancedMesh=i,this.instances=a}get geometry(){var i;return(i=this.instancedMesh.current)==null?void 0:i.geometry}raycast(i,a){var s;const n=this.instancedMesh.current;if(n===void 0||n.geometry===void 0||n.material===void 0)return;Ns.geometry=n.geometry;const t=n.matrixWorld,r=this.instances.current.indexOf(this);if(!(r===-1||r>n.count)){n.getMatrixAt(r,bA),wA.multiplyMatrices(t,bA),Ns.matrixWorld=wA,Nt(n.material,"Material")?Ns.material.side=n.material.side:Ns.material.side=((s=n.material[0])==null?void 0:s.side)??zl,Ns.raycast(i,hl);for(let l=0,c=hl.length;l<c;l++){const h=hl[l];h.instanceId=r,h.object=this,a.push(h)}hl.length=0}}}const Mg=Symbol("threlte-instance-id"),p_=o=>{Do(Mg,o)},g_=()=>Cr(Mg)??"default";function m_(o,e){st(e,!0);let i=z(e,"id",19,g_),a=z(e,"ref",15),n=xt(e,["$$slots","$$events","$$legacy","id","ref","children"]);const{addInstance:t,removeInstance:r,instancedMesh:s,instances:l}=u_(i()),c=new A_(s,l);t(c),di(()=>{r(c)}),qe(o,yt({is:c},()=>n,{get ref(){return a()},set ref(h){a(h)},children:(h,d)=>{var f=tt(),p=ze(f);ut(p,()=>e.children??ht,()=>({ref:c})),Le(h,f)},$$slots:{default:!0}})),at()}function Pg(o,e){st(e,!0);let i=z(e,"index",19,()=>e.meshes.length-1),a=xt(e,["$$slots","$$events","$$legacy","meshes","index","children"]);const n=e.meshes[i()];var t=tt(),r=ze(t);{var s=c=>{f_(c,yt({get geometry(){return n.geometry},get material(){return n.material},get id(){return n.uuid}},()=>a,{children:(h,d)=>{var f=Qe(()=>i()-1);Pg(h,yt({get meshes(){return e.meshes},get index(){return H(f)}},()=>a,{children:(p,m)=>{var b=tt(),v=ze(b);ut(v,()=>e.children??ht),Le(p,b)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},l=c=>{var h=tt(),d=ze(h);ut(d,()=>e.children??ht),Le(c,h)};En(r,c=>{i()>-1?c(s):c(l,!1)})}Le(o,t),at()}function CB(o,e){st(e,!0);let i=xt(e,["$$slots","$$events","$$legacy","meshes","children"]);const a=c=>(...h)=>(p_(c),m_(...h)),n=c=>c.filter(h=>h.isMesh).map(h=>a(h.uuid)),t=c=>Object.entries(c).reduce((h,[d,f])=>(f.isMesh&&(h[d]=a(f.uuid)),h),{});let r=Qe(()=>Array.isArray(e.meshes)?n(e.meshes):t(e.meshes)),s=Qe(()=>Array.isArray(e.meshes)?e.meshes:Object.values(e.meshes)),l=Qe(()=>H(s).filter(c=>c.isMesh));Pg(o,yt({get meshes(){return H(l)}},()=>i,{children:(c,h)=>{var d=tt(),f=ze(d);ut(f,()=>e.children??ht,()=>({components:H(r)})),Le(c,d)},$$slots:{default:!0}})),at()}function EB(o,e){st(e,!0);const{renderer:i,camera:a,scene:n}=wt();let t=z(e,"size",3,25),r=z(e,"focus",3,0),s=z(e,"samples",3,10);const l=xn.shadowmap_pars_fragment;let c=Qe(()=>`
		#define PENUMBRA_FILTER_SIZE float(${t()})
		#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
		vec3 randRGB(vec2 uv) {
			return vec3(
				fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
				fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
				fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
			);
		}

		vec3 lowPassRandRGB(vec2 uv) {
			// 3x3 convolution (average)
			// can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
			vec3 result = vec3(0);
			result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
			result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
			result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
			result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
			result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
			result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
			result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
			result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
			result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
			result *= 0.111111111; // 1.0 / 9.0
			return result;
		}
		vec3 highPassRandRGB(vec2 uv) {
			// by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
			// hp(x) = x - lp(x)
			return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
		}


		vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
			const float goldenAngle = 2.399963f; // radians
			float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
			float theta = float(sampleIndex) * goldenAngle + angle;
			float sine = sin(theta);
			float cosine = cos(theta);
			return vec2(cosine, sine) * r;
		}
		float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
			return (zReceiver - zBlocker) / zBlocker;
		}
		float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
			float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
			float blockerDepthSum = float(${r()});
			float blockers = 0.0;

			int j = 0;
			vec2 offset = vec2(0.);
			float depth = 0.;

			#pragma unroll_loop_start
			for(int i = 0; i < ${s()}; i ++) {
				offset = (vogelDiskSample(j, ${s()}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
				depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
				if (depth < compare) {
					blockerDepthSum += depth;
					blockers++;
				}
				j++;
			}
			#pragma unroll_loop_end

			if (blockers > 0.0) {
				return blockerDepthSum / blockers;
			}
			return -1.0;
		}


		float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
			float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
			float shadow = 0.0f;
			int j = 0;
			vec2 vogelSample = vec2(0.0);
			vec2 offset = vec2(0.0);
			#pragma unroll_loop_start
			for (int i = 0; i < ${s()}; i++) {
				vogelSample = vogelDiskSample(j, ${s()}, angle) * texelSize;
				offset = vogelSample * (1.0 + filterRadius * float(${t()}));
				shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
				j++;
			}
			#pragma unroll_loop_end
			return shadow * 1.0 / ${s()}.0;
		}

		float PCSS (sampler2D shadowMap, vec4 coords) {
			vec2 uv = coords.xy;
			float zReceiver = coords.z; // Assumed to be eye-space z in this code
			float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
			float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
			if (avgBlockerDepth == -1.0) {
				return 1.0;
			}
			float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
			return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
	}`);const h=()=>{n.traverse(d=>{var p,m;const f=d;f.material&&(i==null||i.properties.remove(f.material),(m=(p=f.material).dispose)==null||m.call(p))}),i!=null&&i.info.programs&&(i.info.programs.length=0),i==null||i.compile(n,a.current)};Ae(()=>{xn.shadowmap_pars_fragment=l.replace("#ifdef USE_SHADOWMAP",`#ifdef USE_SHADOWMAP
${H(c)}`).replace("#if defined( SHADOWMAP_TYPE_PCF )",`
return PCSS(shadowMap, shadowCoord);
#if defined( SHADOWMAP_TYPE_PCF )`),h()}),di(()=>{xn.shadowmap_pars_fragment=l,h()}),at()}function xB(o,e){st(e,!0);let i=z(e,"points",19,()=>[]),a=z(e,"shape",3,"none"),n=z(e,"shapeFunction",3,()=>1),t=z(e,"ref",15),r=xt(e,["$$slots","$$events","$$legacy","points","shape","shapeFunction","ref","children"]);const s=Qe(()=>i().length),{invalidate:l}=wt(),c=Qe(()=>new Mt(new Float32Array(H(s)*6),3)),h=Qe(()=>new Mt(new Float32Array(H(s)*6),3)),d=Qe(()=>new Mt(new Float32Array(H(s)*6),3)),f=Qe(()=>new Mt(new Float32Array(H(s)*2),1)),p=Qe(()=>new Mt(new Float32Array(H(s)*2),1)),m=Qe(()=>new Mt(new Float32Array(H(s)*2),1)),b=Qe(()=>new Mt(new Float32Array(H(s)*4),2)),v=Qe(()=>new Mt(new Uint16Array(H(s)*6),1)),y=Qe(()=>a()==="taper"?_=>1*Math.pow(4*_*(1-_),1):n()),E=new hi;Ae(()=>{for(let _=0,C=0,x=0;_<H(s);_+=1,C+=2,x+=6){H(f).setX(C,_/i().length),H(f).setX(C+1,_/i().length),H(p).setX(C,1),H(p).setX(C+1,-1);const B=a()==="none"?1:H(y)(_/(H(s)-1));if(H(m).setX(C,B),H(m).setX(C+1,B),H(b).setXYZW(C,_/(H(s)-1),0,_/(H(s)-1),1),_<H(s)-1){const I=_*2;H(v).setX(x+0,I+0),H(v).setX(x+1,I+1),H(v).setX(x+2,I+2),H(v).setX(x+3,I+2),H(v).setX(x+4,I+1),H(v).setX(x+5,I+3)}}E.setAttribute("position",H(c)),E.setAttribute("previous",H(h)),E.setAttribute("next",H(d)),E.setAttribute("counters",H(f)),E.setAttribute("side",H(p)),E.setAttribute("width",H(m)),E.setAttribute("uv",H(b)),E.setIndex(H(v))}),Ae(()=>{if(i().length===0)return;let _=0,C=0,x=0;const B=i()[0];H(h).setXYZ(C,B.x,B.y,B.z),C+=1,H(h).setXYZ(C,B.x,B.y,B.z),C+=1;for(let k=0;k<H(s);k++){const P=i()[k];H(c).setXYZ(_,P.x,P.y,P.z),_+=1,H(c).setXYZ(_,P.x,P.y,P.z),_+=1,k<H(s)-1&&(H(h).setXYZ(C,P.x,P.y,P.z),C+=1,H(h).setXYZ(C,P.x,P.y,P.z),C+=1),k>0&&k+1<=H(s)&&(H(d).setXYZ(x,P.x,P.y,P.z),x+=1,H(d).setXYZ(x,P.x,P.y,P.z),x+=1)}const I=i()[H(s)-1];H(d).setXYZ(x,I.x,I.y,I.z),x+=1,H(d).setXYZ(x,I.x,I.y,I.z),x+=1,H(c).needsUpdate=!0,H(h).needsUpdate=!0,H(d).needsUpdate=!0,E.computeBoundingSphere(),l()}),qe(o,yt({is:E},()=>r,{get ref(){return t()},set ref(_){t(_)},children:(_,C)=>{var x=tt(),B=ze(x);ut(B,()=>e.children??ht,()=>({ref:E})),Le(_,x)},$$slots:{default:!0}})),at()}const v_=`
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>

uniform float useDash;
uniform float dashArray;
uniform float dashOffset;
uniform float dashRatio;
uniform sampler2D alphaMap;
uniform float useAlphaMap;

varying vec2 vUV;
varying vec4 vColor;
varying float vCounters;

vec4 CustomLinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}

void main()	{
	#include <logdepthbuf_fragment>
	#include <${uc<154?"encodings_fragment":"colorspace_fragment"}>

	vec4 c = vColor;

	if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV ).r;

	if( useDash == 1. ){
			c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
	}

	gl_FragColor = CustomLinearTosRGB(c);
}
`,b_=`
    #include <common>
    ${xn.logdepthbuf_pars_vertex}
    ${xn.fog_pars_vertex}

    attribute vec3 previous;
    attribute vec3 next;
    attribute float side;
    attribute float width;
    attribute float counters;

    uniform vec2 resolution;
    uniform float lineWidth;
    uniform vec3 color;
    uniform float opacity;
    uniform float sizeAttenuation;
    uniform float scaleDown;

    varying vec2 vUV;
    varying vec4 vColor;
    varying float vCounters;

    vec2 intoScreen(vec4 i) {
        return resolution * (0.5 * i.xy / i.w + 0.5);
    }

    void main() {
        float aspect = resolution.y / resolution.x;

        mat4 m = projectionMatrix * modelViewMatrix;

        vec4 currentClip = m * vec4( position, 1.0 );
        vec4 prevClip = m * vec4( previous, 1.0 );
        vec4 nextClip = m * vec4( next, 1.0 );

        vec4 currentNormed = currentClip / currentClip.w;
        vec4 prevNormed = prevClip / prevClip.w;
        vec4 nextNormed = nextClip / nextClip.w;

        vec2 currentScreen = intoScreen(currentNormed);
        vec2 prevScreen = intoScreen(prevNormed);
        vec2 nextScreen = intoScreen(nextNormed);

        float actualWidth = lineWidth * width;

        vec2 dir;
        if(nextScreen == currentScreen) {
            dir = normalize( currentScreen - prevScreen );
        } else if(prevScreen == currentScreen) {
            dir = normalize( nextScreen - currentScreen );
        } else {
            vec2 inDir = currentScreen - prevScreen;
            vec2 outDir = nextScreen - currentScreen;
            vec2 fullDir = nextScreen - prevScreen;

            if(length(fullDir) > 0.0) {
                dir = normalize(fullDir);
            } else if(length(inDir) > 0.0){
                dir = normalize(inDir);
            } else {
                dir = normalize(outDir);
            }
        }

        vec2 normal = vec2(-dir.y, dir.x);

        if(sizeAttenuation != 0.0) {
            normal /= currentClip.w;
            normal *= min(resolution.x, resolution.y);
        }

        if (scaleDown > 0.0) {
            float dist = length(nextNormed - prevNormed);
            normal *= smoothstep(0.0, scaleDown, dist);
        }

        vec2 offsetInScreen = actualWidth * normal * side * 0.5;

        vec2 withOffsetScreen = currentScreen + offsetInScreen;
        vec3 withOffsetNormed = vec3((2.0 * withOffsetScreen/resolution - 1.0), currentNormed.z);

        vCounters = counters;
        vColor = vec4( color, opacity );
        vUV = uv;

        gl_Position = currentClip.w * vec4(withOffsetNormed, 1.0);

        ${xn.logdepthbuf_vertex}
        ${xn.fog_vertex}
    }
`;function IB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(v,"$size",i);let t=z(e,"opacity",3,1),r=z(e,"color",3,"#ffffff"),s=z(e,"dashOffset",3,0),l=z(e,"dashArray",3,0),c=z(e,"dashRatio",3,0),h=z(e,"attenuate",3,!0),d=z(e,"width",3,1),f=z(e,"scaleDown",3,0),p=z(e,"ref",15),m=xt(e,["$$slots","$$events","$$legacy","opacity","color","dashOffset","dashArray","dashRatio","attenuate","width","scaleDown","alphaMap","ref","children"]),{invalidate:b,size:v}=wt();const y={lineWidth:{value:d()},color:{value:new Rt(r())},opacity:{value:t()},resolution:{value:new lt(1,1)},sizeAttenuation:{value:h()?1:0},dashArray:{value:l()},useDash:{value:l()>0?1:0},dashOffset:{value:s()},dashRatio:{value:c()},scaleDown:{value:f()/10},alphaTest:{value:0},alphaMap:{value:e.alphaMap},useAlphaMap:{value:e.alphaMap?1:0}},E=new Gi({uniforms:y});Ae(()=>{y.lineWidth.value=d(),b()}),Ae(()=>{y.opacity.value=t(),b()}),Ae(()=>{y.resolution.value.set(n().width,n().height),b()}),Ae(()=>{y.sizeAttenuation.value=h()?1:0,b()}),Ae(()=>{y.dashArray.value=l(),y.useDash.value=l()>0?1:0,b()}),Ae(()=>{y.dashOffset.value=s(),b()}),Ae(()=>{y.dashRatio.value=c(),b()}),Ae(()=>{y.scaleDown.value=f()/10,b()}),Ae(()=>{y.alphaMap.value=e.alphaMap,y.useAlphaMap.value=e.alphaMap?1:0,b()}),Ae(()=>{y.color.value.set(r()),b()}),qe(o,yt({is:E,fragmentShader:v_,vertexShader:b_},()=>m,{get ref(){return p()},set ref(_){p(_)},children:(_,C)=>{var x=tt(),B=ze(x);ut(B,()=>e.children??ht,()=>({ref:E})),Le(_,x)},$$slots:{default:!0}})),at(),a()}class hc extends Re{constructor(){const e=hc.SkyShader,i=new Gi({name:e.name,uniforms:hs.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:rc,depthWrite:!1});super(new Wn(1,1,1),i),this.isSky=!0}}hc.SkyShader={name:"SkyShader",uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new ie},up:{value:new ie(0,1,0)}},vertexShader:`
		uniform vec3 sunPosition;
		uniform float rayleigh;
		uniform float turbidity;
		uniform float mieCoefficient;
		uniform vec3 up;

		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		// constants for atmospheric scattering
		const float e = 2.71828182845904523536028747135266249775724709369995957;
		const float pi = 3.141592653589793238462643383279502884197169;

		// wavelength of used primaries, according to preetham
		const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
		// this pre-calculation replaces older TotalRayleigh(vec3 lambda) function:
		// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
		const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

		// mie stuff
		// K coefficient for the primaries
		const float v = 4.0;
		const vec3 K = vec3( 0.686, 0.678, 0.666 );
		// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
		const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

		// earth shadow hack
		// cutoffAngle = pi / 1.95;
		const float cutoffAngle = 1.6110731556870734;
		const float steepness = 1.5;
		const float EE = 1000.0;

		float sunIntensity( float zenithAngleCos ) {
			zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
			return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
		}

		vec3 totalMie( float T ) {
			float c = ( 0.2 * T ) * 10E-18;
			return 0.434 * c * MieConst;
		}

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vWorldPosition = worldPosition.xyz;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			gl_Position.z = gl_Position.w; // set z to camera.far

			vSunDirection = normalize( sunPosition );

			vSunE = sunIntensity( dot( vSunDirection, up ) );

			vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

			float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

			// extinction (absorption + out scattering)
			// rayleigh coefficients
			vBetaR = totalRayleigh * rayleighCoefficient;

			// mie coefficients
			vBetaM = totalMie( turbidity ) * mieCoefficient;

		}`,fragmentShader:`
		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		uniform float mieDirectionalG;
		uniform vec3 up;

		// constants for atmospheric scattering
		const float pi = 3.141592653589793238462643383279502884197169;

		const float n = 1.0003; // refractive index of air
		const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

		// optical length at zenith for molecules
		const float rayleighZenithLength = 8.4E3;
		const float mieZenithLength = 1.25E3;
		// 66 arc seconds -> degrees, and the cosine of that
		const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

		// 3.0 / ( 16.0 * pi )
		const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
		// 1.0 / ( 4.0 * pi )
		const float ONE_OVER_FOURPI = 0.07957747154594767;

		float rayleighPhase( float cosTheta ) {
			return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
		}

		float hgPhase( float cosTheta, float g ) {
			float g2 = pow( g, 2.0 );
			float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
			return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
		}

		void main() {

			vec3 direction = normalize( vWorldPosition - cameraPosition );

			// optical length
			// cutoff angle at 90 to avoid singularity in next formula.
			float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
			float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
			float sR = rayleighZenithLength * inverse;
			float sM = mieZenithLength * inverse;

			// combined extinction factor
			vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

			// in scattering
			float cosTheta = dot( direction, vSunDirection );

			float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
			vec3 betaRTheta = vBetaR * rPhase;

			float mPhase = hgPhase( cosTheta, mieDirectionalG );
			vec3 betaMTheta = vBetaM * mPhase;

			vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
			Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

			// nightsky
			float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
			float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
			vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
			vec3 L0 = vec3( 0.1 ) * Fex;

			// composition + solar disc
			float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
			L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

			vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

			vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

			gl_FragColor = vec4( retColor, 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};function BB(o,e){st(e,!0);let i=z(e,"scale",3,1e3),a=z(e,"turbidity",3,10),n=z(e,"rayleigh",3,3),t=z(e,"mieCoefficient",3,.005),r=z(e,"mieDirectionalG",3,.7),s=z(e,"elevation",3,2),l=z(e,"azimuth",3,180),c=z(e,"setEnvironment",3,!0),h=z(e,"cubeMapSize",3,128),d=z(e,"webGLRenderTargetOptions",19,()=>({})),f=z(e,"ref",15),p=xt(e,["$$slots","$$events","$$legacy","scale","turbidity","rayleigh","mieCoefficient","mieDirectionalG","elevation","azimuth","setEnvironment","cubeMapSize","webGLRenderTargetOptions","ref","children"]);const m=new hc,b=new ie,{uniforms:v}=m.material,{renderer:y,scene:E,invalidate:_}=wt();let C=Ti(void 0),x;const B=()=>{rn(C,er(new Np(h(),{type:zn,generateMipmaps:!0,minFilter:xa,...d()}))),x=new zp(1,1.1,H(C))},I=E.environment;Ae(()=>{c()&&H(C)?(E.environment=H(C).texture,_()):c()||(E.environment=I,_())});const{start:k,stop:P}=zt(()=>{m.scale.setScalar(i()),v.turbidity.value=a(),v.rayleigh.value=n(),v.mieCoefficient.value=t(),v.mieDirectionalG.value=r();const D=rr.degToRad(90-s()),U=rr.degToRad(l());b.setFromSphericalCoords(1,D,U),v.sunPosition.value.copy(b),c()&&((!H(C)||!x)&&B(),x==null||x.update(y,m)),_(),P()},{autoStart:!1,autoInvalidate:!1});nn.pre(()=>[i(),a(),n(),t(),r(),s(),l()],()=>k()),di(()=>{var D;m.material.dispose(),E.environment=I;try{(D=H(C))==null||D.dispose()}catch(U){console.warn("Could not dispose renderTarget:",U)}}),qe(o,yt({is:m},()=>p,{get ref(){return f()},set ref(D){f(D)},children:(D,U)=>{var S=tt(),R=ze(S);ut(R,()=>e.children??ht,()=>({ref:m,sunPosition:b,renderTarget:H(C)})),Le(D,S)},$$slots:{default:!0}})),at()}function Qg(o,e){st(e,!0),us(e.name,e.plugin);var i=tt(),a=ze(i);ut(a,()=>e.children??ht),Le(o,i),at()}function SB(o,e){st(e,!0);const{renderStage:i}=wt();let a=z(e,"x",3,0),n=z(e,"y",3,0),t=z(e,"z",3,0),r=z(e,"precise",3,!1),s=z(e,"auto",3,!1),l=z(e,"ref",15),c=z(e,"stage",19,()=>Aa("<Align>",{before:i})),h=xt(e,["$$slots","$$events","$$legacy","x","y","z","precise","auto","ref","onalign","children","stage"]);const d=new pn,f=new pn,p=new pn,m=()=>{var S;if(a()===!1&&n()===!1&&t()===!1)return;p.matrixWorld.identity();const _=new gn().setFromObject(f,r()),C=new ie,x=new Xr,B=_.max.x-_.min.x,I=_.max.y-_.min.y,k=_.max.z-_.min.z;_.getCenter(C),_.getBoundingSphere(x);const P=(n()||0)*I/2,D=(a()||0)*B/2,U=(t()||0)*k/2;p.position.set(a()===!1?0:-C.x+D,n()===!1?0:-C.y+P,t()===!1?0:-C.z+U),(S=e.onalign)==null||S.call(e,{boundingBox:_,center:p.position.clone(),boundingSphere:x,container:d,depth:k,depthAlignment:U,height:I,verticalAlignment:P,width:B,horizontalAlignment:D})},{start:b,stop:v}=zt(()=>{m(),v()},{autoStart:!1,stage:c()}),y=b;nn(()=>[a(),n(),t(),r()],b);const E=_=>{Nt(_.ref,"Object3D")&&nn.pre(()=>[_.ref],()=>(s()&&b(),()=>{s()&&b()}))};return qe(o,yt({is:d},()=>h,{get ref(){return l()},set ref(_){l(_)},children:(_,C)=>{qe(_,{is:p,children:(x,B)=>{qe(x,{is:f,children:(I,k)=>{Qg(I,{name:"align",plugin:E,children:(P,D)=>{var U=tt(),S=ze(U);ut(S,()=>e.children??ht,()=>({align:b,ref:d})),Le(P,U)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})),at({align:y})}const xu=new Lt;class dc{constructor(e){e=e||{},this.zNear=e.webGL===!0?-1:0,this.vertices={near:[new ie,new ie,new ie,new ie],far:[new ie,new ie,new ie,new ie]},e.projectionMatrix!==void 0&&this.setFromProjectionMatrix(e.projectionMatrix,e.maxFar||1e4)}setFromProjectionMatrix(e,i){const a=this.zNear,n=e.elements[2*4+3]===0;return xu.copy(e).invert(),this.vertices.near[0].set(1,1,a),this.vertices.near[1].set(1,-1,a),this.vertices.near[2].set(-1,-1,a),this.vertices.near[3].set(-1,1,a),this.vertices.near.forEach(function(t){t.applyMatrix4(xu)}),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach(function(t){t.applyMatrix4(xu);const r=Math.abs(t.z);n?t.z*=Math.min(i/r,1):t.multiplyScalar(Math.min(i/r,1))}),this.vertices}split(e,i){for(;e.length>i.length;)i.push(new dc);i.length=e.length;for(let a=0;a<e.length;a++){const n=i[a];if(a===0)for(let t=0;t<4;t++)n.vertices.near[t].copy(this.vertices.near[t]);else for(let t=0;t<4;t++)n.vertices.near[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[a-1]);if(a===e.length-1)for(let t=0;t<4;t++)n.vertices.far[t].copy(this.vertices.far[t]);else for(let t=0;t<4;t++)n.vertices.far[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[a])}}toSpace(e,i){for(let a=0;a<4;a++)i.vertices.near[a].copy(this.vertices.near[a]).applyMatrix4(e),i.vertices.far[a].copy(this.vertices.far[a]).applyMatrix4(e)}}const yA={lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

vec3 geometryClearcoatNormal = vec3( 0.0 );

#ifdef USE_CLEARCOAT

	geometryClearcoatNormal = clearcoatNormal;

#endif

#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		// Iridescence F0 approximation
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointLightInfo( pointLight, geometryPosition, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;

		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
 	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;

	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotLightInfo( spotLight, geometryPosition, directLight );

  		// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;

		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && defined( USE_CSM ) && defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	float linearDepth = (vViewPosition.z) / (shadowFar - cameraNear);
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#if defined( USE_SHADOWMAP ) && defined( CSM_FADE )
		vec2 cascade;
		float cascadeCenter;
		float closestEdge;
		float margin;
		float csmx;
		float csmy;

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
				// NOTE: Depth gets larger away from the camera.
				// cascade.x is closer, cascade.y is further
				cascade = CSM_cascades[ i ];
				cascadeCenter = ( cascade.x + cascade.y ) / 2.0;
				closestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;
				margin = 0.25 * pow( closestEdge, 2.0 );
				csmx = cascade.x - margin / 2.0;
				csmy = cascade.y + margin / 2.0;
				if( linearDepth >= csmx && ( linearDepth < csmy || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 ) ) {

					float dist = min( linearDepth - csmx, csmy - linearDepth );
					float ratio = clamp( dist / margin, 0.0, 1.0 );

					vec3 prevColor = directLight.color;
					directionalLightShadow = directionalLightShadows[ i ];
					directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

					bool shouldFadeLastCascade = UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth > cascadeCenter;
					directLight.color = mix( prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0 );

					ReflectedLight prevLight = reflectedLight;
					RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

					bool shouldBlend = UNROLLED_LOOP_INDEX != CSM_CASCADES - 1 || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth < cascadeCenter;
					float blendRatio = shouldBlend ? ratio : 1.0;

					reflectedLight.directDiffuse = mix( prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio );
					reflectedLight.directSpecular = mix( prevLight.directSpecular, reflectedLight.directSpecular, blendRatio );
					reflectedLight.indirectDiffuse = mix( prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio );
					reflectedLight.indirectSpecular = mix( prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio );

				}
			#endif

		}
		#pragma unroll_loop_end
	#elif defined (USE_SHADOWMAP)

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )

				directionalLightShadow = directionalLightShadows[ i ];
				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y) directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && (linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1)) RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

			#endif

		}
		#pragma unroll_loop_end

	#elif ( NUM_DIR_LIGHT_SHADOWS > 0 )
		// note: no loop here - all CSM lights are in fact one light only
		getDirectionalLightInfo( directionalLights[0], directLight );
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	#endif

	#if ( NUM_DIR_LIGHTS > NUM_DIR_LIGHT_SHADOWS)
		// compute the lights not casting shadows (if any)

		#pragma unroll_loop_start
		for ( int i = NUM_DIR_LIGHT_SHADOWS; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];

			getDirectionalLightInfo( directionalLight, directLight );

			RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

		}
		#pragma unroll_loop_end

	#endif

#endif


#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && !defined( USE_CSM ) && !defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalLightInfo( directionalLight, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	#if defined( USE_LIGHT_PROBES )

		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );

	#endif

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`,lights_pars_begin:`
#if defined( USE_CSM ) && defined( CSM_CASCADES )
uniform vec2 CSM_cascades[CSM_CASCADES];
uniform float cameraNear;
uniform float shadowFar;
#endif
	`+xn.lights_pars_begin},_A=new Lt,Iu=new dc({webGL:!0}),Ar=new ie,zs=new gn,Bu=[],Su=[],ku=new Lt,CA=new Lt,w_=new ie(0,1,0);class y_{constructor(e){this.camera=e.camera,this.parent=e.parent,this.cascades=e.cascades||3,this.maxFar=e.maxFar||1e5,this.mode=e.mode||"practical",this.shadowMapSize=e.shadowMapSize||2048,this.shadowBias=e.shadowBias||1e-6,this.lightDirection=e.lightDirection||new ie(1,-1,1).normalize(),this.lightIntensity=e.lightIntensity||3,this.lightNear=e.lightNear||1,this.lightFar=e.lightFar||2e3,this.lightMargin=e.lightMargin||200,this.customSplitsCallback=e.customSplitsCallback,this.fade=!1,this.mainFrustum=new dc({webGL:!0}),this.frustums=[],this.breaks=[],this.lights=[],this.shaders=new Map,this._createLights(),this.updateFrustums(),this._injectInclude()}_createLights(){for(let e=0;e<this.cascades;e++){const i=new kp(16777215,this.lightIntensity);i.castShadow=!0,i.shadow.mapSize.width=this.shadowMapSize,i.shadow.mapSize.height=this.shadowMapSize,i.shadow.camera.near=this.lightNear,i.shadow.camera.far=this.lightFar,i.shadow.bias=this.shadowBias,this.parent.add(i),this.parent.add(i.target),this.lights.push(i)}}_initCascades(){const e=this.camera;e.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(e.projectionMatrix,this.maxFar),this.mainFrustum.split(this.breaks,this.frustums)}_updateShadowBounds(){const e=this.frustums;for(let i=0;i<e.length;i++){const n=this.lights[i].shadow.camera,t=this.frustums[i],r=t.vertices.near,s=t.vertices.far,l=s[0];let c;l.distanceTo(s[2])>l.distanceTo(r[2])?c=s[2]:c=r[2];let h=l.distanceTo(c);if(this.fade){const d=this.camera,f=Math.max(d.far,this.maxFar),p=t.vertices.far[0].z/(f-d.near),m=.25*Math.pow(p,2)*(f-d.near);h+=m}n.left=-h/2,n.right=h/2,n.top=h/2,n.bottom=-h/2,n.updateProjectionMatrix()}}_getBreaks(){const e=this.camera,i=Math.min(e.far,this.maxFar);switch(this.breaks.length=0,this.mode){case"uniform":a(this.cascades,e.near,i,this.breaks);break;case"logarithmic":n(this.cascades,e.near,i,this.breaks);break;case"practical":t(this.cascades,e.near,i,.5,this.breaks);break;case"custom":this.customSplitsCallback===void 0&&console.error("CSM: Custom split scheme callback not defined."),this.customSplitsCallback(this.cascades,e.near,i,this.breaks);break}function a(r,s,l,c){for(let h=1;h<r;h++)c.push((s+(l-s)*h/r)/l);c.push(1)}function n(r,s,l,c){for(let h=1;h<r;h++)c.push(s*(l/s)**(h/r)/l);c.push(1)}function t(r,s,l,c,h){Bu.length=0,Su.length=0,n(r,s,l,Su),a(r,s,l,Bu);for(let d=1;d<r;d++)h.push(rr.lerp(Bu[d-1],Su[d-1],c));h.push(1)}}update(){const e=this.camera,i=this.frustums;ku.lookAt(new ie,this.lightDirection,w_),CA.copy(ku).invert();for(let a=0;a<i.length;a++){const n=this.lights[a],t=n.shadow.camera,r=(t.right-t.left)/this.shadowMapSize,s=(t.top-t.bottom)/this.shadowMapSize;_A.multiplyMatrices(CA,e.matrixWorld),i[a].toSpace(_A,Iu);const l=Iu.vertices.near,c=Iu.vertices.far;zs.makeEmpty();for(let h=0;h<4;h++)zs.expandByPoint(l[h]),zs.expandByPoint(c[h]);zs.getCenter(Ar),Ar.z=zs.max.z+this.lightMargin,Ar.x=Math.floor(Ar.x/r)*r,Ar.y=Math.floor(Ar.y/s)*s,Ar.applyMatrix4(ku),n.position.copy(Ar),n.target.position.copy(Ar),n.target.position.x+=this.lightDirection.x,n.target.position.y+=this.lightDirection.y,n.target.position.z+=this.lightDirection.z}}_injectInclude(){xn.lights_fragment_begin=yA.lights_fragment_begin,xn.lights_pars_begin=yA.lights_pars_begin}setupMaterial(e){e.defines=e.defines||{},e.defines.USE_CSM=1,e.defines.CSM_CASCADES=this.cascades,this.fade&&(e.defines.CSM_FADE="");const i=[],a=this,n=this.shaders;e.onBeforeCompile=function(t){const r=Math.min(a.camera.far,a.maxFar);a._getExtendedBreaks(i),t.uniforms.CSM_cascades={value:i},t.uniforms.cameraNear={value:a.camera.near},t.uniforms.shadowFar={value:r},n.set(e,t)},n.set(e,null)}_updateUniforms(){const e=Math.min(this.camera.far,this.maxFar);this.shaders.forEach(function(a,n){if(a!==null){const t=a.uniforms;this._getExtendedBreaks(t.CSM_cascades.value),t.cameraNear.value=this.camera.near,t.shadowFar.value=e}!this.fade&&"CSM_FADE"in n.defines?(delete n.defines.CSM_FADE,n.needsUpdate=!0):this.fade&&!("CSM_FADE"in n.defines)&&(n.defines.CSM_FADE="",n.needsUpdate=!0)},this)}_getExtendedBreaks(e){for(;e.length<this.breaks.length;)e.push(new lt);e.length=this.breaks.length;for(let i=0;i<this.cascades;i++){const a=this.breaks[i],n=this.breaks[i-1]||0;e[i].x=n,e[i].y=a}}updateFrustums(){this._getBreaks(),this._initCascades(),this._updateShadowBounds(),this._updateUniforms()}remove(){for(let e=0;e<this.lights.length;e++)this.parent.remove(this.lights[e].target),this.parent.remove(this.lights[e])}dispose(){const e=this.shaders;e.forEach(function(i,a){delete a.onBeforeCompile,delete a.defines.USE_CSM,delete a.defines.CSM_CASCADES,delete a.defines.CSM_FADE,i!==null&&(delete i.uniforms.CSM_cascades,delete i.uniforms.cameraNear,delete i.uniforms.shadowFar),a.needsUpdate=!0}),e.clear()}}const __=()=>{let o;const e=new Set,i=r=>Nt(r,"MeshStandardMaterial")||Nt(r,"MeshPhongMaterial"),a=r=>{e.has(r)||(e.add(r),o==null||o(r))},n=r=>{i(r)?a(r):Nt(r,"Mesh")&&(Array.isArray(r.material)?r.material.forEach(s=>{i(s)&&a(s)}):i(r.material)&&a(r.material))},t=r=>{o=r};return us("csm",r=>{Ae(()=>{n(r.ref)})}),Ae(()=>()=>o=void 0),{onNewMaterial:t,allMaterials:e}};var C_=Hn("<!> <!>",1);function kB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(l,"$defaultCamera",i);let t=z(e,"enabled",3,!0),r=z(e,"args",19,()=>({})),s=z(e,"lightDirection",19,()=>[1,-1,1]);const{camera:l,scene:c,size:h}=wt();let d=Ti(void 0);zt(()=>{var _;return(_=H(d))==null?void 0:_.update()},{autoInvalidate:!1});const{onNewMaterial:f,allMaterials:p}=__(),m=()=>{var _,C;(_=H(d))==null||_.remove(),(C=H(d))==null||C.dispose(),rn(d,void 0)};nn(()=>[t()],([_])=>{var C;if(_){const x=new y_({camera:e.camera??n(),parent:c,...r()});(C=e.configure)==null||C.call(e,x);for(const B of p)x.setupMaterial(B);f(B=>x.setupMaterial(B)),rn(d,x)}else f(void 0),m()}),nn(()=>[h,H(d)],([,_])=>{_==null||_.updateFrustums()}),nn(()=>[l,e.camera,H(d)],([_,C,x])=>{x&&(x.camera=C??_,r().maxFar!==void 0&&(x.maxFar=r().maxFar),r().mode!==void 0&&(x.mode=r().mode),x.updateFrustums())}),nn(()=>[H(d),e.lightIntensity,e.lightColor],([_,C,x])=>{_==null||_.lights.forEach(B=>{C!==void 0&&(B.intensity=C/Math.PI),x!==void 0&&B.color.set(x)})}),nn(()=>[H(d),s()],([_,C])=>{_==null||_.lightDirection.set(...C).normalize()}),Ae(()=>m);var b=C_(),v=ze(b);ut(v,()=>e.children??ht);var y=In(v,2);{var E=_=>{var C=tt(),x=ze(C);ut(x,()=>e.fallback??ht),Le(_,C)};En(y,_=>{t()||_(E)})}Le(o,b),at(),a()}function DB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(h,"$camera",i);let t=z(e,"follow",3,!0),r=z(e,"ref",15),s=xt(e,["$$slots","$$events","$$legacy","follow","ref","children"]);const l=new pn,c=new pn,{camera:h,renderStage:d}=wt(),f=new vn;let p=Qe(()=>t()===!0?n():t()===!1?void 0:t());const m=Aa("<Billboard>",{before:d}),{start:b,stop:v}=zt(()=>{var y;c.updateMatrix(),c.updateWorldMatrix(!1,!1),c.getWorldQuaternion(f),(y=H(p))==null||y.getWorldQuaternion(l.quaternion).premultiply(f.invert())},{autoStart:!1,stage:m});Ae(()=>{t()?b():v()}),qe(o,yt({is:c},()=>s,{get ref(){return r()},set ref(y){r(y)},children:(y,E)=>{qe(y,{is:l,children:(_,C)=>{var x=tt(),B=ze(x);ut(B,()=>e.children??ht,()=>({ref:c})),Le(_,x)},$$slots:{default:!0}})},$$slots:{default:!0}})),at(),a()}const E_=`
uniform vec3 glowColor;
uniform float falloffAmount;
uniform float glowSharpness;
uniform float glowInternalRadius;

varying vec3 vPosition;
varying vec3 vNormal;

void main()
{
	// Normal
	vec3 normal = normalize(vNormal);
	if(!gl_FrontFacing)
			normal *= - 1.0;
	vec3 viewDirection = normalize(cameraPosition - vPosition);
	float fresnel = dot(viewDirection, normal);
	fresnel = pow(fresnel, glowInternalRadius + 0.1);
	float falloff = smoothstep(0., falloffAmount, fresnel);
	float fakeGlow = fresnel;
	fakeGlow += fresnel * glowSharpness;
	fakeGlow *= falloff;
	gl_FragColor = vec4(clamp(glowColor * fresnel, 0., 1.0), clamp(fakeGlow, 0., 1.0));

	${xn.tonemapping_fragment}
	${xn.colorspace_fragment}
}`,x_=`varying vec3 vPosition;
varying vec3 vNormal;

void main() {
	vec4 modelPosition = modelMatrix * vec4(position, 1.0);
	gl_Position = projectionMatrix * viewMatrix * modelPosition;
	vec4 modelNormal = modelMatrix * vec4(normal, 0.0);
	vPosition = modelPosition.xyz;
	vNormal = modelNormal.xyz;
}`;function TB(o,e){st(e,!0);let i=z(e,"falloff",3,.1),a=z(e,"glowInternalRadius",3,6),n=z(e,"glowColor",3,"green"),t=z(e,"glowSharpness",3,1),r=z(e,"ref",15),s=xt(e,["$$slots","$$events","$$legacy","falloff","glowInternalRadius","glowColor","glowSharpness","ref","children"]);const l={falloff:{value:i()},glowInternalRadius:{value:a()},glowColor:{value:new Rt(n())},glowSharpness:{value:t()}},c=new Gi({uniforms:l,fragmentShader:E_,vertexShader:x_,transparent:!0,blending:jp,depthTest:!1}),{invalidate:h}=wt();Ae(()=>{c.uniforms.falloff.value=i(),h()}),Ae(()=>{c.uniforms.glowInternalRadius.value=a(),h()}),Ae(()=>{c.uniforms.glowColor.value.set(n()),h()}),Ae(()=>{c.uniforms.glowSharpness.value=t(),h()}),qe(o,yt({is:c},()=>s,{get ref(){return r()},set ref(d){r(d)},children:(d,f)=>{var p=tt(),m=ze(p);ut(m,()=>e.children??ht,()=>({ref:c})),Le(d,p)},$$slots:{default:!0}})),at()}const I_=`
uniform sampler2D pointTexture;
uniform float fade;
uniform float opacity;

varying vec3 vColor;
void main() {
	float pointOpacity = 1.0;
	if (fade == 1.0) {
		float d = distance(gl_PointCoord, vec2(0.5, 0.5));
		pointOpacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
	}
	gl_FragColor = vec4(vColor, pointOpacity * opacity);

	${xn.tonemapping_fragment}
	${xn.colorspace_fragment}
}`,B_=`uniform float time;
attribute float size;
varying vec3 vColor;
void main() {
	vColor = color;
	vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
	gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
	gl_Position = projectionMatrix * mvPosition;
}`;var S_=Hn("<!> <!> <!>",1);function MB(o,e){st(e,!0);let i=z(e,"count",3,5e3),a=z(e,"radius",3,50),n=z(e,"depth",3,50),t=z(e,"factor",3,6),r=z(e,"saturation",3,1),s=z(e,"lightness",3,.8),l=z(e,"speed",3,1),c=z(e,"fade",3,!0),h=z(e,"opacity",3,1),d=z(e,"ref",15),f=xt(e,["$$slots","$$events","$$legacy","count","radius","depth","factor","saturation","lightness","speed","fade","opacity","ref","children"]);const p=new Pp,m=new ie,b=new Vl,v=new Rt,y=D=>m.setFromSpherical(b.set(D,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI)),E=new hi,_=Qe(()=>new Mt(new Float32Array(i()*3),3)),C=Qe(()=>new Mt(new Float32Array(i()*3),3)),x=Qe(()=>new Mt(new Float32Array(i()),1));Ae(()=>{E.setAttribute("position",H(_)),E.setAttribute("color",H(C)),E.setAttribute("size",H(x))}),Ae(()=>{const D=n()/i();let U=a()+n();for(let S=0;S<i();S+=1){U-=D*Math.random();const R=y(U);H(_).setXYZ(S,R.x,R.y,R.z),v.setHSL(S/i(),r(),s()),H(C).setXYZ(S,v.r,v.g,v.b),H(x).setX(S,(.5+.5*Math.random())*t())}});const{stop:B,start:I}=zt(D=>{k.time.value+=D*l()},{autoStart:!1});Ae(()=>l()===0?B():I());const k={time:{value:0},fade:{value:1},opacity:{value:1}},P=new Gi({uniforms:k,vertexShader:B_,fragmentShader:I_});Ae(()=>{k.fade.value=c()?1:0}),Ae(()=>{k.opacity.value=h()}),qe(o,yt({is:p},()=>f,{get ref(){return d()},set ref(D){d(D)},children:(D,U)=>{var S=S_(),R=ze(S);qe(R,{is:E});var Q=In(R,2);qe(Q,{is:P,blending:jp,depthWrite:!1,transparent:!0,vertexColors:!0});var O=In(Q,2);ut(O,()=>e.children??ht,()=>({ref:p})),Le(D,S)},$$slots:{default:!0}})),at()}const Rg=0,k_=1,Ug=2,EA=2,Du=1.25,xA=1,Wr=6*4+4+4,fc=65535,D_=Math.pow(2,-24),Tu=Symbol("SKIP_GENERATION");function Fg(o){return o.index?o.index.count:o.attributes.position.count}function ds(o){return Fg(o)/3}function Lg(o,e=ArrayBuffer){return o>65535?new Uint32Array(new e(4*o)):new Uint16Array(new e(2*o))}function T_(o,e){if(!o.index){const i=o.attributes.position.count,a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=Lg(i,a);o.setIndex(new Mt(n,1));for(let t=0;t<i;t++)n[t]=t}}function Og(o,e){const i=ds(o),a=e||o.drawRange,n=a.start/3,t=(a.start+a.count)/3,r=Math.max(0,n),s=Math.min(i,t)-r;return[{offset:Math.floor(r),count:Math.floor(s)}]}function Gg(o,e){if(!o.groups||!o.groups.length)return Og(o,e);const i=[],a=new Set,n=e||o.drawRange,t=n.start/3,r=(n.start+n.count)/3;for(const l of o.groups){const c=l.start/3,h=(l.start+l.count)/3;a.add(Math.max(t,c)),a.add(Math.min(r,h))}const s=Array.from(a.values()).sort((l,c)=>l-c);for(let l=0;l<s.length-1;l++){const c=s[l],h=s[l+1];i.push({offset:Math.floor(c),count:Math.floor(h-c)})}return i}function M_(o,e){const i=ds(o),a=Gg(o,e).sort((r,s)=>r.offset-s.offset),n=a[a.length-1];n.count=Math.min(i-n.offset,n.count);let t=0;return a.forEach(({count:r})=>t+=r),i!==t}function Mu(o,e,i,a,n){let t=1/0,r=1/0,s=1/0,l=-1/0,c=-1/0,h=-1/0,d=1/0,f=1/0,p=1/0,m=-1/0,b=-1/0,v=-1/0;for(let y=e*6,E=(e+i)*6;y<E;y+=6){const _=o[y+0],C=o[y+1],x=_-C,B=_+C;x<t&&(t=x),B>l&&(l=B),_<d&&(d=_),_>m&&(m=_);const I=o[y+2],k=o[y+3],P=I-k,D=I+k;P<r&&(r=P),D>c&&(c=D),I<f&&(f=I),I>b&&(b=I);const U=o[y+4],S=o[y+5],R=U-S,Q=U+S;R<s&&(s=R),Q>h&&(h=Q),U<p&&(p=U),U>v&&(v=U)}a[0]=t,a[1]=r,a[2]=s,a[3]=l,a[4]=c,a[5]=h,n[0]=d,n[1]=f,n[2]=p,n[3]=m,n[4]=b,n[5]=v}function P_(o,e=null,i=null,a=null){const n=o.attributes.position,t=o.index?o.index.array:null,r=ds(o),s=n.normalized;let l;e===null?(l=new Float32Array(r*6),i=0,a=r):(l=e,i=i||0,a=a||r);const c=n.array,h=n.offset||0;let d=3;n.isInterleavedBufferAttribute&&(d=n.data.stride);const f=["getX","getY","getZ"];for(let p=i;p<i+a;p++){const m=p*3,b=p*6;let v=m+0,y=m+1,E=m+2;t&&(v=t[v],y=t[y],E=t[E]),s||(v=v*d+h,y=y*d+h,E=E*d+h);for(let _=0;_<3;_++){let C,x,B;s?(C=n[f[_]](v),x=n[f[_]](y),B=n[f[_]](E)):(C=c[v+_],x=c[y+_],B=c[E+_]);let I=C;x<I&&(I=x),B<I&&(I=B);let k=C;x>k&&(k=x),B>k&&(k=B);const P=(k-I)/2,D=_*2;l[b+D+0]=I+P,l[b+D+1]=P+(Math.abs(I)+P)*D_}}return l}function dn(o,e,i){return i.min.x=e[o],i.min.y=e[o+1],i.min.z=e[o+2],i.max.x=e[o+3],i.max.y=e[o+4],i.max.z=e[o+5],i}function IA(o){let e=-1,i=-1/0;for(let a=0;a<3;a++){const n=o[a+3]-o[a];n>i&&(i=n,e=a)}return e}function BA(o,e){e.set(o)}function SA(o,e,i){let a,n;for(let t=0;t<3;t++){const r=t+3;a=o[t],n=e[t],i[t]=a<n?a:n,a=o[r],n=e[r],i[r]=a>n?a:n}}function dl(o,e,i){for(let a=0;a<3;a++){const n=e[o+2*a],t=e[o+2*a+1],r=n-t,s=n+t;r<i[a]&&(i[a]=r),s>i[a+3]&&(i[a+3]=s)}}function Hs(o){const e=o[3]-o[0],i=o[4]-o[1],a=o[5]-o[2];return 2*(e*i+i*a+a*e)}const gr=32,Q_=(o,e)=>o.candidate-e.candidate,zr=new Array(gr).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),fl=new Float32Array(6);function R_(o,e,i,a,n,t){let r=-1,s=0;if(t===Rg)r=IA(e),r!==-1&&(s=(e[r]+e[r+3])/2);else if(t===k_)r=IA(o),r!==-1&&(s=U_(i,a,n,r));else if(t===Ug){const l=Hs(o);let c=Du*n;const h=a*6,d=(a+n)*6;for(let f=0;f<3;f++){const p=e[f],v=(e[f+3]-p)/gr;if(n<gr/4){const y=[...zr];y.length=n;let E=0;for(let C=h;C<d;C+=6,E++){const x=y[E];x.candidate=i[C+2*f],x.count=0;const{bounds:B,leftCacheBounds:I,rightCacheBounds:k}=x;for(let P=0;P<3;P++)k[P]=1/0,k[P+3]=-1/0,I[P]=1/0,I[P+3]=-1/0,B[P]=1/0,B[P+3]=-1/0;dl(C,i,B)}y.sort(Q_);let _=n;for(let C=0;C<_;C++){const x=y[C];for(;C+1<_&&y[C+1].candidate===x.candidate;)y.splice(C+1,1),_--}for(let C=h;C<d;C+=6){const x=i[C+2*f];for(let B=0;B<_;B++){const I=y[B];x>=I.candidate?dl(C,i,I.rightCacheBounds):(dl(C,i,I.leftCacheBounds),I.count++)}}for(let C=0;C<_;C++){const x=y[C],B=x.count,I=n-x.count,k=x.leftCacheBounds,P=x.rightCacheBounds;let D=0;B!==0&&(D=Hs(k)/l);let U=0;I!==0&&(U=Hs(P)/l);const S=xA+Du*(D*B+U*I);S<c&&(r=f,c=S,s=x.candidate)}}else{for(let _=0;_<gr;_++){const C=zr[_];C.count=0,C.candidate=p+v+_*v;const x=C.bounds;for(let B=0;B<3;B++)x[B]=1/0,x[B+3]=-1/0}for(let _=h;_<d;_+=6){let B=~~((i[_+2*f]-p)/v);B>=gr&&(B=gr-1);const I=zr[B];I.count++,dl(_,i,I.bounds)}const y=zr[gr-1];BA(y.bounds,y.rightCacheBounds);for(let _=gr-2;_>=0;_--){const C=zr[_],x=zr[_+1];SA(C.bounds,x.rightCacheBounds,C.rightCacheBounds)}let E=0;for(let _=0;_<gr-1;_++){const C=zr[_],x=C.count,B=C.bounds,k=zr[_+1].rightCacheBounds;x!==0&&(E===0?BA(B,fl):SA(B,fl,fl)),E+=x;let P=0,D=0;E!==0&&(P=Hs(fl)/l);const U=n-E;U!==0&&(D=Hs(k)/l);const S=xA+Du*(P*E+D*U);S<c&&(r=f,c=S,s=C.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${t} used.`);return{axis:r,pos:s}}function U_(o,e,i,a){let n=0;for(let t=e,r=e+i;t<r;t++)n+=o[t*6+a*2];return n/i}class Pu{constructor(){this.boundingData=new Float32Array(6)}}function F_(o,e,i,a,n,t){let r=a,s=a+n-1;const l=t.pos,c=t.axis*2;for(;;){for(;r<=s&&i[r*6+c]<l;)r++;for(;r<=s&&i[s*6+c]>=l;)s--;if(r<s){for(let h=0;h<3;h++){let d=e[r*3+h];e[r*3+h]=e[s*3+h],e[s*3+h]=d}for(let h=0;h<6;h++){let d=i[r*6+h];i[r*6+h]=i[s*6+h],i[s*6+h]=d}r++,s--}else return r}}function L_(o,e,i,a,n,t){let r=a,s=a+n-1;const l=t.pos,c=t.axis*2;for(;;){for(;r<=s&&i[r*6+c]<l;)r++;for(;r<=s&&i[s*6+c]>=l;)s--;if(r<s){let h=o[r];o[r]=o[s],o[s]=h;for(let d=0;d<6;d++){let f=i[r*6+d];i[r*6+d]=i[s*6+d],i[s*6+d]=f}r++,s--}else return r}}function ti(o,e){return e[o+15]===65535}function ui(o,e){return e[o+6]}function gi(o,e){return e[o+14]}function Si(o){return o+8}function mi(o,e){return e[o+6]}function sd(o,e){return e[o+7]}let Ng,ta,Rl,zg;const O_=Math.pow(2,32);function hh(o){return"count"in o?1:1+hh(o.left)+hh(o.right)}function G_(o,e,i){return Ng=new Float32Array(i),ta=new Uint32Array(i),Rl=new Uint16Array(i),zg=new Uint8Array(i),dh(o,e)}function dh(o,e){const i=o/4,a=o/2,n="count"in e,t=e.boundingData;for(let r=0;r<6;r++)Ng[i+r]=t[r];if(n)if(e.buffer){const r=e.buffer;zg.set(new Uint8Array(r),o);for(let s=o,l=o+r.byteLength;s<l;s+=Wr){const c=s/2;ti(c,Rl)||(ta[s/4+6]+=i)}return o+r.byteLength}else{const r=e.offset,s=e.count;return ta[i+6]=r,Rl[a+14]=s,Rl[a+15]=fc,o+Wr}else{const r=e.left,s=e.right,l=e.splitAxis;let c;if(c=dh(o+Wr,r),c/4>O_)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return ta[i+6]=c/4,c=dh(c,s),ta[i+7]=l,c}}function N_(o,e){const i=(o.index?o.index.count:o.attributes.position.count)/3,a=i>2**16,n=a?4:2,t=e?new SharedArrayBuffer(i*n):new ArrayBuffer(i*n),r=a?new Uint32Array(t):new Uint16Array(t);for(let s=0,l=r.length;s<l;s++)r[s]=s;return r}function z_(o,e,i,a,n){const{maxDepth:t,verbose:r,maxLeafTris:s,strategy:l,onProgress:c,indirect:h}=n,d=o._indirectBuffer,f=o.geometry,p=f.index?f.index.array:null,m=h?L_:F_,b=ds(f),v=new Float32Array(6);let y=!1;const E=new Pu;return Mu(e,i,a,E.boundingData,v),C(E,i,a,v),E;function _(x){c&&c(x/b)}function C(x,B,I,k=null,P=0){if(!y&&P>=t&&(y=!0,r&&(console.warn(`MeshBVH: Max depth of ${t} reached when generating BVH. Consider increasing maxDepth.`),console.warn(f))),I<=s||P>=t)return _(B+I),x.offset=B,x.count=I,x;const D=R_(x.boundingData,k,e,B,I,l);if(D.axis===-1)return _(B+I),x.offset=B,x.count=I,x;const U=m(d,p,e,B,I,D);if(U===B||U===B+I)_(B+I),x.offset=B,x.count=I;else{x.splitAxis=D.axis;const S=new Pu,R=B,Q=U-B;x.left=S,Mu(e,R,Q,S.boundingData,v),C(S,R,Q,v,P+1);const O=new Pu,G=U,q=I-Q;x.right=O,Mu(e,G,q,O.boundingData,v),C(O,G,q,v,P+1)}return x}}function H_(o,e){const i=o.geometry;e.indirect&&(o._indirectBuffer=N_(i,e.useSharedArrayBuffer),M_(i,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),o._indirectBuffer||T_(i,e);const a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=P_(i),t=e.indirect?Og(i,e.range):Gg(i,e.range);o._roots=t.map(r=>{const s=z_(o,n,r.offset,r.count,e),l=hh(s),c=new a(Wr*l);return G_(0,s,c),c})}class yr{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let a=1/0,n=-1/0;for(let t=0,r=e.length;t<r;t++){const l=e[t][i];a=l<a?l:a,n=l>n?l:n}this.min=a,this.max=n}setFromPoints(e,i){let a=1/0,n=-1/0;for(let t=0,r=i.length;t<r;t++){const s=i[t],l=e.dot(s);a=l<a?l:a,n=l>n?l:n}this.min=a,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}}yr.prototype.setFromBox=function(){const o=new ie;return function(i,a){const n=a.min,t=a.max;let r=1/0,s=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){o.x=n.x*l+t.x*(1-l),o.y=n.y*c+t.y*(1-c),o.z=n.z*h+t.z*(1-h);const d=i.dot(o);r=Math.min(d,r),s=Math.max(d,s)}this.min=r,this.max=s}}();const V_=function(){const o=new ie,e=new ie,i=new ie;return function(n,t,r){const s=n.start,l=o,c=t.start,h=e;i.subVectors(s,c),o.subVectors(n.end,n.start),e.subVectors(t.end,t.start);const d=i.dot(h),f=h.dot(l),p=h.dot(h),m=i.dot(l),v=l.dot(l)*p-f*f;let y,E;v!==0?y=(d*f-m*p)/v:y=0,E=(d+y*f)/p,r.x=y,r.y=E}}(),ad=function(){const o=new lt,e=new ie,i=new ie;return function(n,t,r,s){V_(n,t,o);let l=o.x,c=o.y;if(l>=0&&l<=1&&c>=0&&c<=1){n.at(l,r),t.at(c,s);return}else if(l>=0&&l<=1){c<0?t.at(0,s):t.at(1,s),n.closestPointToPoint(s,!0,r);return}else if(c>=0&&c<=1){l<0?n.at(0,r):n.at(1,r),t.closestPointToPoint(r,!0,s);return}else{let h;l<0?h=n.start:h=n.end;let d;c<0?d=t.start:d=t.end;const f=e,p=i;if(n.closestPointToPoint(d,!0,e),t.closestPointToPoint(h,!0,i),f.distanceToSquared(d)<=p.distanceToSquared(h)){r.copy(f),s.copy(d);return}else{r.copy(h),s.copy(p);return}}}}(),j_=function(){const o=new ie,e=new ie,i=new oc,a=new nr;return function(t,r){const{radius:s,center:l}=t,{a:c,b:h,c:d}=r;if(a.start=c,a.end=h,a.closestPointToPoint(l,!0,o).distanceTo(l)<=s||(a.start=c,a.end=d,a.closestPointToPoint(l,!0,o).distanceTo(l)<=s)||(a.start=h,a.end=d,a.closestPointToPoint(l,!0,o).distanceTo(l)<=s))return!0;const b=r.getPlane(i);if(Math.abs(b.distanceToPoint(l))<=s){const y=b.projectPoint(l,e);if(r.containsPoint(y))return!0}return!1}}(),q_=1e-15;function Qu(o){return Math.abs(o)<q_}class Ni extends Jo{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new ie),this.satBounds=new Array(4).fill().map(()=>new yr),this.points=[this.a,this.b,this.c],this.sphere=new Xr,this.plane=new oc,this.needsUpdate=!0}intersectsSphere(e){return j_(e,this)}update(){const e=this.a,i=this.b,a=this.c,n=this.points,t=this.satAxes,r=this.satBounds,s=t[0],l=r[0];this.getNormal(s),l.setFromPoints(s,n);const c=t[1],h=r[1];c.subVectors(e,i),h.setFromPoints(c,n);const d=t[2],f=r[2];d.subVectors(i,a),f.setFromPoints(d,n);const p=t[3],m=r[3];p.subVectors(a,e),m.setFromPoints(p,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}}Ni.prototype.closestPointToSegment=function(){const o=new ie,e=new ie,i=new nr;return function(n,t=null,r=null){const{start:s,end:l}=n,c=this.points;let h,d=1/0;for(let f=0;f<3;f++){const p=(f+1)%3;i.start.copy(c[f]),i.end.copy(c[p]),ad(i,n,o,e),h=o.distanceToSquared(e),h<d&&(d=h,t&&t.copy(o),r&&r.copy(e))}return this.closestPointToPoint(s,o),h=s.distanceToSquared(o),h<d&&(d=h,t&&t.copy(o),r&&r.copy(s)),this.closestPointToPoint(l,o),h=l.distanceToSquared(o),h<d&&(d=h,t&&t.copy(o),r&&r.copy(l)),Math.sqrt(d)}}();Ni.prototype.intersectsTriangle=function(){const o=new Ni,e=new Array(3),i=new Array(3),a=new yr,n=new yr,t=new ie,r=new ie,s=new ie,l=new ie,c=new ie,h=new nr,d=new nr,f=new nr,p=new ie;function m(b,v,y){const E=b.points;let _=0,C=-1;for(let x=0;x<3;x++){const{start:B,end:I}=h;B.copy(E[x]),I.copy(E[(x+1)%3]),h.delta(r);const k=Qu(v.distanceToPoint(B));if(Qu(v.normal.dot(r))&&k){y.copy(h),_=2;break}const P=v.intersectLine(h,p);if(!P&&k&&p.copy(B),(P||k)&&!Qu(p.distanceTo(I))){if(_<=1)(_===1?y.start:y.end).copy(p),k&&(C=_);else if(_>=2){(C===1?y.start:y.end).copy(p),_=2;break}if(_++,_===2&&C===-1)break}}return _}return function(v,y=null,E=!1){this.needsUpdate&&this.update(),v.isExtendedTriangle?v.needsUpdate&&v.update():(o.copy(v),o.update(),v=o);const _=this.plane,C=v.plane;if(Math.abs(_.normal.dot(C.normal))>1-1e-10){const x=this.satBounds,B=this.satAxes;i[0]=v.a,i[1]=v.b,i[2]=v.c;for(let P=0;P<4;P++){const D=x[P],U=B[P];if(a.setFromPoints(U,i),D.isSeparated(a))return!1}const I=v.satBounds,k=v.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let P=0;P<4;P++){const D=I[P],U=k[P];if(a.setFromPoints(U,e),D.isSeparated(a))return!1}for(let P=0;P<4;P++){const D=B[P];for(let U=0;U<4;U++){const S=k[U];if(t.crossVectors(D,S),a.setFromPoints(t,e),n.setFromPoints(t,i),a.isSeparated(n))return!1}}return y&&(E||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),y.start.set(0,0,0),y.end.set(0,0,0)),!0}else{const x=m(this,C,d);if(x===1&&v.containsPoint(d.end))return y&&(y.start.copy(d.end),y.end.copy(d.end)),!0;if(x!==2)return!1;const B=m(v,_,f);if(B===1&&this.containsPoint(f.end))return y&&(y.start.copy(f.end),y.end.copy(f.end)),!0;if(B!==2)return!1;if(d.delta(s),f.delta(l),s.dot(l)<0){let R=f.start;f.start=f.end,f.end=R}const I=d.start.dot(s),k=d.end.dot(s),P=f.start.dot(s),D=f.end.dot(s),U=k<P,S=I<D;return I!==D&&P!==k&&U===S?!1:(y&&(c.subVectors(d.start,f.start),c.dot(s)>0?y.start.copy(d.start):y.start.copy(f.start),c.subVectors(d.end,f.end),c.dot(s)<0?y.end.copy(d.end):y.end.copy(f.end)),!0)}}}();Ni.prototype.distanceToPoint=function(){const o=new ie;return function(i){return this.closestPointToPoint(i,o),i.distanceTo(o)}}();Ni.prototype.distanceToTriangle=function(){const o=new ie,e=new ie,i=["a","b","c"],a=new nr,n=new nr;return function(r,s=null,l=null){const c=s||l?a:null;if(this.intersectsTriangle(r,c))return(s||l)&&(s&&c.getCenter(s),l&&c.getCenter(l)),0;let h=1/0;for(let d=0;d<3;d++){let f;const p=i[d],m=r[p];this.closestPointToPoint(m,o),f=m.distanceToSquared(o),f<h&&(h=f,s&&s.copy(o),l&&l.copy(m));const b=this[p];r.closestPointToPoint(b,o),f=b.distanceToSquared(o),f<h&&(h=f,s&&s.copy(b),l&&l.copy(o))}for(let d=0;d<3;d++){const f=i[d],p=i[(d+1)%3];a.set(this[f],this[p]);for(let m=0;m<3;m++){const b=i[m],v=i[(m+1)%3];n.set(r[b],r[v]),ad(a,n,o,e);const y=o.distanceToSquared(e);y<h&&(h=y,s&&s.copy(o),l&&l.copy(e))}}return Math.sqrt(h)}}();class oi{constructor(e,i,a){this.isOrientedBox=!0,this.min=new ie,this.max=new ie,this.matrix=new Lt,this.invMatrix=new Lt,this.points=new Array(8).fill().map(()=>new ie),this.satAxes=new Array(3).fill().map(()=>new ie),this.satBounds=new Array(3).fill().map(()=>new yr),this.alignedSatBounds=new Array(3).fill().map(()=>new yr),this.needsUpdate=!1,e&&this.min.copy(e),i&&this.max.copy(i),a&&this.matrix.copy(a)}set(e,i,a){this.min.copy(e),this.max.copy(i),this.matrix.copy(a),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}oi.prototype.update=function(){return function(){const e=this.matrix,i=this.min,a=this.max,n=this.points;for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)for(let d=0;d<=1;d++){const f=1*c|2*h|4*d,p=n[f];p.x=c?a.x:i.x,p.y=h?a.y:i.y,p.z=d?a.z:i.z,p.applyMatrix4(e)}const t=this.satBounds,r=this.satAxes,s=n[0];for(let c=0;c<3;c++){const h=r[c],d=t[c],f=1<<c,p=n[f];h.subVectors(s,p),d.setFromPoints(h,n)}const l=this.alignedSatBounds;l[0].setFromPointsField(n,"x"),l[1].setFromPointsField(n,"y"),l[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();oi.prototype.intersectsBox=function(){const o=new yr;return function(i){this.needsUpdate&&this.update();const a=i.min,n=i.max,t=this.satBounds,r=this.satAxes,s=this.alignedSatBounds;if(o.min=a.x,o.max=n.x,s[0].isSeparated(o)||(o.min=a.y,o.max=n.y,s[1].isSeparated(o))||(o.min=a.z,o.max=n.z,s[2].isSeparated(o)))return!1;for(let l=0;l<3;l++){const c=r[l],h=t[l];if(o.setFromBox(c,i),h.isSeparated(o))return!1}return!0}}();oi.prototype.intersectsTriangle=function(){const o=new Ni,e=new Array(3),i=new yr,a=new yr,n=new ie;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(o.copy(r),o.update(),r=o);const s=this.satBounds,l=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let f=0;f<3;f++){const p=s[f],m=l[f];if(i.setFromPoints(m,e),p.isSeparated(i))return!1}const c=r.satBounds,h=r.satAxes,d=this.points;for(let f=0;f<3;f++){const p=c[f],m=h[f];if(i.setFromPoints(m,d),p.isSeparated(i))return!1}for(let f=0;f<3;f++){const p=l[f];for(let m=0;m<4;m++){const b=h[m];if(n.crossVectors(p,b),i.setFromPoints(n,e),a.setFromPoints(n,d),i.isSeparated(a))return!1}}return!0}}();oi.prototype.closestPointToPoint=function(){return function(e,i){return this.needsUpdate&&this.update(),i.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),i}}();oi.prototype.distanceToPoint=function(){const o=new ie;return function(i){return this.closestPointToPoint(i,o),i.distanceTo(o)}}();oi.prototype.distanceToBox=function(){const o=["x","y","z"],e=new Array(12).fill().map(()=>new nr),i=new Array(12).fill().map(()=>new nr),a=new ie,n=new ie;return function(r,s=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(l||c)&&(r.getCenter(n),this.closestPointToPoint(n,a),r.closestPointToPoint(a,n),l&&l.copy(a),c&&c.copy(n)),0;const h=s*s,d=r.min,f=r.max,p=this.points;let m=1/0;for(let v=0;v<8;v++){const y=p[v];n.copy(y).clamp(d,f);const E=y.distanceToSquared(n);if(E<m&&(m=E,l&&l.copy(y),c&&c.copy(n),E<h))return Math.sqrt(E)}let b=0;for(let v=0;v<3;v++)for(let y=0;y<=1;y++)for(let E=0;E<=1;E++){const _=(v+1)%3,C=(v+2)%3,x=y<<_|E<<C,B=1<<v|y<<_|E<<C,I=p[x],k=p[B];e[b].set(I,k);const D=o[v],U=o[_],S=o[C],R=i[b],Q=R.start,O=R.end;Q[D]=d[D],Q[U]=y?d[U]:f[U],Q[S]=E?d[S]:f[U],O[D]=f[D],O[U]=y?d[U]:f[U],O[S]=E?d[S]:f[U],b++}for(let v=0;v<=1;v++)for(let y=0;y<=1;y++)for(let E=0;E<=1;E++){n.x=v?f.x:d.x,n.y=y?f.y:d.y,n.z=E?f.z:d.z,this.closestPointToPoint(n,a);const _=n.distanceToSquared(a);if(_<m&&(m=_,l&&l.copy(a),c&&c.copy(n),_<h))return Math.sqrt(_)}for(let v=0;v<12;v++){const y=e[v];for(let E=0;E<12;E++){const _=i[E];ad(y,_,a,n);const C=a.distanceToSquared(n);if(C<m&&(m=C,l&&l.copy(a),c&&c.copy(n),C<h))return Math.sqrt(C)}}return Math.sqrt(m)}}();class ld{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class W_ extends ld{constructor(){super(()=>new Ni)}}const ki=new W_;class K_{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let i=null;this.setBuffer=a=>{i&&e.push(i),i=a,this.float32Array=new Float32Array(a),this.uint16Array=new Uint16Array(a),this.uint32Array=new Uint32Array(a)},this.clearBuffer=()=>{i=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Zt=new K_;let qr,rs;const zo=[],Al=new ld(()=>new gn);function Y_(o,e,i,a,n,t){qr=Al.getPrimitive(),rs=Al.getPrimitive(),zo.push(qr,rs),Zt.setBuffer(o._roots[e]);const r=fh(0,o.geometry,i,a,n,t);Zt.clearBuffer(),Al.releasePrimitive(qr),Al.releasePrimitive(rs),zo.pop(),zo.pop();const s=zo.length;return s>0&&(rs=zo[s-1],qr=zo[s-2]),r}function fh(o,e,i,a,n=null,t=0,r=0){const{float32Array:s,uint16Array:l,uint32Array:c}=Zt;let h=o*2;if(ti(h,l)){const f=ui(o,c),p=gi(h,l);return dn(o,s,qr),a(f,p,!1,r,t+o,qr)}else{let D=function(S){const{uint16Array:R,uint32Array:Q}=Zt;let O=S*2;for(;!ti(O,R);)S=Si(S),O=S*2;return ui(S,Q)},U=function(S){const{uint16Array:R,uint32Array:Q}=Zt;let O=S*2;for(;!ti(O,R);)S=mi(S,Q),O=S*2;return ui(S,Q)+gi(O,R)};const f=Si(o),p=mi(o,c);let m=f,b=p,v,y,E,_;if(n&&(E=qr,_=rs,dn(m,s,E),dn(b,s,_),v=n(E),y=n(_),y<v)){m=p,b=f;const S=v;v=y,y=S,E=_}E||(E=qr,dn(m,s,E));const C=ti(m*2,l),x=i(E,C,v,r+1,t+m);let B;if(x===EA){const S=D(m),Q=U(m)-S;B=a(S,Q,!0,r+1,t+m,E)}else B=x&&fh(m,e,i,a,n,t,r+1);if(B)return!0;_=rs,dn(b,s,_);const I=ti(b*2,l),k=i(_,I,y,r+1,t+b);let P;if(k===EA){const S=D(b),Q=U(b)-S;P=a(S,Q,!0,r+1,t+b,_)}else P=k&&fh(b,e,i,a,n,t,r+1);return!!P}}const Vs=new ie,Ru=new ie;function X_(o,e,i={},a=0,n=1/0){const t=a*a,r=n*n;let s=1/0,l=null;if(o.shapecast({boundsTraverseOrder:h=>(Vs.copy(e).clamp(h.min,h.max),Vs.distanceToSquared(e)),intersectsBounds:(h,d,f)=>f<s&&f<r,intersectsTriangle:(h,d)=>{h.closestPointToPoint(e,Vs);const f=e.distanceToSquared(Vs);return f<s&&(Ru.copy(Vs),s=f,l=d),f<t}}),s===1/0)return null;const c=Math.sqrt(s);return i.point?i.point.copy(Ru):i.point=Ru.clone(),i.distance=c,i.faceIndex=l,i}const J_=parseInt(Hp)>=169,po=new ie,go=new ie,mo=new ie,pl=new lt,gl=new lt,ml=new lt,kA=new ie,DA=new ie,TA=new ie,js=new ie;function Z_(o,e,i,a,n,t,r,s){let l;if(t===rc?l=o.intersectTriangle(a,i,e,!0,n):l=o.intersectTriangle(e,i,a,t!==Oi,n),l===null)return null;const c=o.origin.distanceTo(n);return c<r||c>s?null:{distance:c,point:n.clone()}}function $_(o,e,i,a,n,t,r,s,l,c,h){po.fromBufferAttribute(e,t),go.fromBufferAttribute(e,r),mo.fromBufferAttribute(e,s);const d=Z_(o,po,go,mo,js,l,c,h);if(d){const f=new ie;Jo.getBarycoord(js,po,go,mo,f),a&&(pl.fromBufferAttribute(a,t),gl.fromBufferAttribute(a,r),ml.fromBufferAttribute(a,s),d.uv=Jo.getInterpolation(js,po,go,mo,pl,gl,ml,new lt)),n&&(pl.fromBufferAttribute(n,t),gl.fromBufferAttribute(n,r),ml.fromBufferAttribute(n,s),d.uv1=Jo.getInterpolation(js,po,go,mo,pl,gl,ml,new lt)),i&&(kA.fromBufferAttribute(i,t),DA.fromBufferAttribute(i,r),TA.fromBufferAttribute(i,s),d.normal=Jo.getInterpolation(js,po,go,mo,kA,DA,TA,new ie),d.normal.dot(o.direction)>0&&d.normal.multiplyScalar(-1));const p={a:t,b:r,c:s,normal:new ie,materialIndex:0};Jo.getNormal(po,go,mo,p.normal),d.face=p,d.faceIndex=t,J_&&(d.barycoord=f)}return d}function Ac(o,e,i,a,n,t,r){const s=a*3;let l=s+0,c=s+1,h=s+2;const d=o.index;o.index&&(l=d.getX(l),c=d.getX(c),h=d.getX(h));const{position:f,normal:p,uv:m,uv1:b}=o.attributes,v=$_(i,f,p,m,b,l,c,h,e,t,r);return v?(v.faceIndex=a,n&&n.push(v),v):null}function yn(o,e,i,a){const n=o.a,t=o.b,r=o.c;let s=e,l=e+1,c=e+2;i&&(s=i.getX(s),l=i.getX(l),c=i.getX(c)),n.x=a.getX(s),n.y=a.getY(s),n.z=a.getZ(s),t.x=a.getX(l),t.y=a.getY(l),t.z=a.getZ(l),r.x=a.getX(c),r.y=a.getY(c),r.z=a.getZ(c)}function eC(o,e,i,a,n,t,r,s){const{geometry:l,_indirectBuffer:c}=o;for(let h=a,d=a+n;h<d;h++)Ac(l,e,i,h,t,r,s)}function tC(o,e,i,a,n,t,r){const{geometry:s,_indirectBuffer:l}=o;let c=1/0,h=null;for(let d=a,f=a+n;d<f;d++){let p;p=Ac(s,e,i,d,null,t,r),p&&p.distance<c&&(h=p,c=p.distance)}return h}function nC(o,e,i,a,n,t,r){const{geometry:s}=i,{index:l}=s,c=s.attributes.position;for(let h=o,d=e+o;h<d;h++){let f;if(f=h,yn(r,f*3,l,c),r.needsUpdate=!0,a(r,f,n,t))return!0}return!1}function iC(o,e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=o.geometry,a=i.index?i.index.array:null,n=i.attributes.position;let t,r,s,l,c=0;const h=o._roots;for(let f=0,p=h.length;f<p;f++)t=h[f],r=new Uint32Array(t),s=new Uint16Array(t),l=new Float32Array(t),d(0,c),c+=t.byteLength;function d(f,p,m=!1){const b=f*2;if(s[b+15]===fc){const y=r[f+6],E=s[b+14];let _=1/0,C=1/0,x=1/0,B=-1/0,I=-1/0,k=-1/0;for(let P=3*y,D=3*(y+E);P<D;P++){let U=a[P];const S=n.getX(U),R=n.getY(U),Q=n.getZ(U);S<_&&(_=S),S>B&&(B=S),R<C&&(C=R),R>I&&(I=R),Q<x&&(x=Q),Q>k&&(k=Q)}return l[f+0]!==_||l[f+1]!==C||l[f+2]!==x||l[f+3]!==B||l[f+4]!==I||l[f+5]!==k?(l[f+0]=_,l[f+1]=C,l[f+2]=x,l[f+3]=B,l[f+4]=I,l[f+5]=k,!0):!1}else{const y=f+8,E=r[f+6],_=y+p,C=E+p;let x=m,B=!1,I=!1;e?x||(B=e.has(_),I=e.has(C),x=!B&&!I):(B=!0,I=!0);const k=x||B,P=x||I;let D=!1;k&&(D=d(y,p,x));let U=!1;P&&(U=d(E,p,x));const S=D||U;if(S)for(let R=0;R<3;R++){const Q=y+R,O=E+R,G=l[Q],q=l[Q+3],Z=l[O],Y=l[O+3];l[f+R]=G<Z?G:Z,l[f+R+3]=q>Y?q:Y}return S}}}function Yr(o,e,i,a,n){let t,r,s,l,c,h;const d=1/i.direction.x,f=1/i.direction.y,p=1/i.direction.z,m=i.origin.x,b=i.origin.y,v=i.origin.z;let y=e[o],E=e[o+3],_=e[o+1],C=e[o+3+1],x=e[o+2],B=e[o+3+2];return d>=0?(t=(y-m)*d,r=(E-m)*d):(t=(E-m)*d,r=(y-m)*d),f>=0?(s=(_-b)*f,l=(C-b)*f):(s=(C-b)*f,l=(_-b)*f),t>l||s>r||((s>t||isNaN(t))&&(t=s),(l<r||isNaN(r))&&(r=l),p>=0?(c=(x-v)*p,h=(B-v)*p):(c=(B-v)*p,h=(x-v)*p),t>h||c>r)?!1:((c>t||t!==t)&&(t=c),(h<r||r!==r)&&(r=h),t<=n&&r>=a)}function rC(o,e,i,a,n,t,r,s){const{geometry:l,_indirectBuffer:c}=o;for(let h=a,d=a+n;h<d;h++){let f=c?c[h]:h;Ac(l,e,i,f,t,r,s)}}function oC(o,e,i,a,n,t,r){const{geometry:s,_indirectBuffer:l}=o;let c=1/0,h=null;for(let d=a,f=a+n;d<f;d++){let p;p=Ac(s,e,i,l?l[d]:d,null,t,r),p&&p.distance<c&&(h=p,c=p.distance)}return h}function sC(o,e,i,a,n,t,r){const{geometry:s}=i,{index:l}=s,c=s.attributes.position;for(let h=o,d=e+o;h<d;h++){let f;if(f=i.resolveTriangleIndex(h),yn(r,f*3,l,c),r.needsUpdate=!0,a(r,f,n,t))return!0}return!1}function aC(o,e,i,a,n,t,r){Zt.setBuffer(o._roots[e]),Ah(0,o,i,a,n,t,r),Zt.clearBuffer()}function Ah(o,e,i,a,n,t,r){const{float32Array:s,uint16Array:l,uint32Array:c}=Zt,h=o*2;if(ti(h,l)){const f=ui(o,c),p=gi(h,l);eC(e,i,a,f,p,n,t,r)}else{const f=Si(o);Yr(f,s,a,t,r)&&Ah(f,e,i,a,n,t,r);const p=mi(o,c);Yr(p,s,a,t,r)&&Ah(p,e,i,a,n,t,r)}}const lC=["x","y","z"];function cC(o,e,i,a,n,t){Zt.setBuffer(o._roots[e]);const r=ph(0,o,i,a,n,t);return Zt.clearBuffer(),r}function ph(o,e,i,a,n,t){const{float32Array:r,uint16Array:s,uint32Array:l}=Zt;let c=o*2;if(ti(c,s)){const d=ui(o,l),f=gi(c,s);return tC(e,i,a,d,f,n,t)}else{const d=sd(o,l),f=lC[d],m=a.direction[f]>=0;let b,v;m?(b=Si(o),v=mi(o,l)):(b=mi(o,l),v=Si(o));const E=Yr(b,r,a,n,t)?ph(b,e,i,a,n,t):null;if(E){const x=E.point[f];if(m?x<=r[v+d]:x>=r[v+d+3])return E}const C=Yr(v,r,a,n,t)?ph(v,e,i,a,n,t):null;return E&&C?E.distance<=C.distance?E:C:E||C||null}}const vl=new gn,Ho=new Ni,Vo=new Ni,qs=new Lt,MA=new oi,bl=new oi;function uC(o,e,i,a){Zt.setBuffer(o._roots[e]);const n=gh(0,o,i,a);return Zt.clearBuffer(),n}function gh(o,e,i,a,n=null){const{float32Array:t,uint16Array:r,uint32Array:s}=Zt;let l=o*2;if(n===null&&(i.boundingBox||i.computeBoundingBox(),MA.set(i.boundingBox.min,i.boundingBox.max,a),n=MA),ti(l,r)){const h=e.geometry,d=h.index,f=h.attributes.position,p=i.index,m=i.attributes.position,b=ui(o,s),v=gi(l,r);if(qs.copy(a).invert(),i.boundsTree)return dn(o,t,bl),bl.matrix.copy(qs),bl.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:E=>bl.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(a),E.b.applyMatrix4(a),E.c.applyMatrix4(a),E.needsUpdate=!0;for(let _=b*3,C=(v+b)*3;_<C;_+=3)if(yn(Vo,_,d,f),Vo.needsUpdate=!0,E.intersectsTriangle(Vo))return!0;return!1}});for(let y=b*3,E=(v+b)*3;y<E;y+=3){yn(Ho,y,d,f),Ho.a.applyMatrix4(qs),Ho.b.applyMatrix4(qs),Ho.c.applyMatrix4(qs),Ho.needsUpdate=!0;for(let _=0,C=p.count;_<C;_+=3)if(yn(Vo,_,p,m),Vo.needsUpdate=!0,Ho.intersectsTriangle(Vo))return!0}}else{const h=o+8,d=s[o+6];return dn(h,t,vl),!!(n.intersectsBox(vl)&&gh(h,e,i,a,n)||(dn(d,t,vl),n.intersectsBox(vl)&&gh(d,e,i,a,n)))}}const wl=new Lt,Uu=new oi,Ws=new oi,hC=new ie,dC=new ie,fC=new ie,AC=new ie;function pC(o,e,i,a={},n={},t=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Uu.set(e.boundingBox.min,e.boundingBox.max,i),Uu.needsUpdate=!0;const s=o.geometry,l=s.attributes.position,c=s.index,h=e.attributes.position,d=e.index,f=ki.getPrimitive(),p=ki.getPrimitive();let m=hC,b=dC,v=null,y=null;n&&(v=fC,y=AC);let E=1/0,_=null,C=null;return wl.copy(i).invert(),Ws.matrix.copy(wl),o.shapecast({boundsTraverseOrder:x=>Uu.distanceToBox(x),intersectsBounds:(x,B,I)=>I<E&&I<r?(B&&(Ws.min.copy(x.min),Ws.max.copy(x.max),Ws.needsUpdate=!0),!0):!1,intersectsRange:(x,B)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:k=>Ws.distanceToBox(k),intersectsBounds:(k,P,D)=>D<E&&D<r,intersectsRange:(k,P)=>{for(let D=k,U=k+P;D<U;D++){yn(p,3*D,d,h),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let S=x,R=x+B;S<R;S++){yn(f,3*S,c,l),f.needsUpdate=!0;const Q=f.distanceToTriangle(p,m,v);if(Q<E&&(b.copy(m),y&&y.copy(v),E=Q,_=S,C=D),Q<t)return!0}}}});{const I=ds(e);for(let k=0,P=I;k<P;k++){yn(p,3*k,d,h),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let D=x,U=x+B;D<U;D++){yn(f,3*D,c,l),f.needsUpdate=!0;const S=f.distanceToTriangle(p,m,v);if(S<E&&(b.copy(m),y&&y.copy(v),E=S,_=D,C=k),S<t)return!0}}}}}),ki.releasePrimitive(f),ki.releasePrimitive(p),E===1/0?null:(a.point?a.point.copy(b):a.point=b.clone(),a.distance=E,a.faceIndex=_,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(wl),b.applyMatrix4(wl),n.distance=b.sub(n.point).length(),n.faceIndex=C),a)}function gC(o,e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=o.geometry,a=i.index?i.index.array:null,n=i.attributes.position;let t,r,s,l,c=0;const h=o._roots;for(let f=0,p=h.length;f<p;f++)t=h[f],r=new Uint32Array(t),s=new Uint16Array(t),l=new Float32Array(t),d(0,c),c+=t.byteLength;function d(f,p,m=!1){const b=f*2;if(s[b+15]===fc){const y=r[f+6],E=s[b+14];let _=1/0,C=1/0,x=1/0,B=-1/0,I=-1/0,k=-1/0;for(let P=y,D=y+E;P<D;P++){const U=3*o.resolveTriangleIndex(P);for(let S=0;S<3;S++){let R=U+S;R=a?a[R]:R;const Q=n.getX(R),O=n.getY(R),G=n.getZ(R);Q<_&&(_=Q),Q>B&&(B=Q),O<C&&(C=O),O>I&&(I=O),G<x&&(x=G),G>k&&(k=G)}}return l[f+0]!==_||l[f+1]!==C||l[f+2]!==x||l[f+3]!==B||l[f+4]!==I||l[f+5]!==k?(l[f+0]=_,l[f+1]=C,l[f+2]=x,l[f+3]=B,l[f+4]=I,l[f+5]=k,!0):!1}else{const y=f+8,E=r[f+6],_=y+p,C=E+p;let x=m,B=!1,I=!1;e?x||(B=e.has(_),I=e.has(C),x=!B&&!I):(B=!0,I=!0);const k=x||B,P=x||I;let D=!1;k&&(D=d(y,p,x));let U=!1;P&&(U=d(E,p,x));const S=D||U;if(S)for(let R=0;R<3;R++){const Q=y+R,O=E+R,G=l[Q],q=l[Q+3],Z=l[O],Y=l[O+3];l[f+R]=G<Z?G:Z,l[f+R+3]=q>Y?q:Y}return S}}}function mC(o,e,i,a,n,t,r){Zt.setBuffer(o._roots[e]),mh(0,o,i,a,n,t,r),Zt.clearBuffer()}function mh(o,e,i,a,n,t,r){const{float32Array:s,uint16Array:l,uint32Array:c}=Zt,h=o*2;if(ti(h,l)){const f=ui(o,c),p=gi(h,l);rC(e,i,a,f,p,n,t,r)}else{const f=Si(o);Yr(f,s,a,t,r)&&mh(f,e,i,a,n,t,r);const p=mi(o,c);Yr(p,s,a,t,r)&&mh(p,e,i,a,n,t,r)}}const vC=["x","y","z"];function bC(o,e,i,a,n,t){Zt.setBuffer(o._roots[e]);const r=vh(0,o,i,a,n,t);return Zt.clearBuffer(),r}function vh(o,e,i,a,n,t){const{float32Array:r,uint16Array:s,uint32Array:l}=Zt;let c=o*2;if(ti(c,s)){const d=ui(o,l),f=gi(c,s);return oC(e,i,a,d,f,n,t)}else{const d=sd(o,l),f=vC[d],m=a.direction[f]>=0;let b,v;m?(b=Si(o),v=mi(o,l)):(b=mi(o,l),v=Si(o));const E=Yr(b,r,a,n,t)?vh(b,e,i,a,n,t):null;if(E){const x=E.point[f];if(m?x<=r[v+d]:x>=r[v+d+3])return E}const C=Yr(v,r,a,n,t)?vh(v,e,i,a,n,t):null;return E&&C?E.distance<=C.distance?E:C:E||C||null}}const yl=new gn,jo=new Ni,qo=new Ni,Ks=new Lt,PA=new oi,_l=new oi;function wC(o,e,i,a){Zt.setBuffer(o._roots[e]);const n=bh(0,o,i,a);return Zt.clearBuffer(),n}function bh(o,e,i,a,n=null){const{float32Array:t,uint16Array:r,uint32Array:s}=Zt;let l=o*2;if(n===null&&(i.boundingBox||i.computeBoundingBox(),PA.set(i.boundingBox.min,i.boundingBox.max,a),n=PA),ti(l,r)){const h=e.geometry,d=h.index,f=h.attributes.position,p=i.index,m=i.attributes.position,b=ui(o,s),v=gi(l,r);if(Ks.copy(a).invert(),i.boundsTree)return dn(o,t,_l),_l.matrix.copy(Ks),_l.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:E=>_l.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(a),E.b.applyMatrix4(a),E.c.applyMatrix4(a),E.needsUpdate=!0;for(let _=b,C=v+b;_<C;_++)if(yn(qo,3*e.resolveTriangleIndex(_),d,f),qo.needsUpdate=!0,E.intersectsTriangle(qo))return!0;return!1}});for(let y=b,E=v+b;y<E;y++){const _=e.resolveTriangleIndex(y);yn(jo,3*_,d,f),jo.a.applyMatrix4(Ks),jo.b.applyMatrix4(Ks),jo.c.applyMatrix4(Ks),jo.needsUpdate=!0;for(let C=0,x=p.count;C<x;C+=3)if(yn(qo,C,p,m),qo.needsUpdate=!0,jo.intersectsTriangle(qo))return!0}}else{const h=o+8,d=s[o+6];return dn(h,t,yl),!!(n.intersectsBox(yl)&&bh(h,e,i,a,n)||(dn(d,t,yl),n.intersectsBox(yl)&&bh(d,e,i,a,n)))}}const Cl=new Lt,Fu=new oi,Ys=new oi,yC=new ie,_C=new ie,CC=new ie,EC=new ie;function xC(o,e,i,a={},n={},t=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Fu.set(e.boundingBox.min,e.boundingBox.max,i),Fu.needsUpdate=!0;const s=o.geometry,l=s.attributes.position,c=s.index,h=e.attributes.position,d=e.index,f=ki.getPrimitive(),p=ki.getPrimitive();let m=yC,b=_C,v=null,y=null;n&&(v=CC,y=EC);let E=1/0,_=null,C=null;return Cl.copy(i).invert(),Ys.matrix.copy(Cl),o.shapecast({boundsTraverseOrder:x=>Fu.distanceToBox(x),intersectsBounds:(x,B,I)=>I<E&&I<r?(B&&(Ys.min.copy(x.min),Ys.max.copy(x.max),Ys.needsUpdate=!0),!0):!1,intersectsRange:(x,B)=>{if(e.boundsTree){const I=e.boundsTree;return I.shapecast({boundsTraverseOrder:k=>Ys.distanceToBox(k),intersectsBounds:(k,P,D)=>D<E&&D<r,intersectsRange:(k,P)=>{for(let D=k,U=k+P;D<U;D++){const S=I.resolveTriangleIndex(D);yn(p,3*S,d,h),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let R=x,Q=x+B;R<Q;R++){const O=o.resolveTriangleIndex(R);yn(f,3*O,c,l),f.needsUpdate=!0;const G=f.distanceToTriangle(p,m,v);if(G<E&&(b.copy(m),y&&y.copy(v),E=G,_=R,C=D),G<t)return!0}}}})}else{const I=ds(e);for(let k=0,P=I;k<P;k++){yn(p,3*k,d,h),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let D=x,U=x+B;D<U;D++){const S=o.resolveTriangleIndex(D);yn(f,3*S,c,l),f.needsUpdate=!0;const R=f.distanceToTriangle(p,m,v);if(R<E&&(b.copy(m),y&&y.copy(v),E=R,_=D,C=k),R<t)return!0}}}}}),ki.releasePrimitive(f),ki.releasePrimitive(p),E===1/0?null:(a.point?a.point.copy(b):a.point=b.clone(),a.distance=E,a.faceIndex=_,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(Cl),b.applyMatrix4(Cl),n.distance=b.sub(n.point).length(),n.faceIndex=C),a)}function IC(){return typeof SharedArrayBuffer<"u"}const ca=new Zt.constructor,Wl=new Zt.constructor,Hr=new ld(()=>new gn),Wo=new gn,Ko=new gn,Lu=new gn,Ou=new gn;let Gu=!1;function BC(o,e,i,a){if(Gu)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Gu=!0;const n=o._roots,t=e._roots;let r,s=0,l=0;const c=new Lt().copy(i).invert();for(let h=0,d=n.length;h<d;h++){ca.setBuffer(n[h]),l=0;const f=Hr.getPrimitive();dn(0,ca.float32Array,f),f.applyMatrix4(c);for(let p=0,m=t.length;p<m&&(Wl.setBuffer(t[p]),r=Ri(0,0,i,c,a,s,l,0,0,f),Wl.clearBuffer(),l+=t[p].length,!r);p++);if(Hr.releasePrimitive(f),ca.clearBuffer(),s+=n[h].length,r)break}return Gu=!1,r}function Ri(o,e,i,a,n,t=0,r=0,s=0,l=0,c=null,h=!1){let d,f;h?(d=Wl,f=ca):(d=ca,f=Wl);const p=d.float32Array,m=d.uint32Array,b=d.uint16Array,v=f.float32Array,y=f.uint32Array,E=f.uint16Array,_=o*2,C=e*2,x=ti(_,b),B=ti(C,E);let I=!1;if(B&&x)h?I=n(ui(e,y),gi(e*2,E),ui(o,m),gi(o*2,b),l,r+e,s,t+o):I=n(ui(o,m),gi(o*2,b),ui(e,y),gi(e*2,E),s,t+o,l,r+e);else if(B){const k=Hr.getPrimitive();dn(e,v,k),k.applyMatrix4(i);const P=Si(o),D=mi(o,m);dn(P,p,Wo),dn(D,p,Ko);const U=k.intersectsBox(Wo),S=k.intersectsBox(Ko);I=U&&Ri(e,P,a,i,n,r,t,l,s+1,k,!h)||S&&Ri(e,D,a,i,n,r,t,l,s+1,k,!h),Hr.releasePrimitive(k)}else{const k=Si(e),P=mi(e,y);dn(k,v,Lu),dn(P,v,Ou);const D=c.intersectsBox(Lu),U=c.intersectsBox(Ou);if(D&&U)I=Ri(o,k,i,a,n,t,r,s,l+1,c,h)||Ri(o,P,i,a,n,t,r,s,l+1,c,h);else if(D)if(x)I=Ri(o,k,i,a,n,t,r,s,l+1,c,h);else{const S=Hr.getPrimitive();S.copy(Lu).applyMatrix4(i);const R=Si(o),Q=mi(o,m);dn(R,p,Wo),dn(Q,p,Ko);const O=S.intersectsBox(Wo),G=S.intersectsBox(Ko);I=O&&Ri(k,R,a,i,n,r,t,l,s+1,S,!h)||G&&Ri(k,Q,a,i,n,r,t,l,s+1,S,!h),Hr.releasePrimitive(S)}else if(U)if(x)I=Ri(o,P,i,a,n,t,r,s,l+1,c,h);else{const S=Hr.getPrimitive();S.copy(Ou).applyMatrix4(i);const R=Si(o),Q=mi(o,m);dn(R,p,Wo),dn(Q,p,Ko);const O=S.intersectsBox(Wo),G=S.intersectsBox(Ko);I=O&&Ri(P,R,a,i,n,r,t,l,s+1,S,!h)||G&&Ri(P,Q,a,i,n,r,t,l,s+1,S,!h),Hr.releasePrimitive(S)}}return I}const El=new oi,QA=new gn,SC={strategy:Rg,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class cd{static serialize(e,i={}){i={cloneBuffers:!0,...i};const a=e.geometry,n=e._roots,t=e._indirectBuffer,r=a.getIndex();let s;return i.cloneBuffers?s={roots:n.map(l=>l.slice()),index:r?r.array.slice():null,indirectBuffer:t?t.slice():null}:s={roots:n,index:r?r.array:null,indirectBuffer:t},s}static deserialize(e,i,a={}){a={setIndex:!0,indirect:!!e.indirectBuffer,...a};const{index:n,roots:t,indirectBuffer:r}=e,s=new cd(i,{...a,[Tu]:!0});if(s._roots=t,s._indirectBuffer=r||null,a.setIndex){const l=i.getIndex();if(l===null){const c=new Mt(e.index,1,!1);i.setIndex(c)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return s}get indirect(){return!!this._indirectBuffer}constructor(e,i={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(i=Object.assign({...SC,[Tu]:!1},i),i.useSharedArrayBuffer&&!IC())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,i[Tu]||(H_(this,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new gn))),this.resolveTriangleIndex=i.indirect?a=>this._indirectBuffer[a]:a=>a}refit(e=null){return(this.indirect?gC:iC)(this,e)}traverse(e,i=0){const a=this._roots[i],n=new Uint32Array(a),t=new Uint16Array(a);r(0);function r(s,l=0){const c=s*2,h=t[c+15]===fc;if(h){const d=n[s+6],f=t[c+14];e(l,h,new Float32Array(a,s*4,6),d,f)}else{const d=s+Wr/4,f=n[s+6],p=n[s+7];e(l,h,new Float32Array(a,s*4,6),p)||(r(d,l+1),r(f,l+1))}}}raycast(e,i=zl,a=0,n=1/0){const t=this._roots,r=this.geometry,s=[],l=i.isMaterial,c=Array.isArray(i),h=r.groups,d=l?i.side:i,f=this.indirect?mC:aC;for(let p=0,m=t.length;p<m;p++){const b=c?i[h[p].materialIndex].side:d,v=s.length;if(f(this,p,b,e,s,a,n),c){const y=h[p].materialIndex;for(let E=v,_=s.length;E<_;E++)s[E].face.materialIndex=y}}return s}raycastFirst(e,i=zl,a=0,n=1/0){const t=this._roots,r=this.geometry,s=i.isMaterial,l=Array.isArray(i);let c=null;const h=r.groups,d=s?i.side:i,f=this.indirect?bC:cC;for(let p=0,m=t.length;p<m;p++){const b=l?i[h[p].materialIndex].side:d,v=f(this,p,b,e,a,n);v!=null&&(c==null||v.distance<c.distance)&&(c=v,l&&(v.face.materialIndex=h[p].materialIndex))}return c}intersectsGeometry(e,i){let a=!1;const n=this._roots,t=this.indirect?wC:uC;for(let r=0,s=n.length;r<s&&(a=t(this,r,e,i),!a);r++);return a}shapecast(e){const i=ki.getPrimitive(),a=this.indirect?sC:nC;let{boundsTraverseOrder:n,intersectsBounds:t,intersectsRange:r,intersectsTriangle:s}=e;if(r&&s){const d=r;r=(f,p,m,b,v)=>d(f,p,m,b,v)?!0:a(f,p,this,s,m,b,i)}else r||(s?r=(d,f,p,m)=>a(d,f,this,s,p,m,i):r=(d,f,p)=>p);let l=!1,c=0;const h=this._roots;for(let d=0,f=h.length;d<f;d++){const p=h[d];if(l=Y_(this,d,t,r,n,c),l)break;c+=p.byteLength}return ki.releasePrimitive(i),l}bvhcast(e,i,a){let{intersectsRanges:n,intersectsTriangles:t}=a;const r=ki.getPrimitive(),s=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?m=>{const b=this.resolveTriangleIndex(m);yn(r,b*3,s,l)}:m=>{yn(r,m*3,s,l)},h=ki.getPrimitive(),d=e.geometry.index,f=e.geometry.attributes.position,p=e.indirect?m=>{const b=e.resolveTriangleIndex(m);yn(h,b*3,d,f)}:m=>{yn(h,m*3,d,f)};if(t){const m=(b,v,y,E,_,C,x,B)=>{for(let I=y,k=y+E;I<k;I++){p(I),h.a.applyMatrix4(i),h.b.applyMatrix4(i),h.c.applyMatrix4(i),h.needsUpdate=!0;for(let P=b,D=b+v;P<D;P++)if(c(P),r.needsUpdate=!0,t(r,h,P,I,_,C,x,B))return!0}return!1};if(n){const b=n;n=function(v,y,E,_,C,x,B,I){return b(v,y,E,_,C,x,B,I)?!0:m(v,y,E,_,C,x,B,I)}}else n=m}return BC(this,e,i,n)}intersectsBox(e,i){return El.set(e.min,e.max,i),El.needsUpdate=!0,this.shapecast({intersectsBounds:a=>El.intersectsBox(a),intersectsTriangle:a=>El.intersectsTriangle(a)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,a={},n={},t=0,r=1/0){return(this.indirect?xC:pC)(this,e,i,a,n,t,r)}closestPointToPoint(e,i={},a=0,n=1/0){return X_(this,e,i,a,n)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(a=>{dn(0,new Float32Array(a),QA),e.union(QA)}),e}}function kC(o){switch(o){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function DC(o){switch(o){case 1:return Eo;case 2:return es;case 3:return ni;case 4:return ni}}function RA(o){switch(o){case 1:return L0;case 2:return qp;case 3:return eh;case 4:return eh}}class Hg extends Kr{constructor(){super(),this.minFilter=wn,this.magFilter=wn,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const i=this.overrideItemSize,a=e.itemSize,n=e.count;if(i!==null){if(a*n%i!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=i,e.count=n*a/i}const t=e.itemSize,r=e.count,s=e.normalized,l=e.array.constructor,c=l.BYTES_PER_ELEMENT;let h=this._forcedType,d=t;if(h===null)switch(l){case Float32Array:h=fn;break;case Uint8Array:case Uint16Array:case Uint32Array:h=sa;break;case Int8Array:case Int16Array:case Int32Array:h=Wc;break}let f,p,m,b,v=kC(t);switch(h){case fn:m=1,p=DC(t),s&&c===1?(b=l,v+="8",l===Uint8Array?f=Ui:(f=wf,v+="_SNORM")):(b=Float32Array,v+="32F",f=fn);break;case Wc:v+=c*8+"I",m=s?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,p=RA(t),c===1?(b=Int8Array,f=wf):c===2?(b=Int16Array,f=F0):(b=Int32Array,f=Wc);break;case sa:v+=c*8+"UI",m=s?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,p=RA(t),c===1?(b=Uint8Array,f=Ui):c===2?(b=Uint16Array,f=U0):(b=Uint32Array,f=sa);break}d===3&&(p===ni||p===eh)&&(d=4);const y=Math.ceil(Math.sqrt(r))||1,E=d*y*y,_=new b(E),C=e.normalized;e.normalized=!1;for(let x=0;x<r;x++){const B=d*x;_[B]=e.getX(x)/m,t>=2&&(_[B+1]=e.getY(x)/m),t>=3&&(_[B+2]=e.getZ(x)/m,d===4&&(_[B+3]=1)),t>=4&&(_[B+3]=e.getW(x)/m)}e.normalized=C,this.internalFormat=v,this.format=p,this.type=f,this.image.width=y,this.image.height=y,this.image.data=_,this.needsUpdate=!0,this.dispose(),e.itemSize=a,e.count=n}}class TC extends Hg{constructor(){super(),this._forcedType=sa}}class MC extends Hg{constructor(){super(),this._forcedType=fn}}class UA{constructor(){this.index=new TC,this.position=new MC,this.bvhBounds=new Kr,this.bvhContents=new Kr,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:i}=e;if(QC(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(i.attributes.position),e.indirect){const a=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==a.length)if(i.index)this._cachedIndexAttr=i.index.clone();else{const n=Lg(Fg(i));this._cachedIndexAttr=new Mt(n,1,!1)}PC(i,a,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(i.index)}dispose(){const{index:e,position:i,bvhBounds:a,bvhContents:n}=this;e&&e.dispose(),i&&i.dispose(),a&&a.dispose(),n&&n.dispose()}}function PC(o,e,i){const a=i.array,n=o.index?o.index.array:null;for(let t=0,r=e.length;t<r;t++){const s=3*t,l=3*e[t];for(let c=0;c<3;c++)a[s+c]=n?n[l+c]:l+c}}function QC(o,e,i){const a=o._roots;if(a.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const n=a[0],t=new Uint16Array(n),r=new Uint32Array(n),s=new Float32Array(n),l=n.byteLength/Wr,c=2*Math.ceil(Math.sqrt(l/2)),h=new Float32Array(4*c*c),d=Math.ceil(Math.sqrt(l)),f=new Uint32Array(2*d*d);for(let p=0;p<l;p++){const m=p*Wr/4,b=m*2,v=m;for(let y=0;y<3;y++)h[8*p+0+y]=s[v+0+y],h[8*p+4+y]=s[v+3+y];if(ti(b,t)){const y=gi(b,t),E=ui(m,r),_=4294901760|y;f[p*2+0]=_,f[p*2+1]=E}else{const y=4*mi(m,r)/Wr,E=sd(m,r);f[p*2+0]=E,f[p*2+1]=y}}e.image.data=h,e.image.width=c,e.image.height=c,e.format=ni,e.type=fn,e.internalFormat="RGBA32F",e.minFilter=wn,e.magFilter=wn,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),i.image.data=f,i.image.width=d,i.image.height=d,i.format=qp,i.type=sa,i.internalFormat="RG32UI",i.minFilter=wn,i.magFilter=wn,i.generateMipmaps=!1,i.needsUpdate=!0,i.dispose()}const RC=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,UC=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,FC=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,LC=FC,OC=`
	${RC}
	${UC}
`,GC=`#define ENVMAP_TYPE_CUBE_UV
precision highp isampler2D;
precision highp usampler2D;
varying vec3 vWorldPosition;
varying vec3 vNormal;
varying mat4 vModelMatrixInverse;

#ifdef USE_INSTANCING_COLOR
	varying vec3 vInstanceColor;
#endif

#ifdef ENVMAP_TYPE_CUBEM
	uniform samplerCube envMap;
#else
	uniform sampler2D envMap;
#endif

uniform float bounces;
${LC}
${OC}
uniform BVH bvh;
uniform float ior;
uniform bool correctMips;
uniform vec2 resolution;
uniform float fresnel;
uniform mat4 modelMatrix;
uniform mat4 projectionMatrixInverse;
uniform mat4 viewMatrixInverse;
uniform float aberrationStrength;
uniform vec3 color;

float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {
	return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );
}

vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {
	vec3 rayOrigin = ro;
	vec3 rayDirection = rd;
	rayDirection = refract(rayDirection, normal, 1.0 / ior);
	rayOrigin = vWorldPosition + rayDirection * 0.001;
	rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;
	rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);
	for(float i = 0.0; i < bounces; i++) {
		uvec4 faceIndices = uvec4( 0u );
		vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
		vec3 barycoord = vec3( 0.0 );
		float side = 1.0;
		float dist = 0.0;
		bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
		vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);
		vec3 tempDir = refract(rayDirection, faceNormal, ior);
		if (length(tempDir) != 0.0) {
			rayDirection = tempDir;
			break;
		}
		rayDirection = reflect(rayDirection, faceNormal);
		rayOrigin = hitPos + rayDirection * 0.01;
	}
	rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);
	return rayDirection;
}

#include <common>
#include <cube_uv_reflection_fragment>

#ifdef ENVMAP_TYPE_CUBEM
	vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {
		return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));
	}
#else
	vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {
		vec2 uvv = equirectUv( rayDirection );
		vec2 smoothUv = equirectUv( directionCamPerfect );
		return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));
	}
#endif

void main() {
	vec2 uv = gl_FragCoord.xy / resolution;
	vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;
	directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;
	directionCamPerfect = normalize(directionCamPerfect);
	vec3 normal = vNormal;
	vec3 rayOrigin = cameraPosition;
	vec3 rayDirection = normalize(vWorldPosition - cameraPosition);
	vec3 finalColor;
	#ifdef CHROMATIC_ABERRATIONS
		vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
		#ifdef FAST_CHROMA
			vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));
			vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));
		#else
			vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);
			vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);
		#endif
		float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;
		float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;
		float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;
		finalColor = vec3(finalColorR, finalColorG, finalColorB);
	#else
		rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
		finalColor = textureGradient(envMap, rayDirection, directionCamPerfect).rgb;
	#endif

	finalColor *= color;
	#ifdef USE_INSTANCING_COLOR
		finalColor *= vInstanceColor;
	#endif

	vec3 viewDirection = normalize(vWorldPosition - cameraPosition);
	float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;
	gl_FragColor = vec4(mix(finalColor, vec3(1.0), nFresnel), 1.0);
	${xn.tonemapping_fragment}
	${xn.colorspace_fragment}
}`,NC=`uniform mat4 viewMatrixInverse;

varying vec3 vWorldPosition;
varying vec3 vNormal;
varying mat4 vModelMatrixInverse;

#ifdef USE_INSTANCING_COLOR
	varying vec3 vInstanceColor;
#endif

void main() {
	vec4 transformedNormal = vec4(normal, 0.0);
	vec4 transformedPosition = vec4(position, 1.0);
	#ifdef USE_INSTANCING
		transformedNormal = instanceMatrix * transformedNormal;
		transformedPosition = instanceMatrix * transformedPosition;
	#endif

	#ifdef USE_INSTANCING
		vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);
	#else
		vModelMatrixInverse = inverse(modelMatrix);
	#endif

	#ifdef USE_INSTANCING_COLOR
		vInstanceColor = instanceColor.rgb;
	#endif

	vWorldPosition = (modelMatrix * transformedPosition).xyz;
	vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);
	gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;
}`;function PB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(_,"$parent",i),t=()=>cn(v,"$size",i);let r=z(e,"bounces",3,2),s=z(e,"ior",3,2.4),l=z(e,"fresnel",3,0),c=z(e,"aberrationStrength",3,0),h=z(e,"color",3,"white"),d=z(e,"fastChroma",3,!0),f=z(e,"ref",15),p=xt(e,["$$slots","$$events","$$legacy","envMap","bounces","ior","fresnel","aberrationStrength","color","fastChroma","ref"]);const m={envMap:{value:null},bounces:{value:2},ior:{value:2.4},correctMips:{value:!0},aberrationStrength:{value:.01},fresnel:{value:0},bvh:{value:new UA},color:{value:new Rt("white")},resolution:{value:new lt},viewMatrixInverse:{value:new Lt},projectionMatrixInverse:{value:new Lt}},b=new Gi({fragmentShader:GC,vertexShader:NC,uniforms:m});f(b);const{size:v,invalidate:y,camera:E}=wt(),_=or();let C={};const x=(k,P,D)=>{var Z;const U=Nt(k,"CubeTexture"),R=((U?(Z=k.image[0])==null?void 0:Z.width:k==null?void 0:k.image.width)??1024)/4,Q=Math.floor(Math.log2(R)),O=Math.pow(2,Q),G=3*Math.max(O,16*7),q=4*O;U&&(C.ENVMAP_TYPE_CUBEM=""),C.CUBEUV_TEXEL_WIDTH=`${1/G}`,C.CUBEUV_TEXEL_HEIGHT=`${1/q}`,C.CUBEUV_MAX_MIP=`${Q}.0`,P>0&&(C.CHROMATIC_ABERRATIONS=""),D&&(C.FAST_CHROMA="")};Ae(()=>{x(e.envMap,c(),d())}),Uh(()=>{var k;n()&&n()instanceof Re&&n().geometry&&(m.bvh.value=new UA,m.bvh.value.updateFrom(new cd((k=n())==null?void 0:k.geometry.clone().toNonIndexed(),{strategy:Ug})))}),zt(()=>{m.viewMatrixInverse.value=E.current.matrixWorld,m.projectionMatrixInverse.value=E.current.projectionMatrixInverse},{autoInvalidate:!1});const B=new Rt(h());Ae(()=>{B.set(h()),y()});var I=Qe(()=>[t().width,t().height]);qe(o,yt({is:b,get"uniforms.envMap.value"(){return e.envMap},get"uniforms.bounces.value"(){return r()},get"uniforms.ior.value"(){return s()},get"uniforms.fresnel.value"(){return l()},get"uniforms.aberrationStrength.value"(){return c()},"uniforms.color.value":B,get"uniforms.resolution.value"(){return H(I)},defines:C},()=>p)),at(),a()}class zC extends Vp{constructor(e,i={}){const a=i.font;if(a===void 0)super();else{const n=a.generateShapes(e,i.size);i.depth===void 0&&(i.depth=50),i.bevelThickness===void 0&&(i.bevelThickness=10),i.bevelSize===void 0&&(i.bevelSize=8),i.bevelEnabled===void 0&&(i.bevelEnabled=!1),super(n,i)}this.type="TextGeometry"}}class HC extends Ea{constructor(e){super(e)}load(e,i,a,n){const t=this,r=new tr(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(s){const l=t.parse(JSON.parse(s));i&&i(l)},a,n)}parse(e){return new VC(e)}}class VC{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,i=100){const a=[],n=jC(e,i,this.data);for(let t=0,r=n.length;t<r;t++)a.push(...n[t].toShapes());return a}}function jC(o,e,i){const a=Array.from(o),n=e/i.resolution,t=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*n,r=[];let s=0,l=0;for(let c=0;c<a.length;c++){const h=a[c];if(h===`
`)s=0,l-=t;else{const d=qC(h,n,s,l,i);s+=d.offsetX,r.push(d.path)}}return r}function qC(o,e,i,a,n){const t=n.glyphs[o]||n.glyphs["?"];if(!t){console.error('THREE.Font: character "'+o+'" does not exists in font family '+n.familyName+".");return}const r=new O0;let s,l,c,h,d,f,p,m;if(t.o){const b=t._cachedOutline||(t._cachedOutline=t.o.split(" "));for(let v=0,y=b.length;v<y;)switch(b[v++]){case"m":s=b[v++]*e+i,l=b[v++]*e+a,r.moveTo(s,l);break;case"l":s=b[v++]*e+i,l=b[v++]*e+a,r.lineTo(s,l);break;case"q":c=b[v++]*e+i,h=b[v++]*e+a,d=b[v++]*e+i,f=b[v++]*e+a,r.quadraticCurveTo(d,f,c,h);break;case"b":c=b[v++]*e+i,h=b[v++]*e+a,d=b[v++]*e+i,f=b[v++]*e+a,p=b[v++]*e+i,m=b[v++]*e+a,r.bezierCurveTo(d,f,p,m,c,h);break}}return{offsetX:t.ha*e,path:r}}function QB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(H(h),"$loadedFont",i);let t=z(e,"font",3,"https://cdn.jsdelivr.net/npm/three/examples/fonts/helvetiker_regular.typeface.json"),r=z(e,"ref",15),s=xt(e,["$$slots","$$events","$$legacy","text","font","size","depth","curveSegments","bevelEnabled","bevelThickness","bevelSize","bevelOffset","bevelSegments","smooth","extrudePath","steps","UVGenerator","ref","children"]);const l=Er(),c=Ca(HC);let h=Qe(()=>l(typeof t()=="string"?c.load(t()):Fh(new Promise(v=>v(t()))))),d=Qe(()=>{if(n())return new zC(e.text,{font:n(),size:e.size,depth:e.depth,curveSegments:e.curveSegments,bevelEnabled:e.bevelEnabled,bevelThickness:e.bevelThickness,bevelSize:e.bevelSize,bevelOffset:e.bevelOffset,bevelSegments:e.bevelSegments,extrudePath:e.extrudePath,steps:e.steps,UVGenerator:e.UVGenerator})}),f=Qe(()=>{if(H(d))return e.smooth===0?H(d):jh(H(d),e.smooth)});var p=tt(),m=ze(p);{var b=v=>{qe(v,yt({get is(){return H(f)}},()=>s,{get ref(){return r()},set ref(y){r(y)},children:(y,E)=>{var _=tt(),C=ze(_);ut(C,()=>e.children??ht,()=>({ref:H(f)})),Le(y,_)},$$slots:{default:!0}}))};En(m,v=>{H(f)&&v(b)})}Le(o,p),at(),a()}var wh={exports:{}};/*! Tweakpane 3.1.10 (c) 2016 cocopon, licensed under the MIT license. */(function(o,e){(function(i,a){a(e)})(J0,function(i){class a{constructor(u){const[A,w]=u.split("-"),M=A.split(".");this.major=parseInt(M[0],10),this.minor=parseInt(M[1],10),this.patch=parseInt(M[2],10),this.prerelease=w??null}toString(){const u=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[u,this.prerelease].join("-"):u}}class n{constructor(u){this.controller_=u}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(u){this.controller_.viewProps.set("disabled",u)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(u){this.controller_.viewProps.set("hidden",u)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class t{constructor(u){this.target=u}}class r extends t{constructor(u,A,w,M){super(u),this.value=A,this.presetKey=w,this.last=M??!0}}class s extends t{constructor(u,A,w){super(u),this.value=A,this.presetKey=w}}class l extends t{constructor(u,A){super(u),this.expanded=A}}class c extends t{constructor(u,A){super(u),this.index=A}}function h(g){return g}function d(g){return g==null}function f(g,u){if(g.length!==u.length)return!1;for(let A=0;A<g.length;A++)if(g[A]!==u[A])return!1;return!0}function p(g,u){let A=g;do{const w=Object.getOwnPropertyDescriptor(A,u);if(w&&(w.set!==void 0||w.writable===!0))return!0;A=Object.getPrototypeOf(A)}while(A!==null);return!1}const m={alreadydisposed:()=>"View has been already disposed",invalidparams:g=>`Invalid parameters for '${g.name}'`,nomatchingcontroller:g=>`No matching controller for '${g.key}'`,nomatchingview:g=>`No matching view for '${JSON.stringify(g.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:g=>`Property '${g.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class b{static alreadyDisposed(){return new b({type:"alreadydisposed"})}static notBindable(){return new b({type:"notbindable"})}static propertyNotFound(u){return new b({type:"propertynotfound",context:{name:u}})}static shouldNeverHappen(){return new b({type:"shouldneverhappen"})}constructor(u){var A;this.message=(A=m[u.type](u.context))!==null&&A!==void 0?A:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=u.type}}class v{constructor(u,A,w){this.obj_=u,this.key_=A,this.presetKey_=w??A}static isBindable(u){return!(u===null||typeof u!="object"&&typeof u!="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(u){this.obj_[this.key_]=u}writeProperty(u,A){const w=this.read();if(!v.isBindable(w))throw b.notBindable();if(!(u in w))throw b.propertyNotFound(u);w[u]=A}}class y extends n{get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}get title(){var u;return(u=this.controller_.valueController.props.get("title"))!==null&&u!==void 0?u:""}set title(u){this.controller_.valueController.props.set("title",u)}on(u,A){const w=A.bind(this);return this.controller_.valueController.emitter.on(u,()=>{w(new t(this))}),this}}class E{constructor(){this.observers_={}}on(u,A){let w=this.observers_[u];return w||(w=this.observers_[u]=[]),w.push({handler:A}),this}off(u,A){const w=this.observers_[u];return w&&(this.observers_[u]=w.filter(M=>M.handler!==A)),this}emit(u,A){const w=this.observers_[u];w&&w.forEach(M=>{M.handler(A)})}}const _="tp";function C(g){return(A,w)=>[_,"-",g,"v",A?`_${A}`:"",w?`-${w}`:""].join("")}function x(g,u){return A=>u(g(A))}function B(g){return g.rawValue}function I(g,u){g.emitter.on("change",x(B,u)),u(g.rawValue)}function k(g,u,A){I(g.value(u),A)}function P(g,u,A){A?g.classList.add(u):g.classList.remove(u)}function D(g,u){return A=>{P(g,u,A)}}function U(g,u){I(g,A=>{u.textContent=A??""})}const S=C("btn");class R{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(S()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("button");w.classList.add(S("b")),A.viewProps.bindDisabled(w),this.element.appendChild(w),this.buttonElement=w;const M=u.createElement("div");M.classList.add(S("t")),U(A.props.value("title"),M),this.buttonElement.appendChild(M)}}class Q{constructor(u,A){this.emitter=new E,this.onClick_=this.onClick_.bind(this),this.props=A.props,this.viewProps=A.viewProps,this.view=new R(u,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class O{constructor(u,A){var w;this.constraint_=A==null?void 0:A.constraint,this.equals_=(w=A==null?void 0:A.equals)!==null&&w!==void 0?w:(M,K)=>M===K,this.emitter=new E,this.rawValue_=u}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(u){this.setRawValue(u,{forceEmit:!1,last:!0})}setRawValue(u,A){const w=A??{forceEmit:!1,last:!0},M=this.constraint_?this.constraint_.constrain(u):u,K=this.rawValue_;this.equals_(K,M)&&!w.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=M,this.emitter.emit("change",{options:w,previousRawValue:K,rawValue:M,sender:this}))}}class G{constructor(u){this.emitter=new E,this.value_=u}get rawValue(){return this.value_}set rawValue(u){this.setRawValue(u,{forceEmit:!1,last:!0})}setRawValue(u,A){const w=A??{forceEmit:!1,last:!0},M=this.value_;M===u&&!w.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=u,this.emitter.emit("change",{options:w,previousRawValue:M,rawValue:this.value_,sender:this}))}}function q(g,u){const A=u==null?void 0:u.constraint,w=u==null?void 0:u.equals;return!A&&!w?new G(g):new O(g,u)}class Z{constructor(u){this.emitter=new E,this.valMap_=u;for(const A in this.valMap_)this.valMap_[A].emitter.on("change",()=>{this.emitter.emit("change",{key:A,sender:this})})}static createCore(u){return Object.keys(u).reduce((w,M)=>Object.assign(w,{[M]:q(u[M])}),{})}static fromObject(u){const A=this.createCore(u);return new Z(A)}get(u){return this.valMap_[u].rawValue}set(u,A){this.valMap_[u].rawValue=A}value(u){return this.valMap_[u]}}function Y(g,u){const w=Object.keys(u).reduce((M,K)=>{if(M===void 0)return;const re=u[K],De=re(g[K]);return De.succeeded?Object.assign(Object.assign({},M),{[K]:De.value}):void 0},{});return w}function j(g,u){return g.reduce((A,w)=>{if(A===void 0)return;const M=u(w);if(!(!M.succeeded||M.value===void 0))return[...A,M.value]},[])}function L(g){return g===null?!1:typeof g=="object"}function N(g){return u=>A=>{if(!u&&A===void 0)return{succeeded:!1,value:void 0};if(u&&A===void 0)return{succeeded:!0,value:void 0};const w=g(A);return w!==void 0?{succeeded:!0,value:w}:{succeeded:!1,value:void 0}}}function V(g){return{custom:u=>N(u)(g),boolean:N(u=>typeof u=="boolean"?u:void 0)(g),number:N(u=>typeof u=="number"?u:void 0)(g),string:N(u=>typeof u=="string"?u:void 0)(g),function:N(u=>typeof u=="function"?u:void 0)(g),constant:u=>N(A=>A===u?u:void 0)(g),raw:N(u=>u)(g),object:u=>N(A=>{if(L(A))return Y(A,u)})(g),array:u=>N(A=>{if(Array.isArray(A))return j(A,u)})(g)}}const J={optional:V(!0),required:V(!1)};function X(g,u){const A=J.required.object(u)(g);return A.succeeded?A.value:void 0}function $(g){console.warn([`Missing '${g.key}' of ${g.target} in ${g.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function ne(g){return g&&g.parentElement&&g.parentElement.removeChild(g),null}class se{constructor(u){this.value_=u}static create(u){return[new se(u),(A,w)=>{u.setRawValue(A,w)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const _e=C("");function be(g,u){return D(g,_e(void 0,u))}class oe extends Z{constructor(u){var A;super(u),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=se.create(q(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(A=this.get("parent"))===null||A===void 0||A.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(u){var A,w,M;const K=u??{};return new oe(Z.createCore({disabled:(A=K.disabled)!==null&&A!==void 0?A:!1,disposed:!1,hidden:(w=K.hidden)!==null&&w!==void 0?w:!1,parent:(M=K.parent)!==null&&M!==void 0?M:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(u){I(this.globalDisabled_,be(u,"disabled")),k(this,"hidden",be(u,"hidden"))}bindDisabled(u){I(this.globalDisabled_,A=>{u.disabled=A})}bindTabIndex(u){I(this.globalDisabled_,A=>{u.tabIndex=A?-1:0})}handleDispose(u){this.value("disposed").emitter.on("change",A=>{A&&u()})}getGlobalDisabled_(){const u=this.get("parent");return(u?u.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(u){var A;const w=u.previousRawValue;w==null||w.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(A=this.get("parent"))===null||A===void 0||A.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function ue(){return["veryfirst","first","last","verylast"]}const We=C(""),Te={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Se{constructor(u){this.parent_=null,this.blade=u.blade,this.view=u.view,this.viewProps=u.viewProps;const A=this.view.element;this.blade.value("positions").emitter.on("change",()=>{ue().forEach(w=>{A.classList.remove(We(void 0,Te[w]))}),this.blade.get("positions").forEach(w=>{A.classList.add(We(void 0,Te[w]))})}),this.viewProps.handleDispose(()=>{ne(A)})}get parent(){return this.parent_}set parent(u){if(this.parent_=u,!("parent"in this.viewProps.valMap_)){$({key:"parent",target:oe.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const Be="http://www.w3.org/2000/svg";function Ue(g){g.offsetHeight}function ke(g,u){const A=g.style.transition;g.style.transition="none",u(),g.style.transition=A}function He(g){return g.ontouchstart!==void 0}function he(){return globalThis}function te(){return he().document}function Ee(g){const u=g.ownerDocument.defaultView;return u&&"document"in u?g.getContext("2d",{willReadFrequently:!0}):null}const pe={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ce(g,u){const A=g.createElementNS(Be,"svg");return A.innerHTML=pe[u],A}function ge(g,u,A){g.insertBefore(u,g.children[A])}function Je(g){g.parentElement&&g.parentElement.removeChild(g)}function de(g){for(;g.children.length>0;)g.removeChild(g.children[0])}function xe(g){for(;g.childNodes.length>0;)g.removeChild(g.childNodes[0])}function Ie(g){return g.relatedTarget?g.relatedTarget:"explicitOriginalTarget"in g?g.explicitOriginalTarget:null}const Oe=C("lbl");function it(g,u){const A=g.createDocumentFragment();return u.split(`
`).map(M=>g.createTextNode(M)).forEach((M,K)=>{K>0&&A.appendChild(g.createElement("br")),A.appendChild(M)}),A}class pt{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(Oe()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("div");w.classList.add(Oe("l")),k(A.props,"label",K=>{d(K)?this.element.classList.add(Oe(void 0,"nol")):(this.element.classList.remove(Oe(void 0,"nol")),xe(w),w.appendChild(it(u,K)))}),this.element.appendChild(w),this.labelElement=w;const M=u.createElement("div");M.classList.add(Oe("v")),this.element.appendChild(M),this.valueElement=M}}class Pe extends Se{constructor(u,A){const w=A.valueController.viewProps;super(Object.assign(Object.assign({},A),{view:new pt(u,{props:A.props,viewProps:w}),viewProps:w})),this.props=A.props,this.valueController=A.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Ze={id:"button",type:"blade",accept(g){const u=J,A=X(g,{title:u.required.string,view:u.required.constant("button"),label:u.optional.string});return A?{params:A}:null},controller(g){return new Pe(g.document,{blade:g.blade,props:Z.fromObject({label:g.params.label}),valueController:new Q(g.document,{props:Z.fromObject({title:g.params.title}),viewProps:g.viewProps})})},api(g){return!(g.controller instanceof Pe)||!(g.controller.valueController instanceof Q)?null:new y(g.controller)}};class we extends Se{constructor(u){super(u),this.value=u.value}}function ot(){return new Z({positions:q([],{equals:f})})}class $e extends Z{constructor(u){super(u)}static create(u){const A={completed:!0,expanded:u,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},w=Z.createCore(A);return new $e(w)}get styleExpanded(){var u;return(u=this.get("temporaryExpanded"))!==null&&u!==void 0?u:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const u=this.get("expandedHeight");return this.get("shouldFixHeight")&&!d(u)?`${u}px`:"auto"}bindExpandedClass(u,A){const w=()=>{this.styleExpanded?u.classList.add(A):u.classList.remove(A)};k(this,"expanded",w),k(this,"temporaryExpanded",w)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function dt(g,u){let A=0;return ke(u,()=>{g.set("expandedHeight",null),g.set("temporaryExpanded",!0),Ue(u),A=u.clientHeight,g.set("temporaryExpanded",null),Ue(u)}),A}function gt(g,u){u.style.height=g.styleHeight}function ce(g,u){g.value("expanded").emitter.on("beforechange",()=>{if(g.set("completed",!1),d(g.get("expandedHeight"))){const A=dt(g,u);A>0&&g.set("expandedHeight",A)}g.set("shouldFixHeight",!0),Ue(u)}),g.emitter.on("change",()=>{gt(g,u)}),gt(g,u),u.addEventListener("transitionend",A=>{A.propertyName==="height"&&g.cleanUpTransition()})}class Ke extends n{constructor(u,A){super(u),this.rackApi_=A}}function un(g,u){return g.addBlade(Object.assign(Object.assign({},u),{view:"button"}))}function et(g,u){return g.addBlade(Object.assign(Object.assign({},u),{view:"folder"}))}function Ge(g,u){const A=u??{};return g.addBlade(Object.assign(Object.assign({},A),{view:"separator"}))}function Bt(g,u){return g.addBlade(Object.assign(Object.assign({},u),{view:"tab"}))}class mt{constructor(u){this.emitter=new E,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=u}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(u){for(const A of this.allItems())if(u(A))return A;return null}includes(u){return this.cache_.has(u)}add(u,A){if(this.includes(u))throw b.shouldNeverHappen();const w=A!==void 0?A:this.items_.length;this.items_.splice(w,0,u),this.cache_.add(u);const M=this.extract_(u);M&&(M.emitter.on("add",this.onSubListAdd_),M.emitter.on("remove",this.onSubListRemove_),M.allItems().forEach(K=>{this.cache_.add(K)})),this.emitter.emit("add",{index:w,item:u,root:this,target:this})}remove(u){const A=this.items_.indexOf(u);if(A<0)return;this.items_.splice(A,1),this.cache_.delete(u);const w=this.extract_(u);w&&(w.emitter.off("add",this.onSubListAdd_),w.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:A,item:u,root:this,target:this})}onSubListAdd_(u){this.cache_.add(u.item),this.emitter.emit("add",{index:u.index,item:u.item,root:this,target:u.target})}onSubListRemove_(u){this.cache_.delete(u.item),this.emitter.emit("remove",{index:u.index,item:u.item,root:this,target:u.target})}}class Fe extends n{constructor(u){super(u),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new E,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}on(u,A){const w=A.bind(this);return this.emitter_.on(u,M=>{w(M.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(u){const A=u.sender.target.read();this.emitter_.emit("change",{event:new r(this,A,this.controller_.binding.target.presetKey,u.options.last)})}}class rt extends Pe{constructor(u,A){super(u,A),this.binding=A.binding}}class Tt extends n{constructor(u){super(u),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new E,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}on(u,A){const w=A.bind(this);return this.emitter_.on(u,M=>{w(M.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(u){const A=u.sender.target.read();this.emitter_.emit("update",{event:new s(this,A,this.controller_.binding.target.presetKey)})}}class _t extends Pe{constructor(u,A){super(u,A),this.binding=A.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Ct(g){return g instanceof An?g.apiSet_:g instanceof Ke?g.rackApi_.apiSet_:null}function Wt(g,u){const A=g.find(w=>w.controller_===u);if(!A)throw b.shouldNeverHappen();return A}function Mn(g,u,A){if(!v.isBindable(g))throw b.notBindable();return new v(g,u,A)}class An extends n{constructor(u,A){super(u),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new E,this.apiSet_=new mt(Ct),this.pool_=A;const w=this.controller_.rack;w.emitter.on("add",this.onRackAdd_),w.emitter.on("remove",this.onRackRemove_),w.emitter.on("inputchange",this.onRackInputChange_),w.emitter.on("monitorupdate",this.onRackMonitorUpdate_),w.children.forEach(M=>{this.setUpApi_(M)})}get children(){return this.controller_.rack.children.map(u=>Wt(this.apiSet_,u))}addInput(u,A,w){const M=w??{},K=this.controller_.view.element.ownerDocument,re=this.pool_.createInput(K,Mn(u,A,M.presetKey),M),De=new Fe(re);return this.add(De,M.index)}addMonitor(u,A,w){const M=w??{},K=this.controller_.view.element.ownerDocument,re=this.pool_.createMonitor(K,Mn(u,A),M),De=new Tt(re);return this.add(De,M.index)}addFolder(u){return et(this,u)}addButton(u){return un(this,u)}addSeparator(u){return Ge(this,u)}addTab(u){return Bt(this,u)}add(u,A){this.controller_.rack.add(u.controller_,A);const w=this.apiSet_.find(M=>M.controller_===u.controller_);return w&&this.apiSet_.remove(w),this.apiSet_.add(u),u}remove(u){this.controller_.rack.remove(u.controller_)}addBlade(u){const A=this.controller_.view.element.ownerDocument,w=this.pool_.createBlade(A,u),M=this.pool_.createBladeApi(w);return this.add(M,u.index)}on(u,A){const w=A.bind(this);return this.emitter_.on(u,M=>{w(M.event)}),this}setUpApi_(u){this.apiSet_.find(w=>w.controller_===u)||this.apiSet_.add(this.pool_.createBladeApi(u))}onRackAdd_(u){this.setUpApi_(u.bladeController)}onRackRemove_(u){if(u.isRoot){const A=Wt(this.apiSet_,u.bladeController);this.apiSet_.remove(A)}}onRackInputChange_(u){const A=u.bladeController;if(A instanceof rt){const w=Wt(this.apiSet_,A),M=A.binding;this.emitter_.emit("change",{event:new r(w,M.target.read(),M.target.presetKey,u.options.last)})}else if(A instanceof we){const w=Wt(this.apiSet_,A);this.emitter_.emit("change",{event:new r(w,A.value.rawValue,void 0,u.options.last)})}}onRackMonitorUpdate_(u){if(!(u.bladeController instanceof _t))throw b.shouldNeverHappen();const A=Wt(this.apiSet_,u.bladeController),w=u.bladeController.binding;this.emitter_.emit("update",{event:new s(A,w.target.read(),w.target.presetKey)})}}class mn extends Ke{constructor(u,A){super(u,new An(u.rackController,A)),this.emitter_=new E,this.controller_.foldable.value("expanded").emitter.on("change",w=>{this.emitter_.emit("fold",{event:new l(this,w.sender.rawValue)})}),this.rackApi_.on("change",w=>{this.emitter_.emit("change",{event:w})}),this.rackApi_.on("update",w=>{this.emitter_.emit("update",{event:w})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(u){this.controller_.foldable.set("expanded",u)}get title(){return this.controller_.props.get("title")}set title(u){this.controller_.props.set("title",u)}get children(){return this.rackApi_.children}addInput(u,A,w){return this.rackApi_.addInput(u,A,w)}addMonitor(u,A,w){return this.rackApi_.addMonitor(u,A,w)}addFolder(u){return this.rackApi_.addFolder(u)}addButton(u){return this.rackApi_.addButton(u)}addSeparator(u){return this.rackApi_.addSeparator(u)}addTab(u){return this.rackApi_.addTab(u)}add(u,A){return this.rackApi_.add(u,A)}remove(u){this.rackApi_.remove(u)}addBlade(u){return this.rackApi_.addBlade(u)}on(u,A){const w=A.bind(this);return this.emitter_.on(u,M=>{w(M.event)}),this}}class Bn extends Se{constructor(u){super({blade:u.blade,view:u.view,viewProps:u.rackController.viewProps}),this.rackController=u.rackController}}class Sn{constructor(u,A){const w=C(A.viewName);this.element=u.createElement("div"),this.element.classList.add(w()),A.viewProps.bindClassModifiers(this.element)}}function Ht(g,u){for(let A=0;A<g.length;A++){const w=g[A];if(w instanceof rt&&w.binding===u)return w}return null}function Xn(g,u){for(let A=0;A<g.length;A++){const w=g[A];if(w instanceof _t&&w.binding===u)return w}return null}function Jr(g,u){for(let A=0;A<g.length;A++){const w=g[A];if(w instanceof we&&w.value===u)return w}return null}function zi(g){return g instanceof Pn?g.rack:g instanceof Bn?g.rackController.rack:null}function ps(g){const u=zi(g);return u?u.bcSet_:null}class wi{constructor(u){var A,w;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new E,this.blade_=(A=u.blade)!==null&&A!==void 0?A:null,(w=this.blade_)===null||w===void 0||w.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=u.viewProps,this.bcSet_=new mt(ps),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(u,A){var w;(w=u.parent)===null||w===void 0||w.remove(u),p(u,"parent")?u.parent=this:(u.parent_=this,$({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(u,A)}remove(u){p(u,"parent")?u.parent=null:(u.parent_=null,$({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(u)}find(u){return this.bcSet_.allItems().filter(A=>A instanceof u)}onSetAdd_(u){this.updatePositions_();const A=u.target===u.root;if(this.emitter.emit("add",{bladeController:u.item,index:u.index,isRoot:A,sender:this}),!A)return;const w=u.item;if(w.viewProps.emitter.on("change",this.onChildViewPropsChange_),w.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),w.viewProps.handleDispose(this.onChildDispose_),w instanceof rt)w.binding.emitter.on("change",this.onChildInputChange_);else if(w instanceof _t)w.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(w instanceof we)w.value.emitter.on("change",this.onChildValueChange_);else{const M=zi(w);if(M){const K=M.emitter;K.on("layout",this.onDescendantLayout_),K.on("inputchange",this.onDescendantInputChange_),K.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(u){this.updatePositions_();const A=u.target===u.root;if(this.emitter.emit("remove",{bladeController:u.item,isRoot:A,sender:this}),!A)return;const w=u.item;if(w instanceof rt)w.binding.emitter.off("change",this.onChildInputChange_);else if(w instanceof _t)w.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(w instanceof we)w.value.emitter.off("change",this.onChildValueChange_);else{const M=zi(w);if(M){const K=M.emitter;K.off("layout",this.onDescendantLayout_),K.off("inputchange",this.onDescendantInputChange_),K.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const u=this.bcSet_.items.filter(M=>!M.viewProps.get("hidden")),A=u[0],w=u[u.length-1];this.bcSet_.items.forEach(M=>{const K=[];M===A&&(K.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&K.push("veryfirst")),M===w&&(K.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&K.push("verylast")),M.blade.set("positions",K)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(u){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(A=>A.viewProps.get("disposed")).forEach(A=>{this.bcSet_.remove(A)})}onChildInputChange_(u){const A=Ht(this.find(rt),u.sender);if(!A)throw b.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:A,options:u.options,sender:this})}onChildMonitorUpdate_(u){const A=Xn(this.find(_t),u.sender);if(!A)throw b.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:A,sender:this})}onChildValueChange_(u){const A=Jr(this.find(we),u.sender);if(!A)throw b.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:A,options:u.options,sender:this})}onDescendantLayout_(u){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(u){this.emitter.emit("inputchange",{bladeController:u.bladeController,options:u.options,sender:this})}onDescendantMonitorUpdate_(u){this.emitter.emit("monitorupdate",{bladeController:u.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Pn extends Se{constructor(u,A){super(Object.assign(Object.assign({},A),{view:new Sn(u,{viewName:"brk",viewProps:A.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const w=new wi({blade:A.root?void 0:A.blade,viewProps:A.viewProps});w.emitter.on("add",this.onRackAdd_),w.emitter.on("remove",this.onRackRemove_),this.rack=w,this.viewProps.handleDispose(()=>{for(let M=this.rack.children.length-1;M>=0;M--)this.rack.children[M].viewProps.set("disposed",!0)})}onRackAdd_(u){u.isRoot&&ge(this.view.element,u.bladeController.view.element,u.index)}onRackRemove_(u){u.isRoot&&Je(u.bladeController.view.element)}}const T=C("cnt");class F{constructor(u,A){var w;this.className_=C((w=A.viewName)!==null&&w!==void 0?w:"fld"),this.element=u.createElement("div"),this.element.classList.add(this.className_(),T()),A.viewProps.bindClassModifiers(this.element),this.foldable_=A.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),k(this.foldable_,"completed",D(this.element,this.className_(void 0,"cpl")));const M=u.createElement("button");M.classList.add(this.className_("b")),k(A.props,"title",At=>{d(At)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),A.viewProps.bindDisabled(M),this.element.appendChild(M),this.buttonElement=M;const K=u.createElement("div");K.classList.add(this.className_("i")),this.element.appendChild(K);const re=u.createElement("div");re.classList.add(this.className_("t")),U(A.props.value("title"),re),this.buttonElement.appendChild(re),this.titleElement=re;const De=u.createElement("div");De.classList.add(this.className_("m")),this.buttonElement.appendChild(De);const ct=A.containerElement;ct.classList.add(this.className_("c")),this.element.appendChild(ct),this.containerElement=ct}}class W extends Bn{constructor(u,A){var w;const M=$e.create((w=A.expanded)!==null&&w!==void 0?w:!0),K=new Pn(u,{blade:A.blade,root:A.root,viewProps:A.viewProps});super(Object.assign(Object.assign({},A),{rackController:K,view:new F(u,{containerElement:K.view.element,foldable:M,props:A.props,viewName:A.root?"rot":void 0,viewProps:A.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=A.props,this.foldable=M,ce(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const ee={id:"folder",type:"blade",accept(g){const u=J,A=X(g,{title:u.required.string,view:u.required.constant("folder"),expanded:u.optional.boolean});return A?{params:A}:null},controller(g){return new W(g.document,{blade:g.blade,expanded:g.params.expanded,props:Z.fromObject({title:g.params.title}),viewProps:g.viewProps})},api(g){return g.controller instanceof W?new mn(g.controller,g.pool):null}};class fe extends we{constructor(u,A){const w=A.valueController.viewProps;super(Object.assign(Object.assign({},A),{value:A.valueController.value,view:new pt(u,{props:A.props,viewProps:w}),viewProps:w})),this.props=A.props,this.valueController=A.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class le extends n{}const ae=C("spr");class Me{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(ae()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("hr");w.classList.add(ae("r")),this.element.appendChild(w)}}class ye extends Se{constructor(u,A){super(Object.assign(Object.assign({},A),{view:new Me(u,{viewProps:A.viewProps})}))}}const ve={id:"separator",type:"blade",accept(g){const A=X(g,{view:J.required.constant("separator")});return A?{params:A}:null},controller(g){return new ye(g.document,{blade:g.blade,viewProps:g.viewProps})},api(g){return g.controller instanceof ye?new le(g.controller):null}},me=C("tbi");class Ne{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(me()),A.viewProps.bindClassModifiers(this.element),k(A.props,"selected",K=>{K?this.element.classList.add(me(void 0,"sel")):this.element.classList.remove(me(void 0,"sel"))});const w=u.createElement("button");w.classList.add(me("b")),A.viewProps.bindDisabled(w),this.element.appendChild(w),this.buttonElement=w;const M=u.createElement("div");M.classList.add(me("t")),U(A.props.value("title"),M),this.buttonElement.appendChild(M),this.titleElement=M}}class Ye{constructor(u,A){this.emitter=new E,this.onClick_=this.onClick_.bind(this),this.props=A.props,this.viewProps=A.viewProps,this.view=new Ne(u,{props:A.props,viewProps:A.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Ve{constructor(u,A){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Ye(u,{props:A.itemProps,viewProps:oe.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Pn(u,{blade:ot(),viewProps:oe.create()}),this.props=A.props,k(this.props,"selected",w=>{this.itemController.props.set("selected",w),this.contentController.viewProps.set("hidden",!w)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class nt{constructor(u,A){this.controller_=u,this.rackApi_=A}get title(){var u;return(u=this.controller_.itemController.props.get("title"))!==null&&u!==void 0?u:""}set title(u){this.controller_.itemController.props.set("title",u)}get selected(){return this.controller_.props.get("selected")}set selected(u){this.controller_.props.set("selected",u)}get children(){return this.rackApi_.children}addButton(u){return this.rackApi_.addButton(u)}addFolder(u){return this.rackApi_.addFolder(u)}addSeparator(u){return this.rackApi_.addSeparator(u)}addTab(u){return this.rackApi_.addTab(u)}add(u,A){this.rackApi_.add(u,A)}remove(u){this.rackApi_.remove(u)}addInput(u,A,w){return this.rackApi_.addInput(u,A,w)}addMonitor(u,A,w){return this.rackApi_.addMonitor(u,A,w)}addBlade(u){return this.rackApi_.addBlade(u)}}class je extends Ke{constructor(u,A){super(u,new An(u.rackController,A)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new E,this.pageApiMap_=new Map,this.rackApi_.on("change",w=>{this.emitter_.emit("change",{event:w})}),this.rackApi_.on("update",w=>{this.emitter_.emit("update",{event:w})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(w=>{this.setUpPageApi_(w)})}get pages(){return this.controller_.pageSet.items.map(u=>{const A=this.pageApiMap_.get(u);if(!A)throw b.shouldNeverHappen();return A})}addPage(u){const A=this.controller_.view.element.ownerDocument,w=new Ve(A,{itemProps:Z.fromObject({selected:!1,title:u.title}),props:Z.fromObject({selected:!1})});this.controller_.add(w,u.index);const M=this.pageApiMap_.get(w);if(!M)throw b.shouldNeverHappen();return M}removePage(u){this.controller_.remove(u)}on(u,A){const w=A.bind(this);return this.emitter_.on(u,M=>{w(M.event)}),this}setUpPageApi_(u){const A=this.rackApi_.apiSet_.find(M=>M.controller_===u.contentController);if(!A)throw b.shouldNeverHappen();const w=new nt(u,A);this.pageApiMap_.set(u,w)}onPageAdd_(u){this.setUpPageApi_(u.item)}onPageRemove_(u){if(!this.pageApiMap_.get(u.item))throw b.shouldNeverHappen();this.pageApiMap_.delete(u.item)}onSelect_(u){this.emitter_.emit("select",{event:new c(this,u.rawValue)})}}const Xe=-1;class ft{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=q(!0),this.selectedIndex=q(Xe),this.items_=[]}add(u,A){const w=A??this.items_.length;this.items_.splice(w,0,u),u.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(u){const A=this.items_.indexOf(u);A<0||(this.items_.splice(A,1),u.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Xe,this.empty.rawValue=!0;return}const u=this.items_.findIndex(A=>A.rawValue);u<0?(this.items_.forEach((A,w)=>{A.rawValue=w===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((A,w)=>{A.rawValue=w===u}),this.selectedIndex.rawValue=u),this.empty.rawValue=!1}onItemSelectedChange_(u){if(u.rawValue){const A=this.items_.findIndex(w=>w===u.sender);this.items_.forEach((w,M)=>{w.rawValue=M===A}),this.selectedIndex.rawValue=A}else this.keepSelection_()}}const St=C("tab");class Vt{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(St(),T()),A.viewProps.bindClassModifiers(this.element),I(A.empty,D(this.element,St(void 0,"nop")));const w=u.createElement("div");w.classList.add(St("t")),this.element.appendChild(w),this.itemsElement=w;const M=u.createElement("div");M.classList.add(St("i")),this.element.appendChild(M);const K=A.contentsElement;K.classList.add(St("c")),this.element.appendChild(K),this.contentsElement=K}}class hn extends Bn{constructor(u,A){const w=new Pn(u,{blade:A.blade,viewProps:A.viewProps}),M=new ft;super({blade:A.blade,rackController:w,view:new Vt(u,{contentsElement:w.view.element,empty:M.empty,viewProps:A.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new mt(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=M}get pageSet(){return this.pageSet_}add(u,A){this.pageSet_.add(u,A)}remove(u){this.pageSet_.remove(this.pageSet_.items[u])}onPageAdd_(u){const A=u.item;ge(this.view.itemsElement,A.itemController.view.element,u.index),A.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(A.contentController,u.index),this.tab.add(A.props.value("selected"))}onPageRemove_(u){const A=u.item;Je(A.itemController.view.element),A.itemController.viewProps.set("parent",null),this.rackController.rack.remove(A.contentController),this.tab.remove(A.props.value("selected"))}}const Pt={id:"tab",type:"blade",accept(g){const u=J,A=X(g,{pages:u.required.array(u.required.object({title:u.required.string})),view:u.required.constant("tab")});return!A||A.pages.length===0?null:{params:A}},controller(g){const u=new hn(g.document,{blade:g.blade,viewProps:g.viewProps});return g.params.pages.forEach(A=>{const w=new Ve(g.document,{itemProps:Z.fromObject({selected:!1,title:A.title}),props:Z.fromObject({selected:!1})});u.add(w)}),u},api(g){return g.controller instanceof hn?new je(g.controller,g.pool):null}};function bt(g,u){const A=g.accept(u.params);if(!A)return null;const w=J.optional.boolean(u.params.disabled).value,M=J.optional.boolean(u.params.hidden).value;return g.controller({blade:ot(),document:u.document,params:Object.assign(Object.assign({},A.params),{disabled:w,hidden:M}),viewProps:oe.create({disabled:w,hidden:M})})}class Yt{constructor(){this.disabled=!1,this.emitter=new E}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class kn{constructor(u,A){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=u,this.emitter=new E,this.interval_=A,this.setTimer_()}get disabled(){return this.disabled_}set disabled(u){this.disabled_=u,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const u=this.doc_.defaultView;u&&u.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const u=this.doc_.defaultView;u&&(this.timerId_=u.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class $t{constructor(u){this.onValueChange_=this.onValueChange_.bind(this),this.reader=u.reader,this.writer=u.writer,this.emitter=new E,this.value=u.value,this.value.emitter.on("change",this.onValueChange_),this.target=u.target,this.read()}read(){const u=this.target.read();u!==void 0&&(this.value.rawValue=this.reader(u))}write_(u){this.writer(this.target,u)}onValueChange_(u){this.write_(u.rawValue),this.emitter.emit("change",{options:u.options,rawValue:u.rawValue,sender:this})}}function vt(g,u){for(;g.length<u;)g.push(void 0)}function Ot(g){const u=[];return vt(u,g),q(u)}function jn(g){const u=g.indexOf(void 0);return u<0?g:g.slice(0,u)}function fi(g,u){const A=[...jn(g),u];return A.length>g.length?A.splice(0,A.length-g.length):vt(A,g.length),A}class Jn{constructor(u){this.onTick_=this.onTick_.bind(this),this.reader_=u.reader,this.target=u.target,this.emitter=new E,this.value=u.value,this.ticker=u.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const u=this.target.read();if(u===void 0)return;const A=this.value.rawValue,w=this.reader_(u);this.value.rawValue=fi(A,w),this.emitter.emit("update",{rawValue:w,sender:this})}onTick_(u){this.read()}}class Zn{constructor(u){this.constraints=u}constrain(u){return this.constraints.reduce((A,w)=>w.constrain(A),u)}}function si(g,u){if(g instanceof u)return g;if(g instanceof Zn){const A=g.constraints.reduce((w,M)=>w||(M instanceof u?M:null),null);if(A)return A}return null}class Hi{constructor(u){this.values=Z.fromObject({max:u.max,min:u.min})}constrain(u){const A=this.values.get("max"),w=this.values.get("min");return Math.min(Math.max(u,w),A)}}class xr{constructor(u){this.values=Z.fromObject({options:u})}get options(){return this.values.get("options")}constrain(u){const A=this.values.get("options");return A.length===0||A.filter(M=>M.value===u).length>0?u:A[0].value}}class gs{constructor(u){this.values=Z.fromObject({max:u.max,min:u.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(u){const A=this.values.get("max"),w=this.values.get("min");let M=u;return d(w)||(M=Math.max(M,w)),d(A)||(M=Math.min(M,A)),M}}class Ir{constructor(u,A=0){this.step=u,this.origin=A}constrain(u){const A=this.origin%this.step,w=Math.round((u-A)/this.step);return A+w*this.step}}const ar=C("lst");class ka{constructor(u,A){this.onValueChange_=this.onValueChange_.bind(this),this.props_=A.props,this.element=u.createElement("div"),this.element.classList.add(ar()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("select");w.classList.add(ar("s")),A.viewProps.bindDisabled(w),this.element.appendChild(w),this.selectElement=w;const M=u.createElement("div");M.classList.add(ar("m")),M.appendChild(Ce(u,"dropdown")),this.element.appendChild(M),A.value.emitter.on("change",this.onValueChange_),this.value_=A.value,k(this.props_,"options",K=>{de(this.selectElement),K.forEach(re=>{const De=u.createElement("option");De.textContent=re.text,this.selectElement.appendChild(De)}),this.update_()})}update_(){const u=this.props_.get("options").map(A=>A.value);this.selectElement.selectedIndex=u.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Vi{constructor(u,A){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=A.props,this.value=A.value,this.viewProps=A.viewProps,this.view=new ka(u,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(u){const A=u.currentTarget;this.value.rawValue=this.props.get("options")[A.selectedIndex].value}}const lr=C("pop");class Br{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(lr()),A.viewProps.bindClassModifiers(this.element),I(A.shows,D(this.element,lr(void 0,"v")))}}class Sr{constructor(u,A){this.shows=q(!1),this.viewProps=A.viewProps,this.view=new Br(u,{shows:this.shows,viewProps:this.viewProps})}}const ms=C("txt");class Zr{constructor(u,A){this.onChange_=this.onChange_.bind(this),this.element=u.createElement("div"),this.element.classList.add(ms()),A.viewProps.bindClassModifiers(this.element),this.props_=A.props,this.props_.emitter.on("change",this.onChange_);const w=u.createElement("input");w.classList.add(ms("i")),w.type="text",A.viewProps.bindDisabled(w),this.element.appendChild(w),this.inputElement=w,A.value.emitter.on("change",this.onChange_),this.value_=A.value,this.refresh()}refresh(){const u=this.props_.get("formatter");this.inputElement.value=u(this.value_.rawValue)}onChange_(){this.refresh()}}class kr{constructor(u,A){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=A.parser,this.props=A.props,this.value=A.value,this.viewProps=A.viewProps,this.view=new Zr(u,{props:A.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(u){const w=u.currentTarget.value,M=this.parser_(w);d(M)||(this.value.rawValue=M),this.view.refresh()}}function vs(g){return String(g)}function bs(g){return g==="false"?!1:!!g}function $r(g){return vs(g)}class ws{constructor(u){this.text=u}evaluate(){return Number(this.text)}toString(){return this.text}}const Da={"**":(g,u)=>Math.pow(g,u),"*":(g,u)=>g*u,"/":(g,u)=>g/u,"%":(g,u)=>g%u,"+":(g,u)=>g+u,"-":(g,u)=>g-u,"<<":(g,u)=>g<<u,">>":(g,u)=>g>>u,">>>":(g,u)=>g>>>u,"&":(g,u)=>g&u,"^":(g,u)=>g^u,"|":(g,u)=>g|u};class Ai{constructor(u,A,w){this.left=A,this.operator=u,this.right=w}evaluate(){const u=Da[this.operator];if(!u)throw new Error(`unexpected binary operator: '${this.operator}`);return u(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ys={"+":g=>g,"-":g=>-g,"~":g=>~g};class Ta{constructor(u,A){this.operator=u,this.expression=A}evaluate(){const u=ys[this.operator];if(!u)throw new Error(`unexpected unary operator: '${this.operator}`);return u(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function To(g){return(u,A)=>{for(let w=0;w<g.length;w++){const M=g[w](u,A);if(M!=="")return M}return""}}function cr(g,u){var A;const w=g.substr(u).match(/^\s+/);return(A=w&&w[0])!==null&&A!==void 0?A:""}function Ma(g,u){const A=g.substr(u,1);return A.match(/^[1-9]$/)?A:""}function Dr(g,u){var A;const w=g.substr(u).match(/^[0-9]+/);return(A=w&&w[0])!==null&&A!==void 0?A:""}function eo(g,u){const A=Dr(g,u);if(A!=="")return A;const w=g.substr(u,1);if(u+=1,w!=="-"&&w!=="+")return"";const M=Dr(g,u);return M===""?"":w+M}function ur(g,u){const A=g.substr(u,1);if(u+=1,A.toLowerCase()!=="e")return"";const w=eo(g,u);return w===""?"":A+w}function Pi(g,u){const A=g.substr(u,1);if(A==="0")return A;const w=Ma(g,u);return u+=w.length,w===""?"":w+Dr(g,u)}function Pa(g,u){const A=Pi(g,u);if(u+=A.length,A==="")return"";const w=g.substr(u,1);if(u+=w.length,w!==".")return"";const M=Dr(g,u);return u+=M.length,A+w+M+ur(g,u)}function _s(g,u){const A=g.substr(u,1);if(u+=A.length,A!==".")return"";const w=Dr(g,u);return u+=w.length,w===""?"":A+w+ur(g,u)}function Cs(g,u){const A=Pi(g,u);return u+=A.length,A===""?"":A+ur(g,u)}const to=To([Pa,_s,Cs]);function Qa(g,u){var A;const w=g.substr(u).match(/^[01]+/);return(A=w&&w[0])!==null&&A!==void 0?A:""}function no(g,u){const A=g.substr(u,2);if(u+=A.length,A.toLowerCase()!=="0b")return"";const w=Qa(g,u);return w===""?"":A+w}function Es(g,u){var A;const w=g.substr(u).match(/^[0-7]+/);return(A=w&&w[0])!==null&&A!==void 0?A:""}function $n(g,u){const A=g.substr(u,2);if(u+=A.length,A.toLowerCase()!=="0o")return"";const w=Es(g,u);return w===""?"":A+w}function yc(g,u){var A;const w=g.substr(u).match(/^[0-9a-f]+/i);return(A=w&&w[0])!==null&&A!==void 0?A:""}function Mo(g,u){const A=g.substr(u,2);if(u+=A.length,A.toLowerCase()!=="0x")return"";const w=yc(g,u);return w===""?"":A+w}const Po=To([no,$n,Mo]),Ra=To([Po,to]);function _c(g,u){const A=Ra(g,u);return u+=A.length,A===""?null:{evaluable:new ws(A),cursor:u}}function qn(g,u){const A=g.substr(u,1);if(u+=A.length,A!=="(")return null;const w=Ad(g,u);if(!w)return null;u=w.cursor,u+=cr(g,u).length;const M=g.substr(u,1);return u+=M.length,M!==")"?null:{evaluable:w.evaluable,cursor:u}}function pi(g,u){var A;return(A=_c(g,u))!==null&&A!==void 0?A:qn(g,u)}function Qn(g,u){const A=pi(g,u);if(A)return A;const w=g.substr(u,1);if(u+=w.length,w!=="+"&&w!=="-"&&w!=="~")return null;const M=Qn(g,u);return M?(u=M.cursor,{cursor:u,evaluable:new Ta(w,M.evaluable)}):null}function ji(g,u,A){A+=cr(u,A).length;const w=g.filter(M=>u.startsWith(M,A))[0];return w?(A+=w.length,A+=cr(u,A).length,{cursor:A,operator:w}):null}function Ua(g,u){return(A,w)=>{const M=g(A,w);if(!M)return null;w=M.cursor;let K=M.evaluable;for(;;){const re=ji(u,A,w);if(!re)break;w=re.cursor;const De=g(A,w);if(!De)return null;w=De.cursor,K=new Ai(re.operator,K,De.evaluable)}return K?{cursor:w,evaluable:K}:null}}const _m=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((g,u)=>Ua(g,u),Qn);function Ad(g,u){return u+=cr(g,u).length,_m(g,u)}function Cm(g){const u=Ad(g,0);return!u||u.cursor+cr(g,u.cursor).length!==g.length?null:u.evaluable}function hr(g){var u;const A=Cm(g);return(u=A==null?void 0:A.evaluate())!==null&&u!==void 0?u:null}function pd(g){if(typeof g=="number")return g;if(typeof g=="string"){const u=hr(g);if(!d(u))return u}return 0}function Em(g){return String(g)}function Rn(g){return u=>u.toFixed(Math.max(Math.min(g,20),0))}const xm=Rn(0);function Fa(g){return xm(g)+"%"}function gd(g){return String(g)}function Cc(g){return g}function xs({primary:g,secondary:u,forward:A,backward:w}){let M=!1;function K(re){M||(M=!0,re(),M=!1)}g.emitter.on("change",re=>{K(()=>{u.setRawValue(A(g,u),re.options)})}),u.emitter.on("change",re=>{K(()=>{g.setRawValue(w(g,u),re.options)}),K(()=>{u.setRawValue(A(g,u),re.options)})}),K(()=>{u.setRawValue(A(g,u),{forceEmit:!1,last:!0})})}function ai(g,u){const A=g*(u.altKey?.1:1)*(u.shiftKey?10:1);return u.upKey?+A:u.downKey?-A:0}function Is(g){return{altKey:g.altKey,downKey:g.key==="ArrowDown",shiftKey:g.shiftKey,upKey:g.key==="ArrowUp"}}function dr(g){return{altKey:g.altKey,downKey:g.key==="ArrowLeft",shiftKey:g.shiftKey,upKey:g.key==="ArrowRight"}}function Im(g){return g==="ArrowUp"||g==="ArrowDown"}function md(g){return Im(g)||g==="ArrowLeft"||g==="ArrowRight"}function Ec(g,u){var A,w;const M=u.ownerDocument.defaultView,K=u.getBoundingClientRect();return{x:g.pageX-(((A=M&&M.scrollX)!==null&&A!==void 0?A:0)+K.left),y:g.pageY-(((w=M&&M.scrollY)!==null&&w!==void 0?w:0)+K.top)}}class io{constructor(u){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=u,this.emitter=new E,u.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),u.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),u.addEventListener("touchend",this.onTouchEnd_),u.addEventListener("mousedown",this.onMouseDown_)}computePosition_(u){const A=this.elem_.getBoundingClientRect();return{bounds:{width:A.width,height:A.height},point:u?{x:u.x,y:u.y}:null}}onMouseDown_(u){var A;u.preventDefault(),(A=u.currentTarget)===null||A===void 0||A.focus();const w=this.elem_.ownerDocument;w.addEventListener("mousemove",this.onDocumentMouseMove_),w.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:u.altKey,data:this.computePosition_(Ec(u,this.elem_)),sender:this,shiftKey:u.shiftKey})}onDocumentMouseMove_(u){this.emitter.emit("move",{altKey:u.altKey,data:this.computePosition_(Ec(u,this.elem_)),sender:this,shiftKey:u.shiftKey})}onDocumentMouseUp_(u){const A=this.elem_.ownerDocument;A.removeEventListener("mousemove",this.onDocumentMouseMove_),A.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:u.altKey,data:this.computePosition_(Ec(u,this.elem_)),sender:this,shiftKey:u.shiftKey})}onTouchStart_(u){u.preventDefault();const A=u.targetTouches.item(0),w=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:u.altKey,data:this.computePosition_(A?{x:A.clientX-w.left,y:A.clientY-w.top}:void 0),sender:this,shiftKey:u.shiftKey}),this.lastTouch_=A}onTouchMove_(u){const A=u.targetTouches.item(0),w=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:u.altKey,data:this.computePosition_(A?{x:A.clientX-w.left,y:A.clientY-w.top}:void 0),sender:this,shiftKey:u.shiftKey}),this.lastTouch_=A}onTouchEnd_(u){var A;const w=(A=u.targetTouches.item(0))!==null&&A!==void 0?A:this.lastTouch_,M=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:u.altKey,data:this.computePosition_(w?{x:w.clientX-M.left,y:w.clientY-M.top}:void 0),sender:this,shiftKey:u.shiftKey})}}function en(g,u,A,w,M){const K=(g-u)/(A-u);return w+K*(M-w)}function vd(g){return String(g.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function _n(g,u,A){return Math.min(Math.max(g,u),A)}function bd(g,u){return(g%u+u)%u}const yi=C("txt");class Bm{constructor(u,A){this.onChange_=this.onChange_.bind(this),this.props_=A.props,this.props_.emitter.on("change",this.onChange_),this.element=u.createElement("div"),this.element.classList.add(yi(),yi(void 0,"num")),A.arrayPosition&&this.element.classList.add(yi(void 0,A.arrayPosition)),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("input");w.classList.add(yi("i")),w.type="text",A.viewProps.bindDisabled(w),this.element.appendChild(w),this.inputElement=w,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=A.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(yi()),this.inputElement.classList.add(yi("i"));const M=u.createElement("div");M.classList.add(yi("k")),this.element.appendChild(M),this.knobElement=M;const K=u.createElementNS(Be,"svg");K.classList.add(yi("g")),this.knobElement.appendChild(K);const re=u.createElementNS(Be,"path");re.classList.add(yi("gb")),K.appendChild(re),this.guideBodyElem_=re;const De=u.createElementNS(Be,"path");De.classList.add(yi("gh")),K.appendChild(De),this.guideHeadElem_=De;const ct=u.createElement("div");ct.classList.add(C("tt")()),this.knobElement.appendChild(ct),this.tooltipElem_=ct,A.value.emitter.on("change",this.onChange_),this.value=A.value,this.refresh()}onDraggingChange_(u){if(u.rawValue===null){this.element.classList.remove(yi(void 0,"drg"));return}this.element.classList.add(yi(void 0,"drg"));const A=u.rawValue/this.props_.get("draggingScale"),w=A+(A>0?-1:A<0?1:0),M=_n(-w,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${w+M},0 L${w},4 L${w+M},8`,`M ${A},-1 L${A},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${A},4`);const K=this.props_.get("formatter");this.tooltipElem_.textContent=K(this.value.rawValue),this.tooltipElem_.style.left=`${A}px`}refresh(){const u=this.props_.get("formatter");this.inputElement.value=u(this.value.rawValue)}onChange_(){this.refresh()}}class Bs{constructor(u,A){var w;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=A.baseStep,this.parser_=A.parser,this.props=A.props,this.sliderProps_=(w=A.sliderProps)!==null&&w!==void 0?w:null,this.value=A.value,this.viewProps=A.viewProps,this.dragging_=q(null),this.view=new Bm(u,{arrayPosition:A.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const M=new io(this.view.knobElement);M.emitter.on("down",this.onPointerDown_),M.emitter.on("move",this.onPointerMove_),M.emitter.on("up",this.onPointerUp_)}constrainValue_(u){var A,w;const M=(A=this.sliderProps_)===null||A===void 0?void 0:A.get("minValue"),K=(w=this.sliderProps_)===null||w===void 0?void 0:w.get("maxValue");let re=u;return M!==void 0&&(re=Math.max(re,M)),K!==void 0&&(re=Math.min(re,K)),re}onInputChange_(u){const w=u.currentTarget.value,M=this.parser_(w);d(M)||(this.value.rawValue=this.constrainValue_(M)),this.view.refresh()}onInputKeyDown_(u){const A=ai(this.baseStep_,Is(u));A!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+A),{forceEmit:!1,last:!1})}onInputKeyUp_(u){ai(this.baseStep_,Is(u))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(u){if(!u.point)return null;const A=u.point.x-u.bounds.width/2;return this.constrainValue_(this.originRawValue_+A*this.props.get("draggingScale"))}onPointerMove_(u){const A=this.computeDraggingValue_(u.data);A!==null&&(this.value.setRawValue(A,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(u){const A=this.computeDraggingValue_(u.data);A!==null&&(this.value.setRawValue(A,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const xc=C("sld");class Sm{constructor(u,A){this.onChange_=this.onChange_.bind(this),this.props_=A.props,this.props_.emitter.on("change",this.onChange_),this.element=u.createElement("div"),this.element.classList.add(xc()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("div");w.classList.add(xc("t")),A.viewProps.bindTabIndex(w),this.element.appendChild(w),this.trackElement=w;const M=u.createElement("div");M.classList.add(xc("k")),this.trackElement.appendChild(M),this.knobElement=M,A.value.emitter.on("change",this.onChange_),this.value=A.value,this.update_()}update_(){const u=_n(en(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${u}%`}onChange_(){this.update_()}}class km{constructor(u,A){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=A.baseStep,this.value=A.value,this.viewProps=A.viewProps,this.props=A.props,this.view=new Sm(u,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new io(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(u,A){u.point&&this.value.setRawValue(en(_n(u.point.x,0,u.bounds.width),0,u.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),A)}onPointerDownOrMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onKeyDown_(u){const A=ai(this.baseStep_,dr(u));A!==0&&this.value.setRawValue(this.value.rawValue+A,{forceEmit:!1,last:!1})}onKeyUp_(u){ai(this.baseStep_,dr(u))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ic=C("sldtxt");class Dm{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(Ic());const w=u.createElement("div");w.classList.add(Ic("s")),this.sliderView_=A.sliderView,w.appendChild(this.sliderView_.element),this.element.appendChild(w);const M=u.createElement("div");M.classList.add(Ic("t")),this.textView_=A.textView,M.appendChild(this.textView_.element),this.element.appendChild(M)}}class Bc{constructor(u,A){this.value=A.value,this.viewProps=A.viewProps,this.sliderC_=new km(u,{baseStep:A.baseStep,props:A.sliderProps,value:A.value,viewProps:this.viewProps}),this.textC_=new Bs(u,{baseStep:A.baseStep,parser:A.parser,props:A.textProps,sliderProps:A.sliderProps,value:A.value,viewProps:A.viewProps}),this.view=new Dm(u,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Ss(g,u){g.write(u)}function La(g){const u=J;if(Array.isArray(g))return u.required.array(u.required.object({text:u.required.string,value:u.required.raw}))(g).value;if(typeof g=="object")return u.required.raw(g).value}function wd(g){if(g==="inline"||g==="popup")return g}function Tr(g){const u=J;return u.required.object({max:u.optional.number,min:u.optional.number,step:u.optional.number})(g).value}function yd(g){if(Array.isArray(g))return g;const u=[];return Object.keys(g).forEach(A=>{u.push({text:A,value:g[A]})}),u}function Sc(g){return d(g)?null:new xr(yd(g))}function Tm(g){const u=g?si(g,Ir):null;return u?u.step:null}function Oa(g,u){const A=g&&si(g,Ir);return A?vd(A.step):Math.max(vd(u),2)}function Qo(g){const u=Tm(g);return u??1}function Ro(g,u){var A;const w=g&&si(g,Ir),M=Math.abs((A=w==null?void 0:w.step)!==null&&A!==void 0?A:u);return M===0?.1:Math.pow(10,Math.floor(Math.log10(M))-1)}const Ga=C("ckb");class Mm{constructor(u,A){this.onValueChange_=this.onValueChange_.bind(this),this.element=u.createElement("div"),this.element.classList.add(Ga()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("label");w.classList.add(Ga("l")),this.element.appendChild(w);const M=u.createElement("input");M.classList.add(Ga("i")),M.type="checkbox",w.appendChild(M),this.inputElement=M,A.viewProps.bindDisabled(this.inputElement);const K=u.createElement("div");K.classList.add(Ga("w")),w.appendChild(K);const re=Ce(u,"check");K.appendChild(re),A.value.emitter.on("change",this.onValueChange_),this.value=A.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Pm{constructor(u,A){this.onInputChange_=this.onInputChange_.bind(this),this.value=A.value,this.viewProps=A.viewProps,this.view=new Mm(u,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(u){const A=u.currentTarget;this.value.rawValue=A.checked}}function Qm(g){const u=[],A=Sc(g.options);return A&&u.push(A),new Zn(u)}const Rm={id:"input-bool",type:"input",accept:(g,u)=>{if(typeof g!="boolean")return null;const w=X(u,{options:J.optional.custom(La)});return w?{initialValue:g,params:w}:null},binding:{reader:g=>bs,constraint:g=>Qm(g.params),writer:g=>Ss},controller:g=>{const u=g.document,A=g.value,w=g.constraint,M=w&&si(w,xr);return M?new Vi(u,{props:new Z({options:M.values.value("options")}),value:A,viewProps:g.viewProps}):new Pm(u,{value:A,viewProps:g.viewProps})}},ro=C("col");class Um{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(ro()),A.foldable.bindExpandedClass(this.element,ro(void 0,"expanded")),k(A.foldable,"completed",D(this.element,ro(void 0,"cpl")));const w=u.createElement("div");w.classList.add(ro("h")),this.element.appendChild(w);const M=u.createElement("div");M.classList.add(ro("s")),w.appendChild(M),this.swatchElement=M;const K=u.createElement("div");if(K.classList.add(ro("t")),w.appendChild(K),this.textElement=K,A.pickerLayout==="inline"){const re=u.createElement("div");re.classList.add(ro("p")),this.element.appendChild(re),this.pickerElement=re}else this.pickerElement=null}}function Fm(g,u,A){const w=_n(g/255,0,1),M=_n(u/255,0,1),K=_n(A/255,0,1),re=Math.max(w,M,K),De=Math.min(w,M,K),ct=re-De;let At=0,Qt=0;const Ut=(De+re)/2;return ct!==0&&(Qt=ct/(1-Math.abs(re+De-1)),w===re?At=(M-K)/ct:M===re?At=2+(K-w)/ct:At=4+(w-M)/ct,At=At/6+(At<0?1:0)),[At*360,Qt*100,Ut*100]}function Lm(g,u,A){const w=(g%360+360)%360,M=_n(u/100,0,1),K=_n(A/100,0,1),re=(1-Math.abs(2*K-1))*M,De=re*(1-Math.abs(w/60%2-1)),ct=K-re/2;let At,Qt,Ut;return w>=0&&w<60?[At,Qt,Ut]=[re,De,0]:w>=60&&w<120?[At,Qt,Ut]=[De,re,0]:w>=120&&w<180?[At,Qt,Ut]=[0,re,De]:w>=180&&w<240?[At,Qt,Ut]=[0,De,re]:w>=240&&w<300?[At,Qt,Ut]=[De,0,re]:[At,Qt,Ut]=[re,0,De],[(At+ct)*255,(Qt+ct)*255,(Ut+ct)*255]}function Om(g,u,A){const w=_n(g/255,0,1),M=_n(u/255,0,1),K=_n(A/255,0,1),re=Math.max(w,M,K),De=Math.min(w,M,K),ct=re-De;let At;ct===0?At=0:re===w?At=60*(((M-K)/ct%6+6)%6):re===M?At=60*((K-w)/ct+2):At=60*((w-M)/ct+4);const Qt=re===0?0:ct/re,Ut=re;return[At,Qt*100,Ut*100]}function _d(g,u,A){const w=bd(g,360),M=_n(u/100,0,1),K=_n(A/100,0,1),re=K*M,De=re*(1-Math.abs(w/60%2-1)),ct=K-re;let At,Qt,Ut;return w>=0&&w<60?[At,Qt,Ut]=[re,De,0]:w>=60&&w<120?[At,Qt,Ut]=[De,re,0]:w>=120&&w<180?[At,Qt,Ut]=[0,re,De]:w>=180&&w<240?[At,Qt,Ut]=[0,De,re]:w>=240&&w<300?[At,Qt,Ut]=[De,0,re]:[At,Qt,Ut]=[re,0,De],[(At+ct)*255,(Qt+ct)*255,(Ut+ct)*255]}function Gm(g,u,A){const w=A+u*(100-Math.abs(2*A-100))/200;return[g,w!==0?u*(100-Math.abs(2*A-100))/w:0,A+u*(100-Math.abs(2*A-100))/(2*100)]}function Nm(g,u,A){const w=100-Math.abs(A*(200-u)/100-100);return[g,w!==0?u*A/w:0,A*(200-u)/(2*100)]}function oo(g){return[g[0],g[1],g[2]]}function Cd(g,u){return[g[0],g[1],g[2],u]}const zm={hsl:{hsl:(g,u,A)=>[g,u,A],hsv:Gm,rgb:Lm},hsv:{hsl:Nm,hsv:(g,u,A)=>[g,u,A],rgb:_d},rgb:{hsl:Fm,hsv:Om,rgb:(g,u,A)=>[g,u,A]}};function Na(g,u){return[u==="float"?1:g==="rgb"?255:360,u==="float"?1:g==="rgb"?255:100,u==="float"?1:g==="rgb"?255:100]}function Hm(g,u){return g===u?u:bd(g,u)}function Vm(g,u,A){var w;const M=Na(u,A);return[u==="rgb"?_n(g[0],0,M[0]):Hm(g[0],M[0]),_n(g[1],0,M[1]),_n(g[2],0,M[2]),_n((w=g[3])!==null&&w!==void 0?w:1,0,1)]}function Ed(g,u,A,w){const M=Na(u,A),K=Na(u,w);return g.map((re,De)=>re/M[De]*K[De])}function jm(g,u,A){const w=Ed(g,u.mode,u.type,"int"),M=zm[u.mode][A.mode](...w);return Ed(M,A.mode,"int",A.type)}function za(g,u){return typeof g!="object"||d(g)?!1:u in g&&typeof g[u]=="number"}class kt{static black(u="int"){return new kt([0,0,0],"rgb",u)}static fromObject(u,A="int"){const w="a"in u?[u.r,u.g,u.b,u.a]:[u.r,u.g,u.b];return new kt(w,"rgb",A)}static toRgbaObject(u,A="int"){return u.toRgbaObject(A)}static isRgbColorObject(u){return za(u,"r")&&za(u,"g")&&za(u,"b")}static isRgbaColorObject(u){return this.isRgbColorObject(u)&&za(u,"a")}static isColorObject(u){return this.isRgbColorObject(u)}static equals(u,A){if(u.mode!==A.mode)return!1;const w=u.comps_,M=A.comps_;for(let K=0;K<w.length;K++)if(w[K]!==M[K])return!1;return!0}constructor(u,A,w="int"){this.mode=A,this.type=w,this.comps_=Vm(u,A,w)}getComponents(u,A="int"){return Cd(jm(oo(this.comps_),{mode:this.mode,type:this.type},{mode:u??this.mode,type:A}),this.comps_[3])}toRgbaObject(u="int"){const A=this.getComponents("rgb",u);return{r:A[0],g:A[1],b:A[2],a:A[3]}}}const Mr=C("colp");class qm{constructor(u,A){this.alphaViews_=null,this.element=u.createElement("div"),this.element.classList.add(Mr()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("div");w.classList.add(Mr("hsv"));const M=u.createElement("div");M.classList.add(Mr("sv")),this.svPaletteView_=A.svPaletteView,M.appendChild(this.svPaletteView_.element),w.appendChild(M);const K=u.createElement("div");K.classList.add(Mr("h")),this.hPaletteView_=A.hPaletteView,K.appendChild(this.hPaletteView_.element),w.appendChild(K),this.element.appendChild(w);const re=u.createElement("div");if(re.classList.add(Mr("rgb")),this.textView_=A.textView,re.appendChild(this.textView_.element),this.element.appendChild(re),A.alphaViews){this.alphaViews_={palette:A.alphaViews.palette,text:A.alphaViews.text};const De=u.createElement("div");De.classList.add(Mr("a"));const ct=u.createElement("div");ct.classList.add(Mr("ap")),ct.appendChild(this.alphaViews_.palette.element),De.appendChild(ct);const At=u.createElement("div");At.classList.add(Mr("at")),At.appendChild(this.alphaViews_.text.element),De.appendChild(At),this.element.appendChild(De)}}get allFocusableElements(){const u=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(A=>A.inputElement)];return this.alphaViews_&&u.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),u}}function Wm(g){return g==="int"?"int":g==="float"?"float":void 0}function kc(g){const u=J;return X(g,{alpha:u.optional.boolean,color:u.optional.object({alpha:u.optional.boolean,type:u.optional.custom(Wm)}),expanded:u.optional.boolean,picker:u.optional.custom(wd)})}function so(g){return g?.1:1}function ao(g){var u;return(u=g.color)===null||u===void 0?void 0:u.type}function Km(g,u){return g.alpha===u.alpha&&g.mode===u.mode&&g.notation===u.notation&&g.type===u.type}function _i(g,u){const A=g.match(/^(.+)%$/);return Math.min(A?parseFloat(A[1])*.01*u:parseFloat(g),u)}const Ym={deg:g=>g,grad:g=>g*360/400,rad:g=>g*360/(2*Math.PI),turn:g=>g*360};function xd(g){const u=g.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!u)return parseFloat(g);const A=parseFloat(u[1]),w=u[2];return Ym[w](A)}function Id(g){const u=g.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!u)return null;const A=[_i(u[1],255),_i(u[2],255),_i(u[3],255)];return isNaN(A[0])||isNaN(A[1])||isNaN(A[2])?null:A}function Bd(g){return u=>{const A=Id(u);return A?new kt(A,"rgb",g):null}}function Sd(g){const u=g.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!u)return null;const A=[_i(u[1],255),_i(u[2],255),_i(u[3],255),_i(u[4],1)];return isNaN(A[0])||isNaN(A[1])||isNaN(A[2])||isNaN(A[3])?null:A}function kd(g){return u=>{const A=Sd(u);return A?new kt(A,"rgb",g):null}}function Dd(g){const u=g.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!u)return null;const A=[xd(u[1]),_i(u[2],100),_i(u[3],100)];return isNaN(A[0])||isNaN(A[1])||isNaN(A[2])?null:A}function Td(g){return u=>{const A=Dd(u);return A?new kt(A,"hsl",g):null}}function Md(g){const u=g.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!u)return null;const A=[xd(u[1]),_i(u[2],100),_i(u[3],100),_i(u[4],1)];return isNaN(A[0])||isNaN(A[1])||isNaN(A[2])||isNaN(A[3])?null:A}function Pd(g){return u=>{const A=Md(u);return A?new kt(A,"hsl",g):null}}function Qd(g){const u=g.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(u)return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)];const A=g.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return A?[parseInt(A[1],16),parseInt(A[2],16),parseInt(A[3],16)]:null}function Xm(g){const u=Qd(g);return u?new kt(u,"rgb","int"):null}function Rd(g){const u=g.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(u)return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16),en(parseInt(u[4]+u[4],16),0,255,0,1)];const A=g.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return A?[parseInt(A[1],16),parseInt(A[2],16),parseInt(A[3],16),en(parseInt(A[4],16),0,255,0,1)]:null}function Jm(g){const u=Rd(g);return u?new kt(u,"rgb","int"):null}function Ud(g){const u=g.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!u)return null;const A=[parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])];return isNaN(A[0])||isNaN(A[1])||isNaN(A[2])?null:A}function Fd(g){return u=>{const A=Ud(u);return A?new kt(A,"rgb",g):null}}function Ld(g){const u=g.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!u)return null;const A=[parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]),parseFloat(u[4])];return isNaN(A[0])||isNaN(A[1])||isNaN(A[2])||isNaN(A[3])?null:A}function Od(g){return u=>{const A=Ld(u);return A?new kt(A,"rgb",g):null}}const Zm=[{parser:Qd,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Rd,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Id,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Sd,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Dd,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Md,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Ud,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Ld,result:{alpha:!0,mode:"rgb",notation:"object"}}];function $m(g){return Zm.reduce((u,{parser:A,result:w})=>u||(A(g)?w:null),null)}function Dc(g,u="int"){const A=$m(g);return A?A.notation==="hex"&&u!=="float"?Object.assign(Object.assign({},A),{type:"int"}):A.notation==="func"?Object.assign(Object.assign({},A),{type:u}):null:null}const Gd={int:[Xm,Jm,Bd("int"),kd("int"),Td("int"),Pd("int"),Fd("int"),Od("int")],float:[Bd("float"),kd("float"),Td("float"),Pd("float"),Fd("float"),Od("float")]};function ev(g){const u=Gd[g];return A=>{if(typeof A!="string")return kt.black(g);const w=u.reduce((M,K)=>M||K(A),null);return w??kt.black(g)}}function Tc(g){const u=Gd[g];return A=>u.reduce((w,M)=>w||M(A),null)}function Nd(g){const u=_n(Math.floor(g),0,255).toString(16);return u.length===1?`0${u}`:u}function zd(g,u="#"){const A=oo(g.getComponents("rgb")).map(Nd).join("");return`${u}${A}`}function Mc(g,u="#"){const A=g.getComponents("rgb"),w=[A[0],A[1],A[2],A[3]*255].map(Nd).join("");return`${u}${w}`}function Hd(g,u){const A=Rn(u==="float"?2:0);return`rgb(${oo(g.getComponents("rgb",u)).map(M=>A(M)).join(", ")})`}function tv(g){return u=>Hd(u,g)}function Ha(g,u){const A=Rn(2),w=Rn(u==="float"?2:0);return`rgba(${g.getComponents("rgb",u).map((K,re)=>(re===3?A:w)(K)).join(", ")})`}function nv(g){return u=>Ha(u,g)}function iv(g){const u=[Rn(0),Fa,Fa];return`hsl(${oo(g.getComponents("hsl")).map((w,M)=>u[M](w)).join(", ")})`}function rv(g){const u=[Rn(0),Fa,Fa,Rn(2)];return`hsla(${g.getComponents("hsl").map((w,M)=>u[M](w)).join(", ")})`}function Vd(g,u){const A=Rn(u==="float"?2:0),w=["r","g","b"];return`{${oo(g.getComponents("rgb",u)).map((K,re)=>`${w[re]}: ${A(K)}`).join(", ")}}`}function ov(g){return u=>Vd(u,g)}function jd(g,u){const A=Rn(2),w=Rn(u==="float"?2:0),M=["r","g","b","a"];return`{${g.getComponents("rgb",u).map((re,De)=>{const ct=De===3?A:w;return`${M[De]}: ${ct(re)}`}).join(", ")}}`}function sv(g){return u=>jd(u,g)}const av=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:zd},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Mc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:iv},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:rv},...["int","float"].reduce((g,u)=>[...g,{format:{alpha:!1,mode:"rgb",notation:"func",type:u},stringifier:tv(u)},{format:{alpha:!0,mode:"rgb",notation:"func",type:u},stringifier:nv(u)},{format:{alpha:!1,mode:"rgb",notation:"object",type:u},stringifier:ov(u)},{format:{alpha:!0,mode:"rgb",notation:"object",type:u},stringifier:sv(u)}],[])];function Pc(g){return av.reduce((u,A)=>u||(Km(A.format,g)?A.stringifier:null),null)}const ks=C("apl");class lv{constructor(u,A){this.onValueChange_=this.onValueChange_.bind(this),this.value=A.value,this.value.emitter.on("change",this.onValueChange_),this.element=u.createElement("div"),this.element.classList.add(ks()),A.viewProps.bindClassModifiers(this.element),A.viewProps.bindTabIndex(this.element);const w=u.createElement("div");w.classList.add(ks("b")),this.element.appendChild(w);const M=u.createElement("div");M.classList.add(ks("c")),w.appendChild(M),this.colorElem_=M;const K=u.createElement("div");K.classList.add(ks("m")),this.element.appendChild(K),this.markerElem_=K;const re=u.createElement("div");re.classList.add(ks("p")),this.markerElem_.appendChild(re),this.previewElem_=re,this.update_()}update_(){const u=this.value.rawValue,A=u.getComponents("rgb"),w=new kt([A[0],A[1],A[2],0],"rgb"),M=new kt([A[0],A[1],A[2],255],"rgb"),K=["to right",Ha(w),Ha(M)];this.colorElem_.style.background=`linear-gradient(${K.join(",")})`,this.previewElem_.style.backgroundColor=Ha(u);const re=en(A[3],0,1,0,100);this.markerElem_.style.left=`${re}%`}onValueChange_(){this.update_()}}class cv{constructor(u,A){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=A.value,this.viewProps=A.viewProps,this.view=new lv(u,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new io(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(u,A){if(!u.point)return;const w=u.point.x/u.bounds.width,M=this.value.rawValue,[K,re,De]=M.getComponents("hsv");this.value.setRawValue(new kt([K,re,De,w],"hsv"),A)}onPointerDown_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onKeyDown_(u){const A=ai(so(!0),dr(u));if(A===0)return;const w=this.value.rawValue,[M,K,re,De]=w.getComponents("hsv");this.value.setRawValue(new kt([M,K,re,De+A],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(u){ai(so(!0),dr(u))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Uo=C("coltxt");function uv(g){const u=g.createElement("select"),A=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return u.appendChild(A.reduce((w,M)=>{const K=g.createElement("option");return K.textContent=M.text,K.value=M.value,w.appendChild(K),w},g.createDocumentFragment())),u}class hv{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(Uo()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("div");w.classList.add(Uo("m")),this.modeElem_=uv(u),this.modeElem_.classList.add(Uo("ms")),w.appendChild(this.modeSelectElement),A.viewProps.bindDisabled(this.modeElem_);const M=u.createElement("div");M.classList.add(Uo("mm")),M.appendChild(Ce(u,"dropdown")),w.appendChild(M),this.element.appendChild(w);const K=u.createElement("div");K.classList.add(Uo("w")),this.element.appendChild(K),this.textsElem_=K,this.textViews_=A.textViews,this.applyTextViews_(),I(A.colorMode,re=>{this.modeElem_.value=re})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(u){this.textViews_=u,this.applyTextViews_()}applyTextViews_(){de(this.textsElem_);const u=this.element.ownerDocument;this.textViews_.forEach(A=>{const w=u.createElement("div");w.classList.add(Uo("c")),w.appendChild(A.element),this.textsElem_.appendChild(w)})}}function dv(g){return Rn(g==="float"?2:0)}function fv(g,u,A){const w=Na(g,u)[A];return new Hi({min:0,max:w})}function Qc(g,u,A){return new Bs(g,{arrayPosition:A===0?"fst":A===2?"lst":"mid",baseStep:so(!1),parser:u.parser,props:Z.fromObject({draggingScale:u.colorType==="float"?.01:1,formatter:dv(u.colorType)}),value:q(0,{constraint:fv(u.colorMode,u.colorType,A)}),viewProps:u.viewProps})}class Av{constructor(u,A){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=A.colorType,this.parser_=A.parser,this.value=A.value,this.viewProps=A.viewProps,this.colorMode=q(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(u),this.view=new hv(u,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(u){const A={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},w=[Qc(u,A,0),Qc(u,A,1),Qc(u,A,2)];return w.forEach((M,K)=>{xs({primary:this.value,secondary:M.value,forward:re=>re.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[K],backward:(re,De)=>{const ct=this.colorMode.rawValue,At=re.rawValue.getComponents(ct,this.colorType_);return At[K]=De.rawValue,new kt(Cd(oo(At),At[3]),ct,this.colorType_)}})}),w}onModeSelectChange_(u){const A=u.currentTarget;this.colorMode.rawValue=A.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Rc=C("hpl");class pv{constructor(u,A){this.onValueChange_=this.onValueChange_.bind(this),this.value=A.value,this.value.emitter.on("change",this.onValueChange_),this.element=u.createElement("div"),this.element.classList.add(Rc()),A.viewProps.bindClassModifiers(this.element),A.viewProps.bindTabIndex(this.element);const w=u.createElement("div");w.classList.add(Rc("c")),this.element.appendChild(w);const M=u.createElement("div");M.classList.add(Rc("m")),this.element.appendChild(M),this.markerElem_=M,this.update_()}update_(){const u=this.value.rawValue,[A]=u.getComponents("hsv");this.markerElem_.style.backgroundColor=Hd(new kt([A,100,100],"hsv"));const w=en(A,0,360,0,100);this.markerElem_.style.left=`${w}%`}onValueChange_(){this.update_()}}class gv{constructor(u,A){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=A.value,this.viewProps=A.viewProps,this.view=new pv(u,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new io(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(u,A){if(!u.point)return;const w=en(_n(u.point.x,0,u.bounds.width),0,u.bounds.width,0,360),M=this.value.rawValue,[,K,re,De]=M.getComponents("hsv");this.value.setRawValue(new kt([w,K,re,De],"hsv"),A)}onPointerDown_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onKeyDown_(u){const A=ai(so(!1),dr(u));if(A===0)return;const w=this.value.rawValue,[M,K,re,De]=w.getComponents("hsv");this.value.setRawValue(new kt([M+A,K,re,De],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(u){ai(so(!1),dr(u))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Uc=C("svp"),qd=64;class mv{constructor(u,A){this.onValueChange_=this.onValueChange_.bind(this),this.value=A.value,this.value.emitter.on("change",this.onValueChange_),this.element=u.createElement("div"),this.element.classList.add(Uc()),A.viewProps.bindClassModifiers(this.element),A.viewProps.bindTabIndex(this.element);const w=u.createElement("canvas");w.height=qd,w.width=qd,w.classList.add(Uc("c")),this.element.appendChild(w),this.canvasElement=w;const M=u.createElement("div");M.classList.add(Uc("m")),this.element.appendChild(M),this.markerElem_=M,this.update_()}update_(){const u=Ee(this.canvasElement);if(!u)return;const w=this.value.rawValue.getComponents("hsv"),M=this.canvasElement.width,K=this.canvasElement.height,re=u.getImageData(0,0,M,K),De=re.data;for(let Qt=0;Qt<K;Qt++)for(let Ut=0;Ut<M;Ut++){const lo=en(Ut,0,M,0,100),Ts=en(Qt,0,K,100,0),Ms=_d(w[0],lo,Ts),Va=(Qt*M+Ut)*4;De[Va]=Ms[0],De[Va+1]=Ms[1],De[Va+2]=Ms[2],De[Va+3]=255}u.putImageData(re,0,0);const ct=en(w[1],0,100,0,100);this.markerElem_.style.left=`${ct}%`;const At=en(w[2],0,100,100,0);this.markerElem_.style.top=`${At}%`}onValueChange_(){this.update_()}}class vv{constructor(u,A){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=A.value,this.viewProps=A.viewProps,this.view=new mv(u,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new io(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(u,A){if(!u.point)return;const w=en(u.point.x,0,u.bounds.width,0,100),M=en(u.point.y,0,u.bounds.height,100,0),[K,,,re]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new kt([K,w,M,re],"hsv"),A)}onPointerDown_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onKeyDown_(u){md(u.key)&&u.preventDefault();const[A,w,M,K]=this.value.rawValue.getComponents("hsv"),re=so(!1),De=ai(re,dr(u)),ct=ai(re,Is(u));De===0&&ct===0||this.value.setRawValue(new kt([A,w+De,M+ct,K],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(u){const A=so(!1),w=ai(A,dr(u)),M=ai(A,Is(u));w===0&&M===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class bv{constructor(u,A){this.value=A.value,this.viewProps=A.viewProps,this.hPaletteC_=new gv(u,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new vv(u,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=A.supportsAlpha?{palette:new cv(u,{value:this.value,viewProps:this.viewProps}),text:new Bs(u,{parser:hr,baseStep:.1,props:Z.fromObject({draggingScale:.01,formatter:Rn(2)}),value:q(0,{constraint:new Hi({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&xs({primary:this.value,secondary:this.alphaIcs_.text.value,forward:w=>w.rawValue.getComponents()[3],backward:(w,M)=>{const K=w.rawValue.getComponents();return K[3]=M.rawValue,new kt(K,w.rawValue.mode)}}),this.textC_=new Av(u,{colorType:A.colorType,parser:hr,value:this.value,viewProps:this.viewProps}),this.view=new qm(u,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:A.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Fc=C("colsw");class wv{constructor(u,A){this.onValueChange_=this.onValueChange_.bind(this),A.value.emitter.on("change",this.onValueChange_),this.value=A.value,this.element=u.createElement("div"),this.element.classList.add(Fc()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("div");w.classList.add(Fc("sw")),this.element.appendChild(w),this.swatchElem_=w;const M=u.createElement("button");M.classList.add(Fc("b")),A.viewProps.bindDisabled(M),this.element.appendChild(M),this.buttonElement=M,this.update_()}update_(){const u=this.value.rawValue;this.swatchElem_.style.backgroundColor=Mc(u)}onValueChange_(){this.update_()}}class yv{constructor(u,A){this.value=A.value,this.viewProps=A.viewProps,this.view=new wv(u,{value:this.value,viewProps:this.viewProps})}}class Lc{constructor(u,A){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=A.value,this.viewProps=A.viewProps,this.foldable_=$e.create(A.expanded),this.swatchC_=new yv(u,{value:this.value,viewProps:this.viewProps});const w=this.swatchC_.view.buttonElement;w.addEventListener("blur",this.onButtonBlur_),w.addEventListener("click",this.onButtonClick_),this.textC_=new kr(u,{parser:A.parser,props:Z.fromObject({formatter:A.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Um(u,{foldable:this.foldable_,pickerLayout:A.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=A.pickerLayout==="popup"?new Sr(u,{viewProps:this.viewProps}):null;const M=new bv(u,{colorType:A.colorType,supportsAlpha:A.supportsAlpha,value:this.value,viewProps:this.viewProps});M.view.allFocusableElements.forEach(K=>{K.addEventListener("blur",this.onPopupChildBlur_),K.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=M,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(M.view.element),xs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:K=>K.rawValue,backward:(K,re)=>re.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ce(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(u){if(!this.popC_)return;const A=this.view.element,w=u.relatedTarget;(!w||!A.contains(w))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(u){if(!this.popC_)return;const A=this.popC_.view.element,w=Ie(u);w&&A.contains(w)||w&&w===this.swatchC_.view.buttonElement&&!He(A.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(u){this.popC_?u.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&u.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function _v(g,u){return kt.isColorObject(g)?kt.fromObject(g,u):kt.black(u)}function Cv(g){return oo(g.getComponents("rgb")).reduce((u,A)=>u<<8|Math.floor(A)&255,0)}function Ev(g){return g.getComponents("rgb").reduce((u,A,w)=>{const M=Math.floor(w===3?A*255:A)&255;return u<<8|M},0)>>>0}function xv(g){return new kt([g>>16&255,g>>8&255,g&255],"rgb")}function Iv(g){return new kt([g>>24&255,g>>16&255,g>>8&255,en(g&255,0,255,0,1)],"rgb")}function Bv(g){return typeof g!="number"?kt.black():xv(g)}function Sv(g){return typeof g!="number"?kt.black():Iv(g)}function kv(g){const u=Pc(g);return u?(A,w)=>{Ss(A,u(w))}:null}function Dv(g){const u=g?Ev:Cv;return(A,w)=>{Ss(A,u(w))}}function Tv(g,u,A){const w=u.toRgbaObject(A);g.writeProperty("r",w.r),g.writeProperty("g",w.g),g.writeProperty("b",w.b),g.writeProperty("a",w.a)}function Mv(g,u,A){const w=u.toRgbaObject(A);g.writeProperty("r",w.r),g.writeProperty("g",w.g),g.writeProperty("b",w.b)}function Pv(g,u){return(A,w)=>{g?Tv(A,w,u):Mv(A,w,u)}}function Oc(g){var u;return!!(g!=null&&g.alpha||!((u=g==null?void 0:g.color)===null||u===void 0)&&u.alpha)}function Qv(g){return g?u=>Mc(u,"0x"):u=>zd(u,"0x")}function Rv(g){return"color"in g||"view"in g&&g.view==="color"}const Uv={id:"input-color-number",type:"input",accept:(g,u)=>{if(typeof g!="number"||!Rv(u))return null;const A=kc(u);return A?{initialValue:g,params:A}:null},binding:{reader:g=>Oc(g.params)?Sv:Bv,equals:kt.equals,writer:g=>Dv(Oc(g.params))},controller:g=>{const u=Oc(g.params),A="expanded"in g.params?g.params.expanded:void 0,w="picker"in g.params?g.params.picker:void 0;return new Lc(g.document,{colorType:"int",expanded:A??!1,formatter:Qv(u),parser:Tc("int"),pickerLayout:w??"popup",supportsAlpha:u,value:g.value,viewProps:g.viewProps})}};function Fv(g){return kt.isRgbaColorObject(g)}function Lv(g){return u=>_v(u,g)}function Ov(g,u){return A=>g?jd(A,u):Vd(A,u)}const Gv={id:"input-color-object",type:"input",accept:(g,u)=>{if(!kt.isColorObject(g))return null;const A=kc(u);return A?{initialValue:g,params:A}:null},binding:{reader:g=>Lv(ao(g.params)),equals:kt.equals,writer:g=>Pv(Fv(g.initialValue),ao(g.params))},controller:g=>{var u;const A=kt.isRgbaColorObject(g.initialValue),w="expanded"in g.params?g.params.expanded:void 0,M="picker"in g.params?g.params.picker:void 0,K=(u=ao(g.params))!==null&&u!==void 0?u:"int";return new Lc(g.document,{colorType:K,expanded:w??!1,formatter:Ov(A,K),parser:Tc(K),pickerLayout:M??"popup",supportsAlpha:A,value:g.value,viewProps:g.viewProps})}},Nv={id:"input-color-string",type:"input",accept:(g,u)=>{if(typeof g!="string"||"view"in u&&u.view==="text")return null;const A=Dc(g,ao(u));if(!A||!Pc(A))return null;const M=kc(u);return M?{initialValue:g,params:M}:null},binding:{reader:g=>{var u;return ev((u=ao(g.params))!==null&&u!==void 0?u:"int")},equals:kt.equals,writer:g=>{const u=Dc(g.initialValue,ao(g.params));if(!u)throw b.shouldNeverHappen();const A=kv(u);if(!A)throw b.notBindable();return A}},controller:g=>{const u=Dc(g.initialValue,ao(g.params));if(!u)throw b.shouldNeverHappen();const A=Pc(u);if(!A)throw b.shouldNeverHappen();const w="expanded"in g.params?g.params.expanded:void 0,M="picker"in g.params?g.params.picker:void 0;return new Lc(g.document,{colorType:u.type,expanded:w??!1,formatter:A,parser:Tc(u.type),pickerLayout:M??"popup",supportsAlpha:u.alpha,value:g.value,viewProps:g.viewProps})}};class Pr{constructor(u){this.components=u.components,this.asm_=u.assembly}constrain(u){const A=this.asm_.toComponents(u).map((w,M)=>{var K,re;return(re=(K=this.components[M])===null||K===void 0?void 0:K.constrain(w))!==null&&re!==void 0?re:w});return this.asm_.fromComponents(A)}}const Wd=C("pndtxt");class zv{constructor(u,A){this.textViews=A.textViews,this.element=u.createElement("div"),this.element.classList.add(Wd()),this.textViews.forEach(w=>{const M=u.createElement("div");M.classList.add(Wd("a")),M.appendChild(w.element),this.element.appendChild(M)})}}function Hv(g,u,A){return new Bs(g,{arrayPosition:A===0?"fst":A===u.axes.length-1?"lst":"mid",baseStep:u.axes[A].baseStep,parser:u.parser,props:u.axes[A].textProps,value:q(0,{constraint:u.axes[A].constraint}),viewProps:u.viewProps})}class Gc{constructor(u,A){this.value=A.value,this.viewProps=A.viewProps,this.acs_=A.axes.map((w,M)=>Hv(u,A,M)),this.acs_.forEach((w,M)=>{xs({primary:this.value,secondary:w.value,forward:K=>A.assembly.toComponents(K.rawValue)[M],backward:(K,re)=>{const De=A.assembly.toComponents(K.rawValue);return De[M]=re.rawValue,A.assembly.fromComponents(De)}})}),this.view=new zv(u,{textViews:this.acs_.map(w=>w.view)})}}function Kd(g,u){return"step"in g&&!d(g.step)?new Ir(g.step,u):null}function Yd(g){return!d(g.max)&&!d(g.min)?new Hi({max:g.max,min:g.min}):!d(g.max)||!d(g.min)?new gs({max:g.max,min:g.min}):null}function Vv(g){const u=si(g,Hi);if(u)return[u.values.get("min"),u.values.get("max")];const A=si(g,gs);return A?[A.minValue,A.maxValue]:[void 0,void 0]}function jv(g,u){const A=[],w=Kd(g,u);w&&A.push(w);const M=Yd(g);M&&A.push(M);const K=Sc(g.options);return K&&A.push(K),new Zn(A)}const qv={id:"input-number",type:"input",accept:(g,u)=>{if(typeof g!="number")return null;const A=J,w=X(u,{format:A.optional.function,max:A.optional.number,min:A.optional.number,options:A.optional.custom(La),step:A.optional.number});return w?{initialValue:g,params:w}:null},binding:{reader:g=>pd,constraint:g=>jv(g.params,g.initialValue),writer:g=>Ss},controller:g=>{var u;const A=g.value,w=g.constraint,M=w&&si(w,xr);if(M)return new Vi(g.document,{props:new Z({options:M.values.value("options")}),value:A,viewProps:g.viewProps});const K=(u="format"in g.params?g.params.format:void 0)!==null&&u!==void 0?u:Rn(Oa(w,A.rawValue)),re=w&&si(w,Hi);return re?new Bc(g.document,{baseStep:Qo(w),parser:hr,sliderProps:new Z({maxValue:re.values.value("max"),minValue:re.values.value("min")}),textProps:Z.fromObject({draggingScale:Ro(w,A.rawValue),formatter:K}),value:A,viewProps:g.viewProps}):new Bs(g.document,{baseStep:Qo(w),parser:hr,props:Z.fromObject({draggingScale:Ro(w,A.rawValue),formatter:K}),value:A,viewProps:g.viewProps})}};class Qr{constructor(u=0,A=0){this.x=u,this.y=A}getComponents(){return[this.x,this.y]}static isObject(u){if(d(u))return!1;const A=u.x,w=u.y;return!(typeof A!="number"||typeof w!="number")}static equals(u,A){return u.x===A.x&&u.y===A.y}toObject(){return{x:this.x,y:this.y}}}const Xd={toComponents:g=>g.getComponents(),fromComponents:g=>new Qr(...g)},Fo=C("p2d");class Wv{constructor(u,A){this.element=u.createElement("div"),this.element.classList.add(Fo()),A.viewProps.bindClassModifiers(this.element),I(A.expanded,D(this.element,Fo(void 0,"expanded")));const w=u.createElement("div");w.classList.add(Fo("h")),this.element.appendChild(w);const M=u.createElement("button");M.classList.add(Fo("b")),M.appendChild(Ce(u,"p2dpad")),A.viewProps.bindDisabled(M),w.appendChild(M),this.buttonElement=M;const K=u.createElement("div");if(K.classList.add(Fo("t")),w.appendChild(K),this.textElement=K,A.pickerLayout==="inline"){const re=u.createElement("div");re.classList.add(Fo("p")),this.element.appendChild(re),this.pickerElement=re}else this.pickerElement=null}}const Rr=C("p2dp");class Kv{constructor(u,A){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=A.invertsY,this.maxValue_=A.maxValue,this.element=u.createElement("div"),this.element.classList.add(Rr()),A.layout==="popup"&&this.element.classList.add(Rr(void 0,"p")),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("div");w.classList.add(Rr("p")),A.viewProps.bindTabIndex(w),this.element.appendChild(w),this.padElement=w;const M=u.createElementNS(Be,"svg");M.classList.add(Rr("g")),this.padElement.appendChild(M),this.svgElem_=M;const K=u.createElementNS(Be,"line");K.classList.add(Rr("ax")),K.setAttributeNS(null,"x1","0"),K.setAttributeNS(null,"y1","50%"),K.setAttributeNS(null,"x2","100%"),K.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(K);const re=u.createElementNS(Be,"line");re.classList.add(Rr("ax")),re.setAttributeNS(null,"x1","50%"),re.setAttributeNS(null,"y1","0"),re.setAttributeNS(null,"x2","50%"),re.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(re);const De=u.createElementNS(Be,"line");De.classList.add(Rr("l")),De.setAttributeNS(null,"x1","50%"),De.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(De),this.lineElem_=De;const ct=u.createElement("div");ct.classList.add(Rr("m")),this.padElement.appendChild(ct),this.markerElem_=ct,A.value.emitter.on("change",this.onValueChange_),this.value=A.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[u,A]=this.value.rawValue.getComponents(),w=this.maxValue_,M=en(u,-w,+w,0,100),K=en(A,-w,+w,0,100),re=this.invertsY_?100-K:K;this.lineElem_.setAttributeNS(null,"x2",`${M}%`),this.lineElem_.setAttributeNS(null,"y2",`${re}%`),this.markerElem_.style.left=`${M}%`,this.markerElem_.style.top=`${re}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Jd(g,u,A){return[ai(u[0],dr(g)),ai(u[1],Is(g))*(A?1:-1)]}class Yv{constructor(u,A){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=A.value,this.viewProps=A.viewProps,this.baseSteps_=A.baseSteps,this.maxValue_=A.maxValue,this.invertsY_=A.invertsY,this.view=new Kv(u,{invertsY:this.invertsY_,layout:A.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new io(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(u,A){if(!u.point)return;const w=this.maxValue_,M=en(u.point.x,0,u.bounds.width,-w,+w),K=en(this.invertsY_?u.bounds.height-u.point.y:u.point.y,0,u.bounds.height,-w,+w);this.value.setRawValue(new Qr(M,K),A)}onPointerDown_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onPadKeyDown_(u){md(u.key)&&u.preventDefault();const[A,w]=Jd(u,this.baseSteps_,this.invertsY_);A===0&&w===0||this.value.setRawValue(new Qr(this.value.rawValue.x+A,this.value.rawValue.y+w),{forceEmit:!1,last:!1})}onPadKeyUp_(u){const[A,w]=Jd(u,this.baseSteps_,this.invertsY_);A===0&&w===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Xv{constructor(u,A){var w,M;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=A.value,this.viewProps=A.viewProps,this.foldable_=$e.create(A.expanded),this.popC_=A.pickerLayout==="popup"?new Sr(u,{viewProps:this.viewProps}):null;const K=new Yv(u,{baseSteps:[A.axes[0].baseStep,A.axes[1].baseStep],invertsY:A.invertsY,layout:A.pickerLayout,maxValue:A.maxValue,value:this.value,viewProps:this.viewProps});K.view.allFocusableElements.forEach(re=>{re.addEventListener("blur",this.onPopupChildBlur_),re.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=K,this.textC_=new Gc(u,{assembly:Xd,axes:A.axes,parser:A.parser,value:this.value,viewProps:this.viewProps}),this.view=new Wv(u,{expanded:this.foldable_.value("expanded"),pickerLayout:A.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(w=this.view.buttonElement)===null||w===void 0||w.addEventListener("blur",this.onPadButtonBlur_),(M=this.view.buttonElement)===null||M===void 0||M.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),xs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:re=>re.rawValue,backward:(re,De)=>De.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ce(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(u){if(!this.popC_)return;const A=this.view.element,w=u.relatedTarget;(!w||!A.contains(w))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(u){if(!this.popC_)return;const A=this.popC_.view.element,w=Ie(u);w&&A.contains(w)||w&&w===this.view.buttonElement&&!He(A.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(u){this.popC_?u.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&u.key==="Escape"&&this.view.buttonElement.focus()}}class Lo{constructor(u=0,A=0,w=0){this.x=u,this.y=A,this.z=w}getComponents(){return[this.x,this.y,this.z]}static isObject(u){if(d(u))return!1;const A=u.x,w=u.y,M=u.z;return!(typeof A!="number"||typeof w!="number"||typeof M!="number")}static equals(u,A){return u.x===A.x&&u.y===A.y&&u.z===A.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Zd={toComponents:g=>g.getComponents(),fromComponents:g=>new Lo(...g)};function Jv(g){return Lo.isObject(g)?new Lo(g.x,g.y,g.z):new Lo}function Zv(g,u){g.writeProperty("x",u.x),g.writeProperty("y",u.y),g.writeProperty("z",u.z)}function $v(g,u){return new Pr({assembly:Zd,components:[fr("x"in g?g.x:void 0,u.x),fr("y"in g?g.y:void 0,u.y),fr("z"in g?g.z:void 0,u.z)]})}function Nc(g,u){return{baseStep:Qo(u),constraint:u,textProps:Z.fromObject({draggingScale:Ro(u,g),formatter:Rn(Oa(u,g))})}}const eb={id:"input-point3d",type:"input",accept:(g,u)=>{if(!Lo.isObject(g))return null;const A=J,w=X(u,{x:A.optional.custom(Tr),y:A.optional.custom(Tr),z:A.optional.custom(Tr)});return w?{initialValue:g,params:w}:null},binding:{reader:g=>Jv,constraint:g=>$v(g.params,g.initialValue),equals:Lo.equals,writer:g=>Zv},controller:g=>{const u=g.value,A=g.constraint;if(!(A instanceof Pr))throw b.shouldNeverHappen();return new Gc(g.document,{assembly:Zd,axes:[Nc(u.rawValue.x,A.components[0]),Nc(u.rawValue.y,A.components[1]),Nc(u.rawValue.z,A.components[2])],parser:hr,value:u,viewProps:g.viewProps})}};class Oo{constructor(u=0,A=0,w=0,M=0){this.x=u,this.y=A,this.z=w,this.w=M}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(u){if(d(u))return!1;const A=u.x,w=u.y,M=u.z,K=u.w;return!(typeof A!="number"||typeof w!="number"||typeof M!="number"||typeof K!="number")}static equals(u,A){return u.x===A.x&&u.y===A.y&&u.z===A.z&&u.w===A.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const $d={toComponents:g=>g.getComponents(),fromComponents:g=>new Oo(...g)};function tb(g){return Oo.isObject(g)?new Oo(g.x,g.y,g.z,g.w):new Oo}function nb(g,u){g.writeProperty("x",u.x),g.writeProperty("y",u.y),g.writeProperty("z",u.z),g.writeProperty("w",u.w)}function ib(g,u){return new Pr({assembly:$d,components:[fr("x"in g?g.x:void 0,u.x),fr("y"in g?g.y:void 0,u.y),fr("z"in g?g.z:void 0,u.z),fr("w"in g?g.w:void 0,u.w)]})}function rb(g,u){return{baseStep:Qo(u),constraint:u,textProps:Z.fromObject({draggingScale:Ro(u,g),formatter:Rn(Oa(u,g))})}}const ob={id:"input-point4d",type:"input",accept:(g,u)=>{if(!Oo.isObject(g))return null;const A=J,w=X(u,{x:A.optional.custom(Tr),y:A.optional.custom(Tr),z:A.optional.custom(Tr),w:A.optional.custom(Tr)});return w?{initialValue:g,params:w}:null},binding:{reader:g=>tb,constraint:g=>ib(g.params,g.initialValue),equals:Oo.equals,writer:g=>nb},controller:g=>{const u=g.value,A=g.constraint;if(!(A instanceof Pr))throw b.shouldNeverHappen();return new Gc(g.document,{assembly:$d,axes:u.rawValue.getComponents().map((w,M)=>rb(w,A.components[M])),parser:hr,value:u,viewProps:g.viewProps})}};function sb(g){const u=[],A=Sc(g.options);return A&&u.push(A),new Zn(u)}const ab={id:"input-string",type:"input",accept:(g,u)=>{if(typeof g!="string")return null;const w=X(u,{options:J.optional.custom(La)});return w?{initialValue:g,params:w}:null},binding:{reader:g=>gd,constraint:g=>sb(g.params),writer:g=>Ss},controller:g=>{const u=g.document,A=g.value,w=g.constraint,M=w&&si(w,xr);return M?new Vi(u,{props:new Z({options:M.values.value("options")}),value:A,viewProps:g.viewProps}):new kr(u,{parser:K=>K,props:Z.fromObject({formatter:Cc}),value:A,viewProps:g.viewProps})}},Ds={monitor:{defaultInterval:200,defaultLineCount:3}},ef=C("mll");class lb{constructor(u,A){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=A.formatter,this.element=u.createElement("div"),this.element.classList.add(ef()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("textarea");w.classList.add(ef("i")),w.style.height=`calc(var(--bld-us) * ${A.lineCount})`,w.readOnly=!0,A.viewProps.bindDisabled(w),this.element.appendChild(w),this.textareaElem_=w,A.value.emitter.on("change",this.onValueUpdate_),this.value=A.value,this.update_()}update_(){const u=this.textareaElem_,A=u.scrollTop===u.scrollHeight-u.clientHeight,w=[];this.value.rawValue.forEach(M=>{M!==void 0&&w.push(this.formatter_(M))}),u.textContent=w.join(`
`),A&&(u.scrollTop=u.scrollHeight)}onValueUpdate_(){this.update_()}}class zc{constructor(u,A){this.value=A.value,this.viewProps=A.viewProps,this.view=new lb(u,{formatter:A.formatter,lineCount:A.lineCount,value:this.value,viewProps:this.viewProps})}}const tf=C("sgl");class cb{constructor(u,A){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=A.formatter,this.element=u.createElement("div"),this.element.classList.add(tf()),A.viewProps.bindClassModifiers(this.element);const w=u.createElement("input");w.classList.add(tf("i")),w.readOnly=!0,w.type="text",A.viewProps.bindDisabled(w),this.element.appendChild(w),this.inputElement=w,A.value.emitter.on("change",this.onValueUpdate_),this.value=A.value,this.update_()}update_(){const u=this.value.rawValue,A=u[u.length-1];this.inputElement.value=A!==void 0?this.formatter_(A):""}onValueUpdate_(){this.update_()}}class Hc{constructor(u,A){this.value=A.value,this.viewProps=A.viewProps,this.view=new cb(u,{formatter:A.formatter,value:this.value,viewProps:this.viewProps})}}const ub={id:"monitor-bool",type:"monitor",accept:(g,u)=>{if(typeof g!="boolean")return null;const w=X(u,{lineCount:J.optional.number});return w?{initialValue:g,params:w}:null},binding:{reader:g=>bs},controller:g=>{var u;return g.value.rawValue.length===1?new Hc(g.document,{formatter:$r,value:g.value,viewProps:g.viewProps}):new zc(g.document,{formatter:$r,lineCount:(u=g.params.lineCount)!==null&&u!==void 0?u:Ds.monitor.defaultLineCount,value:g.value,viewProps:g.viewProps})}},Ur=C("grl");class hb{constructor(u,A){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=u.createElement("div"),this.element.classList.add(Ur()),A.viewProps.bindClassModifiers(this.element),this.formatter_=A.formatter,this.props_=A.props,this.cursor_=A.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const w=u.createElementNS(Be,"svg");w.classList.add(Ur("g")),w.style.height=`calc(var(--bld-us) * ${A.lineCount})`,this.element.appendChild(w),this.svgElem_=w;const M=u.createElementNS(Be,"polyline");this.svgElem_.appendChild(M),this.lineElem_=M;const K=u.createElement("div");K.classList.add(Ur("t"),C("tt")()),this.element.appendChild(K),this.tooltipElem_=K,A.value.emitter.on("change",this.onValueUpdate_),this.value=A.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const u=this.svgElem_.getBoundingClientRect(),A=this.value.rawValue.length-1,w=this.props_.get("minValue"),M=this.props_.get("maxValue"),K=[];this.value.rawValue.forEach((Qt,Ut)=>{if(Qt===void 0)return;const lo=en(Ut,0,A,0,u.width),Ts=en(Qt,w,M,u.height,0);K.push([lo,Ts].join(","))}),this.lineElem_.setAttributeNS(null,"points",K.join(" "));const re=this.tooltipElem_,De=this.value.rawValue[this.cursor_.rawValue];if(De===void 0){re.classList.remove(Ur("t","a"));return}const ct=en(this.cursor_.rawValue,0,A,0,u.width),At=en(De,w,M,u.height,0);re.style.left=`${ct}px`,re.style.top=`${At}px`,re.textContent=`${this.formatter_(De)}`,re.classList.contains(Ur("t","a"))||(re.classList.add(Ur("t","a"),Ur("t","in")),Ue(re),re.classList.remove(Ur("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class db{constructor(u,A){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=A.props,this.value=A.value,this.viewProps=A.viewProps,this.cursor_=q(-1),this.view=new hb(u,{cursor:this.cursor_,formatter:A.formatter,lineCount:A.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!He(u))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const w=new io(this.view.element);w.emitter.on("down",this.onGraphPointerDown_),w.emitter.on("move",this.onGraphPointerMove_),w.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(u){const A=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(en(u.offsetX,0,A.width,0,this.value.rawValue.length))}onGraphPointerDown_(u){this.onGraphPointerMove_(u)}onGraphPointerMove_(u){if(!u.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(en(u.data.point.x,0,u.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Vc(g){return"format"in g&&!d(g.format)?g.format:Rn(2)}function fb(g){var u;return g.value.rawValue.length===1?new Hc(g.document,{formatter:Vc(g.params),value:g.value,viewProps:g.viewProps}):new zc(g.document,{formatter:Vc(g.params),lineCount:(u=g.params.lineCount)!==null&&u!==void 0?u:Ds.monitor.defaultLineCount,value:g.value,viewProps:g.viewProps})}function Ab(g){var u,A,w;return new db(g.document,{formatter:Vc(g.params),lineCount:(u=g.params.lineCount)!==null&&u!==void 0?u:Ds.monitor.defaultLineCount,props:Z.fromObject({maxValue:(A="max"in g.params?g.params.max:null)!==null&&A!==void 0?A:100,minValue:(w="min"in g.params?g.params.min:null)!==null&&w!==void 0?w:0}),value:g.value,viewProps:g.viewProps})}function nf(g){return"view"in g&&g.view==="graph"}const pb={id:"monitor-number",type:"monitor",accept:(g,u)=>{if(typeof g!="number")return null;const A=J,w=X(u,{format:A.optional.function,lineCount:A.optional.number,max:A.optional.number,min:A.optional.number,view:A.optional.string});return w?{initialValue:g,params:w}:null},binding:{defaultBufferSize:g=>nf(g)?64:1,reader:g=>pd},controller:g=>nf(g.params)?Ab(g):fb(g)},gb={id:"monitor-string",type:"monitor",accept:(g,u)=>{if(typeof g!="string")return null;const A=J,w=X(u,{lineCount:A.optional.number,multiline:A.optional.boolean});return w?{initialValue:g,params:w}:null},binding:{reader:g=>gd},controller:g=>{var u;const A=g.value;return A.rawValue.length>1||"multiline"in g.params&&g.params.multiline?new zc(g.document,{formatter:Cc,lineCount:(u=g.params.lineCount)!==null&&u!==void 0?u:Ds.monitor.defaultLineCount,value:A,viewProps:g.viewProps}):new Hc(g.document,{formatter:Cc,value:A,viewProps:g.viewProps})}};function mb(g,u){var A;const w=g.accept(u.target.read(),u.params);if(d(w))return null;const M=J,K={target:u.target,initialValue:w.initialValue,params:w.params},re=g.binding.reader(K),De=g.binding.constraint?g.binding.constraint(K):void 0,ct=q(re(w.initialValue),{constraint:De,equals:g.binding.equals}),At=new $t({reader:re,target:u.target,value:ct,writer:g.binding.writer(K)}),Qt=M.optional.boolean(u.params.disabled).value,Ut=M.optional.boolean(u.params.hidden).value,lo=g.controller({constraint:De,document:u.document,initialValue:w.initialValue,params:w.params,value:At.value,viewProps:oe.create({disabled:Qt,hidden:Ut})});return new rt(u.document,{binding:At,blade:ot(),props:Z.fromObject({label:"label"in u.params?(A=M.optional.string(u.params.label).value)!==null&&A!==void 0?A:null:u.target.key}),valueController:lo})}function vb(g,u){return u===0?new Yt:new kn(g,u??Ds.monitor.defaultInterval)}function bb(g,u){var A,w,M;const K=J,re=g.accept(u.target.read(),u.params);if(d(re))return null;const De={target:u.target,initialValue:re.initialValue,params:re.params},ct=g.binding.reader(De),At=(w=(A=K.optional.number(u.params.bufferSize).value)!==null&&A!==void 0?A:g.binding.defaultBufferSize&&g.binding.defaultBufferSize(re.params))!==null&&w!==void 0?w:1,Qt=K.optional.number(u.params.interval).value,Ut=new Jn({reader:ct,target:u.target,ticker:vb(u.document,Qt),value:Ot(At)}),lo=K.optional.boolean(u.params.disabled).value,Ts=K.optional.boolean(u.params.hidden).value,Ms=g.controller({document:u.document,params:re.params,value:Ut.value,viewProps:oe.create({disabled:lo,hidden:Ts})});return new _t(u.document,{binding:Ut,blade:ot(),props:Z.fromObject({label:"label"in u.params?(M=K.optional.string(u.params.label).value)!==null&&M!==void 0?M:null:u.target.key}),valueController:Ms})}class wb{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(u){u.type==="blade"?this.pluginsMap_.blades.unshift(u):u.type==="input"?this.pluginsMap_.inputs.unshift(u):u.type==="monitor"&&this.pluginsMap_.monitors.unshift(u)}createInput(u,A,w){const M=A.read();if(d(M))throw new b({context:{key:A.key},type:"nomatchingcontroller"});const K=this.pluginsMap_.inputs.reduce((re,De)=>re??mb(De,{document:u,target:A,params:w}),null);if(K)return K;throw new b({context:{key:A.key},type:"nomatchingcontroller"})}createMonitor(u,A,w){const M=this.pluginsMap_.monitors.reduce((K,re)=>K??bb(re,{document:u,params:w,target:A}),null);if(M)return M;throw new b({context:{key:A.key},type:"nomatchingcontroller"})}createBlade(u,A){const w=this.pluginsMap_.blades.reduce((M,K)=>M??bt(K,{document:u,params:A}),null);if(!w)throw new b({type:"nomatchingview",context:{params:A}});return w}createBladeApi(u){if(u instanceof rt)return new Fe(u);if(u instanceof _t)return new Tt(u);if(u instanceof Pn)return new An(u,this);const A=this.pluginsMap_.blades.reduce((w,M)=>w??M.api({controller:u,pool:this}),null);if(!A)throw b.shouldNeverHappen();return A}}function yb(){const g=new wb;return[Bb,eb,ob,ab,qv,Nv,Gv,Uv,Rm,ub,gb,pb,Ze,ee,ve,Pt].forEach(u=>{g.register(u)}),g}function _b(g){return Qr.isObject(g)?new Qr(g.x,g.y):new Qr}function Cb(g,u){g.writeProperty("x",u.x),g.writeProperty("y",u.y)}function fr(g,u){if(!g)return;const A=[],w=Kd(g,u);w&&A.push(w);const M=Yd(g);return M&&A.push(M),new Zn(A)}function Eb(g,u){return new Pr({assembly:Xd,components:[fr("x"in g?g.x:void 0,u.x),fr("y"in g?g.y:void 0,u.y)]})}function rf(g,u){const[A,w]=g?Vv(g):[];if(!d(A)||!d(w))return Math.max(Math.abs(A??0),Math.abs(w??0));const M=Qo(g);return Math.max(Math.abs(M)*10,Math.abs(u)*10)}function xb(g,u){const A=u instanceof Pr?u.components[0]:void 0,w=u instanceof Pr?u.components[1]:void 0,M=rf(A,g.x),K=rf(w,g.y);return Math.max(M,K)}function of(g,u){return{baseStep:Qo(u),constraint:u,textProps:Z.fromObject({draggingScale:Ro(u,g),formatter:Rn(Oa(u,g))})}}function Ib(g){if(!("y"in g))return!1;const u=g.y;return u&&"inverted"in u?!!u.inverted:!1}const Bb={id:"input-point2d",type:"input",accept:(g,u)=>{if(!Qr.isObject(g))return null;const A=J,w=X(u,{expanded:A.optional.boolean,picker:A.optional.custom(wd),x:A.optional.custom(Tr),y:A.optional.object({inverted:A.optional.boolean,max:A.optional.number,min:A.optional.number,step:A.optional.number})});return w?{initialValue:g,params:w}:null},binding:{reader:g=>_b,constraint:g=>Eb(g.params,g.initialValue),equals:Qr.equals,writer:g=>Cb},controller:g=>{const u=g.document,A=g.value,w=g.constraint;if(!(w instanceof Pr))throw b.shouldNeverHappen();const M="expanded"in g.params?g.params.expanded:void 0,K="picker"in g.params?g.params.picker:void 0;return new Xv(u,{axes:[of(A.rawValue.x,w.components[0]),of(A.rawValue.y,w.components[1])],expanded:M??!1,invertsY:Ib(g.params),maxValue:xb(A.rawValue,w),parser:hr,pickerLayout:K??"popup",value:A,viewProps:g.viewProps})}};class sf extends n{constructor(u){super(u),this.emitter_=new E,this.controller_.valueController.value.emitter.on("change",A=>{this.emitter_.emit("change",{event:new r(this,A.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}get options(){return this.controller_.valueController.props.get("options")}set options(u){this.controller_.valueController.props.set("options",u)}get value(){return this.controller_.valueController.value.rawValue}set value(u){this.controller_.valueController.value.rawValue=u}on(u,A){const w=A.bind(this);return this.emitter_.on(u,M=>{w(M.event)}),this}}class af extends n{constructor(u){super(u),this.emitter_=new E,this.controller_.valueController.value.emitter.on("change",A=>{this.emitter_.emit("change",{event:new r(this,A.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(u){this.controller_.valueController.sliderController.props.set("maxValue",u)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(u){this.controller_.valueController.sliderController.props.set("minValue",u)}get value(){return this.controller_.valueController.value.rawValue}set value(u){this.controller_.valueController.value.rawValue=u}on(u,A){const w=A.bind(this);return this.emitter_.on(u,M=>{w(M.event)}),this}}class lf extends n{constructor(u){super(u),this.emitter_=new E,this.controller_.valueController.value.emitter.on("change",A=>{this.emitter_.emit("change",{event:new r(this,A.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(u){this.controller_.valueController.props.set("formatter",u)}get value(){return this.controller_.valueController.value.rawValue}set value(u){this.controller_.valueController.value.rawValue=u}on(u,A){const w=A.bind(this);return this.emitter_.on(u,M=>{w(M.event)}),this}}const Sb=function(){return{id:"list",type:"blade",accept(g){const u=J,A=X(g,{options:u.required.custom(La),value:u.required.raw,view:u.required.constant("list"),label:u.optional.string});return A?{params:A}:null},controller(g){const u=new xr(yd(g.params.options)),A=q(g.params.value,{constraint:u}),w=new Vi(g.document,{props:new Z({options:u.values.value("options")}),value:A,viewProps:g.viewProps});return new fe(g.document,{blade:g.blade,props:Z.fromObject({label:g.params.label}),valueController:w})},api(g){return!(g.controller instanceof fe)||!(g.controller.valueController instanceof Vi)?null:new sf(g.controller)}}}();function kb(g){return g.reduce((u,A)=>Object.assign(u,{[A.presetKey]:A.read()}),{})}function Db(g,u){g.forEach(A=>{const w=u[A.target.presetKey];w!==void 0&&A.writer(A.target,A.reader(w))})}class Tb extends mn{constructor(u,A){super(u,A)}get element(){return this.controller_.view.element}importPreset(u){const A=this.controller_.rackController.rack.find(rt).map(w=>w.binding);Db(A,u),this.refresh()}exportPreset(){const u=this.controller_.rackController.rack.find(rt).map(A=>A.binding.target);return kb(u)}refresh(){this.controller_.rackController.rack.find(rt).forEach(u=>{u.binding.read()}),this.controller_.rackController.rack.find(_t).forEach(u=>{u.binding.read()})}}class Mb extends W{constructor(u,A){super(u,{expanded:A.expanded,blade:A.blade,props:A.props,root:!0,viewProps:A.viewProps})}}const Pb={id:"slider",type:"blade",accept(g){const u=J,A=X(g,{max:u.required.number,min:u.required.number,view:u.required.constant("slider"),format:u.optional.function,label:u.optional.string,value:u.optional.number});return A?{params:A}:null},controller(g){var u,A;const w=(u=g.params.value)!==null&&u!==void 0?u:0,M=new Hi({max:g.params.max,min:g.params.min}),K=new Bc(g.document,{baseStep:1,parser:hr,sliderProps:new Z({maxValue:M.values.value("max"),minValue:M.values.value("min")}),textProps:Z.fromObject({draggingScale:Ro(void 0,w),formatter:(A=g.params.format)!==null&&A!==void 0?A:Em}),value:q(w,{constraint:M}),viewProps:g.viewProps});return new fe(g.document,{blade:g.blade,props:Z.fromObject({label:g.params.label}),valueController:K})},api(g){return!(g.controller instanceof fe)||!(g.controller.valueController instanceof Bc)?null:new af(g.controller)}},Qb=function(){return{id:"text",type:"blade",accept(g){const u=J,A=X(g,{parse:u.required.function,value:u.required.raw,view:u.required.constant("text"),format:u.optional.function,label:u.optional.string});return A?{params:A}:null},controller(g){var u;const A=new kr(g.document,{parser:g.params.parse,props:Z.fromObject({formatter:(u=g.params.format)!==null&&u!==void 0?u:w=>String(w)}),value:q(g.params.value),viewProps:g.viewProps});return new fe(g.document,{blade:g.blade,props:Z.fromObject({label:g.params.label}),valueController:A})},api(g){return!(g.controller instanceof fe)||!(g.controller.valueController instanceof kr)?null:new lf(g.controller)}}}();function Rb(g){const u=g.createElement("div");return u.classList.add(C("dfw")()),g.body&&g.body.appendChild(u),u}function cf(g,u,A){if(g.querySelector(`style[data-tp-style=${u}]`))return;const w=g.createElement("style");w.dataset.tpStyle=u,w.textContent=A,g.head.appendChild(w)}class Ub extends Tb{constructor(u){var A,w;const M=u??{},K=(A=M.document)!==null&&A!==void 0?A:te(),re=yb(),De=new Mb(K,{expanded:M.expanded,blade:ot(),props:Z.fromObject({title:M.title}),viewProps:oe.create()});super(De,re),this.pool_=re,this.containerElem_=(w=M.container)!==null&&w!==void 0?w:Rb(K),this.containerElem_.appendChild(this.element),this.doc_=K,this.usesDefaultWrapper_=!M.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw b.alreadyDisposed();return this.doc_}dispose(){const u=this.containerElem_;if(!u)throw b.alreadyDisposed();if(this.usesDefaultWrapper_){const A=u.parentElement;A&&A.removeChild(u)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(u){("plugin"in u?[u.plugin]:"plugins"in u?u.plugins:[]).forEach(w=>{this.pool_.register(w),this.embedPluginStyle_(w)})}embedPluginStyle_(u){u.css&&cf(this.document,`plugin-${u.id}`,u.css)}setUpDefaultPlugins_(){cf(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(u=>{this.embedPluginStyle_(u)}),this.registerPlugin({plugins:[Pb,Sb,Pt,Qb]})}}const Fb=new a("3.1.10");i.BladeApi=n,i.ButtonApi=y,i.FolderApi=mn,i.InputBindingApi=Fe,i.ListApi=sf,i.MonitorBindingApi=Tt,i.Pane=Ub,i.SeparatorApi=le,i.SliderApi=af,i.TabApi=je,i.TabPageApi=nt,i.TextApi=lf,i.TpChangeEvent=r,i.VERSION=Fb,Object.defineProperty(i,"__esModule",{value:!0})})})(wh,wh.exports);var WC=wh.exports;function KC(){var o=Object.create(null);function e(n,t){var r=n.id,s=n.name,l=n.dependencies;l===void 0&&(l=[]);var c=n.init;c===void 0&&(c=function(){});var h=n.getTransferables;if(h===void 0&&(h=null),!o[r])try{l=l.map(function(f){return f&&f.isWorkerModule&&(e(f,function(p){if(p instanceof Error)throw p}),f=o[f.id].value),f}),c=a("<"+s+">.init",c),h&&(h=a("<"+s+">.getTransferables",h));var d=null;typeof c=="function"?d=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),o[r]={id:r,value:d,getTransferables:h},t(d)}catch(f){f&&f.noLog||console.error(f),t(f)}}function i(n,t){var r,s=n.id,l=n.args;(!o[s]||typeof o[s].value!="function")&&t(new Error("Worker module "+s+": not found or its 'init' did not return a function"));try{var c=(r=o[s]).value.apply(r,l);c&&typeof c.then=="function"?c.then(h,function(d){return t(d instanceof Error?d:new Error(""+d))}):h(c)}catch(d){t(d)}function h(d){try{var f=o[s].getTransferables&&o[s].getTransferables(d);(!f||!Array.isArray(f)||!f.length)&&(f=void 0),t(d,f)}catch(p){console.error(p),t(p)}}}function a(n,t){var r=void 0;self.troikaDefine=function(l){return r=l};var s=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+t+`
)`],{type:"application/javascript"}));try{importScripts(s)}catch(l){console.error(l)}return URL.revokeObjectURL(s),delete self.troikaDefine,r}self.addEventListener("message",function(n){var t=n.data,r=t.messageId,s=t.action,l=t.data;try{s==="registerModule"&&e(l,function(c){c instanceof Error?postMessage({messageId:r,success:!1,error:c.message}):postMessage({messageId:r,success:!0,result:{isCallable:typeof c=="function"}})}),s==="callModule"&&i(l,function(c,h){c instanceof Error?postMessage({messageId:r,success:!1,error:c.message}):postMessage({messageId:r,success:!0,result:c},h||void 0)})}catch(c){postMessage({messageId:r,success:!1,error:c.stack})}})}function YC(o){var e=function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];return e._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,i);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var i=o.dependencies,a=o.init;i=Array.isArray(i)?i.map(function(t){return t&&(t=t.onMainThread||t,t._getInitResult&&(t=t._getInitResult())),t}):[];var n=Promise.all(i).then(function(t){return a.apply(null,t)});return e._getInitResult=function(){return n},n},e}var Vg=function(){var o=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),o=!0}catch(i){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+i.message+"]")}return Vg=function(){return o},o},XC=0,JC=0,Nu=!1,ua=Object.create(null),ha=Object.create(null),yh=Object.create(null);function fs(o){if((!o||typeof o.init!="function")&&!Nu)throw new Error("requires `options.init` function");var e=o.dependencies,i=o.init,a=o.getTransferables,n=o.workerId,t=YC(o);n==null&&(n="#default");var r="workerModule"+ ++XC,s=o.name||r,l=null;e=e&&e.map(function(h){return typeof h=="function"&&!h.workerModuleData&&(Nu=!0,h=fs({workerId:n,name:"<"+s+"> function dependency: "+h.name,init:`function(){return (
`+Ul(h)+`
)}`}),Nu=!1),h&&h.workerModuleData&&(h=h.workerModuleData),h});function c(){for(var h=[],d=arguments.length;d--;)h[d]=arguments[d];if(!Vg())return t.apply(void 0,h);if(!l){l=FA(n,"registerModule",c.workerModuleData);var f=function(){l=null,ha[n].delete(f)};(ha[n]||(ha[n]=new Set)).add(f)}return l.then(function(p){var m=p.isCallable;if(m)return FA(n,"callModule",{id:r,args:h});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:r,name:s,dependencies:e,init:Ul(i),getTransferables:a&&Ul(a)},c.onMainThread=t,c}function ZC(o){ha[o]&&ha[o].forEach(function(e){e()}),ua[o]&&(ua[o].terminate(),delete ua[o])}function Ul(o){var e=o.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function $C(o){var e=ua[o];if(!e){var i=Ul(KC);e=ua[o]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+o.replace(/\*/g,"")+` **/

;(`+i+")()"],{type:"application/javascript"}))),e.onmessage=function(a){var n=a.data,t=n.messageId,r=yh[t];if(!r)throw new Error("WorkerModule response with empty or unknown messageId");delete yh[t],r(n)}}return e}function FA(o,e,i){return new Promise(function(a,n){var t=++JC;yh[t]=function(r){r.success?a(r.result):n(new Error("Error in worker "+e+" call: "+r.error))},$C(o).postMessage({messageId:t,action:e,data:i})})}function pc(){var o=function(e){function i(Y,j,L,N,V,J,X,$){var ne=1-X;$.x=ne*ne*Y+2*ne*X*L+X*X*V,$.y=ne*ne*j+2*ne*X*N+X*X*J}function a(Y,j,L,N,V,J,X,$,ne,se){var _e=1-ne;se.x=_e*_e*_e*Y+3*_e*_e*ne*L+3*_e*ne*ne*V+ne*ne*ne*X,se.y=_e*_e*_e*j+3*_e*_e*ne*N+3*_e*ne*ne*J+ne*ne*ne*$}function n(Y,j){for(var L=/([MLQCZ])([^MLQCZ]*)/g,N,V,J,X,$;N=L.exec(Y);){var ne=N[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(se){return parseFloat(se)});switch(N[1]){case"M":X=V=ne[0],$=J=ne[1];break;case"L":(ne[0]!==X||ne[1]!==$)&&j("L",X,$,X=ne[0],$=ne[1]);break;case"Q":{j("Q",X,$,X=ne[2],$=ne[3],ne[0],ne[1]);break}case"C":{j("C",X,$,X=ne[4],$=ne[5],ne[0],ne[1],ne[2],ne[3]);break}case"Z":(X!==V||$!==J)&&j("L",X,$,V,J);break}}}function t(Y,j,L){L===void 0&&(L=16);var N={x:0,y:0};n(Y,function(V,J,X,$,ne,se,_e,be,oe){switch(V){case"L":j(J,X,$,ne);break;case"Q":{for(var ue=J,We=X,Te=1;Te<L;Te++)i(J,X,se,_e,$,ne,Te/(L-1),N),j(ue,We,N.x,N.y),ue=N.x,We=N.y;break}case"C":{for(var Se=J,Be=X,Ue=1;Ue<L;Ue++)a(J,X,se,_e,be,oe,$,ne,Ue/(L-1),N),j(Se,Be,N.x,N.y),Se=N.x,Be=N.y;break}}})}var r="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",s="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function h(Y,j){var L=Y.getContext?Y.getContext("webgl",c):Y,N=l.get(L);if(!N){let _e=function(Se){var Be=J[Se];if(!Be&&(Be=J[Se]=L.getExtension(Se),!Be))throw new Error(Se+" not supported");return Be},be=function(Se,Be){var Ue=L.createShader(Be);return L.shaderSource(Ue,Se),L.compileShader(Ue),Ue},oe=function(Se,Be,Ue,ke){if(!X[Se]){var He={},he={},te=L.createProgram();L.attachShader(te,be(Be,L.VERTEX_SHADER)),L.attachShader(te,be(Ue,L.FRAGMENT_SHADER)),L.linkProgram(te),X[Se]={program:te,transaction:function(pe){L.useProgram(te),pe({setUniform:function(ge,Je){for(var de=[],xe=arguments.length-2;xe-- >0;)de[xe]=arguments[xe+2];var Ie=he[Je]||(he[Je]=L.getUniformLocation(te,Je));L["uniform"+ge].apply(L,[Ie].concat(de))},setAttribute:function(ge,Je,de,xe,Ie){var Oe=He[ge];Oe||(Oe=He[ge]={buf:L.createBuffer(),loc:L.getAttribLocation(te,ge),data:null}),L.bindBuffer(L.ARRAY_BUFFER,Oe.buf),L.vertexAttribPointer(Oe.loc,Je,L.FLOAT,!1,0,0),L.enableVertexAttribArray(Oe.loc),V?L.vertexAttribDivisor(Oe.loc,xe):_e("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Oe.loc,xe),Ie!==Oe.data&&(L.bufferData(L.ARRAY_BUFFER,Ie,de),Oe.data=Ie)}})}}}X[Se].transaction(ke)},ue=function(Se,Be){ne++;try{L.activeTexture(L.TEXTURE0+ne);var Ue=$[Se];Ue||(Ue=$[Se]=L.createTexture(),L.bindTexture(L.TEXTURE_2D,Ue),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.NEAREST),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.NEAREST)),L.bindTexture(L.TEXTURE_2D,Ue),Be(Ue,ne)}finally{ne--}},We=function(Se,Be,Ue){var ke=L.createFramebuffer();se.push(ke),L.bindFramebuffer(L.FRAMEBUFFER,ke),L.activeTexture(L.TEXTURE0+Be),L.bindTexture(L.TEXTURE_2D,Se),L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,Se,0);try{Ue(ke)}finally{L.deleteFramebuffer(ke),L.bindFramebuffer(L.FRAMEBUFFER,se[--se.length-1]||null)}},Te=function(){J={},X={},$={},ne=-1,se.length=0};var V=typeof WebGL2RenderingContext<"u"&&L instanceof WebGL2RenderingContext,J={},X={},$={},ne=-1,se=[];L.canvas.addEventListener("webglcontextlost",function(Se){Te(),Se.preventDefault()},!1),l.set(L,N={gl:L,isWebGL2:V,getExtension:_e,withProgram:oe,withTexture:ue,withTextureFramebuffer:We,handleContextLoss:Te})}j(N)}function d(Y,j,L,N,V,J,X,$){X===void 0&&(X=15),$===void 0&&($=null),h(Y,function(ne){var se=ne.gl,_e=ne.withProgram,be=ne.withTexture;be("copy",function(oe,ue){se.texImage2D(se.TEXTURE_2D,0,se.RGBA,V,J,0,se.RGBA,se.UNSIGNED_BYTE,j),_e("copy",r,s,function(We){var Te=We.setUniform,Se=We.setAttribute;Se("aUV",2,se.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Te("1i","image",ue),se.bindFramebuffer(se.FRAMEBUFFER,$||null),se.disable(se.BLEND),se.colorMask(X&8,X&4,X&2,X&1),se.viewport(L,N,V,J),se.scissor(L,N,V,J),se.drawArrays(se.TRIANGLES,0,3)})})})}function f(Y,j,L){var N=Y.width,V=Y.height;h(Y,function(J){var X=J.gl,$=new Uint8Array(N*V*4);X.readPixels(0,0,N,V,X.RGBA,X.UNSIGNED_BYTE,$),Y.width=j,Y.height=L,d(X,$,0,0,N,V)})}var p=Object.freeze({__proto__:null,withWebGLContext:h,renderImageData:d,resizeWebGLCanvasWithoutClearing:f});function m(Y,j,L,N,V,J){J===void 0&&(J=1);var X=new Uint8Array(Y*j),$=N[2]-N[0],ne=N[3]-N[1],se=[];t(L,function(Se,Be,Ue,ke){se.push({x1:Se,y1:Be,x2:Ue,y2:ke,minX:Math.min(Se,Ue),minY:Math.min(Be,ke),maxX:Math.max(Se,Ue),maxY:Math.max(Be,ke)})}),se.sort(function(Se,Be){return Se.maxX-Be.maxX});for(var _e=0;_e<Y;_e++)for(var be=0;be<j;be++){var oe=We(N[0]+$*(_e+.5)/Y,N[1]+ne*(be+.5)/j),ue=Math.pow(1-Math.abs(oe)/V,J)/2;oe<0&&(ue=1-ue),ue=Math.max(0,Math.min(255,Math.round(ue*255))),X[be*Y+_e]=ue}return X;function We(Se,Be){for(var Ue=1/0,ke=1/0,He=se.length;He--;){var he=se[He];if(he.maxX+ke<=Se)break;if(Se+ke>he.minX&&Be-ke<he.maxY&&Be+ke>he.minY){var te=y(Se,Be,he.x1,he.y1,he.x2,he.y2);te<Ue&&(Ue=te,ke=Math.sqrt(Ue))}}return Te(Se,Be)&&(ke=-ke),ke}function Te(Se,Be){for(var Ue=0,ke=se.length;ke--;){var He=se[ke];if(He.maxX<=Se)break;var he=He.y1>Be!=He.y2>Be&&Se<(He.x2-He.x1)*(Be-He.y1)/(He.y2-He.y1)+He.x1;he&&(Ue+=He.y1<He.y2?1:-1)}return Ue!==0}}function b(Y,j,L,N,V,J,X,$,ne,se){J===void 0&&(J=1),$===void 0&&($=0),ne===void 0&&(ne=0),se===void 0&&(se=0),v(Y,j,L,N,V,J,X,null,$,ne,se)}function v(Y,j,L,N,V,J,X,$,ne,se,_e){J===void 0&&(J=1),ne===void 0&&(ne=0),se===void 0&&(se=0),_e===void 0&&(_e=0);for(var be=m(Y,j,L,N,V,J),oe=new Uint8Array(be.length*4),ue=0;ue<be.length;ue++)oe[ue*4+_e]=be[ue];d(X,oe,ne,se,Y,j,1<<3-_e,$)}function y(Y,j,L,N,V,J){var X=V-L,$=J-N,ne=X*X+$*$,se=ne?Math.max(0,Math.min(1,((Y-L)*X+(j-N)*$)/ne)):0,_e=Y-(L+se*X),be=j-(N+se*$);return _e*_e+be*be}var E=Object.freeze({__proto__:null,generate:m,generateIntoCanvas:b,generateIntoFramebuffer:v}),_="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",C="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",x="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",B=new Float32Array([0,0,2,0,0,2]),I=null,k=!1,P={},D=new WeakMap;function U(Y){if(!k&&!O(Y))throw new Error("WebGL generation not supported")}function S(Y,j,L,N,V,J,X){if(J===void 0&&(J=1),X===void 0&&(X=null),!X&&(X=I,!X)){var $=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!$)throw new Error("OffscreenCanvas or DOM canvas not supported");X=I=$.getContext("webgl",{depth:!1})}U(X);var ne=new Uint8Array(Y*j*4);h(X,function(oe){var ue=oe.gl,We=oe.withTexture,Te=oe.withTextureFramebuffer;We("readable",function(Se,Be){ue.texImage2D(ue.TEXTURE_2D,0,ue.RGBA,Y,j,0,ue.RGBA,ue.UNSIGNED_BYTE,null),Te(Se,Be,function(Ue){Q(Y,j,L,N,V,J,ue,Ue,0,0,0),ue.readPixels(0,0,Y,j,ue.RGBA,ue.UNSIGNED_BYTE,ne)})})});for(var se=new Uint8Array(Y*j),_e=0,be=0;_e<ne.length;_e+=4)se[be++]=ne[_e];return se}function R(Y,j,L,N,V,J,X,$,ne,se){J===void 0&&(J=1),$===void 0&&($=0),ne===void 0&&(ne=0),se===void 0&&(se=0),Q(Y,j,L,N,V,J,X,null,$,ne,se)}function Q(Y,j,L,N,V,J,X,$,ne,se,_e){J===void 0&&(J=1),ne===void 0&&(ne=0),se===void 0&&(se=0),_e===void 0&&(_e=0),U(X);var be=[];t(L,function(oe,ue,We,Te){be.push(oe,ue,We,Te)}),be=new Float32Array(be),h(X,function(oe){var ue=oe.gl,We=oe.isWebGL2,Te=oe.getExtension,Se=oe.withProgram,Be=oe.withTexture,Ue=oe.withTextureFramebuffer,ke=oe.handleContextLoss;if(Be("rawDistances",function(He,he){(Y!==He._lastWidth||j!==He._lastHeight)&&ue.texImage2D(ue.TEXTURE_2D,0,ue.RGBA,He._lastWidth=Y,He._lastHeight=j,0,ue.RGBA,ue.UNSIGNED_BYTE,null),Se("main",_,C,function(te){var Ee=te.setAttribute,pe=te.setUniform,Ce=!We&&Te("ANGLE_instanced_arrays"),ge=!We&&Te("EXT_blend_minmax");Ee("aUV",2,ue.STATIC_DRAW,0,B),Ee("aLineSegment",4,ue.DYNAMIC_DRAW,1,be),pe.apply(void 0,["4f","uGlyphBounds"].concat(N)),pe("1f","uMaxDistance",V),pe("1f","uExponent",J),Ue(He,he,function(Je){ue.enable(ue.BLEND),ue.colorMask(!0,!0,!0,!0),ue.viewport(0,0,Y,j),ue.scissor(0,0,Y,j),ue.blendFunc(ue.ONE,ue.ONE),ue.blendEquationSeparate(ue.FUNC_ADD,We?ue.MAX:ge.MAX_EXT),ue.clear(ue.COLOR_BUFFER_BIT),We?ue.drawArraysInstanced(ue.TRIANGLES,0,3,be.length/4):Ce.drawArraysInstancedANGLE(ue.TRIANGLES,0,3,be.length/4)})}),Se("post",r,x,function(te){te.setAttribute("aUV",2,ue.STATIC_DRAW,0,B),te.setUniform("1i","tex",he),ue.bindFramebuffer(ue.FRAMEBUFFER,$),ue.disable(ue.BLEND),ue.colorMask(_e===0,_e===1,_e===2,_e===3),ue.viewport(ne,se,Y,j),ue.scissor(ne,se,Y,j),ue.drawArrays(ue.TRIANGLES,0,3)})}),ue.isContextLost())throw ke(),new Error("webgl context lost")})}function O(Y){var j=!Y||Y===I?P:Y.canvas||Y,L=D.get(j);if(L===void 0){k=!0;var N=null;try{var V=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],J=S(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,Y);L=J&&V.length===J.length&&J.every(function(X,$){return X===V[$]}),L||(N="bad trial run results",console.info(V,J))}catch(X){L=!1,N=X.message}N&&console.warn("WebGL SDF generation not supported:",N),k=!1,D.set(j,L)}return L}var G=Object.freeze({__proto__:null,generate:S,generateIntoCanvas:R,generateIntoFramebuffer:Q,isSupported:O});function q(Y,j,L,N,V,J){V===void 0&&(V=Math.max(N[2]-N[0],N[3]-N[1])/2),J===void 0&&(J=1);try{return S.apply(G,arguments)}catch(X){return console.info("WebGL SDF generation failed, falling back to JS",X),m.apply(E,arguments)}}function Z(Y,j,L,N,V,J,X,$,ne,se){V===void 0&&(V=Math.max(N[2]-N[0],N[3]-N[1])/2),J===void 0&&(J=1),$===void 0&&($=0),ne===void 0&&(ne=0),se===void 0&&(se=0);try{return R.apply(G,arguments)}catch(_e){return console.info("WebGL SDF generation failed, falling back to JS",_e),b.apply(E,arguments)}}return e.forEachPathCommand=n,e.generate=q,e.generateIntoCanvas=Z,e.javascript=E,e.pathToLineSegments=t,e.webgl=G,e.webglUtils=p,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return o}function jg(){var o=function(e){var i={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},a={},n={};a.L=1,n[1]="L",Object.keys(i).forEach(function(ke,He){a[ke]=1<<He+1,n[a[ke]]=ke}),Object.freeze(a);var t=a.LRI|a.RLI|a.FSI,r=a.L|a.R|a.AL,s=a.B|a.S|a.WS|a.ON|a.FSI|a.LRI|a.RLI|a.PDI,l=a.BN|a.RLE|a.LRE|a.RLO|a.LRO|a.PDF,c=a.S|a.WS|a.B|t|a.PDI|l,h=null;function d(){if(!h){h=new Map;var ke=function(he){if(i.hasOwnProperty(he)){var te=0;i[he].split(",").forEach(function(Ee){var pe=Ee.split("+"),Ce=pe[0],ge=pe[1];Ce=parseInt(Ce,36),ge=ge?parseInt(ge,36):0,h.set(te+=Ce,a[he]);for(var Je=0;Je<ge;Je++)h.set(++te,a[he])})}};for(var He in i)ke(He)}}function f(ke){return d(),h.get(ke.codePointAt(0))||a.L}function p(ke){return n[f(ke)]}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function b(ke,He){var he=36,te=0,Ee=new Map,pe=He&&new Map,Ce;return ke.split(",").forEach(function ge(Je){if(Je.indexOf("+")!==-1)for(var de=+Je;de--;)ge(Ce);else{Ce=Je;var xe=Je.split(">"),Ie=xe[0],Oe=xe[1];Ie=String.fromCodePoint(te+=parseInt(Ie,he)),Oe=String.fromCodePoint(te+=parseInt(Oe,he)),Ee.set(Ie,Oe),He&&pe.set(Oe,Ie)}}),{map:Ee,reverseMap:pe}}var v,y,E;function _(){if(!v){var ke=b(m.pairs,!0),He=ke.map,he=ke.reverseMap;v=He,y=he,E=b(m.canonical,!1).map}}function C(ke){return _(),v.get(ke)||null}function x(ke){return _(),y.get(ke)||null}function B(ke){return _(),E.get(ke)||null}var I=a.L,k=a.R,P=a.EN,D=a.ES,U=a.ET,S=a.AN,R=a.CS,Q=a.B,O=a.S,G=a.ON,q=a.BN,Z=a.NSM,Y=a.AL,j=a.LRO,L=a.RLO,N=a.LRE,V=a.RLE,J=a.PDF,X=a.LRI,$=a.RLI,ne=a.FSI,se=a.PDI;function _e(ke,He){for(var he=125,te=new Uint32Array(ke.length),Ee=0;Ee<ke.length;Ee++)te[Ee]=f(ke[Ee]);var pe=new Map;function Ce(qn,pi){var Qn=te[qn];te[qn]=pi,pe.set(Qn,pe.get(Qn)-1),Qn&s&&pe.set(s,pe.get(s)-1),pe.set(pi,(pe.get(pi)||0)+1),pi&s&&pe.set(s,(pe.get(s)||0)+1)}for(var ge=new Uint8Array(ke.length),Je=new Map,de=[],xe=null,Ie=0;Ie<ke.length;Ie++)xe||de.push(xe={start:Ie,end:ke.length-1,level:He==="rtl"?1:He==="ltr"?0:Ra(Ie,!1)}),te[Ie]&Q&&(xe.end=Ie,xe=null);for(var Oe=V|N|L|j|t|se|J|Q,it=function(qn){return qn+(qn&1?1:2)},pt=function(qn){return qn+(qn&1?2:1)},Pe=0;Pe<de.length;Pe++){xe=de[Pe];var Ze=[{_level:xe.level,_override:0,_isolate:0}],we=void 0,ot=0,$e=0,dt=0;pe.clear();for(var gt=xe.start;gt<=xe.end;gt++){var ce=te[gt];if(we=Ze[Ze.length-1],pe.set(ce,(pe.get(ce)||0)+1),ce&s&&pe.set(s,(pe.get(s)||0)+1),ce&Oe)if(ce&(V|N)){ge[gt]=we._level;var Ke=(ce===V?pt:it)(we._level);Ke<=he&&!ot&&!$e?Ze.push({_level:Ke,_override:0,_isolate:0}):ot||$e++}else if(ce&(L|j)){ge[gt]=we._level;var un=(ce===L?pt:it)(we._level);un<=he&&!ot&&!$e?Ze.push({_level:un,_override:ce&L?k:I,_isolate:0}):ot||$e++}else if(ce&t){ce&ne&&(ce=Ra(gt+1,!0)===1?$:X),ge[gt]=we._level,we._override&&Ce(gt,we._override);var et=(ce===$?pt:it)(we._level);et<=he&&ot===0&&$e===0?(dt++,Ze.push({_level:et,_override:0,_isolate:1,_isolInitIndex:gt})):ot++}else if(ce&se){if(ot>0)ot--;else if(dt>0){for($e=0;!Ze[Ze.length-1]._isolate;)Ze.pop();var Ge=Ze[Ze.length-1]._isolInitIndex;Ge!=null&&(Je.set(Ge,gt),Je.set(gt,Ge)),Ze.pop(),dt--}we=Ze[Ze.length-1],ge[gt]=we._level,we._override&&Ce(gt,we._override)}else ce&J?(ot===0&&($e>0?$e--:!we._isolate&&Ze.length>1&&(Ze.pop(),we=Ze[Ze.length-1])),ge[gt]=we._level):ce&Q&&(ge[gt]=xe.level);else ge[gt]=we._level,we._override&&ce!==q&&Ce(gt,we._override)}for(var Bt=[],mt=null,Fe=xe.start;Fe<=xe.end;Fe++){var rt=te[Fe];if(!(rt&l)){var Tt=ge[Fe],_t=rt&t,Ct=rt===se;mt&&Tt===mt._level?(mt._end=Fe,mt._endsWithIsolInit=_t):Bt.push(mt={_start:Fe,_end:Fe,_level:Tt,_startsWithPDI:Ct,_endsWithIsolInit:_t})}}for(var Wt=[],Mn=0;Mn<Bt.length;Mn++){var An=Bt[Mn];if(!An._startsWithPDI||An._startsWithPDI&&!Je.has(An._start)){for(var mn=[mt=An],Bn=void 0;mt&&mt._endsWithIsolInit&&(Bn=Je.get(mt._end))!=null;)for(var Sn=Mn+1;Sn<Bt.length;Sn++)if(Bt[Sn]._start===Bn){mn.push(mt=Bt[Sn]);break}for(var Ht=[],Xn=0;Xn<mn.length;Xn++)for(var Jr=mn[Xn],zi=Jr._start;zi<=Jr._end;zi++)Ht.push(zi);for(var ps=ge[Ht[0]],wi=xe.level,Pn=Ht[0]-1;Pn>=0;Pn--)if(!(te[Pn]&l)){wi=ge[Pn];break}var T=Ht[Ht.length-1],F=ge[T],W=xe.level;if(!(te[T]&t)){for(var ee=T+1;ee<=xe.end;ee++)if(!(te[ee]&l)){W=ge[ee];break}}Wt.push({_seqIndices:Ht,_sosType:Math.max(wi,ps)%2?k:I,_eosType:Math.max(W,F)%2?k:I})}}for(var fe=0;fe<Wt.length;fe++){var le=Wt[fe],ae=le._seqIndices,Me=le._sosType,ye=le._eosType,ve=ge[ae[0]]&1?k:I;if(pe.get(Z))for(var me=0;me<ae.length;me++){var Ne=ae[me];if(te[Ne]&Z){for(var Ye=Me,Ve=me-1;Ve>=0;Ve--)if(!(te[ae[Ve]]&l)){Ye=te[ae[Ve]];break}Ce(Ne,Ye&(t|se)?G:Ye)}}if(pe.get(P))for(var nt=0;nt<ae.length;nt++){var je=ae[nt];if(te[je]&P)for(var Xe=nt-1;Xe>=-1;Xe--){var ft=Xe===-1?Me:te[ae[Xe]];if(ft&r){ft===Y&&Ce(je,S);break}}}if(pe.get(Y))for(var St=0;St<ae.length;St++){var Vt=ae[St];te[Vt]&Y&&Ce(Vt,k)}if(pe.get(D)||pe.get(R))for(var hn=1;hn<ae.length-1;hn++){var Pt=ae[hn];if(te[Pt]&(D|R)){for(var bt=0,Yt=0,kn=hn-1;kn>=0&&(bt=te[ae[kn]],!!(bt&l));kn--);for(var $t=hn+1;$t<ae.length&&(Yt=te[ae[$t]],!!(Yt&l));$t++);bt===Yt&&(te[Pt]===D?bt===P:bt&(P|S))&&Ce(Pt,bt)}}if(pe.get(P))for(var vt=0;vt<ae.length;vt++){var Ot=ae[vt];if(te[Ot]&P){for(var jn=vt-1;jn>=0&&te[ae[jn]]&(U|l);jn--)Ce(ae[jn],P);for(vt++;vt<ae.length&&te[ae[vt]]&(U|l|P);vt++)te[ae[vt]]!==P&&Ce(ae[vt],P)}}if(pe.get(U)||pe.get(D)||pe.get(R))for(var fi=0;fi<ae.length;fi++){var Jn=ae[fi];if(te[Jn]&(U|D|R)){Ce(Jn,G);for(var Zn=fi-1;Zn>=0&&te[ae[Zn]]&l;Zn--)Ce(ae[Zn],G);for(var si=fi+1;si<ae.length&&te[ae[si]]&l;si++)Ce(ae[si],G)}}if(pe.get(P))for(var Hi=0,xr=Me;Hi<ae.length;Hi++){var gs=ae[Hi],Ir=te[gs];Ir&P?xr===I&&Ce(gs,I):Ir&r&&(xr=Ir)}if(pe.get(s)){var ar=k|P|S,ka=ar|I,Vi=[];{for(var lr=[],Br=0;Br<ae.length;Br++)if(te[ae[Br]]&s){var Sr=ke[ae[Br]],ms=void 0;if(C(Sr)!==null)if(lr.length<63)lr.push({char:Sr,seqIndex:Br});else break;else if((ms=x(Sr))!==null)for(var Zr=lr.length-1;Zr>=0;Zr--){var kr=lr[Zr].char;if(kr===ms||kr===x(B(Sr))||C(B(kr))===Sr){Vi.push([lr[Zr].seqIndex,Br]),lr.length=Zr;break}}}Vi.sort(function(qn,pi){return qn[0]-pi[0]})}for(var vs=0;vs<Vi.length;vs++){for(var bs=Vi[vs],$r=bs[0],ws=bs[1],Da=!1,Ai=0,ys=$r+1;ys<ws;ys++){var Ta=ae[ys];if(te[Ta]&ka){Da=!0;var To=te[Ta]&ar?k:I;if(To===ve){Ai=To;break}}}if(Da&&!Ai){Ai=Me;for(var cr=$r-1;cr>=0;cr--){var Ma=ae[cr];if(te[Ma]&ka){var Dr=te[Ma]&ar?k:I;Dr!==ve?Ai=Dr:Ai=ve;break}}}if(Ai){if(te[ae[$r]]=te[ae[ws]]=Ai,Ai!==ve){for(var eo=$r+1;eo<ae.length;eo++)if(!(te[ae[eo]]&l)){f(ke[ae[eo]])&Z&&(te[ae[eo]]=Ai);break}}if(Ai!==ve){for(var ur=ws+1;ur<ae.length;ur++)if(!(te[ae[ur]]&l)){f(ke[ae[ur]])&Z&&(te[ae[ur]]=Ai);break}}}}for(var Pi=0;Pi<ae.length;Pi++)if(te[ae[Pi]]&s){for(var Pa=Pi,_s=Pi,Cs=Me,to=Pi-1;to>=0;to--)if(te[ae[to]]&l)Pa=to;else{Cs=te[ae[to]]&ar?k:I;break}for(var Qa=ye,no=Pi+1;no<ae.length;no++)if(te[ae[no]]&(s|l))_s=no;else{Qa=te[ae[no]]&ar?k:I;break}for(var Es=Pa;Es<=_s;Es++)te[ae[Es]]=Cs===Qa?Cs:ve;Pi=_s}}}for(var $n=xe.start;$n<=xe.end;$n++){var yc=ge[$n],Mo=te[$n];if(yc&1?Mo&(I|P|S)&&ge[$n]++:Mo&k?ge[$n]++:Mo&(S|P)&&(ge[$n]+=2),Mo&l&&(ge[$n]=$n===0?xe.level:ge[$n-1]),$n===xe.end||f(ke[$n])&(O|Q))for(var Po=$n;Po>=0&&f(ke[Po])&c;Po--)ge[Po]=xe.level}}return{levels:ge,paragraphs:de};function Ra(qn,pi){for(var Qn=qn;Qn<ke.length;Qn++){var ji=te[Qn];if(ji&(k|Y))return 1;if(ji&(Q|I)||pi&&ji===se)return 0;if(ji&t){var Ua=_c(Qn);Qn=Ua===-1?ke.length:Ua}}return 0}function _c(qn){for(var pi=1,Qn=qn+1;Qn<ke.length;Qn++){var ji=te[Qn];if(ji&Q)break;if(ji&se){if(--pi===0)return Qn}else ji&t&&pi++}return-1}}var be="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",oe;function ue(){if(!oe){var ke=b(be,!0),He=ke.map,he=ke.reverseMap;he.forEach(function(te,Ee){He.set(Ee,te)}),oe=He}}function We(ke){return ue(),oe.get(ke)||null}function Te(ke,He,he,te){var Ee=ke.length;he=Math.max(0,he==null?0:+he),te=Math.min(Ee-1,te==null?Ee-1:+te);for(var pe=new Map,Ce=he;Ce<=te;Ce++)if(He[Ce]&1){var ge=We(ke[Ce]);ge!==null&&pe.set(Ce,ge)}return pe}function Se(ke,He,he,te){var Ee=ke.length;he=Math.max(0,he==null?0:+he),te=Math.min(Ee-1,te==null?Ee-1:+te);var pe=[];return He.paragraphs.forEach(function(Ce){var ge=Math.max(he,Ce.start),Je=Math.min(te,Ce.end);if(ge<Je){for(var de=He.levels.slice(ge,Je+1),xe=Je;xe>=ge&&f(ke[xe])&c;xe--)de[xe]=Ce.level;for(var Ie=Ce.level,Oe=1/0,it=0;it<de.length;it++){var pt=de[it];pt>Ie&&(Ie=pt),pt<Oe&&(Oe=pt|1)}for(var Pe=Ie;Pe>=Oe;Pe--)for(var Ze=0;Ze<de.length;Ze++)if(de[Ze]>=Pe){for(var we=Ze;Ze+1<de.length&&de[Ze+1]>=Pe;)Ze++;Ze>we&&pe.push([we+ge,Ze+ge])}}}),pe}function Be(ke,He,he,te){var Ee=Ue(ke,He,he,te),pe=[].concat(ke);return Ee.forEach(function(Ce,ge){pe[ge]=(He.levels[Ce]&1?We(ke[Ce]):null)||ke[Ce]}),pe.join("")}function Ue(ke,He,he,te){for(var Ee=Se(ke,He,he,te),pe=[],Ce=0;Ce<ke.length;Ce++)pe[Ce]=Ce;return Ee.forEach(function(ge){for(var Je=ge[0],de=ge[1],xe=pe.slice(Je,de+1),Ie=xe.length;Ie--;)pe[de-Ie]=xe[Ie]}),pe}return e.closingToOpeningBracket=x,e.getBidiCharType=f,e.getBidiCharTypeName=p,e.getCanonicalBracket=B,e.getEmbeddingLevels=_e,e.getMirroredCharacter=We,e.getMirroredCharactersMap=Te,e.getReorderSegments=Se,e.getReorderedIndices=Ue,e.getReorderedString=Be,e.openingToClosingBracket=C,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return o}const qg=/\bvoid\s+main\s*\(\s*\)\s*{/g;function _h(o){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function i(a,n){let t=xn[n];return t?_h(t):a}return o.replace(e,i)}const Ln=[];for(let o=0;o<256;o++)Ln[o]=(o<16?"0":"")+o.toString(16);function eE(){const o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,a=Math.random()*4294967295|0;return(Ln[o&255]+Ln[o>>8&255]+Ln[o>>16&255]+Ln[o>>24&255]+"-"+Ln[e&255]+Ln[e>>8&255]+"-"+Ln[e>>16&15|64]+Ln[e>>24&255]+"-"+Ln[i&63|128]+Ln[i>>8&255]+"-"+Ln[i>>16&255]+Ln[i>>24&255]+Ln[a&255]+Ln[a>>8&255]+Ln[a>>16&255]+Ln[a>>24&255]).toUpperCase()}const vo=Object.assign||function(){let o=arguments[0];for(let e=1,i=arguments.length;e<i;e++){let a=arguments[e];if(a)for(let n in a)Object.prototype.hasOwnProperty.call(a,n)&&(o[n]=a[n])}return o},tE=Date.now(),LA=new WeakMap,OA=new Map;let nE=1e10;function Ch(o,e){const i=sE(e);let a=LA.get(o);if(a||LA.set(o,a=Object.create(null)),a[i])return new a[i];const n=`_onBeforeCompile${i}`,t=function(c,h){o.onBeforeCompile.call(this,c,h);const d=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let f=OA[d];if(!f){const p=iE(this,c,e,i);f=OA[d]=p}c.vertexShader=f.vertexShader,c.fragmentShader=f.fragmentShader,vo(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-tE}}),this[n]&&this[n](c)},r=function(){return s(e.chained?o:o.clone())},s=function(c){const h=Object.create(c,l);return Object.defineProperty(h,"baseMaterial",{value:o}),Object.defineProperty(h,"id",{value:nE++}),h.uuid=eE(),h.uniforms=vo({},c.uniforms,e.uniforms),h.defines=vo({},c.defines,e.defines),h.defines[`TROIKA_DERIVED_MATERIAL_${i}`]="",h.extensions=vo({},c.extensions,e.extensions),h._listeners=void 0,h},l={constructor:{value:r},isDerivedMaterial:{value:!0},type:{get:()=>o.type,set:c=>{o.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const h=this.baseMaterial;return c===h||h.isDerivedMaterial&&h.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return o.customProgramCacheKey()+"|"+i}},onBeforeCompile:{get(){return t},set(c){this[n]=c}},copy:{writable:!0,configurable:!0,value:function(c){return o.copy.call(this,c),!o.isShaderMaterial&&!o.isDerivedMaterial&&(vo(this.extensions,c.extensions),vo(this.defines,c.defines),vo(this.uniforms,hs.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new o.constructor;return s(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=Ch(o.isDerivedMaterial?o.getDepthMaterial():new sc({depthPacking:nc}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=Ch(o.isDerivedMaterial?o.getDistanceMaterial():new Vh,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:h}=this;c&&c.dispose(),h&&h.dispose(),o.dispose.call(this)}}};return a[i]=r,new r}function iE(o,{vertexShader:e,fragmentShader:i},a,n){let{vertexDefs:t,vertexMainIntro:r,vertexMainOutro:s,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:h,fragmentMainOutro:d,fragmentColorTransform:f,customRewriter:p,timeUniform:m}=a;if(t=t||"",r=r||"",s=s||"",c=c||"",h=h||"",d=d||"",(l||p)&&(e=_h(e)),(f||p)&&(i=i.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),i=_h(i)),p){let b=p({vertexShader:e,fragmentShader:i});e=b.vertexShader,i=b.fragmentShader}if(f){let b=[];i=i.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,v=>(b.push(v),"")),d=`${f}
${b.join(`
`)}
${d}`}if(m){const b=`
uniform float ${m};
`;t=b+t,c=b+c}return l&&(e=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${e}
`,t=`${t}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,r=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${r}
`,e=e.replace(/\b(position|normal|uv)\b/g,(b,v,y,E)=>/\battribute\s+vec[23]\s+$/.test(E.substr(0,y))?v:`troika_${v}_${n}`),o.map&&o.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),e=GA(e,n,t,r,s),i=GA(i,n,c,h,d),{vertexShader:e,fragmentShader:i}}function GA(o,e,i,a,n){return(a||n||i)&&(o=o.replace(qg,`
${i}
void troikaOrigMain${e}() {`),o+=`
void main() {
  ${a}
  troikaOrigMain${e}();
  ${n}
}`),o}function rE(o,e){return o==="uniforms"?void 0:typeof e=="function"?e.toString():e}let oE=0;const NA=new Map;function sE(o){const e=JSON.stringify(o,rE);let i=NA.get(e);return i==null&&NA.set(e,i=++oE),i}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function aE(){return typeof window>"u"&&(self.window=self),function(o){var e={parse:function(n){var t=e._bin,r=new Uint8Array(n);if(t.readASCII(r,0,4)=="ttcf"){var s=4;t.readUshort(r,s),s+=2,t.readUshort(r,s),s+=2;var l=t.readUint(r,s);s+=4;for(var c=[],h=0;h<l;h++){var d=t.readUint(r,s);s+=4,c.push(e._readFont(r,d))}return c}return[e._readFont(r,0)]},_readFont:function(n,t){var r=e._bin,s=t;r.readFixed(n,t),t+=4;var l=r.readUshort(n,t);t+=2,r.readUshort(n,t),t+=2,r.readUshort(n,t),t+=2,r.readUshort(n,t),t+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],h={_data:n,_offset:s},d={},f=0;f<l;f++){var p=r.readASCII(n,t,4);t+=4,r.readUint(n,t),t+=4;var m=r.readUint(n,t);t+=4;var b=r.readUint(n,t);t+=4,d[p]={offset:m,length:b}}for(f=0;f<c.length;f++){var v=c[f];d[v]&&(h[v.trim()]=e[v.trim()].parse(n,d[v].offset,d[v].length,h))}return h},_tabOffset:function(n,t,r){for(var s=e._bin,l=s.readUshort(n,r+4),c=r+12,h=0;h<l;h++){var d=s.readASCII(n,c,4);c+=4,s.readUint(n,c),c+=4;var f=s.readUint(n,c);if(c+=4,s.readUint(n,c),c+=4,d==t)return f}return 0}};e._bin={readFixed:function(n,t){return(n[t]<<8|n[t+1])+(n[t+2]<<8|n[t+3])/65540},readF2dot14:function(n,t){return e._bin.readShort(n,t)/16384},readInt:function(n,t){return e._bin._view(n).getInt32(t)},readInt8:function(n,t){return e._bin._view(n).getInt8(t)},readShort:function(n,t){return e._bin._view(n).getInt16(t)},readUshort:function(n,t){return e._bin._view(n).getUint16(t)},readUshorts:function(n,t,r){for(var s=[],l=0;l<r;l++)s.push(e._bin.readUshort(n,t+2*l));return s},readUint:function(n,t){return e._bin._view(n).getUint32(t)},readUint64:function(n,t){return 4294967296*e._bin.readUint(n,t)+e._bin.readUint(n,t+4)},readASCII:function(n,t,r){for(var s="",l=0;l<r;l++)s+=String.fromCharCode(n[t+l]);return s},readUnicode:function(n,t,r){for(var s="",l=0;l<r;l++){var c=n[t++]<<8|n[t++];s+=String.fromCharCode(c)}return s},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(n,t,r){var s=e._bin._tdec;return s&&t==0&&r==n.length?s.decode(n):e._bin.readASCII(n,t,r)},readBytes:function(n,t,r){for(var s=[],l=0;l<r;l++)s.push(n[t+l]);return s},readASCIIArray:function(n,t,r){for(var s=[],l=0;l<r;l++)s.push(String.fromCharCode(n[t+l]));return s},_view:function(n){return n._dataView||(n._dataView=n.buffer?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(new Uint8Array(n).buffer))}},e._lctf={},e._lctf.parse=function(n,t,r,s,l){var c=e._bin,h={},d=t;c.readFixed(n,t),t+=4;var f=c.readUshort(n,t);t+=2;var p=c.readUshort(n,t);t+=2;var m=c.readUshort(n,t);return t+=2,h.scriptList=e._lctf.readScriptList(n,d+f),h.featureList=e._lctf.readFeatureList(n,d+p),h.lookupList=e._lctf.readLookupList(n,d+m,l),h},e._lctf.readLookupList=function(n,t,r){var s=e._bin,l=t,c=[],h=s.readUshort(n,t);t+=2;for(var d=0;d<h;d++){var f=s.readUshort(n,t);t+=2;var p=e._lctf.readLookupTable(n,l+f,r);c.push(p)}return c},e._lctf.readLookupTable=function(n,t,r){var s=e._bin,l=t,c={tabs:[]};c.ltype=s.readUshort(n,t),t+=2,c.flag=s.readUshort(n,t),t+=2;var h=s.readUshort(n,t);t+=2;for(var d=c.ltype,f=0;f<h;f++){var p=s.readUshort(n,t);t+=2;var m=r(n,d,l+p,c);c.tabs.push(m)}return c},e._lctf.numOfOnes=function(n){for(var t=0,r=0;r<32;r++)n>>>r&1&&t++;return t},e._lctf.readClassDef=function(n,t){var r=e._bin,s=[],l=r.readUshort(n,t);if(t+=2,l==1){var c=r.readUshort(n,t);t+=2;var h=r.readUshort(n,t);t+=2;for(var d=0;d<h;d++)s.push(c+d),s.push(c+d),s.push(r.readUshort(n,t)),t+=2}if(l==2){var f=r.readUshort(n,t);for(t+=2,d=0;d<f;d++)s.push(r.readUshort(n,t)),t+=2,s.push(r.readUshort(n,t)),t+=2,s.push(r.readUshort(n,t)),t+=2}return s},e._lctf.getInterval=function(n,t){for(var r=0;r<n.length;r+=3){var s=n[r],l=n[r+1];if(n[r+2],s<=t&&t<=l)return r}return-1},e._lctf.readCoverage=function(n,t){var r=e._bin,s={};s.fmt=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);return t+=2,s.fmt==1&&(s.tab=r.readUshorts(n,t,l)),s.fmt==2&&(s.tab=r.readUshorts(n,t,3*l)),s},e._lctf.coverageIndex=function(n,t){var r=n.tab;if(n.fmt==1)return r.indexOf(t);if(n.fmt==2){var s=e._lctf.getInterval(r,t);if(s!=-1)return r[s+2]+(t-r[s])}return-1},e._lctf.readFeatureList=function(n,t){var r=e._bin,s=t,l=[],c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=r.readASCII(n,t,4);t+=4;var f=r.readUshort(n,t);t+=2;var p=e._lctf.readFeatureTable(n,s+f);p.tag=d.trim(),l.push(p)}return l},e._lctf.readFeatureTable=function(n,t){var r=e._bin,s=t,l={},c=r.readUshort(n,t);t+=2,c>0&&(l.featureParams=s+c);var h=r.readUshort(n,t);t+=2,l.tab=[];for(var d=0;d<h;d++)l.tab.push(r.readUshort(n,t+2*d));return l},e._lctf.readScriptList=function(n,t){var r=e._bin,s=t,l={},c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=r.readASCII(n,t,4);t+=4;var f=r.readUshort(n,t);t+=2,l[d.trim()]=e._lctf.readScriptTable(n,s+f)}return l},e._lctf.readScriptTable=function(n,t){var r=e._bin,s=t,l={},c=r.readUshort(n,t);t+=2,c>0&&(l.default=e._lctf.readLangSysTable(n,s+c));var h=r.readUshort(n,t);t+=2;for(var d=0;d<h;d++){var f=r.readASCII(n,t,4);t+=4;var p=r.readUshort(n,t);t+=2,l[f.trim()]=e._lctf.readLangSysTable(n,s+p)}return l},e._lctf.readLangSysTable=function(n,t){var r=e._bin,s={};r.readUshort(n,t),t+=2,s.reqFeature=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);return t+=2,s.features=r.readUshorts(n,t,l),s},e.CFF={},e.CFF.parse=function(n,t,r){var s=e._bin;(n=new Uint8Array(n.buffer,t,r))[t=0],n[++t],n[++t],n[++t],t++;var l=[];t=e.CFF.readIndex(n,t,l);for(var c=[],h=0;h<l.length-1;h++)c.push(s.readASCII(n,t+l[h],l[h+1]-l[h]));t+=l[l.length-1];var d=[];t=e.CFF.readIndex(n,t,d);var f=[];for(h=0;h<d.length-1;h++)f.push(e.CFF.readDict(n,t+d[h],t+d[h+1]));t+=d[d.length-1];var p=f[0],m=[];t=e.CFF.readIndex(n,t,m);var b=[];for(h=0;h<m.length-1;h++)b.push(s.readASCII(n,t+m[h],m[h+1]-m[h]));if(t+=m[m.length-1],e.CFF.readSubrs(n,t,p),p.CharStrings){t=p.CharStrings,m=[],t=e.CFF.readIndex(n,t,m);var v=[];for(h=0;h<m.length-1;h++)v.push(s.readBytes(n,t+m[h],m[h+1]-m[h]));p.CharStrings=v}if(p.ROS){t=p.FDArray;var y=[];for(t=e.CFF.readIndex(n,t,y),p.FDArray=[],h=0;h<y.length-1;h++){var E=e.CFF.readDict(n,t+y[h],t+y[h+1]);e.CFF._readFDict(n,E,b),p.FDArray.push(E)}t+=y[y.length-1],t=p.FDSelect,p.FDSelect=[];var _=n[t];if(t++,_!=3)throw _;var C=s.readUshort(n,t);for(t+=2,h=0;h<C+1;h++)p.FDSelect.push(s.readUshort(n,t),n[t+2]),t+=3}return p.Encoding&&(p.Encoding=e.CFF.readEncoding(n,p.Encoding,p.CharStrings.length)),p.charset&&(p.charset=e.CFF.readCharset(n,p.charset,p.CharStrings.length)),e.CFF._readFDict(n,p,b),p},e.CFF._readFDict=function(n,t,r){var s;for(var l in t.Private&&(s=t.Private[1],t.Private=e.CFF.readDict(n,s,s+t.Private[0]),t.Private.Subrs&&e.CFF.readSubrs(n,s+t.Private.Subrs,t.Private)),t)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(t[l]=r[t[l]-426+35])},e.CFF.readSubrs=function(n,t,r){var s=e._bin,l=[];t=e.CFF.readIndex(n,t,l);var c,h=l.length;c=h<1240?107:h<33900?1131:32768,r.Bias=c,r.Subrs=[];for(var d=0;d<l.length-1;d++)r.Subrs.push(s.readBytes(n,t+l[d],l[d+1]-l[d]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(n,t){for(var r=0;r<n.charset.length;r++)if(n.charset[r]==t)return r;return-1},e.CFF.glyphBySE=function(n,t){return t<0||t>255?-1:e.CFF.glyphByUnicode(n,e.CFF.tableSE[t])},e.CFF.readEncoding=function(n,t,r){e._bin;var s=[".notdef"],l=n[t];if(t++,l!=0)throw"error: unknown encoding format: "+l;var c=n[t];t++;for(var h=0;h<c;h++)s.push(n[t+h]);return s},e.CFF.readCharset=function(n,t,r){var s=e._bin,l=[".notdef"],c=n[t];if(t++,c==0)for(var h=0;h<r;h++){var d=s.readUshort(n,t);t+=2,l.push(d)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<r;){d=s.readUshort(n,t),t+=2;var f=0;for(c==1?(f=n[t],t++):(f=s.readUshort(n,t),t+=2),h=0;h<=f;h++)l.push(d),d++}}return l},e.CFF.readIndex=function(n,t,r){var s=e._bin,l=s.readUshort(n,t)+1,c=n[t+=2];if(t++,c==1)for(var h=0;h<l;h++)r.push(n[t+h]);else if(c==2)for(h=0;h<l;h++)r.push(s.readUshort(n,t+2*h));else if(c==3)for(h=0;h<l;h++)r.push(16777215&s.readUint(n,t+3*h-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(t+=l*c)-1},e.CFF.getCharString=function(n,t,r){var s=e._bin,l=n[t],c=n[t+1];n[t+2],n[t+3],n[t+4];var h=1,d=null,f=null;l<=20&&(d=l,h=1),l==12&&(d=100*l+c,h=2),21<=l&&l<=27&&(d=l,h=1),l==28&&(f=s.readShort(n,t+1),h=3),29<=l&&l<=31&&(d=l,h=1),32<=l&&l<=246&&(f=l-139,h=1),247<=l&&l<=250&&(f=256*(l-247)+c+108,h=2),251<=l&&l<=254&&(f=256*-(l-251)-c-108,h=2),l==255&&(f=s.readInt(n,t+1)/65535,h=5),r.val=f??"o"+d,r.size=h},e.CFF.readCharString=function(n,t,r){for(var s=t+r,l=e._bin,c=[];t<s;){var h=n[t],d=n[t+1];n[t+2],n[t+3],n[t+4];var f=1,p=null,m=null;h<=20&&(p=h,f=1),h==12&&(p=100*h+d,f=2),h!=19&&h!=20||(p=h,f=2),21<=h&&h<=27&&(p=h,f=1),h==28&&(m=l.readShort(n,t+1),f=3),29<=h&&h<=31&&(p=h,f=1),32<=h&&h<=246&&(m=h-139,f=1),247<=h&&h<=250&&(m=256*(h-247)+d+108,f=2),251<=h&&h<=254&&(m=256*-(h-251)-d-108,f=2),h==255&&(m=l.readInt(n,t+1)/65535,f=5),c.push(m??"o"+p),t+=f}return c},e.CFF.readDict=function(n,t,r){for(var s=e._bin,l={},c=[];t<r;){var h=n[t],d=n[t+1];n[t+2],n[t+3],n[t+4];var f=1,p=null,m=null;if(h==28&&(m=s.readShort(n,t+1),f=3),h==29&&(m=s.readInt(n,t+1),f=5),32<=h&&h<=246&&(m=h-139,f=1),247<=h&&h<=250&&(m=256*(h-247)+d+108,f=2),251<=h&&h<=254&&(m=256*-(h-251)-d-108,f=2),h==255)throw m=s.readInt(n,t+1)/65535,f=5,"unknown number";if(h==30){var b=[];for(f=1;;){var v=n[t+f];f++;var y=v>>4,E=15&v;if(y!=15&&b.push(y),E!=15&&b.push(E),E==15)break}for(var _="",C=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],x=0;x<b.length;x++)_+=C[b[x]];m=parseFloat(_)}h<=21&&(p=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][h],f=1,h==12&&(p=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][d],f=2)),p!=null?(l[p]=c.length==1?c[0]:c,c=[]):c.push(m),t+=f}return l},e.cmap={},e.cmap.parse=function(n,t,r){n=new Uint8Array(n.buffer,t,r),t=0;var s=e._bin,l={};s.readUshort(n,t),t+=2;var c=s.readUshort(n,t);t+=2;var h=[];l.tables=[];for(var d=0;d<c;d++){var f=s.readUshort(n,t);t+=2;var p=s.readUshort(n,t);t+=2;var m=s.readUint(n,t);t+=4;var b="p"+f+"e"+p,v=h.indexOf(m);if(v==-1){var y;v=l.tables.length,h.push(m);var E=s.readUshort(n,m);E==0?y=e.cmap.parse0(n,m):E==4?y=e.cmap.parse4(n,m):E==6?y=e.cmap.parse6(n,m):E==12?y=e.cmap.parse12(n,m):console.debug("unknown format: "+E,f,p,m),l.tables.push(y)}if(l[b]!=null)throw"multiple tables for one platform+encoding";l[b]=v}return l},e.cmap.parse0=function(n,t){var r=e._bin,s={};s.format=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);t+=2,r.readUshort(n,t),t+=2,s.map=[];for(var c=0;c<l-6;c++)s.map.push(n[t+c]);return s},e.cmap.parse4=function(n,t){var r=e._bin,s=t,l={};l.format=r.readUshort(n,t),t+=2;var c=r.readUshort(n,t);t+=2,r.readUshort(n,t),t+=2;var h=r.readUshort(n,t);t+=2;var d=h/2;l.searchRange=r.readUshort(n,t),t+=2,l.entrySelector=r.readUshort(n,t),t+=2,l.rangeShift=r.readUshort(n,t),t+=2,l.endCount=r.readUshorts(n,t,d),t+=2*d,t+=2,l.startCount=r.readUshorts(n,t,d),t+=2*d,l.idDelta=[];for(var f=0;f<d;f++)l.idDelta.push(r.readShort(n,t)),t+=2;for(l.idRangeOffset=r.readUshorts(n,t,d),t+=2*d,l.glyphIdArray=[];t<s+c;)l.glyphIdArray.push(r.readUshort(n,t)),t+=2;return l},e.cmap.parse6=function(n,t){var r=e._bin,s={};s.format=r.readUshort(n,t),t+=2,r.readUshort(n,t),t+=2,r.readUshort(n,t),t+=2,s.firstCode=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);t+=2,s.glyphIdArray=[];for(var c=0;c<l;c++)s.glyphIdArray.push(r.readUshort(n,t)),t+=2;return s},e.cmap.parse12=function(n,t){var r=e._bin,s={};s.format=r.readUshort(n,t),t+=2,t+=2,r.readUint(n,t),t+=4,r.readUint(n,t),t+=4;var l=r.readUint(n,t);t+=4,s.groups=[];for(var c=0;c<l;c++){var h=t+12*c,d=r.readUint(n,h+0),f=r.readUint(n,h+4),p=r.readUint(n,h+8);s.groups.push([d,f,p])}return s},e.glyf={},e.glyf.parse=function(n,t,r,s){for(var l=[],c=0;c<s.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(n,t){var r=e._bin,s=n._data,l=e._tabOffset(s,"glyf",n._offset)+n.loca[t];if(n.loca[t]==n.loca[t+1])return null;var c={};if(c.noc=r.readShort(s,l),l+=2,c.xMin=r.readShort(s,l),l+=2,c.yMin=r.readShort(s,l),l+=2,c.xMax=r.readShort(s,l),l+=2,c.yMax=r.readShort(s,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var h=0;h<c.noc;h++)c.endPts.push(r.readUshort(s,l)),l+=2;var d=r.readUshort(s,l);if(l+=2,s.length-l<d)return null;c.instructions=r.readBytes(s,l,d),l+=d;var f=c.endPts[c.noc-1]+1;for(c.flags=[],h=0;h<f;h++){var p=s[l];if(l++,c.flags.push(p),(8&p)!=0){var m=s[l];l++;for(var b=0;b<m;b++)c.flags.push(p),h++}}for(c.xs=[],h=0;h<f;h++){var v=(2&c.flags[h])!=0,y=(16&c.flags[h])!=0;v?(c.xs.push(y?s[l]:-s[l]),l++):y?c.xs.push(0):(c.xs.push(r.readShort(s,l)),l+=2)}for(c.ys=[],h=0;h<f;h++)v=(4&c.flags[h])!=0,y=(32&c.flags[h])!=0,v?(c.ys.push(y?s[l]:-s[l]),l++):y?c.ys.push(0):(c.ys.push(r.readShort(s,l)),l+=2);var E=0,_=0;for(h=0;h<f;h++)E+=c.xs[h],_+=c.ys[h],c.xs[h]=E,c.ys[h]=_}else{var C;c.parts=[];do{C=r.readUshort(s,l),l+=2;var x={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(x),x.glyphIndex=r.readUshort(s,l),l+=2,1&C){var B=r.readShort(s,l);l+=2;var I=r.readShort(s,l);l+=2}else B=r.readInt8(s,l),l++,I=r.readInt8(s,l),l++;2&C?(x.m.tx=B,x.m.ty=I):(x.p1=B,x.p2=I),8&C?(x.m.a=x.m.d=r.readF2dot14(s,l),l+=2):64&C?(x.m.a=r.readF2dot14(s,l),l+=2,x.m.d=r.readF2dot14(s,l),l+=2):128&C&&(x.m.a=r.readF2dot14(s,l),l+=2,x.m.b=r.readF2dot14(s,l),l+=2,x.m.c=r.readF2dot14(s,l),l+=2,x.m.d=r.readF2dot14(s,l),l+=2)}while(32&C);if(256&C){var k=r.readUshort(s,l);for(l+=2,c.instr=[],h=0;h<k;h++)c.instr.push(s[l]),l++}}return c},e.GDEF={},e.GDEF.parse=function(n,t,r,s){var l=t;t+=4;var c=e._bin.readUshort(n,t);return{glyphClassDef:c===0?null:e._lctf.readClassDef(n,l+c)}},e.GPOS={},e.GPOS.parse=function(n,t,r,s){return e._lctf.parse(n,t,r,s,e.GPOS.subt)},e.GPOS.subt=function(n,t,r,s){var l=e._bin,c=r,h={};if(h.fmt=l.readUshort(n,r),r+=2,t==1||t==2||t==3||t==7||t==8&&h.fmt<=2){var d=l.readUshort(n,r);r+=2,h.coverage=e._lctf.readCoverage(n,d+c)}if(t==1&&h.fmt==1){var f=l.readUshort(n,r);r+=2,f!=0&&(h.pos=e.GPOS.readValueRecord(n,r,f))}else if(t==2&&h.fmt>=1&&h.fmt<=2){f=l.readUshort(n,r),r+=2;var p=l.readUshort(n,r);r+=2;var m=e._lctf.numOfOnes(f),b=e._lctf.numOfOnes(p);if(h.fmt==1){h.pairsets=[];var v=l.readUshort(n,r);r+=2;for(var y=0;y<v;y++){var E=c+l.readUshort(n,r);r+=2;var _=l.readUshort(n,E);E+=2;for(var C=[],x=0;x<_;x++){var B=l.readUshort(n,E);E+=2,f!=0&&(S=e.GPOS.readValueRecord(n,E,f),E+=2*m),p!=0&&(R=e.GPOS.readValueRecord(n,E,p),E+=2*b),C.push({gid2:B,val1:S,val2:R})}h.pairsets.push(C)}}if(h.fmt==2){var I=l.readUshort(n,r);r+=2;var k=l.readUshort(n,r);r+=2;var P=l.readUshort(n,r);r+=2;var D=l.readUshort(n,r);for(r+=2,h.classDef1=e._lctf.readClassDef(n,c+I),h.classDef2=e._lctf.readClassDef(n,c+k),h.matrix=[],y=0;y<P;y++){var U=[];for(x=0;x<D;x++){var S=null,R=null;f!=0&&(S=e.GPOS.readValueRecord(n,r,f),r+=2*m),p!=0&&(R=e.GPOS.readValueRecord(n,r,p),r+=2*b),U.push({val1:S,val2:R})}h.matrix.push(U)}}}else if(t==4&&h.fmt==1)h.markCoverage=e._lctf.readCoverage(n,l.readUshort(n,r)+c),h.baseCoverage=e._lctf.readCoverage(n,l.readUshort(n,r+2)+c),h.markClassCount=l.readUshort(n,r+4),h.markArray=e.GPOS.readMarkArray(n,l.readUshort(n,r+6)+c),h.baseArray=e.GPOS.readBaseArray(n,l.readUshort(n,r+8)+c,h.markClassCount);else if(t==6&&h.fmt==1)h.mark1Coverage=e._lctf.readCoverage(n,l.readUshort(n,r)+c),h.mark2Coverage=e._lctf.readCoverage(n,l.readUshort(n,r+2)+c),h.markClassCount=l.readUshort(n,r+4),h.mark1Array=e.GPOS.readMarkArray(n,l.readUshort(n,r+6)+c),h.mark2Array=e.GPOS.readBaseArray(n,l.readUshort(n,r+8)+c,h.markClassCount);else{if(t==9&&h.fmt==1){var Q=l.readUshort(n,r);r+=2;var O=l.readUint(n,r);if(r+=4,s.ltype==9)s.ltype=Q;else if(s.ltype!=Q)throw"invalid extension substitution";return e.GPOS.subt(n,s.ltype,c+O)}console.debug("unsupported GPOS table LookupType",t,"format",h.fmt)}return h},e.GPOS.readValueRecord=function(n,t,r){var s=e._bin,l=[];return l.push(1&r?s.readShort(n,t):0),t+=1&r?2:0,l.push(2&r?s.readShort(n,t):0),t+=2&r?2:0,l.push(4&r?s.readShort(n,t):0),t+=4&r?2:0,l.push(8&r?s.readShort(n,t):0),t+=8&r?2:0,l},e.GPOS.readBaseArray=function(n,t,r){var s=e._bin,l=[],c=t,h=s.readUshort(n,t);t+=2;for(var d=0;d<h;d++){for(var f=[],p=0;p<r;p++)f.push(e.GPOS.readAnchorRecord(n,c+s.readUshort(n,t))),t+=2;l.push(f)}return l},e.GPOS.readMarkArray=function(n,t){var r=e._bin,s=[],l=t,c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=e.GPOS.readAnchorRecord(n,r.readUshort(n,t+2)+l);d.markClass=r.readUshort(n,t),s.push(d),t+=4}return s},e.GPOS.readAnchorRecord=function(n,t){var r=e._bin,s={};return s.fmt=r.readUshort(n,t),s.x=r.readShort(n,t+2),s.y=r.readShort(n,t+4),s},e.GSUB={},e.GSUB.parse=function(n,t,r,s){return e._lctf.parse(n,t,r,s,e.GSUB.subt)},e.GSUB.subt=function(n,t,r,s){var l=e._bin,c=r,h={};if(h.fmt=l.readUshort(n,r),r+=2,t!=1&&t!=2&&t!=4&&t!=5&&t!=6)return null;if(t==1||t==2||t==4||t==5&&h.fmt<=2||t==6&&h.fmt<=2){var d=l.readUshort(n,r);r+=2,h.coverage=e._lctf.readCoverage(n,c+d)}if(t==1&&h.fmt>=1&&h.fmt<=2){if(h.fmt==1)h.delta=l.readShort(n,r),r+=2;else if(h.fmt==2){var f=l.readUshort(n,r);r+=2,h.newg=l.readUshorts(n,r,f),r+=2*h.newg.length}}else if(t==2&&h.fmt==1){f=l.readUshort(n,r),r+=2,h.seqs=[];for(var p=0;p<f;p++){var m=l.readUshort(n,r)+c;r+=2;var b=l.readUshort(n,m);h.seqs.push(l.readUshorts(n,m+2,b))}}else if(t==4)for(h.vals=[],f=l.readUshort(n,r),r+=2,p=0;p<f;p++){var v=l.readUshort(n,r);r+=2,h.vals.push(e.GSUB.readLigatureSet(n,c+v))}else if(t==5&&h.fmt==2){if(h.fmt==2){var y=l.readUshort(n,r);r+=2,h.cDef=e._lctf.readClassDef(n,c+y),h.scset=[];var E=l.readUshort(n,r);for(r+=2,p=0;p<E;p++){var _=l.readUshort(n,r);r+=2,h.scset.push(_==0?null:e.GSUB.readSubClassSet(n,c+_))}}}else if(t==6&&h.fmt==3){if(h.fmt==3){for(p=0;p<3;p++){f=l.readUshort(n,r),r+=2;for(var C=[],x=0;x<f;x++)C.push(e._lctf.readCoverage(n,c+l.readUshort(n,r+2*x)));r+=2*f,p==0&&(h.backCvg=C),p==1&&(h.inptCvg=C),p==2&&(h.ahedCvg=C)}f=l.readUshort(n,r),r+=2,h.lookupRec=e.GSUB.readSubstLookupRecords(n,r,f)}}else{if(t==7&&h.fmt==1){var B=l.readUshort(n,r);r+=2;var I=l.readUint(n,r);if(r+=4,s.ltype==9)s.ltype=B;else if(s.ltype!=B)throw"invalid extension substitution";return e.GSUB.subt(n,s.ltype,c+I)}console.debug("unsupported GSUB table LookupType",t,"format",h.fmt)}return h},e.GSUB.readSubClassSet=function(n,t){var r=e._bin.readUshort,s=t,l=[],c=r(n,t);t+=2;for(var h=0;h<c;h++){var d=r(n,t);t+=2,l.push(e.GSUB.readSubClassRule(n,s+d))}return l},e.GSUB.readSubClassRule=function(n,t){var r=e._bin.readUshort,s={},l=r(n,t),c=r(n,t+=2);t+=2,s.input=[];for(var h=0;h<l-1;h++)s.input.push(r(n,t)),t+=2;return s.substLookupRecords=e.GSUB.readSubstLookupRecords(n,t,c),s},e.GSUB.readSubstLookupRecords=function(n,t,r){for(var s=e._bin.readUshort,l=[],c=0;c<r;c++)l.push(s(n,t),s(n,t+2)),t+=4;return l},e.GSUB.readChainSubClassSet=function(n,t){var r=e._bin,s=t,l=[],c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=r.readUshort(n,t);t+=2,l.push(e.GSUB.readChainSubClassRule(n,s+d))}return l},e.GSUB.readChainSubClassRule=function(n,t){for(var r=e._bin,s={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var h=r.readUshort(n,t);t+=2,c==1&&h--,s[l[c]]=r.readUshorts(n,t,h),t+=2*s[l[c]].length}return h=r.readUshort(n,t),t+=2,s.subst=r.readUshorts(n,t,2*h),t+=2*s.subst.length,s},e.GSUB.readLigatureSet=function(n,t){var r=e._bin,s=t,l=[],c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=r.readUshort(n,t);t+=2,l.push(e.GSUB.readLigature(n,s+d))}return l},e.GSUB.readLigature=function(n,t){var r=e._bin,s={chain:[]};s.nglyph=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);t+=2;for(var c=0;c<l-1;c++)s.chain.push(r.readUshort(n,t)),t+=2;return s},e.head={},e.head.parse=function(n,t,r){var s=e._bin,l={};return s.readFixed(n,t),t+=4,l.fontRevision=s.readFixed(n,t),t+=4,s.readUint(n,t),t+=4,s.readUint(n,t),t+=4,l.flags=s.readUshort(n,t),t+=2,l.unitsPerEm=s.readUshort(n,t),t+=2,l.created=s.readUint64(n,t),t+=8,l.modified=s.readUint64(n,t),t+=8,l.xMin=s.readShort(n,t),t+=2,l.yMin=s.readShort(n,t),t+=2,l.xMax=s.readShort(n,t),t+=2,l.yMax=s.readShort(n,t),t+=2,l.macStyle=s.readUshort(n,t),t+=2,l.lowestRecPPEM=s.readUshort(n,t),t+=2,l.fontDirectionHint=s.readShort(n,t),t+=2,l.indexToLocFormat=s.readShort(n,t),t+=2,l.glyphDataFormat=s.readShort(n,t),t+=2,l},e.hhea={},e.hhea.parse=function(n,t,r){var s=e._bin,l={};return s.readFixed(n,t),t+=4,l.ascender=s.readShort(n,t),t+=2,l.descender=s.readShort(n,t),t+=2,l.lineGap=s.readShort(n,t),t+=2,l.advanceWidthMax=s.readUshort(n,t),t+=2,l.minLeftSideBearing=s.readShort(n,t),t+=2,l.minRightSideBearing=s.readShort(n,t),t+=2,l.xMaxExtent=s.readShort(n,t),t+=2,l.caretSlopeRise=s.readShort(n,t),t+=2,l.caretSlopeRun=s.readShort(n,t),t+=2,l.caretOffset=s.readShort(n,t),t+=2,t+=8,l.metricDataFormat=s.readShort(n,t),t+=2,l.numberOfHMetrics=s.readUshort(n,t),t+=2,l},e.hmtx={},e.hmtx.parse=function(n,t,r,s){for(var l=e._bin,c={aWidth:[],lsBearing:[]},h=0,d=0,f=0;f<s.maxp.numGlyphs;f++)f<s.hhea.numberOfHMetrics&&(h=l.readUshort(n,t),t+=2,d=l.readShort(n,t),t+=2),c.aWidth.push(h),c.lsBearing.push(d);return c},e.kern={},e.kern.parse=function(n,t,r,s){var l=e._bin,c=l.readUshort(n,t);if(t+=2,c==1)return e.kern.parseV1(n,t-2,r,s);var h=l.readUshort(n,t);t+=2;for(var d={glyph1:[],rval:[]},f=0;f<h;f++){t+=2,r=l.readUshort(n,t),t+=2;var p=l.readUshort(n,t);t+=2;var m=p>>>8;if((m&=15)!=0)throw"unknown kern table format: "+m;t=e.kern.readFormat0(n,t,d)}return d},e.kern.parseV1=function(n,t,r,s){var l=e._bin;l.readFixed(n,t),t+=4;var c=l.readUint(n,t);t+=4;for(var h={glyph1:[],rval:[]},d=0;d<c;d++){l.readUint(n,t),t+=4;var f=l.readUshort(n,t);t+=2,l.readUshort(n,t),t+=2;var p=f>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;t=e.kern.readFormat0(n,t,h)}return h},e.kern.readFormat0=function(n,t,r){var s=e._bin,l=-1,c=s.readUshort(n,t);t+=2,s.readUshort(n,t),t+=2,s.readUshort(n,t),t+=2,s.readUshort(n,t),t+=2;for(var h=0;h<c;h++){var d=s.readUshort(n,t);t+=2;var f=s.readUshort(n,t);t+=2;var p=s.readShort(n,t);t+=2,d!=l&&(r.glyph1.push(d),r.rval.push({glyph2:[],vals:[]}));var m=r.rval[r.rval.length-1];m.glyph2.push(f),m.vals.push(p),l=d}return t},e.loca={},e.loca.parse=function(n,t,r,s){var l=e._bin,c=[],h=s.head.indexToLocFormat,d=s.maxp.numGlyphs+1;if(h==0)for(var f=0;f<d;f++)c.push(l.readUshort(n,t+(f<<1))<<1);if(h==1)for(f=0;f<d;f++)c.push(l.readUint(n,t+(f<<2)));return c},e.maxp={},e.maxp.parse=function(n,t,r){var s=e._bin,l={},c=s.readUint(n,t);return t+=4,l.numGlyphs=s.readUshort(n,t),t+=2,c==65536&&(l.maxPoints=s.readUshort(n,t),t+=2,l.maxContours=s.readUshort(n,t),t+=2,l.maxCompositePoints=s.readUshort(n,t),t+=2,l.maxCompositeContours=s.readUshort(n,t),t+=2,l.maxZones=s.readUshort(n,t),t+=2,l.maxTwilightPoints=s.readUshort(n,t),t+=2,l.maxStorage=s.readUshort(n,t),t+=2,l.maxFunctionDefs=s.readUshort(n,t),t+=2,l.maxInstructionDefs=s.readUshort(n,t),t+=2,l.maxStackElements=s.readUshort(n,t),t+=2,l.maxSizeOfInstructions=s.readUshort(n,t),t+=2,l.maxComponentElements=s.readUshort(n,t),t+=2,l.maxComponentDepth=s.readUshort(n,t),t+=2),l},e.name={},e.name.parse=function(n,t,r){var s=e._bin,l={};s.readUshort(n,t),t+=2;var c=s.readUshort(n,t);t+=2,s.readUshort(n,t);for(var h,d=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=t+=2,p=0;p<c;p++){var m=s.readUshort(n,t);t+=2;var b=s.readUshort(n,t);t+=2;var v=s.readUshort(n,t);t+=2;var y=s.readUshort(n,t);t+=2;var E=s.readUshort(n,t);t+=2;var _=s.readUshort(n,t);t+=2;var C,x=d[y],B=f+12*c+_;if(m==0)C=s.readUnicode(n,B,E/2);else if(m==3&&b==0)C=s.readUnicode(n,B,E/2);else if(b==0)C=s.readASCII(n,B,E);else if(b==1)C=s.readUnicode(n,B,E/2);else if(b==3)C=s.readUnicode(n,B,E/2);else{if(m!=1)throw"unknown encoding "+b+", platformID: "+m;C=s.readASCII(n,B,E),console.debug("reading unknown MAC encoding "+b+" as ASCII")}var I="p"+m+","+v.toString(16);l[I]==null&&(l[I]={}),l[I][x!==void 0?x:y]=C,l[I]._lang=v}for(var k in l)if(l[k].postScriptName!=null&&l[k]._lang==1033)return l[k];for(var k in l)if(l[k].postScriptName!=null&&l[k]._lang==0)return l[k];for(var k in l)if(l[k].postScriptName!=null&&l[k]._lang==3084)return l[k];for(var k in l)if(l[k].postScriptName!=null)return l[k];for(var k in l){h=k;break}return console.debug("returning name table with languageID "+l[h]._lang),l[h]},e["OS/2"]={},e["OS/2"].parse=function(n,t,r){var s=e._bin.readUshort(n,t);t+=2;var l={};if(s==0)e["OS/2"].version0(n,t,l);else if(s==1)e["OS/2"].version1(n,t,l);else if(s==2||s==3||s==4)e["OS/2"].version2(n,t,l);else{if(s!=5)throw"unknown OS/2 table version: "+s;e["OS/2"].version5(n,t,l)}return l},e["OS/2"].version0=function(n,t,r){var s=e._bin;return r.xAvgCharWidth=s.readShort(n,t),t+=2,r.usWeightClass=s.readUshort(n,t),t+=2,r.usWidthClass=s.readUshort(n,t),t+=2,r.fsType=s.readUshort(n,t),t+=2,r.ySubscriptXSize=s.readShort(n,t),t+=2,r.ySubscriptYSize=s.readShort(n,t),t+=2,r.ySubscriptXOffset=s.readShort(n,t),t+=2,r.ySubscriptYOffset=s.readShort(n,t),t+=2,r.ySuperscriptXSize=s.readShort(n,t),t+=2,r.ySuperscriptYSize=s.readShort(n,t),t+=2,r.ySuperscriptXOffset=s.readShort(n,t),t+=2,r.ySuperscriptYOffset=s.readShort(n,t),t+=2,r.yStrikeoutSize=s.readShort(n,t),t+=2,r.yStrikeoutPosition=s.readShort(n,t),t+=2,r.sFamilyClass=s.readShort(n,t),t+=2,r.panose=s.readBytes(n,t,10),t+=10,r.ulUnicodeRange1=s.readUint(n,t),t+=4,r.ulUnicodeRange2=s.readUint(n,t),t+=4,r.ulUnicodeRange3=s.readUint(n,t),t+=4,r.ulUnicodeRange4=s.readUint(n,t),t+=4,r.achVendID=[s.readInt8(n,t),s.readInt8(n,t+1),s.readInt8(n,t+2),s.readInt8(n,t+3)],t+=4,r.fsSelection=s.readUshort(n,t),t+=2,r.usFirstCharIndex=s.readUshort(n,t),t+=2,r.usLastCharIndex=s.readUshort(n,t),t+=2,r.sTypoAscender=s.readShort(n,t),t+=2,r.sTypoDescender=s.readShort(n,t),t+=2,r.sTypoLineGap=s.readShort(n,t),t+=2,r.usWinAscent=s.readUshort(n,t),t+=2,r.usWinDescent=s.readUshort(n,t),t+=2},e["OS/2"].version1=function(n,t,r){var s=e._bin;return t=e["OS/2"].version0(n,t,r),r.ulCodePageRange1=s.readUint(n,t),t+=4,r.ulCodePageRange2=s.readUint(n,t),t+=4},e["OS/2"].version2=function(n,t,r){var s=e._bin;return t=e["OS/2"].version1(n,t,r),r.sxHeight=s.readShort(n,t),t+=2,r.sCapHeight=s.readShort(n,t),t+=2,r.usDefault=s.readUshort(n,t),t+=2,r.usBreak=s.readUshort(n,t),t+=2,r.usMaxContext=s.readUshort(n,t),t+=2},e["OS/2"].version5=function(n,t,r){var s=e._bin;return t=e["OS/2"].version2(n,t,r),r.usLowerOpticalPointSize=s.readUshort(n,t),t+=2,r.usUpperOpticalPointSize=s.readUshort(n,t),t+=2},e.post={},e.post.parse=function(n,t,r){var s=e._bin,l={};return l.version=s.readFixed(n,t),t+=4,l.italicAngle=s.readFixed(n,t),t+=4,l.underlinePosition=s.readShort(n,t),t+=2,l.underlineThickness=s.readShort(n,t),t+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(n,t){var r=n.cmap,s=-1;if(r.p0e4!=null?s=r.p0e4:r.p3e1!=null?s=r.p3e1:r.p1e0!=null?s=r.p1e0:r.p0e3!=null&&(s=r.p0e3),s==-1)throw"no familiar platform and encoding!";var l=r.tables[s];if(l.format==0)return t>=l.map.length?0:l.map[t];if(l.format==4){for(var c=-1,h=0;h<l.endCount.length;h++)if(t<=l.endCount[h]){c=h;break}return c==-1||l.startCount[c]>t?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[t-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:t+l.idDelta[c])}if(l.format==12){if(t>l.groups[l.groups.length-1][1])return 0;for(h=0;h<l.groups.length;h++){var d=l.groups[h];if(d[0]<=t&&t<=d[1])return d[2]+(t-d[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(n,t){var r={cmds:[],crds:[]};if(n.SVG&&n.SVG.entries[t]){var s=n.SVG.entries[t];return s==null?r:(typeof s=="string"&&(s=e.SVG.toPath(s),n.SVG.entries[t]=s),s)}if(n.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:n.CFF.Private?n.CFF.Private.defaultWidthX:0,open:!1},c=n.CFF,h=n.CFF.Private;if(c.ROS){for(var d=0;c.FDSelect[d+2]<=t;)d+=2;h=c.FDArray[c.FDSelect[d+1]].Private}e.U._drawCFF(n.CFF.CharStrings[t],l,c,h,r)}else n.glyf&&e.U._drawGlyf(t,n,r);return r},e.U._drawGlyf=function(n,t,r){var s=t.glyf[n];s==null&&(s=t.glyf[n]=e.glyf._parseGlyf(t,n)),s!=null&&(s.noc>-1?e.U._simpleGlyph(s,r):e.U._compoGlyph(s,t,r))},e.U._simpleGlyph=function(n,t){for(var r=0;r<n.noc;r++){for(var s=r==0?0:n.endPts[r-1]+1,l=n.endPts[r],c=s;c<=l;c++){var h=c==s?l:c-1,d=c==l?s:c+1,f=1&n.flags[c],p=1&n.flags[h],m=1&n.flags[d],b=n.xs[c],v=n.ys[c];if(c==s)if(f){if(!p){e.U.P.moveTo(t,b,v);continue}e.U.P.moveTo(t,n.xs[h],n.ys[h])}else p?e.U.P.moveTo(t,n.xs[h],n.ys[h]):e.U.P.moveTo(t,(n.xs[h]+b)/2,(n.ys[h]+v)/2);f?p&&e.U.P.lineTo(t,b,v):m?e.U.P.qcurveTo(t,b,v,n.xs[d],n.ys[d]):e.U.P.qcurveTo(t,b,v,(b+n.xs[d])/2,(v+n.ys[d])/2)}e.U.P.closePath(t)}},e.U._compoGlyph=function(n,t,r){for(var s=0;s<n.parts.length;s++){var l={cmds:[],crds:[]},c=n.parts[s];e.U._drawGlyf(c.glyphIndex,t,l);for(var h=c.m,d=0;d<l.crds.length;d+=2){var f=l.crds[d],p=l.crds[d+1];r.crds.push(f*h.a+p*h.b+h.tx),r.crds.push(f*h.c+p*h.d+h.ty)}for(d=0;d<l.cmds.length;d++)r.cmds.push(l.cmds[d])}},e.U._getGlyphClass=function(n,t){var r=e._lctf.getInterval(t,n);return r==-1?0:t[r+2]},e.U._applySubs=function(n,t,r,s){for(var l=n.length-t-1,c=0;c<r.tabs.length;c++)if(r.tabs[c]!=null){var h,d=r.tabs[c];if(!d.coverage||(h=e._lctf.coverageIndex(d.coverage,n[t]))!=-1){if(r.ltype==1)n[t],d.fmt==1?n[t]=n[t]+d.delta:n[t]=d.newg[h];else if(r.ltype==4)for(var f=d.vals[h],p=0;p<f.length;p++){var m=f[p],b=m.chain.length;if(!(b>l)){for(var v=!0,y=0,E=0;E<b;E++){for(;n[t+y+(1+E)]==-1;)y++;m.chain[E]!=n[t+y+(1+E)]&&(v=!1)}if(v){for(n[t]=m.nglyph,E=0;E<b+y;E++)n[t+E+1]=-1;break}}}else if(r.ltype==5&&d.fmt==2)for(var _=e._lctf.getInterval(d.cDef,n[t]),C=d.cDef[_+2],x=d.scset[C],B=0;B<x.length;B++){var I=x[B],k=I.input;if(!(k.length>l)){for(v=!0,E=0;E<k.length;E++){var P=e._lctf.getInterval(d.cDef,n[t+1+E]);if(_==-1&&d.cDef[P+2]!=k[E]){v=!1;break}}if(v){var D=I.substLookupRecords;for(p=0;p<D.length;p+=2)D[p],D[p+1]}}}else if(r.ltype==6&&d.fmt==3){if(!e.U._glsCovered(n,d.backCvg,t-d.backCvg.length)||!e.U._glsCovered(n,d.inptCvg,t)||!e.U._glsCovered(n,d.ahedCvg,t+d.inptCvg.length))continue;var U=d.lookupRec;for(B=0;B<U.length;B+=2){_=U[B];var S=s[U[B+1]];e.U._applySubs(n,t+_,S,s)}}}}},e.U._glsCovered=function(n,t,r){for(var s=0;s<t.length;s++)if(e._lctf.coverageIndex(t[s],n[r+s])==-1)return!1;return!0},e.U.glyphsToPath=function(n,t,r){for(var s={cmds:[],crds:[]},l=0,c=0;c<t.length;c++){var h=t[c];if(h!=-1){for(var d=c<t.length-1&&t[c+1]!=-1?t[c+1]:0,f=e.U.glyphToPath(n,h),p=0;p<f.crds.length;p+=2)s.crds.push(f.crds[p]+l),s.crds.push(f.crds[p+1]);for(r&&s.cmds.push(r),p=0;p<f.cmds.length;p++)s.cmds.push(f.cmds[p]);r&&s.cmds.push("X"),l+=n.hmtx.aWidth[h],c<t.length-1&&(l+=e.U.getPairAdjustment(n,h,d))}}return s},e.U.P={},e.U.P.moveTo=function(n,t,r){n.cmds.push("M"),n.crds.push(t,r)},e.U.P.lineTo=function(n,t,r){n.cmds.push("L"),n.crds.push(t,r)},e.U.P.curveTo=function(n,t,r,s,l,c,h){n.cmds.push("C"),n.crds.push(t,r,s,l,c,h)},e.U.P.qcurveTo=function(n,t,r,s,l){n.cmds.push("Q"),n.crds.push(t,r,s,l)},e.U.P.closePath=function(n){n.cmds.push("Z")},e.U._drawCFF=function(n,t,r,s,l){for(var c=t.stack,h=t.nStems,d=t.haveWidth,f=t.width,p=t.open,m=0,b=t.x,v=t.y,y=0,E=0,_=0,C=0,x=0,B=0,I=0,k=0,P=0,D=0,U={val:0,size:0};m<n.length;){e.CFF.getCharString(n,m,U);var S=U.val;if(m+=U.size,S=="o1"||S=="o18")c.length%2!=0&&!d&&(f=c.shift()+s.nominalWidthX),h+=c.length>>1,c.length=0,d=!0;else if(S=="o3"||S=="o23")c.length%2!=0&&!d&&(f=c.shift()+s.nominalWidthX),h+=c.length>>1,c.length=0,d=!0;else if(S=="o4")c.length>1&&!d&&(f=c.shift()+s.nominalWidthX,d=!0),p&&e.U.P.closePath(l),v+=c.pop(),e.U.P.moveTo(l,b,v),p=!0;else if(S=="o5")for(;c.length>0;)b+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,b,v);else if(S=="o6"||S=="o7")for(var R=c.length,Q=S=="o6",O=0;O<R;O++){var G=c.shift();Q?b+=G:v+=G,Q=!Q,e.U.P.lineTo(l,b,v)}else if(S=="o8"||S=="o24"){R=c.length;for(var q=0;q+6<=R;)y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),b=_+c.shift(),v=C+c.shift(),e.U.P.curveTo(l,y,E,_,C,b,v),q+=6;S=="o24"&&(b+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,b,v))}else{if(S=="o11")break;if(S=="o1234"||S=="o1235"||S=="o1236"||S=="o1237")S=="o1234"&&(E=v,_=(y=b+c.shift())+c.shift(),D=C=E+c.shift(),B=C,k=v,b=(I=(x=(P=_+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,y,E,_,C,P,D),e.U.P.curveTo(l,x,B,I,k,b,v)),S=="o1235"&&(y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),P=_+c.shift(),D=C+c.shift(),x=P+c.shift(),B=D+c.shift(),I=x+c.shift(),k=B+c.shift(),b=I+c.shift(),v=k+c.shift(),c.shift(),e.U.P.curveTo(l,y,E,_,C,P,D),e.U.P.curveTo(l,x,B,I,k,b,v)),S=="o1236"&&(y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),D=C=E+c.shift(),B=C,I=(x=(P=_+c.shift())+c.shift())+c.shift(),k=B+c.shift(),b=I+c.shift(),e.U.P.curveTo(l,y,E,_,C,P,D),e.U.P.curveTo(l,x,B,I,k,b,v)),S=="o1237"&&(y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),P=_+c.shift(),D=C+c.shift(),x=P+c.shift(),B=D+c.shift(),I=x+c.shift(),k=B+c.shift(),Math.abs(I-b)>Math.abs(k-v)?b=I+c.shift():v=k+c.shift(),e.U.P.curveTo(l,y,E,_,C,P,D),e.U.P.curveTo(l,x,B,I,k,b,v));else if(S=="o14"){if(c.length>0&&!d&&(f=c.shift()+r.nominalWidthX,d=!0),c.length==4){var Z=c.shift(),Y=c.shift(),j=c.shift(),L=c.shift(),N=e.CFF.glyphBySE(r,j),V=e.CFF.glyphBySE(r,L);e.U._drawCFF(r.CharStrings[N],t,r,s,l),t.x=Z,t.y=Y,e.U._drawCFF(r.CharStrings[V],t,r,s,l)}p&&(e.U.P.closePath(l),p=!1)}else if(S=="o19"||S=="o20")c.length%2!=0&&!d&&(f=c.shift()+s.nominalWidthX),h+=c.length>>1,c.length=0,d=!0,m+=h+7>>3;else if(S=="o21")c.length>2&&!d&&(f=c.shift()+s.nominalWidthX,d=!0),v+=c.pop(),b+=c.pop(),p&&e.U.P.closePath(l),e.U.P.moveTo(l,b,v),p=!0;else if(S=="o22")c.length>1&&!d&&(f=c.shift()+s.nominalWidthX,d=!0),b+=c.pop(),p&&e.U.P.closePath(l),e.U.P.moveTo(l,b,v),p=!0;else if(S=="o25"){for(;c.length>6;)b+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,b,v);y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),b=_+c.shift(),v=C+c.shift(),e.U.P.curveTo(l,y,E,_,C,b,v)}else if(S=="o26")for(c.length%2&&(b+=c.shift());c.length>0;)y=b,E=v+c.shift(),b=_=y+c.shift(),v=(C=E+c.shift())+c.shift(),e.U.P.curveTo(l,y,E,_,C,b,v);else if(S=="o27")for(c.length%2&&(v+=c.shift());c.length>0;)E=v,_=(y=b+c.shift())+c.shift(),C=E+c.shift(),b=_+c.shift(),v=C,e.U.P.curveTo(l,y,E,_,C,b,v);else if(S=="o10"||S=="o29"){var J=S=="o10"?s:r;if(c.length==0)console.debug("error: empty stack");else{var X=c.pop(),$=J.Subrs[X+J.Bias];t.x=b,t.y=v,t.nStems=h,t.haveWidth=d,t.width=f,t.open=p,e.U._drawCFF($,t,r,s,l),b=t.x,v=t.y,h=t.nStems,d=t.haveWidth,f=t.width,p=t.open}}else if(S=="o30"||S=="o31"){var ne=c.length,se=(q=0,S=="o31");for(q+=ne-(R=-3&ne);q<R;)se?(E=v,_=(y=b+c.shift())+c.shift(),v=(C=E+c.shift())+c.shift(),R-q==5?(b=_+c.shift(),q++):b=_,se=!1):(y=b,E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),b=_+c.shift(),R-q==5?(v=C+c.shift(),q++):v=C,se=!0),e.U.P.curveTo(l,y,E,_,C,b,v),q+=4}else{if((S+"").charAt(0)=="o")throw console.debug("Unknown operation: "+S,n),S;c.push(S)}}}t.x=b,t.y=v,t.nStems=h,t.haveWidth=d,t.width=f,t.open=p};var i=e,a={Typr:i};return o.Typr=i,o.default=a,Object.defineProperty(o,"__esModule",{value:!0}),o}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function lE(){return function(o){var e=Uint8Array,i=Uint16Array,a=Uint32Array,n=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),t=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),r=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(S,R){for(var Q=new i(31),O=0;O<31;++O)Q[O]=R+=1<<S[O-1];var G=new a(Q[30]);for(O=1;O<30;++O)for(var q=Q[O];q<Q[O+1];++q)G[q]=q-Q[O]<<5|O;return[Q,G]},l=s(n,2),c=l[0],h=l[1];c[28]=258,h[258]=28;for(var d=s(t,0)[0],f=new i(32768),p=0;p<32768;++p){var m=(43690&p)>>>1|(21845&p)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,f[p]=((65280&m)>>>8|(255&m)<<8)>>>1}var b=function(S,R,Q){for(var O=S.length,G=0,q=new i(R);G<O;++G)++q[S[G]-1];var Z,Y=new i(R);for(G=0;G<R;++G)Y[G]=Y[G-1]+q[G-1]<<1;{Z=new i(1<<R);var j=15-R;for(G=0;G<O;++G)if(S[G])for(var L=G<<4|S[G],N=R-S[G],V=Y[S[G]-1]++<<N,J=V|(1<<N)-1;V<=J;++V)Z[f[V]>>>j]=L}return Z},v=new e(288);for(p=0;p<144;++p)v[p]=8;for(p=144;p<256;++p)v[p]=9;for(p=256;p<280;++p)v[p]=7;for(p=280;p<288;++p)v[p]=8;var y=new e(32);for(p=0;p<32;++p)y[p]=5;var E=b(v,9),_=b(y,5),C=function(S){for(var R=S[0],Q=1;Q<S.length;++Q)S[Q]>R&&(R=S[Q]);return R},x=function(S,R,Q){var O=R/8|0;return(S[O]|S[O+1]<<8)>>(7&R)&Q},B=function(S,R){var Q=R/8|0;return(S[Q]|S[Q+1]<<8|S[Q+2]<<16)>>(7&R)},I=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],k=function(S,R,Q){var O=new Error(R||I[S]);if(O.code=S,Error.captureStackTrace&&Error.captureStackTrace(O,k),!Q)throw O;return O},P=function(S,R,Q){var O=S.length;if(!O||Q&&!Q.l&&O<5)return R||new e(0);var G=!R||Q,q=!Q||Q.i;Q||(Q={}),R||(R=new e(3*O));var Z,Y=function(we){var ot=R.length;if(we>ot){var $e=new e(Math.max(2*ot,we));$e.set(R),R=$e}},j=Q.f||0,L=Q.p||0,N=Q.b||0,V=Q.l,J=Q.d,X=Q.m,$=Q.n,ne=8*O;do{if(!V){Q.f=j=x(S,L,1);var se=x(S,L+1,3);if(L+=3,!se){var _e=S[(he=((Z=L)/8|0)+(7&Z&&1)+4)-4]|S[he-3]<<8,be=he+_e;if(be>O){q&&k(0);break}G&&Y(N+_e),R.set(S.subarray(he,be),N),Q.b=N+=_e,Q.p=L=8*be;continue}if(se==1)V=E,J=_,X=9,$=5;else if(se==2){var oe=x(S,L,31)+257,ue=x(S,L+10,15)+4,We=oe+x(S,L+5,31)+1;L+=14;for(var Te=new e(We),Se=new e(19),Be=0;Be<ue;++Be)Se[r[Be]]=x(S,L+3*Be,7);L+=3*ue;var Ue=C(Se),ke=(1<<Ue)-1,He=b(Se,Ue);for(Be=0;Be<We;){var he,te=He[x(S,L,ke)];if(L+=15&te,(he=te>>>4)<16)Te[Be++]=he;else{var Ee=0,pe=0;for(he==16?(pe=3+x(S,L,3),L+=2,Ee=Te[Be-1]):he==17?(pe=3+x(S,L,7),L+=3):he==18&&(pe=11+x(S,L,127),L+=7);pe--;)Te[Be++]=Ee}}var Ce=Te.subarray(0,oe),ge=Te.subarray(oe);X=C(Ce),$=C(ge),V=b(Ce,X),J=b(ge,$)}else k(1);if(L>ne){q&&k(0);break}}G&&Y(N+131072);for(var Je=(1<<X)-1,de=(1<<$)-1,xe=L;;xe=L){var Ie=(Ee=V[B(S,L)&Je])>>>4;if((L+=15&Ee)>ne){q&&k(0);break}if(Ee||k(2),Ie<256)R[N++]=Ie;else{if(Ie==256){xe=L,V=null;break}var Oe=Ie-254;if(Ie>264){var it=n[Be=Ie-257];Oe=x(S,L,(1<<it)-1)+c[Be],L+=it}var pt=J[B(S,L)&de],Pe=pt>>>4;if(pt||k(3),L+=15&pt,ge=d[Pe],Pe>3&&(it=t[Pe],ge+=B(S,L)&(1<<it)-1,L+=it),L>ne){q&&k(0);break}G&&Y(N+131072);for(var Ze=N+Oe;N<Ze;N+=4)R[N]=R[N-ge],R[N+1]=R[N+1-ge],R[N+2]=R[N+2-ge],R[N+3]=R[N+3-ge];N=Ze}}Q.l=V,Q.p=xe,Q.b=N,V&&(j=1,Q.m=X,Q.d=J,Q.n=$)}while(!j);return N==R.length?R:function(we,ot,$e){($e==null||$e>we.length)&&($e=we.length);var dt=new(we instanceof i?i:we instanceof a?a:e)($e-ot);return dt.set(we.subarray(ot,$e)),dt}(R,0,N)},D=new e(0),U=typeof TextDecoder<"u"&&new TextDecoder;try{U.decode(D,{stream:!0})}catch{}return o.convert_streams=function(S){var R=new DataView(S),Q=0;function O(){var oe=R.getUint16(Q);return Q+=2,oe}function G(){var oe=R.getUint32(Q);return Q+=4,oe}function q(oe){_e.setUint16(be,oe),be+=2}function Z(oe){_e.setUint32(be,oe),be+=4}for(var Y={signature:G(),flavor:G(),length:G(),numTables:O(),reserved:O(),totalSfntSize:G(),majorVersion:O(),minorVersion:O(),metaOffset:G(),metaLength:G(),metaOrigLength:G(),privOffset:G(),privLength:G()},j=0;Math.pow(2,j)<=Y.numTables;)j++;j--;for(var L=16*Math.pow(2,j),N=16*Y.numTables-L,V=12,J=[],X=0;X<Y.numTables;X++)J.push({tag:G(),offset:G(),compLength:G(),origLength:G(),origChecksum:G()}),V+=16;var $,ne=new Uint8Array(12+16*J.length+J.reduce(function(oe,ue){return oe+ue.origLength+4},0)),se=ne.buffer,_e=new DataView(se),be=0;return Z(Y.flavor),q(Y.numTables),q(L),q(j),q(N),J.forEach(function(oe){Z(oe.tag),Z(oe.origChecksum),Z(V),Z(oe.origLength),oe.outOffset=V,(V+=oe.origLength)%4!=0&&(V+=4-V%4)}),J.forEach(function(oe){var ue,We=S.slice(oe.offset,oe.offset+oe.compLength);if(oe.compLength!=oe.origLength){var Te=new Uint8Array(oe.origLength);ue=new Uint8Array(We,2),P(ue,Te)}else Te=new Uint8Array(We);ne.set(Te,oe.outOffset);var Se=0;(V=oe.outOffset+oe.origLength)%4!=0&&(Se=4-V%4),ne.set(new Uint8Array(Se).buffer,oe.outOffset+oe.origLength),$=V+Se}),se.slice(0,$)},Object.defineProperty(o,"__esModule",{value:!0}),o}({}).convert_streams}function cE(o,e){const i={M:2,L:2,Q:4,C:6,Z:0},a={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},n=1,t=2,r=4,s=8,l=16,c=32;let h;function d(I){if(!h){const k={R:t,L:n,D:r,C:l,U:c,T:s};h=new Map;for(let P in a){let D=0;a[P].split(",").forEach(U=>{let[S,R]=U.split("+");S=parseInt(S,36),R=R?parseInt(R,36):0,h.set(D+=S,k[P]);for(let Q=R;Q--;)h.set(++D,k[P])})}}return h.get(I)||c}const f=1,p=2,m=3,b=4,v=[null,"isol","init","fina","medi"];function y(I){const k=new Uint8Array(I.length);let P=c,D=f,U=-1;for(let S=0;S<I.length;S++){const R=I.codePointAt(S);let Q=d(R)|0,O=f;Q&s||(P&(n|r|l)?Q&(t|r|l)?(O=m,(D===f||D===m)&&k[U]++):Q&(n|c)&&(D===p||D===b)&&k[U]--:P&(t|c)&&(D===p||D===b)&&k[U]--,D=k[S]=O,P=Q,U=S,R>65535&&S++)}return k}function E(I,k){const P=[];for(let U=0;U<k.length;U++){const S=k.codePointAt(U);S>65535&&U++,P.push(o.U.codeToGlyph(I,S))}const D=I.GSUB;if(D){const{lookupList:U,featureList:S}=D;let R;const Q=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,O=[];S.forEach(G=>{if(Q.test(G.tag))for(let q=0;q<G.tab.length;q++){if(O[G.tab[q]])continue;O[G.tab[q]]=!0;const Z=U[G.tab[q]],Y=/^(isol|init|fina|medi)$/.test(G.tag);Y&&!R&&(R=y(k));for(let j=0;j<P.length;j++)(!R||!Y||v[R[j]]===G.tag)&&o.U._applySubs(P,j,Z,U)}})}return P}function _(I,k){const P=new Int16Array(k.length*3);let D=0;for(;D<k.length;D++){const Q=k[D];if(Q===-1)continue;P[D*3+2]=I.hmtx.aWidth[Q];const O=I.GPOS;if(O){const G=O.lookupList;for(let q=0;q<G.length;q++){const Z=G[q];for(let Y=0;Y<Z.tabs.length;Y++){const j=Z.tabs[Y];if(Z.ltype===1){if(o._lctf.coverageIndex(j.coverage,Q)!==-1&&j.pos){R(j.pos,D);break}}else if(Z.ltype===2){let L=null,N=U();if(N!==-1){const V=o._lctf.coverageIndex(j.coverage,k[N]);if(V!==-1){if(j.fmt===1){const J=j.pairsets[V];for(let X=0;X<J.length;X++)J[X].gid2===Q&&(L=J[X])}else if(j.fmt===2){const J=o.U._getGlyphClass(k[N],j.classDef1),X=o.U._getGlyphClass(Q,j.classDef2);L=j.matrix[J][X]}if(L){L.val1&&R(L.val1,N),L.val2&&R(L.val2,D);break}}}}else if(Z.ltype===4){const L=o._lctf.coverageIndex(j.markCoverage,Q);if(L!==-1){const N=U(S),V=N===-1?-1:o._lctf.coverageIndex(j.baseCoverage,k[N]);if(V!==-1){const J=j.markArray[L],X=j.baseArray[V][J.markClass];P[D*3]=X.x-J.x+P[N*3]-P[N*3+2],P[D*3+1]=X.y-J.y+P[N*3+1];break}}}else if(Z.ltype===6){const L=o._lctf.coverageIndex(j.mark1Coverage,Q);if(L!==-1){const N=U();if(N!==-1){const V=k[N];if(C(I,V)===3){const J=o._lctf.coverageIndex(j.mark2Coverage,V);if(J!==-1){const X=j.mark1Array[L],$=j.mark2Array[J][X.markClass];P[D*3]=$.x-X.x+P[N*3]-P[N*3+2],P[D*3+1]=$.y-X.y+P[N*3+1];break}}}}}}}}else if(I.kern&&!I.cff){const G=U();if(G!==-1){const q=I.kern.glyph1.indexOf(k[G]);if(q!==-1){const Z=I.kern.rval[q].glyph2.indexOf(Q);Z!==-1&&(P[G*3+2]+=I.kern.rval[q].vals[Z])}}}}return P;function U(Q){for(let O=D-1;O>=0;O--)if(k[O]!==-1&&(!Q||Q(k[O])))return O;return-1}function S(Q){return C(I,Q)===1}function R(Q,O){for(let G=0;G<3;G++)P[O*3+G]+=Q[G]||0}}function C(I,k){const P=I.GDEF&&I.GDEF.glyphClassDef;return P?o.U._getGlyphClass(k,P):0}function x(...I){for(let k=0;k<I.length;k++)if(typeof I[k]=="number")return I[k]}function B(I){const k=Object.create(null),P=I["OS/2"],D=I.hhea,U=I.head.unitsPerEm,S=x(P&&P.sTypoAscender,D&&D.ascender,U),R={unitsPerEm:U,ascender:S,descender:x(P&&P.sTypoDescender,D&&D.descender,0),capHeight:x(P&&P.sCapHeight,S),xHeight:x(P&&P.sxHeight,S),lineGap:x(P&&P.sTypoLineGap,D&&D.lineGap),supportsCodePoint(Q){return o.U.codeToGlyph(I,Q)>0},forEachGlyph(Q,O,G,q){let Z=0;const Y=1/R.unitsPerEm*O,j=E(I,Q);let L=0;const N=_(I,j);return j.forEach((V,J)=>{if(V!==-1){let X=k[V];if(!X){const{cmds:$,crds:ne}=o.U.glyphToPath(I,V);let se="",_e=0;for(let Te=0,Se=$.length;Te<Se;Te++){const Be=i[$[Te]];se+=$[Te];for(let Ue=1;Ue<=Be;Ue++)se+=(Ue>1?",":"")+ne[_e++]}let be,oe,ue,We;if(ne.length){be=oe=1/0,ue=We=-1/0;for(let Te=0,Se=ne.length;Te<Se;Te+=2){let Be=ne[Te],Ue=ne[Te+1];Be<be&&(be=Be),Ue<oe&&(oe=Ue),Be>ue&&(ue=Be),Ue>We&&(We=Ue)}}else be=ue=oe=We=0;X=k[V]={index:V,advanceWidth:I.hmtx.aWidth[V],xMin:be,yMin:oe,xMax:ue,yMax:We,path:se}}q.call(null,X,Z+N[J*3]*Y,N[J*3+1]*Y,L),Z+=N[J*3+2]*Y,G&&(Z+=G*O)}L+=Q.codePointAt(L)>65535?2:1}),Z}};return R}return function(k){const P=new Uint8Array(k,0,4),D=o._bin.readASCII(P,0,4);if(D==="wOFF")k=e(k);else if(D==="wOF2")throw new Error("woff2 fonts not supported");return B(o.parse(k)[0])}}const uE=fs({name:"Typr Font Parser",dependencies:[aE,lE,cE],init(o,e,i){const a=o(),n=e();return i(a,n)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function hE(){return function(o){var e=function(){this.buckets=new Map};e.prototype.add=function(_){var C=_>>5;this.buckets.set(C,(this.buckets.get(C)||0)|1<<(31&_))},e.prototype.has=function(_){var C=this.buckets.get(_>>5);return C!==void 0&&(C&1<<(31&_))!=0},e.prototype.serialize=function(){var _=[];return this.buckets.forEach(function(C,x){_.push((+x).toString(36)+":"+C.toString(36))}),_.join(",")},e.prototype.deserialize=function(_){var C=this;this.buckets.clear(),_.split(",").forEach(function(x){var B=x.split(":");C.buckets.set(parseInt(B[0],36),parseInt(B[1],36))})};var i=Math.pow(2,8),a=i-1,n=~a;function t(_){var C=function(B){return B&n}(_).toString(16),x=function(B){return(B&n)+i-1}(_).toString(16);return"codepoint-index/plane"+(_>>16)+"/"+C+"-"+x+".json"}function r(_,C){var x=_&a,B=C.codePointAt(x/6|0);return((B=(B||48)-48)&1<<x%6)!=0}function s(_,C){var x;(x=_,x.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(B){return B.split("-").map(function(I){return parseInt(I.trim(),16)})})).forEach(function(B){var I=B[0],k=B[1];k===void 0&&(k=I),C(I,k)})}function l(_,C){s(_,function(x,B){for(var I=x;I<=B;I++)C(I)})}var c={},h={},d=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function p(_){var C=d.get(_);return C||(C=new e,l(_.ranges,function(x){return C.add(x)}),d.set(_,C)),C}var m,b=new Map;function v(_,C,x){return _[C]?C:_[x]?x:function(B){for(var I in B)return I}(_)}function y(_,C){var x=C;if(!_.includes(x)){x=1/0;for(var B=0;B<_.length;B++)Math.abs(_[B]-C)<Math.abs(x-C)&&(x=_[B])}return x}function E(_){return m||(m=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(C){m.add(C)})),m.has(_)}return o.CodePointSet=e,o.clearCache=function(){c={},h={}},o.getFontsForString=function(_,C){C===void 0&&(C={});var x,B=C.lang;B===void 0&&(B=new RegExp("\\p{Script=Hangul}","u").test(x=_)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(x)?"ja":"en");var I=C.category;I===void 0&&(I="sans-serif");var k=C.style;k===void 0&&(k="normal");var P=C.weight;P===void 0&&(P=400);var D=(C.dataUrl||f).replace(/\/$/g,""),U=new Map,S=new Uint8Array(_.length),R={},Q={},O=new Array(_.length),G=new Map,q=!1;function Z(L){var N=b.get(L);return N||(N=fetch(D+"/"+L).then(function(V){if(!V.ok)throw new Error(V.statusText);return V.json().then(function(J){if(!Array.isArray(J)||J[0]!==1)throw new Error("Incorrect schema version; need 1, got "+J[0]);return J[1]})}).catch(function(V){if(D!==f)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+D+'", trying default CDN. '+V.message),q=!0),D=f,b.delete(L),Z(L);throw V}),b.set(L,N)),N}for(var Y=function(L){var N=_.codePointAt(L),V=t(N);O[L]=V,c[V]||G.has(V)||G.set(V,Z(V).then(function(J){c[V]=J})),N>65535&&(L++,j=L)},j=0;j<_.length;j++)Y(j);return Promise.all(G.values()).then(function(){G.clear();for(var L=function(V){var J=_.codePointAt(V),X=null,$=c[O[V]],ne=void 0;for(var se in $){var _e=Q[se];if(_e===void 0&&(_e=Q[se]=new RegExp(se).test(B||"en")),_e){for(var be in ne=se,$[se])if(r(J,$[se][be])){X=be;break}break}}if(!X){e:for(var oe in $)if(oe!==ne){for(var ue in $[oe])if(r(J,$[oe][ue])){X=ue;break e}}}X||(console.debug("No font coverage for U+"+J.toString(16)),X="latin"),O[V]=X,h[X]||G.has(X)||G.set(X,Z("font-meta/"+X+".json").then(function(We){h[X]=We})),J>65535&&(V++,N=V)},N=0;N<_.length;N++)L(N);return Promise.all(G.values())}).then(function(){for(var L,N=null,V=0;V<_.length;V++){var J=_.codePointAt(V);if(N&&(E(J)||p(N).has(J)))S[V]=S[V-1];else{N=h[O[V]];var X=R[N.id];if(!X){var $=N.typeforms,ne=v($,I,"sans-serif"),se=v($[ne],k,"normal"),_e=y((L=$[ne])===null||L===void 0?void 0:L[se],P);X=R[N.id]=D+"/font-files/"+N.id+"/"+ne+"."+se+"."+_e+".woff"}var be=U.get(X);be==null&&(be=U.size,U.set(X,be)),S[V]=be}J>65535&&(V++,S[V]=S[V-1])}return{fontUrls:Array.from(U.keys()),chars:S}})},Object.defineProperty(o,"__esModule",{value:!0}),o}({})}function dE(o,e){const i=Object.create(null),a=Object.create(null);function n(r,s){const l=c=>{console.error(`Failure loading font ${r}`,c)};try{const c=new XMLHttpRequest;c.open("get",r,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)l(new Error(c.statusText));else if(c.status>0)try{const h=o(c.response);h.src=r,s(h)}catch(h){l(h)}},c.onerror=l,c.send()}catch(c){l(c)}}function t(r,s){let l=i[r];l?s(l):a[r]?a[r].push(s):(a[r]=[s],n(r,c=>{c.src=r,i[r]=c,a[r].forEach(h=>h(c)),delete a[r]}))}return function(r,s,{lang:l,fonts:c=[],style:h="normal",weight:d="normal",unicodeFontsURL:f}={}){const p=new Uint8Array(r.length),m=[];r.length||E();const b=new Map,v=[];if(h!=="italic"&&(h="normal"),typeof d!="number"&&(d=d==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(C=>!C.lang||C.lang.test(l)).reverse(),c.length){let I=0;(function k(P=0){for(let D=P,U=r.length;D<U;D++){const S=r.codePointAt(D);if(I===1&&m[p[D-1]].supportsCodePoint(S)||D>0&&/\s/.test(r[D]))p[D]=p[D-1],I===2&&(v[v.length-1][1]=D);else for(let R=p[D],Q=c.length;R<=Q;R++)if(R===Q){const O=I===2?v[v.length-1]:v[v.length]=[D,D];O[1]=D,I=2}else{p[D]=R;const{src:O,unicodeRange:G}=c[R];if(!G||_(S,G)){const q=i[O];if(!q){t(O,()=>{k(D)});return}if(q.supportsCodePoint(S)){let Z=b.get(q);typeof Z!="number"&&(Z=m.length,m.push(q),b.set(q,Z)),p[D]=Z,I=1;break}}}S>65535&&D+1<U&&(p[D+1]=p[D],D++,I===2&&(v[v.length-1][1]=D))}y()})()}else v.push([0,r.length-1]),y();function y(){if(v.length){const C=v.map(x=>r.substring(x[0],x[1]+1)).join(`
`);e.getFontsForString(C,{lang:l||void 0,style:h,weight:d,dataUrl:f}).then(({fontUrls:x,chars:B})=>{const I=m.length;let k=0;v.forEach(D=>{for(let U=0,S=D[1]-D[0];U<=S;U++)p[D[0]+U]=B[k++]+I;k++});let P=0;x.forEach((D,U)=>{t(D,S=>{m[U+I]=S,++P===x.length&&E()})})})}else E()}function E(){s({chars:p,fonts:m})}function _(C,x){for(let B=0;B<x.length;B++){const[I,k=I]=x[B];if(I<=C&&C<=k)return!0}return!1}}}const fE=fs({name:"FontResolver",dependencies:[dE,uE,hE],init(o,e,i){return o(e,i())}});function AE(o,e){const a=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",t=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function r({text:m,lang:b,fonts:v,style:y,weight:E,preResolvedFonts:_,unicodeFontsURL:C},x){const B=({chars:I,fonts:k})=>{let P,D;const U=[];for(let S=0;S<I.length;S++)I[S]!==D?(D=I[S],U.push(P={start:S,end:S,fontObj:k[I[S]]})):P.end=S;x(U)};_?B(_):o(m,B,{lang:b,fonts:v,style:y,weight:E,unicodeFontsURL:C})}function s({text:m="",font:b,lang:v,sdfGlyphSize:y=64,fontSize:E=400,fontWeight:_=1,fontStyle:C="normal",letterSpacing:x=0,lineHeight:B="normal",maxWidth:I=1/0,direction:k,textAlign:P="left",textIndent:D=0,whiteSpace:U="normal",overflowWrap:S="normal",anchorX:R=0,anchorY:Q=0,metricsOnly:O=!1,unicodeFontsURL:G,preResolvedFonts:q=null,includeCaretPositions:Z=!1,chunkedBoundsSize:Y=8192,colorRanges:j=null},L){const N=d(),V={fontLoad:0,typesetting:0};m.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),m=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),E=+E,x=+x,I=+I,B=B||"normal",D=+D,r({text:m,lang:v,style:C,weight:_,fonts:typeof b=="string"?[{src:b}]:b,unicodeFontsURL:G,preResolvedFonts:q},J=>{V.fontLoad=d()-N;const X=isFinite(I);let $=null,ne=null,se=null,_e=null,be=null,oe=null,ue=null,We=null,Te=0,Se=0,Be=U!=="nowrap";const Ue=new Map,ke=d();let He=D,he=0,te=new f;const Ee=[te];J.forEach(de=>{const{fontObj:xe}=de,{ascender:Ie,descender:Oe,unitsPerEm:it,lineGap:pt,capHeight:Pe,xHeight:Ze}=xe;let we=Ue.get(xe);if(!we){const ce=E/it,Ke=B==="normal"?(Ie-Oe+pt)*ce:B*E,un=(Ke-(Ie-Oe)*ce)/2,et=Math.min(Ke,(Ie-Oe)*ce),Ge=(Ie+Oe)/2*ce+et/2;we={index:Ue.size,src:xe.src,fontObj:xe,fontSizeMult:ce,unitsPerEm:it,ascender:Ie*ce,descender:Oe*ce,capHeight:Pe*ce,xHeight:Ze*ce,lineHeight:Ke,baseline:-un-Ie*ce,caretTop:Ge,caretBottom:Ge-et},Ue.set(xe,we)}const{fontSizeMult:ot}=we,$e=m.slice(de.start,de.end+1);let dt,gt;xe.forEachGlyph($e,E,x,(ce,Ke,un,et)=>{Ke+=he,et+=de.start,dt=Ke,gt=ce;const Ge=m.charAt(et),Bt=ce.advanceWidth*ot,mt=te.count;let Fe;if("isEmpty"in ce||(ce.isWhitespace=!!Ge&&new RegExp(n).test(Ge),ce.canBreakAfter=!!Ge&&t.test(Ge),ce.isEmpty=ce.xMin===ce.xMax||ce.yMin===ce.yMax||a.test(Ge)),!ce.isWhitespace&&!ce.isEmpty&&Se++,Be&&X&&!ce.isWhitespace&&Ke+Bt+He>I&&mt){if(te.glyphAt(mt-1).glyphObj.canBreakAfter)Fe=new f,He=-Ke;else for(let Tt=mt;Tt--;)if(Tt===0&&S==="break-word"){Fe=new f,He=-Ke;break}else if(te.glyphAt(Tt).glyphObj.canBreakAfter){Fe=te.splitAt(Tt+1);const _t=Fe.glyphAt(0).x;He-=_t;for(let Ct=Fe.count;Ct--;)Fe.glyphAt(Ct).x-=_t;break}Fe&&(te.isSoftWrapped=!0,te=Fe,Ee.push(te),Te=I)}let rt=te.glyphAt(te.count);rt.glyphObj=ce,rt.x=Ke+He,rt.y=un,rt.width=Bt,rt.charIndex=et,rt.fontData=we,Ge===`
`&&(te=new f,Ee.push(te),He=-(Ke+Bt+x*E)+D)}),he=dt+gt.advanceWidth*ot+x*E});let pe=0;Ee.forEach(de=>{let xe=!0;for(let Ie=de.count;Ie--;){const Oe=de.glyphAt(Ie);xe&&!Oe.glyphObj.isWhitespace&&(de.width=Oe.x+Oe.width,de.width>Te&&(Te=de.width),xe=!1);let{lineHeight:it,capHeight:pt,xHeight:Pe,baseline:Ze}=Oe.fontData;it>de.lineHeight&&(de.lineHeight=it);const we=Ze-de.baseline;we<0&&(de.baseline+=we,de.cap+=we,de.ex+=we),de.cap=Math.max(de.cap,de.baseline+pt),de.ex=Math.max(de.ex,de.baseline+Pe)}de.baseline-=pe,de.cap-=pe,de.ex-=pe,pe+=de.lineHeight});let Ce=0,ge=0;if(R&&(typeof R=="number"?Ce=-R:typeof R=="string"&&(Ce=-Te*(R==="left"?0:R==="center"?.5:R==="right"?1:c(R)))),Q&&(typeof Q=="number"?ge=-Q:typeof Q=="string"&&(ge=Q==="top"?0:Q==="top-baseline"?-Ee[0].baseline:Q==="top-cap"?-Ee[0].cap:Q==="top-ex"?-Ee[0].ex:Q==="middle"?pe/2:Q==="bottom"?pe:Q==="bottom-baseline"?-Ee[Ee.length-1].baseline:c(Q)*pe)),!O){const de=e.getEmbeddingLevels(m,k);$=new Uint16Array(Se),ne=new Uint8Array(Se),se=new Float32Array(Se*2),_e={},ue=[1/0,1/0,-1/0,-1/0],We=[],Z&&(oe=new Float32Array(m.length*4)),j&&(be=new Uint8Array(Se*3));let xe=0,Ie=-1,Oe=-1,it,pt;if(Ee.forEach((Pe,Ze)=>{let{count:we,width:ot}=Pe;if(we>0){let $e=0;for(let et=we;et--&&Pe.glyphAt(et).glyphObj.isWhitespace;)$e++;let dt=0,gt=0;if(P==="center")dt=(Te-ot)/2;else if(P==="right")dt=Te-ot;else if(P==="justify"&&Pe.isSoftWrapped){let et=0;for(let Ge=we-$e;Ge--;)Pe.glyphAt(Ge).glyphObj.isWhitespace&&et++;gt=(Te-ot)/et}if(gt||dt){let et=0;for(let Ge=0;Ge<we;Ge++){let Bt=Pe.glyphAt(Ge);const mt=Bt.glyphObj;Bt.x+=dt+et,gt!==0&&mt.isWhitespace&&Ge<we-$e&&(et+=gt,Bt.width+=gt)}}const ce=e.getReorderSegments(m,de,Pe.glyphAt(0).charIndex,Pe.glyphAt(Pe.count-1).charIndex);for(let et=0;et<ce.length;et++){const[Ge,Bt]=ce[et];let mt=1/0,Fe=-1/0;for(let rt=0;rt<we;rt++)if(Pe.glyphAt(rt).charIndex>=Ge){let Tt=rt,_t=rt;for(;_t<we;_t++){let Ct=Pe.glyphAt(_t);if(Ct.charIndex>Bt)break;_t<we-$e&&(mt=Math.min(mt,Ct.x),Fe=Math.max(Fe,Ct.x+Ct.width))}for(let Ct=Tt;Ct<_t;Ct++){const Wt=Pe.glyphAt(Ct);Wt.x=Fe-(Wt.x+Wt.width-mt)}break}}let Ke;const un=et=>Ke=et;for(let et=0;et<we;et++){const Ge=Pe.glyphAt(et);Ke=Ge.glyphObj;const Bt=Ke.index,mt=de.levels[Ge.charIndex]&1;if(mt){const Fe=e.getMirroredCharacter(m[Ge.charIndex]);Fe&&Ge.fontData.fontObj.forEachGlyph(Fe,0,0,un)}if(Z){const{charIndex:Fe,fontData:rt}=Ge,Tt=Ge.x+Ce,_t=Ge.x+Ge.width+Ce;oe[Fe*4]=mt?_t:Tt,oe[Fe*4+1]=mt?Tt:_t,oe[Fe*4+2]=Pe.baseline+rt.caretBottom+ge,oe[Fe*4+3]=Pe.baseline+rt.caretTop+ge;const Ct=Fe-Ie;Ct>1&&h(oe,Ie,Ct),Ie=Fe}if(j){const{charIndex:Fe}=Ge;for(;Fe>Oe;)Oe++,j.hasOwnProperty(Oe)&&(pt=j[Oe])}if(!Ke.isWhitespace&&!Ke.isEmpty){const Fe=xe++,{fontSizeMult:rt,src:Tt,index:_t}=Ge.fontData,Ct=_e[Tt]||(_e[Tt]={});Ct[Bt]||(Ct[Bt]={path:Ke.path,pathBounds:[Ke.xMin,Ke.yMin,Ke.xMax,Ke.yMax]});const Wt=Ge.x+Ce,Mn=Ge.y+Pe.baseline+ge;se[Fe*2]=Wt,se[Fe*2+1]=Mn;const An=Wt+Ke.xMin*rt,mn=Mn+Ke.yMin*rt,Bn=Wt+Ke.xMax*rt,Sn=Mn+Ke.yMax*rt;An<ue[0]&&(ue[0]=An),mn<ue[1]&&(ue[1]=mn),Bn>ue[2]&&(ue[2]=Bn),Sn>ue[3]&&(ue[3]=Sn),Fe%Y===0&&(it={start:Fe,end:Fe,rect:[1/0,1/0,-1/0,-1/0]},We.push(it)),it.end++;const Ht=it.rect;if(An<Ht[0]&&(Ht[0]=An),mn<Ht[1]&&(Ht[1]=mn),Bn>Ht[2]&&(Ht[2]=Bn),Sn>Ht[3]&&(Ht[3]=Sn),$[Fe]=Bt,ne[Fe]=_t,j){const Xn=Fe*3;be[Xn]=pt>>16&255,be[Xn+1]=pt>>8&255,be[Xn+2]=pt&255}}}}}),oe){const Pe=m.length-Ie;Pe>1&&h(oe,Ie,Pe)}}const Je=[];Ue.forEach(({index:de,src:xe,unitsPerEm:Ie,ascender:Oe,descender:it,lineHeight:pt,capHeight:Pe,xHeight:Ze})=>{Je[de]={src:xe,unitsPerEm:Ie,ascender:Oe,descender:it,lineHeight:pt,capHeight:Pe,xHeight:Ze}}),V.typesetting=d()-ke,L({glyphIds:$,glyphFontIndices:ne,glyphPositions:se,glyphData:_e,fontData:Je,caretPositions:oe,glyphColors:be,chunkedBounds:We,fontSize:E,topBaseline:ge+Ee[0].baseline,blockBounds:[Ce,ge-pe,Ce+Te,ge],visibleBounds:ue,timings:V})})}function l(m,b){s({...m,metricsOnly:!0},v=>{const[y,E,_,C]=v.blockBounds;b({width:_-y,height:C-E})})}function c(m){let b=m.match(/^([\d.]+)%$/),v=b?parseFloat(b[1]):NaN;return isNaN(v)?0:v/100}function h(m,b,v){const y=m[b*4],E=m[b*4+1],_=m[b*4+2],C=m[b*4+3],x=(E-y)/v;for(let B=0;B<v;B++){const I=(b+B)*4;m[I]=y+x*B,m[I+1]=y+x*(B+1),m[I+2]=_,m[I+3]=C}}function d(){return(self.performance||Date).now()}function f(){this.data=[]}const p=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(m){let b=f.flyweight;return b.data=this.data,b.index=m,b},splitAt(m){let b=new f;return b.data=this.data.splice(m*p.length),b}},f.flyweight=p.reduce((m,b,v,y)=>(Object.defineProperty(m,b,{get(){return this.data[this.index*p.length+v]},set(E){this.data[this.index*p.length+v]=E}}),m),{data:null,index:0}),{typeset:s,measure:l}}const Io=()=>(self.performance||Date).now(),gc=pc();let zA;function pE(o,e,i,a,n,t,r,s,l,c,h=!0){return h?mE(o,e,i,a,n,t,r,s,l,c).then(null,d=>(zA||(console.warn("WebGL SDF generation failed, falling back to JS",d),zA=!0),VA(o,e,i,a,n,t,r,s,l,c))):VA(o,e,i,a,n,t,r,s,l,c)}const Fl=[],gE=5;let Eh=0;function Wg(){const o=Io();for(;Fl.length&&Io()-o<gE;)Fl.shift()();Eh=Fl.length?setTimeout(Wg,0):0}const mE=(...o)=>new Promise((e,i)=>{Fl.push(()=>{const a=Io();try{gc.webgl.generateIntoCanvas(...o),e({timing:Io()-a})}catch(n){i(n)}}),Eh||(Eh=setTimeout(Wg,0))}),vE=4,bE=2e3,HA={};let wE=0;function VA(o,e,i,a,n,t,r,s,l,c){const h="TroikaTextSDFGenerator_JS_"+wE++%vE;let d=HA[h];return d||(d=HA[h]={workerModule:fs({name:h,workerId:h,dependencies:[pc,Io],init(f,p){const m=f().javascript.generate;return function(...b){const v=p();return{textureData:m(...b),timing:p()-v}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),d.requests++,clearTimeout(d.idleTimer),d.workerModule(o,e,i,a,n,t).then(({textureData:f,timing:p})=>{const m=Io(),b=new Uint8Array(f.length*4);for(let v=0;v<f.length;v++)b[v*4+c]=f[v];return gc.webglUtils.renderImageData(r,b,s,l,o,e,1<<3-c),p+=Io()-m,--d.requests===0&&(d.idleTimer=setTimeout(()=>{ZC(h)},bE)),{timing:p}})}function yE(o){o._warm||(gc.webgl.isSupported(o),o._warm=!0)}const _E=gc.webglUtils.resizeWebGLCanvasWithoutClearing,Zo={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},CE=new Rt;function Yo(){return(self.performance||Date).now()}const jA=Object.create(null);function EE(o,e){o=IE({},o);const i=Yo(),{defaultFontURL:a}=Zo,n=[];if(a&&n.push({label:"default",src:qA(a)}),o.font&&n.push({label:"user",src:qA(o.font)}),o.font=n,o.text=""+o.text,o.sdfGlyphSize=o.sdfGlyphSize||Zo.sdfGlyphSize,o.unicodeFontsURL=o.unicodeFontsURL||Zo.unicodeFontsURL,o.colorRanges!=null){let p={};for(let m in o.colorRanges)if(o.colorRanges.hasOwnProperty(m)){let b=o.colorRanges[m];typeof b!="number"&&(b=CE.set(b).getHex()),p[m]=b}o.colorRanges=p}Object.freeze(o);const{textureWidth:t,sdfExponent:r}=Zo,{sdfGlyphSize:s}=o,l=t/s*4;let c=jA[s];if(!c){const p=document.createElement("canvas");p.width=t,p.height=s*256/l,c=jA[s]={glyphCount:0,sdfGlyphSize:s,sdfCanvas:p,sdfTexture:new ga(p,void 0,void 0,void 0,bn,bn),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,xE(c)}const{sdfTexture:h,sdfCanvas:d}=c;Xg(o).then(p=>{const{glyphIds:m,glyphFontIndices:b,fontData:v,glyphPositions:y,fontSize:E,timings:_}=p,C=[],x=new Float32Array(m.length*4);let B=0,I=0;const k=Yo(),P=v.map(Q=>{let O=c.glyphsByFont.get(Q.src);return O||c.glyphsByFont.set(Q.src,O=new Map),O});m.forEach((Q,O)=>{const G=b[O],{src:q,unitsPerEm:Z}=v[G];let Y=P[G].get(Q);if(!Y){const{path:J,pathBounds:X}=p.glyphData[q][Q],$=Math.max(X[2]-X[0],X[3]-X[1])/s*(Zo.sdfMargin*s+.5),ne=c.glyphCount++,se=[X[0]-$,X[1]-$,X[2]+$,X[3]+$];P[G].set(Q,Y={path:J,atlasIndex:ne,sdfViewBox:se}),C.push(Y)}const{sdfViewBox:j}=Y,L=y[I++],N=y[I++],V=E/Z;x[B++]=L+j[0]*V,x[B++]=N+j[1]*V,x[B++]=L+j[2]*V,x[B++]=N+j[3]*V,m[O]=Y.atlasIndex}),_.quads=(_.quads||0)+(Yo()-k);const D=Yo();_.sdf={};const U=d.height,S=Math.ceil(c.glyphCount/l),R=Math.pow(2,Math.ceil(Math.log2(S*s)));R>U&&(console.info(`Increasing SDF texture size ${U}->${R}`),_E(d,t,R),h.dispose()),Promise.all(C.map(Q=>Kg(Q,c,o.gpuAccelerateSDF).then(({timing:O})=>{_.sdf[Q.atlasIndex]=O}))).then(()=>{C.length&&!c.contextLost&&(Yg(c),h.needsUpdate=!0),_.sdfTotal=Yo()-D,_.total=Yo()-i,e(Object.freeze({parameters:o,sdfTexture:h,sdfGlyphSize:s,sdfExponent:r,glyphBounds:x,glyphAtlasIndices:m,glyphColors:p.glyphColors,caretPositions:p.caretPositions,chunkedBounds:p.chunkedBounds,ascender:p.ascender,descender:p.descender,lineHeight:p.lineHeight,capHeight:p.capHeight,xHeight:p.xHeight,topBaseline:p.topBaseline,blockBounds:p.blockBounds,visibleBounds:p.visibleBounds,timings:p.timings}))})}),Promise.resolve().then(()=>{c.contextLost||yE(d)})}function Kg({path:o,atlasIndex:e,sdfViewBox:i},{sdfGlyphSize:a,sdfCanvas:n,contextLost:t},r){if(t)return Promise.resolve({timing:-1});const{textureWidth:s,sdfExponent:l}=Zo,c=Math.max(i[2]-i[0],i[3]-i[1]),h=Math.floor(e/4),d=h%(s/a)*a,f=Math.floor(h/(s/a))*a,p=e%4;return pE(a,a,o,i,c,l,n,d,f,p,r)}function xE(o){const e=o.sdfCanvas;e.addEventListener("webglcontextlost",i=>{console.log("Context Lost",i),i.preventDefault(),o.contextLost=!0}),e.addEventListener("webglcontextrestored",i=>{console.log("Context Restored",i),o.contextLost=!1;const a=[];o.glyphsByFont.forEach(n=>{n.forEach(t=>{a.push(Kg(t,o,!0))})}),Promise.all(a).then(()=>{Yg(o),o.sdfTexture.needsUpdate=!0})})}function IE(o,e){for(let i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);return o}let xl;function qA(o){return xl||(xl=typeof document>"u"?{}:document.createElement("a")),xl.href=o,xl.href}function Yg(o){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:i}=o,{width:a,height:n}=e,t=o.sdfCanvas.getContext("webgl");let r=i.image.data;(!r||r.length!==a*n*4)&&(r=new Uint8Array(a*n*4),i.image={width:a,height:n,data:r},i.flipY=!1,i.isDataTexture=!0),t.readPixels(0,0,a,n,t.RGBA,t.UNSIGNED_BYTE,r)}}const BE=fs({name:"Typesetter",dependencies:[AE,fE,jg],init(o,e,i){return o(e,i())}}),Xg=fs({name:"Typesetter",dependencies:[BE],init(o){return function(e){return new Promise(i=>{o.typeset(e,i)})}},getTransferables(o){const e=[];for(let i in o)o[i]&&o[i].buffer&&e.push(o[i].buffer);return e}});Xg.onMainThread;const WA={};function SE(o){let e=WA[o];return e||(e=WA[o]=new _r(1,1,o,o).translate(.5,.5,0)),e}const kE="aTroikaGlyphBounds",KA="aTroikaGlyphIndex",DE="aTroikaGlyphColor";let TE=class extends zh{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Xr,this.boundingBox=new gn}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let i=SE(e);["position","normal","uv"].forEach(a=>{this.attributes[a]=i.attributes[a].clone()}),this.setIndex(i.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,i,a,n,t){this.updateAttributeData(kE,e,4),this.updateAttributeData(KA,i,1),this.updateAttributeData(DE,t,3),this._blockBounds=a,this._chunkedBounds=n,this.instanceCount=i.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:i,boundingBox:a}=this;if(i){const{PI:n,floor:t,min:r,max:s,sin:l,cos:c}=Math,h=n/2,d=n*2,f=Math.abs(i),p=e[0]/f,m=e[2]/f,b=t((p+h)/d)!==t((m+h)/d)?-f:r(l(p)*f,l(m)*f),v=t((p-h)/d)!==t((m-h)/d)?f:s(l(p)*f,l(m)*f),y=t((p+n)/d)!==t((m+n)/d)?f*2:s(f-c(p)*f,f-c(m)*f);a.min.set(b,e[1],i<0?-y:0),a.max.set(v,e[3],i<0?0:y)}else a.min.set(e[0],e[1],0),a.max.set(e[2],e[3],0);a.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let i=this.getAttribute(KA).count,a=this._chunkedBounds;if(a)for(let n=a.length;n--;){i=a[n].end;let t=a[n].rect;if(t[1]<e.w&&t[3]>e.y&&t[0]<e.z&&t[2]>e.x)break}this.instanceCount=i}updateAttributeData(e,i,a){const n=this.getAttribute(e);i?n&&n.array.length===i.length?(n.array.set(i),n.needsUpdate=!0):(this.setAttribute(e,new $l(i,a)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(e)}};const ME=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,PE=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,QE=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,RE=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function UE(o){const e=Ch(o,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new lt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new ri(0,0,0,0)},uTroikaClipRect:{value:new ri(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new lt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Rt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Wp},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:ME,vertexTransform:PE,fragmentDefs:QE,fragmentColorTransform:RE,customRewriter({vertexShader:i,fragmentShader:a}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(a)&&(a=a.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(i)||(i=i.replace(qg,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:i,fragmentShader:a}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const ud=new Tn({color:16777215,side:Oi,transparent:!0}),YA=8421504,XA=new Lt,Il=new ie,zu=new ie,Xs=[],FE=new ie,Hu="+x+y";function JA(o){return Array.isArray(o)?o[0]:o}let Jg=()=>{const o=new Re(new _r(1,1),ud);return Jg=()=>o,o},Zg=()=>{const o=new Re(new _r(1,1,32,1),ud);return Zg=()=>o,o};const LE={type:"syncstart"},OE={type:"synccomplete"},$g=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],GE=$g.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Xt=class extends Re{constructor(){const e=new TE;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=YA,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=Hu,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(LE),EE({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},i=>{this._isSyncing=!1,this._textRenderInfo=i,this.geometry.updateGlyphs(i.glyphBounds,i.glyphAtlasIndices,i.blockBounds,i.chunkedBounds,i.glyphColors);const a=this._queuedSyncs;a&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{a.forEach(n=>n&&n())})),this.dispatchEvent(OE),e&&e()})))}onBeforeRender(e,i,a,n,t,r){this.sync(),t.isTroikaTextMaterial&&this._prepareForRender(t)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return UE(e)}get material(){let e=this._derivedMaterial;const i=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=ud.clone());if((!e||!e.isDerivedFrom(i))&&(e=this._derivedMaterial=this.createDerivedMaterial(i),i.addEventListener("dispose",function a(){i.removeEventListener("dispose",a),e.dispose()})),this.hasOutline()){let a=e._outlineMtl;return a||(a=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),a.isTextOutlineMaterial=!0,a.depthWrite=!1,a.map=null,e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),a.dispose()})),[a,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return JA(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return JA(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const i=e.isTextOutlineMaterial,a=e.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:s,blockBounds:l}=n;a.uTroikaSDFTexture.value=s,a.uTroikaSDFTextureSize.value.set(s.image.width,s.image.height),a.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,a.uTroikaSDFExponent.value=n.sdfExponent,a.uTroikaTotalBounds.value.fromArray(l),a.uTroikaUseGlyphColors.value=!i&&!!n.glyphColors;let c=0,h=0,d=0,f,p,m,b=0,v=0;if(i){let{outlineWidth:E,outlineOffsetX:_,outlineOffsetY:C,outlineBlur:x,outlineOpacity:B}=this;c=this._parsePercent(E)||0,h=Math.max(0,this._parsePercent(x)||0),f=B,b=this._parsePercent(_)||0,v=this._parsePercent(C)||0}else d=Math.max(0,this._parsePercent(this.strokeWidth)||0),d&&(m=this.strokeColor,a.uTroikaStrokeColor.value.set(m??YA),p=this.strokeOpacity,p==null&&(p=1)),f=this.fillOpacity;a.uTroikaEdgeOffset.value=c,a.uTroikaPositionOffset.value.set(b,v),a.uTroikaBlurRadius.value=h,a.uTroikaStrokeWidth.value=d,a.uTroikaStrokeOpacity.value=p,a.uTroikaFillOpacity.value=f??1,a.uTroikaCurveRadius.value=this.curveRadius||0;let y=this.clipRect;if(y&&Array.isArray(y)&&y.length===4)a.uTroikaClipRect.value.fromArray(y);else{const E=(this.fontSize||.1)*100;a.uTroikaClipRect.value.set(l[0]-E,l[1]-E,l[2]+E,l[3]+E)}this.geometry.applyClipRect(a.uTroikaClipRect.value)}a.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const t=i?this.outlineColor||0:this.color;if(t==null)delete e.color;else{const s=e.hasOwnProperty("color")?e.color:e.color=new Rt;(t!==s._input||typeof t=="object")&&s.set(s._input=t)}let r=this.orientation||Hu;if(r!==e._orientation){let s=a.uTroikaOrient.value;r=r.replace(/[^-+xyz]/g,"");let l=r!==Hu&&r.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,h,d,f]=l;Il.set(0,0,0)[h]=c==="-"?1:-1,zu.set(0,0,0)[f]=d==="-"?-1:1,XA.lookAt(FE,Il.cross(zu),zu),s.setFromMatrix4(XA)}else s.identity();e._orientation=r}}_parsePercent(e){if(typeof e=="string"){let i=e.match(/^(-?[\d.]+)%$/),a=i?parseFloat(i[1]):NaN;e=(isNaN(a)?0:a/100)*this.fontSize}return e}localPositionToTextCoords(e,i=new lt){i.copy(e);const a=this.curveRadius;return a&&(i.x=Math.atan2(e.x,Math.abs(a)-Math.abs(e.z))*Math.abs(a)),i}worldPositionToTextCoords(e,i=new lt){return Il.copy(e),this.localPositionToTextCoords(this.worldToLocal(Il),i)}raycast(e,i){const{textRenderInfo:a,curveRadius:n}=this;if(a){const t=a.blockBounds,r=n?Zg():Jg(),s=r.geometry,{position:l,uv:c}=s.attributes;for(let h=0;h<c.count;h++){let d=t[0]+c.getX(h)*(t[2]-t[0]);const f=t[1]+c.getY(h)*(t[3]-t[1]);let p=0;n&&(p=n-Math.cos(d/n)*n,d=Math.sin(d/n)*n),l.setXYZ(h,d,f,p)}s.boundingSphere=this.geometry.boundingSphere,s.boundingBox=this.geometry.boundingBox,r.matrixWorld=this.matrixWorld,r.material.side=this.material.side,Xs.length=0,r.raycast(e,Xs);for(let h=0;h<Xs.length;h++)Xs[h].object=this,i.push(Xs[h])}}copy(e){const i=this.geometry;return super.copy(e),this.geometry=i,GE.forEach(a=>{this[a]=e[a]}),this}clone(){return new this.constructor().copy(this)}};$g.forEach(o=>{const e="_private_"+o;Object.defineProperty(Xt.prototype,o,{get(){return this[e]},set(i){i!==this[e]&&(this[e]=i,this._needsSync=!0)}})});new gn;new Rt;class NE{constructor(e){var i;this._charts=new Map,this._width=400,this._height=110,this._backgroundOpacity=.7,this._perf=e.perf,this._backgroundOpacity=(i=e.backgroundOpacity)!=null?i:this._backgroundOpacity,this.wrapper=document.createElement("div"),this.wrapper.id="three-perf-ui",this.wrapper.style.position="fixed",this.wrapper.style.bottom="0",this.wrapper.style.left="0",this.wrapper.style.width=this._width+"px",this.wrapper.style.height=this._height+"px",e.domElement.appendChild(this.wrapper),this.canvas=document.createElement("canvas"),this.canvas.width=this._width,this.canvas.height=this._height,this.canvas.style.position="absolute",this.wrapper.appendChild(this.canvas),this.initCanvas()}setScale(e){this.wrapper.style.width=e*this.width+"px",this.wrapper.style.height=e*this.height+"px",this._renderer.setSize(this._width*e,this._height*e,!0)}initCanvas(){this._renderer=new G0({canvas:this.canvas,antialias:!0,alpha:!0}),this._renderer.setClearColor(0,this._backgroundOpacity),this._renderer.setPixelRatio(window.devicePixelRatio),this._scene=new Op,this._camera=new Ia(0,this._width,0,-this._height,.1,100),this._camera.position.set(0,0,10),this._camera.lookAt(0,0,0),this._camera.updateProjectionMatrix(),this._scene.add(this._camera),this._scene.userData.useStats=!1;const e=new Xt;e.anchorX="right",e.position.set(45,-8,0),e.text="0.000",e.fontSize=15,e.color="rgb(253, 151, 31)",e.sync(),this._scene.add(e);const i=new Xt;i.anchorX="right",i.position.set(65,-7,0),i.text="ms",i.fontSize=9,i.color="rgb(255, 255, 255)",i.sync(),this._scene.add(i);const a=new Xt;a.anchorX="right",a.position.set(65,-22,0),a.text="GPU",a.fontSize=9,a.color="rgb(253, 151, 31)",a.sync(),this._scene.add(a);const n=new Xt;n.anchorX="right",n.position.set(115,-8,0),n.text="0.000",n.fontSize=15,n.color="rgb(66, 226, 46)",n.sync(),this._scene.add(n);const t=new Xt;t.anchorX="right",t.position.set(135,-7,0),t.text="ms",t.fontSize=9,t.color="rgb(255, 255, 255)",t.sync(),this._scene.add(t);const r=new Xt;r.anchorX="right",r.position.set(135,-22,0),r.text="CPU",r.fontSize=9,r.color="rgb(66, 226, 46)",r.sync(),this._scene.add(r);const s=new Xt;s.anchorX="center",s.position.set(165,-8,0),s.text="0",s.fontSize=15,s.color="rgb(238, 38, 110)",s.sync(),this._scene.add(s);const l=new Xt;l.anchorX="center",l.position.set(175,-22,0),l.text="FPS",l.fontSize=9,l.color="rgb(238, 38, 110)",l.sync(),this._scene.add(l);const c=new Xt;c.anchorX="right",c.position.set(235,-8,0),c.text="0",c.fontSize=15,c.color="#ffffff",c.sync(),this._scene.add(c);const h=new Xt;h.anchorX="right",h.position.set(235,-22,0),h.text="calls",h.fontSize=9,h.color="rgb(101, 197, 188)",h.sync(),this._scene.add(h);const d=new Xt;d.anchorX="right",d.position.set(315,-8,0),d.text="0",d.fontSize=15,d.color="#ffffff",d.sync(),this._scene.add(d);const f=new Xt;f.anchorX="right",f.position.set(315,-22,0),f.text="triangles",f.fontSize=9,f.color="rgb(101, 197, 188)",f.sync(),this._scene.add(f);const p=new Xt;p.anchorX="right",p.position.set(365,-8,0),p.text="0",p.fontSize=15,p.color="#ffffff",p.sync(),this._scene.add(p);const m=new Xt;m.anchorX="right",m.position.set(365,-22,0),m.text="passes",m.fontSize=9,m.color="rgb(101, 197, 188)",m.sync(),this._scene.add(m),this._basicInfoElements={gpuValue:e,cpuValue:n,fpsValue:s,callsValue:c,trianglesValue:d,renderpassesValue:p};const b=new Xt;b.anchorX="right",b.position.set(65,-39,0),b.text="0",b.fontSize=15,b.color="#ffffff",b.sync(),this._scene.add(b);const v=new Xt;v.anchorX="right",v.position.set(65,-53,0),v.text="geometries",v.fontSize=9,v.color="rgb(101, 197, 188)",v.sync(),this._scene.add(v);const y=new Xt;y.anchorX="right",y.position.set(135,-39,0),y.text="0",y.fontSize=15,y.color="#ffffff",y.sync(),this._scene.add(y);const E=new Xt;E.anchorX="right",E.position.set(135,-53,0),E.text="textures",E.fontSize=9,E.color="rgb(101, 197, 188)",E.sync(),this._scene.add(E);const _=new Xt;_.anchorX="right",_.position.set(205,-39,0),_.text="0",_.fontSize=15,_.color="#ffffff",_.sync(),this._scene.add(_);const C=new Xt;C.anchorX="right",C.position.set(205,-53,0),C.text="shaders",C.fontSize=9,C.color="rgb(101, 197, 188)",C.sync(),this._scene.add(C);const x=new Xt;x.anchorX="right",x.position.set(275,-39,0),x.text="0",x.fontSize=15,x.color="#ffffff",x.sync(),this._scene.add(x);const B=new Xt;B.anchorX="right",B.position.set(275,-53,0),B.text="lines",B.fontSize=9,B.color="rgb(101, 197, 188)",B.sync(),this._scene.add(B);const I=new Xt;I.anchorX="right",I.position.set(345,-39,0),I.text="0",I.fontSize=15,I.color="#ffffff",I.sync(),this._scene.add(I);const k=new Xt;k.anchorX="right",k.position.set(345,-53,0),k.text="points",k.fontSize=9,k.color="rgb(101, 197, 188)",k.sync(),this._scene.add(k),this._memInfoElements={geometriesValue:b,geometriesLabel:v,texturesValue:y,texturesLabel:E,shadersValue:_,shadersLabel:C,linesValue:x,linesLabel:B,pointsValue:I,pointsLabel:k};const P=new hi;let D=new Float32Array(60*3);for(let q=0;q<60;q++)D[3*q+0]=this._width/59*q,D[3*q+1]=-110,D[3*q+2]=0;let U=new Mt(D,3);U.usage=oa,P.setAttribute("position",U);const S=new xi(P,new ia({color:"rgb(253, 151, 31)"}));this._scene.add(S),this._charts.set("gpu",S);const R=new hi;D=new Float32Array(60*3);for(let q=0;q<60;q++)D[3*q+0]=this._width/59*q,D[3*q+1]=-110,D[3*q+2]=0;U=new Mt(D,3),U.usage=oa,R.setAttribute("position",U);const Q=new xi(R,new ia({color:"rgb(66, 226, 46)"}));this._scene.add(Q),this._charts.set("cpu",Q);const O=new hi;D=new Float32Array(60*3);for(let q=0;q<60;q++)D[3*q+0]=this._width/59*q,D[3*q+1]=-110,D[3*q+2]=0;U=new Mt(D,3),U.usage=oa,O.setAttribute("position",U);const G=new xi(O,new ia({color:"rgb(238, 38, 110)"}));this._scene.add(G),this._charts.set("fps",G)}update(){var e,i;if(this._perf.chart&&this._perf.showGraph)for(const a in this._perf.chart.data){const n=this._perf.chart.data[a];if(!this._charts.get(a)||!n)continue;const r=this._charts.get(a).geometry.attributes.position;let s=0;for(let l=0;l<n.length;l++)n[l]>s&&(s=n[l]);s=Math.max(s,20);for(let l=0;l<n.length;l++){let c=(this._perf.chart.circularId+l+1)%60;r.setY(l,(n[c]/s*90-110)*this.height/110)}r.needsUpdate=!0}this._basicInfoElements.gpuValue.text=this._perf.log.gpu.toFixed(3),this._basicInfoElements.cpuValue.text=this._perf.log.cpu.toFixed(3),this._basicInfoElements.fpsValue.text=this._perf.log.fps.toFixed(0),this._basicInfoElements.callsValue.text=this._perf.threeRenderer.info.render.calls.toString(),this._basicInfoElements.trianglesValue.text=this._perf.threeRenderer.info.render.triangles.toString(),this._basicInfoElements.renderpassesValue.text=this._perf.renderPassesNumber.toString(),this._memInfoElements.geometriesValue.text=this._perf.threeRenderer.info.memory.geometries.toString(),this._memInfoElements.texturesValue.text=this._perf.threeRenderer.info.memory.textures.toString(),this._memInfoElements.shadersValue.text=(i=(e=this._perf.threeRenderer.info.programs)==null?void 0:e.length.toString())!=null?i:"",this._memInfoElements.linesValue.text=this._perf.threeRenderer.info.render.lines.toString(),this._memInfoElements.pointsValue.text=this._perf.threeRenderer.info.render.points.toString(),this.render()}render(){this._renderer.render(this._scene,this._camera)}dispose(){this.wrapper.remove()}toggleVisibility(e){this.wrapper.style.display=e?"block":"none"}toggleCharts(e){this._charts.forEach(i=>{i.visible=e}),this._perf.showGraph?this.height=this._perf.memory?110:70:this.height=this._perf.memory?70:40,this.wrapper.style.height=this._perf.scale*this.height+"px"}toggleMemoryInfo(e){for(const i in this._memInfoElements)this._memInfoElements[i].visible=e;this.width=380,this._perf.showGraph?this.height=this._perf.memory?110:70:this.height=this._perf.memory?70:40,this.wrapper.style.width=this._perf.scale*this.width+"px",this.wrapper.style.height=this._perf.scale*this.height+"px"}setBackgroundOpacity(e){this._backgroundOpacity=e,this._renderer.setClearColor(0,this._backgroundOpacity),this.render()}get width(){return this._width}set width(e){this._width=e,this._camera.right=e,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._perf.scale*this._width,this._perf.scale*this._height),this.render()}get height(){return this._height}set height(e){this._height=e,this._camera.bottom=-e,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._perf.scale*this._width,this._perf.scale*this._height),this.render()}}const Xi={value:0,fpsLimit:60,isOverLimit:0},Js=o=>(o==null?void 0:o.reduce((e,i)=>e+i,0))/o.length;class zE{constructor(e){this.names=[""],this.finished=[],this.paused=!1,this.overClock=!1,this.queryHasResult=!1,this.queryCreated=!1,this.isWebGL2=!0,this.memAccums=[],this.gpuAccums=[],this.activeAccums=[],this.logsAccums={mem:[],gpu:[],cpu:[],fps:[],fpsFixed:[]},this.fpsChart=[],this.gpuChart=[],this.cpuChart=[],this.memChart=[],this.paramLogger=()=>{},this.glFinish=()=>{},this.chartLogger=()=>{},this.chartLen=60,this.logsPerSecond=10,this.maxMemory=1500,this.chartHz=10,this.startCpuProfiling=!1,this.lastCalculateFixed=0,this.chartFrame=0,this.gpuTimeProcess=0,this.chartTime=0,this.activeQueries=0,this.circularId=0,this.detected=0,this.frameId=0,this.rafId=0,this.idleCbId=0,this.checkQueryId=0,this.uuid=void 0,this.currentCpu=0,this.currentMem=0,this.paramFrame=0,this.paramTime=0,this.now=()=>{},this.t0=0,this.nextFps=i=>{const a=16.666666666666668,n=a-i.timeRemaining(),t=a*Xi.fpsLimit/10/n;t<0||(Xi.value=t,Xi.isOverLimit<25?Xi.isOverLimit++:this.perf.overclockingFps=!0)},this.nextFrame=i=>{this.frameId++;const a=i||this.now();let n=a-this.paramTime,t=0;if(this.frameId<=1)this.paramFrame=this.frameId,this.paramTime=a;else if(a>=this.paramTime){this.maxMemory=window.performance.memory?window.performance.memory.jsHeapSizeLimit/1048576:0;const r=this.frameId-this.paramFrame,s=r*1e3/n,l=this.perf.overclockingFps?Xi.value:s;if(t=this.isWebGL2?this.gpuAccums[0]:this.gpuAccums[0]/n,this.isWebGL2?this.gpuAccums[0]=0:Promise.all(this.finished).then(()=>{this.gpuAccums[0]=0,this.finished=[]}),this.currentMem=Math.round(window.performance&&window.performance.memory?window.performance.memory.usedJSHeapSize/1048576:0),window.performance&&this.startCpuProfiling){window.performance.mark("cpu-finished");const c=performance.measure("cpu-duration","cpu-started","cpu-finished");this.currentCpu=c.duration,this.logsAccums.cpu.push(this.currentCpu),this.startCpuProfiling=!1}this.logsAccums.mem.push(this.currentMem),this.logsAccums.fpsFixed.push(s),this.logsAccums.fps.push(l),this.logsAccums.gpu.push(t),this.overClock&&typeof window.requestIdleCallback<"u"&&(Xi.isOverLimit>0&&l>s?Xi.isOverLimit--:this.perf.overclockingFps&&(this.perf.overclockingFps=!1)),a>=this.paramTime+1e3/this.logsPerSecond&&(this.paramLogger({cpu:Js(this.logsAccums.cpu),gpu:Js(this.logsAccums.gpu),mem:Js(this.logsAccums.mem),fps:Js(this.logsAccums.fps),duration:Math.round(n),maxMemory:this.maxMemory,frameCount:r}),this.logsAccums.mem=[],this.logsAccums.fps=[],this.logsAccums.gpu=[],this.logsAccums.cpu=[],this.paramFrame=this.frameId,this.paramTime=a),this.overClock&&a-this.lastCalculateFixed>=2*1e3&&(this.lastCalculateFixed=i,Xi.fpsLimit=Math.round(Js(this.logsAccums.fpsFixed)/10)*100,this.perf.fpsLimit=Xi.fpsLimit/10,this.logsAccums.fpsFixed=[],this.paramFrame=this.frameId,this.paramTime=a)}if(!this.detected||!this.chartFrame)this.chartFrame=this.frameId,this.chartTime=a,this.circularId=0;else{const r=a-this.chartTime;let s=this.chartHz*r/1e3;for(;--s>0&&this.detected;){const c=(this.frameId-this.chartFrame)/r*1e3,h=this.perf.overclockingFps?Xi.value:c;this.fpsChart[this.circularId%this.chartLen]=h;const d=1e3/this.currentMem,f=this.currentCpu,p=(this.isWebGL2?this.gpuAccums[1]*2:Math.round(this.gpuAccums[1]/n*100))+4;p>0&&(this.gpuChart[this.circularId%this.chartLen]=p),f>0&&(this.cpuChart[this.circularId%this.chartLen]=f),d>0&&(this.memChart[this.circularId%this.chartLen]=d);for(let m=0;m<this.names.length;m++)this.chartLogger({i:m,data:{fps:this.fpsChart,gpu:this.gpuChart,cpu:this.cpuChart,mem:this.memChart},circularId:this.circularId});this.circularId++,this.chartFrame=this.frameId,this.chartTime=a}}},this.perf=e.perf,this.trackGPU=e.trackGPU,this.overClock=e.overClock,this.logsPerSecond=e.logsPerSecond,this.gl=e.gl,this.paramLogger=e.paramLogger,this.chartLogger=e.chartLogger,window.GLPerf=window.GLPerf||{},this.fpsChart=new Array(this.chartLen).fill(0),this.gpuChart=new Array(this.chartLen).fill(0),this.cpuChart=new Array(this.chartLen).fill(0),this.memChart=new Array(this.chartLen).fill(0),this.now=()=>window.performance&&window.performance.now?window.performance.now():Date.now(),this.initGpu(),this.is120hz()}initGpu(){this.uuid=rr.generateUUID(),this.gl&&(this.isWebGL2=!0,this.extension||(this.extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")),this.extension===null&&(this.isWebGL2=!1))}is120hz(){let e=0;const i=a=>{++e<20?this.rafId=window.requestAnimationFrame(i):(this.detected=Math.ceil(1e3*e/(a-this.t0)/70),window.cancelAnimationFrame(this.rafId)),this.t0||(this.t0=a)};this.rafId=window.requestAnimationFrame(i)}addUI(e){this.names.indexOf(e)===-1&&(this.names.push(e),this.gpuAccums.push(0),this.activeAccums.push(!1))}startGpu(){const e=this.gl,i=this.extension;if(!(!e||!i)&&this.isWebGL2){let a=!1,n,t;if(this.query){this.queryHasResult=!1;let r=this.query;if(a=e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),n=e.getParameter(i.GPU_DISJOINT_EXT),a&&!n){t=e.getQueryParameter(this.query,e.QUERY_RESULT);const s=t*1e-6;(a||n)&&(e.deleteQuery(this.query),r=null),a&&s>0&&(n||this.activeAccums.forEach((l,c)=>{this.gpuAccums[c]=s}))}}(a||!this.query)&&(this.queryCreated=!0,this.query=e.createQuery(),e.beginQuery(i.TIME_ELAPSED_EXT,this.query))}}endGpu(){const e=this.extension,i=this.gl;this.isWebGL2&&this.queryCreated&&i.getQuery(e.TIME_ELAPSED_EXT,i.CURRENT_QUERY)&&i.endQuery(e.TIME_ELAPSED_EXT)}begin(e){this.startGpu(),this.updateAccums(e)}end(e){this.endGpu(),this.updateAccums(e)}updateAccums(e){let i=this.names.indexOf(e);i===-1&&(i=this.names.length,this.addUI(e));const a=this.now();this.activeAccums[i]=!this.activeAccums[i],this.t0=a}}Mi.prototype.updateMatrixWorld;Mi.prototype.updateWorldMatrix;Mi.prototype.updateMatrix;const ZA=["calls","triangles","points","lines"],$A=["gpu","cpu","mem","fps"];class HE{constructor(e){var i,a,n,t,r,s,l,c,h,d,f,p;this.gui=new WC.Pane,this.accumulated={totalFrames:0,log:{i:0,maxMemory:0,gpu:0,mem:0,cpu:0,fps:0,duration:0,frameCount:0},gl:{calls:0,triangles:0,points:0,lines:0,counts:0},max:{log:{i:0,maxMemory:0,gpu:0,mem:0,cpu:0,fps:0,duration:0,frameCount:0},gl:{calls:0,triangles:0,points:0,lines:0,counts:0}}},this.renderPassesNumber=0,this._keypressed="",this._guiVisible=!0,this.actionToCallUI="dev",this.keypressHandler=x=>{if(!this.actionToCallUI)return;this._keypressed+=x.key;const B=this._keypressed.split("");for(;B.length>this.actionToCallUI.length;)B.shift();B.join("")===this.actionToCallUI&&(this._keypressed="",this.guiVisible=!this.guiVisible)},this.afterRender=()=>{this._enabled&&(this.perfEngine.paused||(this.perfEngine.nextFrame(window.performance.now()),this.perfEngine.overClock&&typeof window.requestIdleCallback<"u"&&(this.perfEngine.idleCbId=requestIdleCallback(this.perfEngine.nextFps))),this.perfEngine&&this.perfEngine.end("profiler"),window.performance&&(window.performance.mark("cpu-started"),this.perfEngine.startCpuProfiling=!0),this.deepAnalyze)},this.deepAnalyze=(i=e.deepAnalyze)!=null?i:!1,this.threeRenderer=e.renderer,this.ui=new NE({perf:this,domElement:e.domElement,backgroundOpacity:e.backgroundOpacity}),this._visible=(a=e.visible)!=null?a:!0,this._enabled=(n=e.enabled)!=null?n:!0,this.scale=(t=e.scale)!=null?t:1,this.anchorX=(r=e.anchorX)!=null?r:"left",this.anchorY=(s=e.anchorY)!=null?s:"top",this.showGraph=(l=e.showGraph)!=null?l:!0,this.memory=(c=e.memory)!=null?c:!0,this.actionToCallUI=(h=e.actionToCallUI)!=null?h:"",this.guiVisible=(d=e.guiVisible)!=null?d:!1,this.gui.element.parentElement.style.width="300px",window.addEventListener("keypress",this.keypressHandler);const m=(f=e.overClock)!=null?f:!0;this.perfEngine=new zE({perf:this,trackGPU:!0,overClock:m,chartLen:120,chartHz:60,logsPerSecond:(p=e.logsPerSecond)!=null?p:10,gl:e.renderer.getContext(),chartLogger:x=>{this.chart=x},paramLogger:x=>{if(!this._enabled)return;const B={maxMemory:x.maxMemory,gpu:x.gpu,cpu:x.cpu,mem:x.mem,fps:x.fps,totalTime:x.duration,frameCount:x.frameCount};this.log=B;const I=this.accumulated,k=this.threeRenderer.info.render;I.totalFrames++,I.gl.calls+=k.calls,I.gl.triangles+=k.triangles,I.gl.points+=k.points,I.gl.lines+=k.lines,I.log.gpu+=x.gpu,I.log.cpu+=x.cpu,I.log.mem+=x.mem,I.log.fps+=x.fps;for(let P=0;P<ZA.length;P++){const D=ZA[P],U=k[D];U>I.max.gl[D]&&(I.max.gl[D]=U)}for(let P=0;P<$A.length;P++){const D=$A[P],U=x[D];U>I.max.log[D]&&(I.max.log[D]=U)}this.accumulated=I,this.ui.update()}});const b=e.renderer.getContext();let v=null,y=null;const E=b.getExtension("WEBGL_debug_renderer_info"),_=b.getParameter(b.VERSION);E!=null&&(v=b.getParameter(E.UNMASKED_RENDERER_WEBGL),y=b.getParameter(E.UNMASKED_VENDOR_WEBGL)),y||(y="Unknown vendor"),v||(v=b.getParameter(b.RENDERER)),this.startTime=performance.now(),this.infos={version:_,renderer:v,vendor:y},this.rendererRender=this.threeRenderer.render,this.threeRenderer.info.autoReset=!1,this.threeRenderer.render=(x,B)=>{this.renderPassesNumber++,this.rendererRender.call(this.threeRenderer,x,B)},this.guiFolder=this.gui.addFolder({title:"Settings"});const C=this.guiFolder.addFolder({title:"ThreePerf"});C.addInput(this,"visible",{label:"Visible"}),C.addInput(this,"enabled",{label:"Enabled"}),C.addInput(this,"anchorX",{label:"xAnchor",options:{left:"left",right:"right"}}),C.addInput(this,"anchorY",{label:"yAnchor",options:{top:"top",bottom:"bottom"}}),C.addInput(this,"backgroundOpacity",{label:"Background opacity",min:0,max:1,step:.1}),C.addInput(this,"memory",{label:"Memory"}),C.addInput(this,"showGraph",{label:"Charts"}),C.addInput(this,"scale",{label:"Scale",min:.1,max:2,step:.1}),C.addInput(this,"logsPerSecond",{label:"LogsPerSecond",min:1,max:60,step:1}),console.log("ThreePerf inited.")}begin(){this.perfEngine.begin("profiler")}end(){this.afterRender(),this.renderPassesNumber=0,this.threeRenderer.info.reset()}dispose(){var e;this.ui.dispose(),(e=this.gui.element.parentElement)==null||e.remove(),window.removeEventListener("keypress",this.keypressHandler)}get enabled(){return this._enabled}set enabled(e){this._enabled=e}get visible(){return this._visible}set visible(e){this._visible=e,this.ui.toggleVisibility(e)}get guiVisible(){return this._guiVisible}set guiVisible(e){this._guiVisible=e,this.gui.element.parentElement.style.display=e?"block":"none"}get anchorX(){return this._anchorX}set anchorX(e){this._anchorX=e,this._anchorX==="left"?(this.ui.wrapper.style.left="0",this.ui.wrapper.style.right=""):(this.ui.wrapper.style.left="",this.ui.wrapper.style.right="0")}get anchorY(){return this._anchorY}set anchorY(e){this._anchorY=e,this._anchorY==="top"?(this.ui.wrapper.style.top="0",this.ui.wrapper.style.bottom=""):(this.ui.wrapper.style.top="",this.ui.wrapper.style.bottom="0")}get showGraph(){return this._showGraph}set showGraph(e){this._showGraph=e,this.ui.toggleCharts(e)}get memory(){return this._memory}set memory(e){this._memory=e,this.ui.toggleMemoryInfo(e)}get scale(){return this._scale}set scale(e){this._scale=e,this.ui.setScale(e)}get logsPerSecond(){return this.perfEngine.logsPerSecond}set logsPerSecond(e){this.perfEngine.logsPerSecond=e}get backgroundOpacity(){return this.ui._backgroundOpacity}set backgroundOpacity(e){this.ui.setBackgroundOpacity(e)}}function FB(o,e){st(e,!0);let i=z(e,"domElement",19,()=>document.body),a=z(e,"logsPerSecond",3,10),n=z(e,"showGraph",3,!0),t=z(e,"memory",3,!0),r=z(e,"enabled",3,!0),s=z(e,"visible",3,!0),l=z(e,"actionToCallUI",3,""),c=z(e,"guiVisible",3,!1),h=z(e,"backgroundOpacity",3,.7),d=z(e,"scale",3,1),f=z(e,"anchorX",3,"left"),p=z(e,"anchorY",3,"top");const{renderer:m,renderStage:b,mainStage:v}=wt();let y;Ae(()=>{y==null||y.dispose(),y=new HE({domElement:i(),renderer:m})}),Ae(()=>{y.logsPerSecond=a(),y.showGraph=n(),y.memory=t(),y.enabled=r(),y.visible=s(),y.actionToCallUI=l(),y.guiVisible=c(),y.backgroundOpacity=h(),y.scale=d(),y.anchorX=f(),y.anchorY=p()}),zt(()=>{y.begin()},{stage:Aa("monitor-begin",{before:v})}),zt(()=>{y.end()},{stage:Aa("monitor-end",{after:b})}),di(()=>{y&&y.dispose()}),at()}const VE=`
#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>

uniform float thickness;
uniform bool screenspace;
uniform vec2 size;

void main() {
  #if defined (USE_SKINNING)
    #include <beginnormal_vertex>
    #include <morphnormal_vertex>
    #include <skinbase_vertex>
    #include <skinnormal_vertex>
    #include <defaultnormal_vertex>
  #endif
  #include <begin_vertex>
  #include <morphtarget_vertex>
  #include <skinning_vertex>
  #include <project_vertex>
  vec4 tNormal = vec4(normal, 0.0);
  vec4 tPosition = vec4(transformed, 1.0);
  #ifdef USE_INSTANCING
    tNormal = instanceMatrix * tNormal;
    tPosition = instanceMatrix * tPosition;
  #endif
  if (!screenspace) {
    vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
  } else {
    vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
    vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
    vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
    clipPosition.xy += offset;
    gl_Position = clipPosition;
  }
}`,jE=`
uniform vec3 color;
uniform float opacity;
void main(){
  gl_FragColor = vec4(color, opacity);
  #include <tonemapping_fragment>
  #include <${uc>=154?"colorspace_fragment":"encodings_fragment"}>
}
`;var qE=Hn("<!> <!>",1),WE=Hn("<!> <!>",1);function LB(o,e){st(e,!0);let i=z(e,"color",3,"black"),a=z(e,"screenspace",3,!1),n=z(e,"opacity",3,1),t=z(e,"transparent",3,!1),r=z(e,"thickness",3,.05),s=z(e,"toneMapped",3,!0),l=z(e,"angle",19,()=>Math.PI),c=z(e,"polygonOffset",3,!1),h=z(e,"polygonOffsetFactor",3,0),d=z(e,"renderOrder",3,0),f=z(e,"ref",15),p=xt(e,["$$slots","$$events","$$legacy","color","screenspace","opacity","transparent","thickness","toneMapped","angle","polygonOffset","polygonOffsetFactor","renderOrder","children","ref"]);const{renderer:m}=wt(),b={screenspace:{value:a()},color:{value:new Rt(i())},opacity:{value:n()},thickness:{value:r()},size:{value:new lt}},v=new pn;f(v);const y=new Gi({side:rc,uniforms:b,vertexShader:VE,fragmentShader:jE}),E=or();let _=Jl(E),C=Qe(()=>{if(Nt(_.current,"Mesh"))return jh(_.current.geometry,l())}),x=Qe(()=>{if(Nt(_.current,"Mesh")){if(Nt(_.current,"SkinnedMesh")){const B=new Tp;return B.bind(_.current.skeleton,_.current.bindMatrix),B}else if(Nt(_.current,"InstancedMesh")){const B=new Zl(void 0,void 0,_.current.count);return B.instanceMatrix=_.current.instanceMatrix,B}return new Re}});Ae(()=>{H(x)&&(H(x).renderOrder=d())}),Ae(()=>{y.transparent=t()}),Ae(()=>{y.toneMapped=s()}),Ae(()=>{y.polygonOffset=c()}),Ae(()=>{y.polygonOffsetFactor=h()}),Ae(()=>{y.uniforms.screenspace.value=a()}),Ae(()=>{y.uniforms.color.value.set(i())}),Ae(()=>{y.uniforms.opacity.value=n()}),Ae(()=>{y.uniforms.thickness.value=r()}),Ae(()=>{m.getDrawingBufferSize(y.uniforms.size.value)}),qe(o,yt({is:v},()=>p,{children:(B,I)=>{var k=WE(),P=ze(k);qe(P,{get is(){return H(x)},children:(U,S)=>{var R=qE(),Q=ze(R);qe(Q,{get is(){return H(C)}});var O=In(Q,2);qe(O,{is:y}),Le(U,R)},$$slots:{default:!0}});var D=In(P,2);ut(D,()=>e.children??ht,()=>({ref:v})),Le(B,k)},$$slots:{default:!0}})),at()}function OB(o,e){st(e,!0);let i=z(e,"id",3,1),a=z(e,"colorWrite",3,!1),n=z(e,"depthWrite",3,!1),t=z(e,"ref",15),r=xt(e,["$$slots","$$events","$$legacy","id","colorWrite","depthWrite","ref","children"]);const s=new Re;Et(()=>{const{material:c}=s;Array.isArray(c)||(c.colorWrite=a(),c.depthWrite=n(),c.stencilWrite=!0,c.stencilRef=i(),c.stencilFunc=N0,c.stencilFail=Kc,c.stencilZFail=Kc,c.stencilZPass=Kc)});var l=Qe(()=>-i());qe(o,yt({is:s,get renderOrder(){return H(l)}},()=>r,{get ref(){return t()},set ref(c){t(c)},children:(c,h)=>{var d=tt(),f=ze(d);ut(f,()=>e.children??ht,()=>({ref:s})),Le(c,d)},$$slots:{default:!0}})),at()}function GB(o,e){st(e,!0);const i=Jl(Er().suspended),{renderer:a}=wt();Et(()=>(i.current||(a.shadowMap.autoUpdate=!1,a.shadowMap.needsUpdate=!0),()=>{a.shadowMap.autoUpdate=!0,a.shadowMap.needsUpdate=!0})),at()}function NB(o,e){st(e,!0);let i=z(e,"ref",15),a=xt(e,["$$slots","$$events","$$legacy","ref","children"]);const n=new z0;us("detailed",t=>{if(or().current!==n)return;let s,l=t.props.distance,c=t.props.hysteresis;const h=Qe(()=>Nt(t.ref,"Object3D")?t.ref:void 0),d=Qe(()=>t.props.distance??0),f=Qe(()=>t.props.hysteresis??0),p=(v,y,E)=>{n.addLevel(v,y,E)},m=v=>{const y=n.levels.findIndex(E=>E.object===v);y>-1&&n.levels.splice(y,1)},b=(v,y,E)=>{K0(()=>{const _=n.levels.find(C=>C.object===v);_&&(_.distance=y,_.hysteresis=E)})};return nn.pre(()=>[H(h),H(d),H(f)],([v,y,E])=>{v!==s&&(s&&m(s),v&&p(v,y,E),s=v),v&&(y!==l||E!==c)&&(b(v,y,E),l=y,c=E)}),di(()=>{H(h)&&m(H(h))}),{pluginProps:["distance","hysteresis"]}}),qe(o,yt({is:n},()=>a,{get ref(){return i()},set ref(t){i(t)},children:(t,r)=>{var s=tt(),l=ze(s);ut(l,()=>e.children??ht,()=>({ref:n})),Le(t,s)},$$slots:{default:!0}})),at()}const KE=`void main() {
	gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
	discard;
}
`,YE="void main() {}";function zB(o,e){st(e,!0);let i=z(e,"ref",15),a=xt(e,["$$slots","$$events","$$legacy","children","ref"]);var n=tt(),t=ze(n);bi(t,()=>qe.ShaderMaterial,(r,s)=>{s(r,yt({fragmentShader:KE,vertexShader:YE},()=>a,{get ref(){return i()},set ref(l){i(l)},children:(l,c)=>{var h=tt(),d=ze(h);ut(d,()=>e.children??ht,i),Le(l,h)},$$slots:{default:!0}}))}),Le(o,n),at()}const XE=new gn;function HB(o,e){st(e,!0);const{renderStage:i}=wt();let a=z(e,"auto",3,!1),n=z(e,"box",3,XE),t=z(e,"stage",19,()=>Aa("<Resize>",{before:i})),r=z(e,"ref",15),s=xt(e,["$$slots","$$events","$$legacy","axis","auto","box","precise","onresize","stage","ref","children"]);const l=new pn,c=new pn,h=new pn,d=()=>{var B;h.matrixWorld.identity();const{max:v,min:y}=n().setFromObject(c,e.precise),E=v.x-y.x,_=v.y-y.y,C=v.z-y.z,x=e.axis==="x"?E:e.axis==="y"?_:e.axis==="z"?C:Math.max(E,_,C);h.scale.setScalar(1/x),(B=e.onresize)==null||B.call(e)},{start:f,stop:p}=zt(()=>{d(),p()},{autoStart:!1,stage:t()}),m=f;nn(()=>[e.axis,e.precise],f);const b=v=>{Nt(v.ref,"Object3D")&&nn.pre(()=>[v.ref],()=>(a()&&f(),()=>{a()&&f()}))};return qe(o,yt({is:l},()=>s,{get ref(){return r()},set ref(v){r(v)},children:(v,y)=>{qe(v,{is:h,children:(E,_)=>{qe(E,{is:c,children:(C,x)=>{Qg(C,{name:"resize",plugin:b,children:(B,I)=>{var k=tt(),P=ze(k);ut(P,()=>e.children??ht,()=>({ref:l,resize:f})),Le(B,k)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})),at({resize:m})}var JE=Hn("<!> <!>",1);function VB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(I,"$started",i);let t=z(e,"background",3,"auto"),r=z(e,"far",3,1e3),s=z(e,"fog",3,"auto"),l=z(e,"frames",3,1/0),c=z(e,"near",3,.1),h=z(e,"resolution",3,256),d=z(e,"ref",15),f=xt(e,["$$slots","$$events","$$legacy","background","far","fog","frames","near","onupdatestart","onupdatestop","resolution","children","ref"]);const{camera:p,renderTarget:m}=Dg(()=>c(),()=>r(),()=>h()),{renderer:b,scene:v}=wt(),y=new pn,E=new pn;let _=0;const C=()=>{var D;if(_<l()){E.visible=!1;const U=v.fog,S=v.background;v.background=t()==="auto"?S:t(),v.fog=s()==="auto"?U:s(),p.update(b,v),v.background=S,v.fog=U,E.visible=!0,_+=1}else B(),(D=e.onupdatestop)==null||D.call(e)},{start:x,stop:B,started:I}=zt(C,{autoStart:!1}),k=()=>{var D,U;n()&&(B(),(D=e.onupdatestop)==null||D.call(e)),_=0,x(),(U=e.onupdatestart)==null||U.call(e)};nn(()=>[t(),r(),c(),s(),l(),h()],k),qe(o,yt({is:y},()=>f,{get ref(){return d()},set ref(D){d(D)},children:(D,U)=>{var S=JE(),R=ze(S);qe(R,{is:p});var Q=In(R,2);qe(Q,{is:E,children:(O,G)=>{var q=tt(),Z=ze(q);ut(Z,()=>e.children??ht,()=>({camera:p,ref:y,renderTarget:m,restart:k,update:C})),Le(O,q)},$$slots:{default:!0}}),Le(D,S)},$$slots:{default:!0}}));var P=at({camera:p,renderTarget:m,update:C,restart:k});return a(),P}const em=(o,e)=>{o.save();const i=o.fillStyle;o.fillStyle=e,o.fillRect(0,0,o.canvas.width,o.canvas.height),o.fillStyle=i,o.restore()},ZE=new Rt,tm=(o,e=[])=>{for(const i of e)o.addColorStop(i.offset,ZE.set(i.color).getStyle());return o};function jB(o,e){st(e,!0);let i=z(e,"width",3,1024),a=z(e,"height",3,1024),n=z(e,"startX",3,0),t=z(e,"startY",3,0),r=z(e,"endX",3,0),s=z(e,"endY",19,a),l=z(e,"stops",19,()=>[{offset:0,color:"black"},{offset:1,color:"white"}]),c=z(e,"attach",3,"map"),h=z(e,"ref",15),d=xt(e,["$$slots","$$events","$$legacy","width","height","startX","startY","endX","endY","stops","attach","children","ref"]);const f=new OffscreenCanvas(0,0),p=f.getContext("2d"),m=new ma(f);Ae(()=>{f.width=i()}),Ae(()=>{f.height=a()}),nn(()=>[e.wrapS,e.wrapT],()=>{m.needsUpdate=!0,v()});const b=Qe(()=>{const y=p==null?void 0:p.createLinearGradient(n(),t(),r(),s());return y!==void 0&&tm(y,l()),y}),{invalidate:v}=wt();Et(()=>{H(b)!==void 0&&p!==null&&(em(p,H(b)),m.needsUpdate=!0,v())}),qe(o,yt({is:m,get attach(){return c()}},()=>d,{get ref(){return h()},set ref(y){h(y)},children:(y,E)=>{var _=tt(),C=ze(_);ut(C,()=>e.children??ht,()=>({ref:m})),Le(y,_)},$$slots:{default:!0}})),at()}function qB(o,e){st(e,!0);let i=z(e,"width",3,1024),a=z(e,"height",3,1024),n=z(e,"innerRadius",3,0),t=z(e,"outerRadius",3,"auto"),r=z(e,"stops",19,()=>[{offset:0,color:"black"},{offset:1,color:"white"}]),s=z(e,"attach",3,"map"),l=z(e,"ref",15),c=xt(e,["$$slots","$$events","$$legacy","width","height","innerRadius","outerRadius","stops","attach","children","ref"]);const h=new OffscreenCanvas(0,0),d=h.getContext("2d"),f=new ma(h);Ae(()=>{h.width=i()}),Ae(()=>{h.height=a()}),nn(()=>[e.wrapS,e.wrapT],()=>{f.needsUpdate=!0,v()});let p=Qe(()=>.5*i()),m=Qe(()=>.5*a());const b=Qe(()=>{const y=d==null?void 0:d.createRadialGradient(H(p),H(m),n(),H(p),H(m),t()==="auto"?Math.hypot(H(p),H(m)):t());return y!==void 0&&tm(y,r()),y}),{invalidate:v}=wt();Et(()=>{H(b)!==void 0&&d!==null&&(em(d,H(b)),f.needsUpdate=!0,v())}),qe(o,yt({is:f},()=>c,{get attach(){return s()},get ref(){return l()},set ref(y){l(y)},children:(y,E)=>{var _=tt(),C=ze(_);ut(C,()=>e.children??ht,()=>({ref:f})),Le(y,_)},$$slots:{default:!0}})),at()}var _a;class $E{constructor(e){qi(this,_a,Ti(!1));nn(()=>[e()],([i])=>{const a=new IntersectionObserver(n=>{for(const t of n)this.isOffscreen=!t.isIntersecting});return a.observe(i),()=>{a.disconnect()}})}get isOffscreen(){return H(It(this,_a))}set isOffscreen(e){rn(It(this,_a),er(e))}}_a=new WeakMap;function ex(o,e){st(e,!0);const i=new $E(()=>e.dom),a=wt();Hb({dom:e.dom,canvas:a.canvas}),Vb();const{scene:n}=Lh();jb(n),qb(n);const{camera:t}=Ip();Wb();const{renderer:r,renderStage:s,canvas:l}=wt(),c=new ri,h=new ri;let d;const{start:f,stop:p}=zt(Symbol("<View>"),()=>{if(i.isOffscreen)return;const{left:v,bottom:y,width:E,height:_}=e.dom.getBoundingClientRect(),{bottom:C,left:x}=l.getBoundingClientRect(),B=C-y,I=v-x;r.getScissor(h),r.getViewport(c),d=r.getScissorTest(),r.setViewport(I,B,E,_),r.setScissor(I,B,E,_),r.setScissorTest(!0),r.render(n,t.current),r.setViewport(c),r.setScissor(h),r.setScissorTest(d)},{stage:s,autoStart:!1});Et(()=>{i.isOffscreen?p():f()});var m=tt(),b=ze(m);ut(b,()=>e.children??ht),Le(o,m),at()}function WB(o,e){st(e,!0);var i=tt(),a=ze(i);{var n=t=>{ex(t,{get dom(){return e.dom},children:(r,s)=>{var l=tt(),c=ze(l);ut(c,()=>e.children??ht),Le(r,l)},$$slots:{default:!0}})};En(a,t=>{e.dom&&t(n)})}Le(o,i),at()}class tx{constructor(e,i=" .:-=+*#%@",a={}){const n=a.resolution||.15,t=a.scale||1,r=a.color||!1,s=a.alpha||!1,l=a.block||!1,c=a.invert||!1,h=a.strResolution||"low";let d,f;const p=document.createElement("div");p.style.cursor="default";const m=document.createElement("table");p.appendChild(m);let b,v,y;this.setSize=function(S,R){d=S,f=R,e.setSize(S,R),E()},this.render=function(S,R){e.render(S,R),U(m)},this.domElement=p;function E(){b=Math.floor(d*n),v=Math.floor(f*n),x.width=b,x.height=v,y=e.domElement,y.style.backgroundColor&&(m.rows[0].cells[0].style.backgroundColor=y.style.backgroundColor,m.rows[0].cells[0].style.color=y.style.color),m.cellSpacing="0",m.cellPadding="0";const S=m.style;S.whiteSpace="pre",S.margin="0px",S.padding="0px",S.letterSpacing=D+"px",S.fontFamily=_,S.fontSize=k+"px",S.lineHeight=P+"px",S.textAlign="left",S.textDecoration="none"}const _="courier new, monospace",C=e.domElement,x=document.createElement("canvas");if(!x.getContext)return;const B=x.getContext("2d");if(!B.getImageData)return;let I;if(i)I=i.split("");else{const S=" .,:;i1tfLCG08@".split(""),R=" CGO08@".split("");I=r?R:S}const k=2/n*t,P=2/n*t;let D=0;if(h=="low")switch(t){case 1:D=-1;break;case 2:case 3:D=-2.1;break;case 4:D=-3.1;break;case 5:D=-4.15;break}if(h=="medium")switch(t){case 1:D=0;break;case 2:D=-1;break;case 3:D=-1.04;break;case 4:case 5:D=-2.1;break}if(h=="high")switch(t){case 1:case 2:D=0;break;case 3:case 4:case 5:D=-1;break}function U(S){B.clearRect(0,0,b,v),B.drawImage(C,0,0,b,v);const R=B.getImageData(0,0,b,v).data;let Q="";for(let O=0;O<v;O+=2){for(let G=0;G<b;G++){const q=(O*b+G)*4,Z=R[q],Y=R[q+1],j=R[q+2],L=R[q+3];let N,V;V=(.3*Z+.59*Y+.11*j)/255,L==0&&(V=1),N=Math.floor((1-V)*(I.length-1)),c&&(N=I.length-N-1);let J=I[N];(J===void 0||J==" ")&&(J="&nbsp;"),r?Q+="<span style='color:rgb("+Z+","+Y+","+j+");"+(l?"background-color:rgb("+Z+","+Y+","+j+");":"")+(s?"opacity:"+L/255+";":"")+"'>"+J+"</span>":Q+=J}Q+="<br/>"}S.innerHTML=`<tr><td style="display:block;width:${d}px;height:${f}px;overflow:hidden">${Q}</td></tr>`}}}function KB(o,e){st(e,!0);const i=" .:-+*=%@#";let a=z(e,"autoRender",3,!0),n=z(e,"bgColor",3,"#000000"),t=z(e,"characters",3,i),r=z(e,"fgColor",3,"#ffffff"),s=z(e,"options",19,()=>({}));const{autoRender:l,camera:c,renderStage:h,renderer:d,canvas:f,dom:p,scene:m,size:b}=wt(),v=Qe(()=>t()||i),y=Qe(()=>{const D=new tx(d,H(v),s());return D.domElement.style.position="absolute",D.domElement.style.top="0px",D.domElement.style.left="0px",D.domElement.style.pointerEvents="none",D}),E=()=>H(y),_=Jl(b);Ae(()=>{H(y).setSize(_.current.width,_.current.height)}),Ae(()=>{H(y).domElement.style.color=r()}),Ae(()=>{H(y).domElement.style.backgroundColor=n()}),Et(()=>{f.style.opacity="0";const D=H(y).domElement;return p.appendChild(D),()=>{f.style.opacity="1",p.removeChild(D)}});const{start:C,stop:x}=zt(()=>{H(y).render(e.scene??m,e.camera??c.current)},{autoInvalidate:!1,autoStart:!1,stage:h}),B=()=>{var D;C(),(D=e.onstart)==null||D.call(e)},I=()=>{var D;x(),(D=e.onstop)==null||D.call(e)};Et(()=>{if(a())return B(),()=>{I()}}),Et(()=>{const D=l.current;return l.set(!a()),()=>{l.set(D)}});var k=tt(),P=ze(k);return ut(P,()=>e.children??ht,()=>({asciiEffect:H(y)})),Le(o,k),at({getEffect:E,start:B,stop:I})}const Vu=typeof window<"u"?document.createElement("div"):void 0,YB=()=>{us("transitions",o=>{if(!Vu||!o.props.in&&!o.props.out&&!o.props.transition)return;const{invalidate:e}=wt();Vu.dispatchEvent=r=>{var s,l,c,h,d,f,p,m;return r.type==="introstart"?(l=(s=o.props).onintrostart)==null||l.call(s):r.type==="outrostart"?(h=(c=o.props).onoutrostart)==null||h.call(c):r.type==="introend"?(f=(d=o.props).onintroend)==null||f.call(d):r.type==="outroend"&&((m=(p=o.props).onoutroend)==null||m.call(p)),!0};const i=r=>(s,l,c)=>{const h=r(o.ref,{direction:c.direction});return{...h,tick(...d){var f;e(),(f=h==null?void 0:h.tick)==null||f.call(h,...d)}}},a=["in","out","transition"],n={in:5,out:6,transition:7},t={in:1,out:2,transition:3};for(const r of a){const s=o.props[r];if(s){const c="global"in s?n[r]:t[r];Z0(c,Vu,()=>i(s))}}return{pluginProps:["in","out","transition","onintrostart","onoutrostart","onintroend","onoutroend"]}})},XB=o=>o,JB=o=>Object.assign(o,{global:!0});var nx=Hn("<!> <!>",1);function ZB(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(s,"$suspended",i),t=()=>cn(l,"$errors",i);let r=z(e,"final",3,!1);const{suspended:s,errors:l,setFinal:c}=sy({final:r()});Et(()=>c(r())),Et(()=>{var E;n()||(E=e.onload)==null||E.call(e)}),Et(()=>{var E;n()&&((E=e.onsuspend)==null||E.call(e))}),Et(()=>{var E;t().length>0&&((E=e.onerror)==null||E.call(e,t()))});const{invalidate:h}=wt(),d=new pn,f=Kb();ii([f,s,l],([E,_,C])=>{if(E){if(_||C.length){E.remove(d),h();return}return E.add(d),h(),()=>{E.remove(d),h()}}});var p=nx(),m=ze(p);qe(m,{is:d,attach:!1,children:(E,_)=>{var C=tt(),x=ze(C);ut(x,()=>e.children??ht,()=>({suspended:n(),errors:t()})),Le(E,C)},$$slots:{default:!0}});var b=In(m,2);{var v=E=>{var _=tt(),C=ze(_);ut(C,()=>e.error??ht,()=>({errors:t()})),Le(E,_)},y=E=>{var _=tt(),C=ze(_);{var x=B=>{var I=tt(),k=ze(I);ut(k,()=>e.fallback??ht),Le(B,I)};En(C,B=>{n()&&B(x)},!0)}Le(E,_)};En(b,E=>{t().length?E(v):E(y,!1)})}Le(o,p),at(),a()}const $B=o=>{const e=Cr(lc);let i;const a=wr(!1);if(Uh(()=>{e||(i=o()),a.set(!0)}),!e){di(()=>i==null?void 0:i());return}ii([e.suspended,a],([n,t])=>(t&&!n&&(i=o()),()=>i==null?void 0:i()))},eS=o=>{const e=Cr(lc);if(!e)return;const i=wr(!1);Uh(()=>{i.set(!0)}),ii([e.suspended,i],([a,n])=>{n&&a&&o()})};var ix=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],rx=["difference","intersection","symmetricDifference","union"],ep=!1,as,Li,jr,Yl,nm;const Xl=class Xl extends Set{constructor(i){super();qi(this,Yl);qi(this,as,new Map);qi(this,Li,vr(0));qi(this,jr,vr(0));if(i){for(var a of i)super.add(a);It(this,jr).v=super.size}ep||Ps(this,Yl,nm).call(this)}has(i){var a=super.has(i),n=It(this,as),t=n.get(i);if(t===void 0){if(!a)return H(It(this,Li)),!1;t=vr(!0),n.set(i,t)}return H(t),a}add(i){return super.has(i)||(super.add(i),rn(It(this,jr),super.size),Vr(It(this,Li))),this}delete(i){var a=super.delete(i),n=It(this,as),t=n.get(i);return t!==void 0&&(n.delete(i),rn(t,!1)),a&&(rn(It(this,jr),super.size),Vr(It(this,Li))),a}clear(){if(super.size!==0){super.clear();var i=It(this,as);for(var a of i.values())rn(a,!1);i.clear(),rn(It(this,jr),0),Vr(It(this,Li))}}keys(){return this.values()}values(){return H(It(this,Li)),super.values()}entries(){return H(It(this,Li)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return H(It(this,jr))}};as=new WeakMap,Li=new WeakMap,jr=new WeakMap,Yl=new WeakSet,nm=function(){ep=!0;var i=Xl.prototype,a=Set.prototype;for(const n of ix)i[n]=function(...t){return H(It(this,Li)),a[n].apply(this,t)};for(const n of rx)i[n]=function(...t){H(It(this,Li));var r=a[n].apply(this,t);return new Xl(r)}};let xh=Xl;var Ji,Zi,br,ls,Ll;const fd=class fd extends Map{constructor(i){super();qi(this,ls);qi(this,Ji,new Map);qi(this,Zi,vr(0));qi(this,br,vr(0));if(i){for(var[a,n]of i)super.set(a,n);It(this,br).v=super.size}}has(i){var a=It(this,Ji),n=a.get(i);if(n===void 0){var t=super.get(i);if(t!==void 0)n=vr(0),a.set(i,n);else return H(It(this,Zi)),!1}return H(n),!0}forEach(i,a){Ps(this,ls,Ll).call(this),super.forEach(i,a)}get(i){var a=It(this,Ji),n=a.get(i);if(n===void 0){var t=super.get(i);if(t!==void 0)n=vr(0),a.set(i,n);else{H(It(this,Zi));return}}return H(n),super.get(i)}set(i,a){var d;var n=It(this,Ji),t=n.get(i),r=super.get(i),s=super.set(i,a),l=It(this,Zi);if(t===void 0)n.set(i,vr(0)),rn(It(this,br),super.size),Vr(l);else if(r!==a){Vr(t);var c=l.reactions===null?null:new Set(l.reactions),h=c===null||!((d=t.reactions)!=null&&d.every(f=>c.has(f)));h&&Vr(l)}return s}delete(i){var a=It(this,Ji),n=a.get(i),t=super.delete(i);return n!==void 0&&(a.delete(i),rn(It(this,br),super.size),rn(n,-1),Vr(It(this,Zi))),t}clear(){if(super.size!==0){super.clear();var i=It(this,Ji);rn(It(this,br),0);for(var a of i.values())rn(a,-1);Vr(It(this,Zi)),i.clear()}}keys(){return H(It(this,Zi)),super.keys()}values(){return Ps(this,ls,Ll).call(this),super.values()}entries(){return Ps(this,ls,Ll).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return H(It(this,br)),super.size}};Ji=new WeakMap,Zi=new WeakMap,br=new WeakMap,ls=new WeakSet,Ll=function(){H(It(this,Zi));var i=It(this,Ji);if(It(this,br).v!==i.size)for(var a of df(fd.prototype,this,"keys").call(this))i.has(a)||i.set(a,vr(0));for(var[,n]of It(this,Ji))H(n)};let Ih=fd;const ox=()=>{const o=new Ih;return{addPortal(i,a){o.has(a)?console.warn(`Portal with id ${a} already exists. Skipping portal creation.`):o.set(a,i)},removePortal(i){o.has(i)?o.delete(i):console.warn(`Portal with id ${i} does not exist. Skipping portal removal.`)},getPortal(i){return{get current(){return o.get(i)}}},hasPortal(i){return o.has(i)}}},im=()=>Oh("threlte-portals",ox());function tS(o,e){st(e,!0);let i=z(e,"id",3,"default");const{getPortal:a}=im(),n=a(i());let t=Qe(()=>e.object??n.current);const r=new xh,s=new Mi;s.add=d=>(r.add(d),d),s.remove=d=>(r.delete(d),d),s.clear=()=>(r.clear(),s),Ae(()=>{let d=H(t);if(d!==void 0){for(const f of r)d.children.includes(f)||d.add(f);return()=>{for(const f of r)d.children.includes(f)&&d.remove(f)}}});var l=tt(),c=ze(l);{var h=d=>{qe(d,{is:s,attach:!1,children:(f,p)=>{var m=tt(),b=ze(m);ut(b,()=>e.children??ht),Le(f,m)},$$slots:{default:!0}})};En(c,d=>{H(t)&&d(h)})}Le(o,l),at()}function nS(o,e){st(e,!0);const[i,a]=Vn(),n=()=>cn(r,"$parent",i);let t=z(e,"id",3,"default");const r=or();if(!n())throw new Error("<PortalTarget> must be used within a <Canvas> component.");const{addPortal:s,removePortal:l}=im();ii(r,c=>{if(!(!c||!Nt(c,"Object3D")))return s(c,t()),()=>{l(t())}}),at(),a()}function sx(){var o=Object.create(null);function e(n,t){var r=n.id,s=n.name,l=n.dependencies;l===void 0&&(l=[]);var c=n.init;c===void 0&&(c=function(){});var h=n.getTransferables;if(h===void 0&&(h=null),!o[r])try{l=l.map(function(f){return f&&f.isWorkerModule&&(e(f,function(p){if(p instanceof Error)throw p}),f=o[f.id].value),f}),c=a("<"+s+">.init",c),h&&(h=a("<"+s+">.getTransferables",h));var d=null;typeof c=="function"?d=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),o[r]={id:r,value:d,getTransferables:h},t(d)}catch(f){f&&f.noLog||console.error(f),t(f)}}function i(n,t){var r,s=n.id,l=n.args;(!o[s]||typeof o[s].value!="function")&&t(new Error("Worker module "+s+": not found or its 'init' did not return a function"));try{var c=(r=o[s]).value.apply(r,l);c&&typeof c.then=="function"?c.then(h,function(d){return t(d instanceof Error?d:new Error(""+d))}):h(c)}catch(d){t(d)}function h(d){try{var f=o[s].getTransferables&&o[s].getTransferables(d);(!f||!Array.isArray(f)||!f.length)&&(f=void 0),t(d,f)}catch(p){console.error(p),t(p)}}}function a(n,t){var r=void 0;self.troikaDefine=function(l){return r=l};var s=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+t+`
)`],{type:"application/javascript"}));try{importScripts(s)}catch(l){console.error(l)}return URL.revokeObjectURL(s),delete self.troikaDefine,r}self.addEventListener("message",function(n){var t=n.data,r=t.messageId,s=t.action,l=t.data;try{s==="registerModule"&&e(l,function(c){c instanceof Error?postMessage({messageId:r,success:!1,error:c.message}):postMessage({messageId:r,success:!0,result:{isCallable:typeof c=="function"}})}),s==="callModule"&&i(l,function(c,h){c instanceof Error?postMessage({messageId:r,success:!1,error:c.message}):postMessage({messageId:r,success:!0,result:c},h||void 0)})}catch(c){postMessage({messageId:r,success:!1,error:c.stack})}})}function ax(o){var e=function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];return e._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,i);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var i=o.dependencies,a=o.init;i=Array.isArray(i)?i.map(function(t){return t&&(t=t.onMainThread||t,t._getInitResult&&(t=t._getInitResult())),t}):[];var n=Promise.all(i).then(function(t){return a.apply(null,t)});return e._getInitResult=function(){return n},n},e}var rm=function(){var o=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),o=!0}catch(i){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+i.message+"]")}return rm=function(){return o},o},lx=0,cx=0,ju=!1,da=Object.create(null),fa=Object.create(null),Bh=Object.create(null);function As(o){if((!o||typeof o.init!="function")&&!ju)throw new Error("requires `options.init` function");var e=o.dependencies,i=o.init,a=o.getTransferables,n=o.workerId,t=ax(o);n==null&&(n="#default");var r="workerModule"+ ++lx,s=o.name||r,l=null;e=e&&e.map(function(h){return typeof h=="function"&&!h.workerModuleData&&(ju=!0,h=As({workerId:n,name:"<"+s+"> function dependency: "+h.name,init:`function(){return (
`+Ol(h)+`
)}`}),ju=!1),h&&h.workerModuleData&&(h=h.workerModuleData),h});function c(){for(var h=[],d=arguments.length;d--;)h[d]=arguments[d];if(!rm())return t.apply(void 0,h);if(!l){l=tp(n,"registerModule",c.workerModuleData);var f=function(){l=null,fa[n].delete(f)};(fa[n]||(fa[n]=new Set)).add(f)}return l.then(function(p){var m=p.isCallable;if(m)return tp(n,"callModule",{id:r,args:h});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:r,name:s,dependencies:e,init:Ol(i),getTransferables:a&&Ol(a)},c.onMainThread=t,c}function ux(o){fa[o]&&fa[o].forEach(function(e){e()}),da[o]&&(da[o].terminate(),delete da[o])}function Ol(o){var e=o.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function hx(o){var e=da[o];if(!e){var i=Ol(sx);e=da[o]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+o.replace(/\*/g,"")+` **/

;(`+i+")()"],{type:"application/javascript"}))),e.onmessage=function(a){var n=a.data,t=n.messageId,r=Bh[t];if(!r)throw new Error("WorkerModule response with empty or unknown messageId");delete Bh[t],r(n)}}return e}function tp(o,e,i){return new Promise(function(a,n){var t=++cx;Bh[t]=function(r){r.success?a(r.result):n(new Error("Error in worker "+e+" call: "+r.error))},hx(o).postMessage({messageId:t,action:e,data:i})})}const om=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Sh(o){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function i(a,n){let t=xn[n];return t?Sh(t):a}return o.replace(e,i)}const On=[];for(let o=0;o<256;o++)On[o]=(o<16?"0":"")+o.toString(16);function dx(){const o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,a=Math.random()*4294967295|0;return(On[o&255]+On[o>>8&255]+On[o>>16&255]+On[o>>24&255]+"-"+On[e&255]+On[e>>8&255]+"-"+On[e>>16&15|64]+On[e>>24&255]+"-"+On[i&63|128]+On[i>>8&255]+"-"+On[i>>16&255]+On[i>>24&255]+On[a&255]+On[a>>8&255]+On[a>>16&255]+On[a>>24&255]).toUpperCase()}const bo=Object.assign||function(){let o=arguments[0];for(let e=1,i=arguments.length;e<i;e++){let a=arguments[e];if(a)for(let n in a)Object.prototype.hasOwnProperty.call(a,n)&&(o[n]=a[n])}return o},fx=Date.now(),np=new WeakMap,ip=new Map;let Ax=1e10;function kh(o,e){const i=vx(e);let a=np.get(o);if(a||np.set(o,a=Object.create(null)),a[i])return new a[i];const n=`_onBeforeCompile${i}`,t=function(c,h){o.onBeforeCompile.call(this,c,h);const d=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let f=ip[d];if(!f){const p=px(this,c,e,i);f=ip[d]=p}c.vertexShader=f.vertexShader,c.fragmentShader=f.fragmentShader,bo(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-fx}}),this[n]&&this[n](c)},r=function(){return s(e.chained?o:o.clone())},s=function(c){const h=Object.create(c,l);return Object.defineProperty(h,"baseMaterial",{value:o}),Object.defineProperty(h,"id",{value:Ax++}),h.uuid=dx(),h.uniforms=bo({},c.uniforms,e.uniforms),h.defines=bo({},c.defines,e.defines),h.defines[`TROIKA_DERIVED_MATERIAL_${i}`]="",h.extensions=bo({},c.extensions,e.extensions),h._listeners=void 0,h},l={constructor:{value:r},isDerivedMaterial:{value:!0},type:{get:()=>o.type,set:c=>{o.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const h=this.baseMaterial;return c===h||h.isDerivedMaterial&&h.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return o.customProgramCacheKey()+"|"+i}},onBeforeCompile:{get(){return t},set(c){this[n]=c}},copy:{writable:!0,configurable:!0,value:function(c){return o.copy.call(this,c),!o.isShaderMaterial&&!o.isDerivedMaterial&&(bo(this.extensions,c.extensions),bo(this.defines,c.defines),bo(this.uniforms,hs.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new o.constructor;return s(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=kh(o.isDerivedMaterial?o.getDepthMaterial():new sc({depthPacking:nc}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=kh(o.isDerivedMaterial?o.getDistanceMaterial():new Vh,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:h}=this;c&&c.dispose(),h&&h.dispose(),o.dispose.call(this)}}};return a[i]=r,new r}function px(o,{vertexShader:e,fragmentShader:i},a,n){let{vertexDefs:t,vertexMainIntro:r,vertexMainOutro:s,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:h,fragmentMainOutro:d,fragmentColorTransform:f,customRewriter:p,timeUniform:m}=a;if(t=t||"",r=r||"",s=s||"",c=c||"",h=h||"",d=d||"",(l||p)&&(e=Sh(e)),(f||p)&&(i=i.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),i=Sh(i)),p){let b=p({vertexShader:e,fragmentShader:i});e=b.vertexShader,i=b.fragmentShader}if(f){let b=[];i=i.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,v=>(b.push(v),"")),d=`${f}
${b.join(`
`)}
${d}`}if(m){const b=`
uniform float ${m};
`;t=b+t,c=b+c}return l&&(e=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${e}
`,t=`${t}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,r=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${r}
`,e=e.replace(/\b(position|normal|uv)\b/g,(b,v,y,E)=>/\battribute\s+vec[23]\s+$/.test(E.substr(0,y))?v:`troika_${v}_${n}`),o.map&&o.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),e=rp(e,n,t,r,s),i=rp(i,n,c,h,d),{vertexShader:e,fragmentShader:i}}function rp(o,e,i,a,n){return(a||n||i)&&(o=o.replace(om,`
${i}
void troikaOrigMain${e}() {`),o+=`
void main() {
  ${a}
  troikaOrigMain${e}();
  ${n}
}`),o}function gx(o,e){return o==="uniforms"?void 0:typeof e=="function"?e.toString():e}let mx=0;const op=new Map;function vx(o){const e=JSON.stringify(o,gx);let i=op.get(e);return i==null&&op.set(e,i=++mx),i}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function bx(){return typeof window>"u"&&(self.window=self),function(o){var e={parse:function(n){var t=e._bin,r=new Uint8Array(n);if(t.readASCII(r,0,4)=="ttcf"){var s=4;t.readUshort(r,s),s+=2,t.readUshort(r,s),s+=2;var l=t.readUint(r,s);s+=4;for(var c=[],h=0;h<l;h++){var d=t.readUint(r,s);s+=4,c.push(e._readFont(r,d))}return c}return[e._readFont(r,0)]},_readFont:function(n,t){var r=e._bin,s=t;r.readFixed(n,t),t+=4;var l=r.readUshort(n,t);t+=2,r.readUshort(n,t),t+=2,r.readUshort(n,t),t+=2,r.readUshort(n,t),t+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],h={_data:n,_offset:s},d={},f=0;f<l;f++){var p=r.readASCII(n,t,4);t+=4,r.readUint(n,t),t+=4;var m=r.readUint(n,t);t+=4;var b=r.readUint(n,t);t+=4,d[p]={offset:m,length:b}}for(f=0;f<c.length;f++){var v=c[f];d[v]&&(h[v.trim()]=e[v.trim()].parse(n,d[v].offset,d[v].length,h))}return h},_tabOffset:function(n,t,r){for(var s=e._bin,l=s.readUshort(n,r+4),c=r+12,h=0;h<l;h++){var d=s.readASCII(n,c,4);c+=4,s.readUint(n,c),c+=4;var f=s.readUint(n,c);if(c+=4,s.readUint(n,c),c+=4,d==t)return f}return 0}};e._bin={readFixed:function(n,t){return(n[t]<<8|n[t+1])+(n[t+2]<<8|n[t+3])/65540},readF2dot14:function(n,t){return e._bin.readShort(n,t)/16384},readInt:function(n,t){return e._bin._view(n).getInt32(t)},readInt8:function(n,t){return e._bin._view(n).getInt8(t)},readShort:function(n,t){return e._bin._view(n).getInt16(t)},readUshort:function(n,t){return e._bin._view(n).getUint16(t)},readUshorts:function(n,t,r){for(var s=[],l=0;l<r;l++)s.push(e._bin.readUshort(n,t+2*l));return s},readUint:function(n,t){return e._bin._view(n).getUint32(t)},readUint64:function(n,t){return 4294967296*e._bin.readUint(n,t)+e._bin.readUint(n,t+4)},readASCII:function(n,t,r){for(var s="",l=0;l<r;l++)s+=String.fromCharCode(n[t+l]);return s},readUnicode:function(n,t,r){for(var s="",l=0;l<r;l++){var c=n[t++]<<8|n[t++];s+=String.fromCharCode(c)}return s},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(n,t,r){var s=e._bin._tdec;return s&&t==0&&r==n.length?s.decode(n):e._bin.readASCII(n,t,r)},readBytes:function(n,t,r){for(var s=[],l=0;l<r;l++)s.push(n[t+l]);return s},readASCIIArray:function(n,t,r){for(var s=[],l=0;l<r;l++)s.push(String.fromCharCode(n[t+l]));return s},_view:function(n){return n._dataView||(n._dataView=n.buffer?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(new Uint8Array(n).buffer))}},e._lctf={},e._lctf.parse=function(n,t,r,s,l){var c=e._bin,h={},d=t;c.readFixed(n,t),t+=4;var f=c.readUshort(n,t);t+=2;var p=c.readUshort(n,t);t+=2;var m=c.readUshort(n,t);return t+=2,h.scriptList=e._lctf.readScriptList(n,d+f),h.featureList=e._lctf.readFeatureList(n,d+p),h.lookupList=e._lctf.readLookupList(n,d+m,l),h},e._lctf.readLookupList=function(n,t,r){var s=e._bin,l=t,c=[],h=s.readUshort(n,t);t+=2;for(var d=0;d<h;d++){var f=s.readUshort(n,t);t+=2;var p=e._lctf.readLookupTable(n,l+f,r);c.push(p)}return c},e._lctf.readLookupTable=function(n,t,r){var s=e._bin,l=t,c={tabs:[]};c.ltype=s.readUshort(n,t),t+=2,c.flag=s.readUshort(n,t),t+=2;var h=s.readUshort(n,t);t+=2;for(var d=c.ltype,f=0;f<h;f++){var p=s.readUshort(n,t);t+=2;var m=r(n,d,l+p,c);c.tabs.push(m)}return c},e._lctf.numOfOnes=function(n){for(var t=0,r=0;r<32;r++)n>>>r&1&&t++;return t},e._lctf.readClassDef=function(n,t){var r=e._bin,s=[],l=r.readUshort(n,t);if(t+=2,l==1){var c=r.readUshort(n,t);t+=2;var h=r.readUshort(n,t);t+=2;for(var d=0;d<h;d++)s.push(c+d),s.push(c+d),s.push(r.readUshort(n,t)),t+=2}if(l==2){var f=r.readUshort(n,t);for(t+=2,d=0;d<f;d++)s.push(r.readUshort(n,t)),t+=2,s.push(r.readUshort(n,t)),t+=2,s.push(r.readUshort(n,t)),t+=2}return s},e._lctf.getInterval=function(n,t){for(var r=0;r<n.length;r+=3){var s=n[r],l=n[r+1];if(n[r+2],s<=t&&t<=l)return r}return-1},e._lctf.readCoverage=function(n,t){var r=e._bin,s={};s.fmt=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);return t+=2,s.fmt==1&&(s.tab=r.readUshorts(n,t,l)),s.fmt==2&&(s.tab=r.readUshorts(n,t,3*l)),s},e._lctf.coverageIndex=function(n,t){var r=n.tab;if(n.fmt==1)return r.indexOf(t);if(n.fmt==2){var s=e._lctf.getInterval(r,t);if(s!=-1)return r[s+2]+(t-r[s])}return-1},e._lctf.readFeatureList=function(n,t){var r=e._bin,s=t,l=[],c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=r.readASCII(n,t,4);t+=4;var f=r.readUshort(n,t);t+=2;var p=e._lctf.readFeatureTable(n,s+f);p.tag=d.trim(),l.push(p)}return l},e._lctf.readFeatureTable=function(n,t){var r=e._bin,s=t,l={},c=r.readUshort(n,t);t+=2,c>0&&(l.featureParams=s+c);var h=r.readUshort(n,t);t+=2,l.tab=[];for(var d=0;d<h;d++)l.tab.push(r.readUshort(n,t+2*d));return l},e._lctf.readScriptList=function(n,t){var r=e._bin,s=t,l={},c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=r.readASCII(n,t,4);t+=4;var f=r.readUshort(n,t);t+=2,l[d.trim()]=e._lctf.readScriptTable(n,s+f)}return l},e._lctf.readScriptTable=function(n,t){var r=e._bin,s=t,l={},c=r.readUshort(n,t);t+=2,c>0&&(l.default=e._lctf.readLangSysTable(n,s+c));var h=r.readUshort(n,t);t+=2;for(var d=0;d<h;d++){var f=r.readASCII(n,t,4);t+=4;var p=r.readUshort(n,t);t+=2,l[f.trim()]=e._lctf.readLangSysTable(n,s+p)}return l},e._lctf.readLangSysTable=function(n,t){var r=e._bin,s={};r.readUshort(n,t),t+=2,s.reqFeature=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);return t+=2,s.features=r.readUshorts(n,t,l),s},e.CFF={},e.CFF.parse=function(n,t,r){var s=e._bin;(n=new Uint8Array(n.buffer,t,r))[t=0],n[++t],n[++t],n[++t],t++;var l=[];t=e.CFF.readIndex(n,t,l);for(var c=[],h=0;h<l.length-1;h++)c.push(s.readASCII(n,t+l[h],l[h+1]-l[h]));t+=l[l.length-1];var d=[];t=e.CFF.readIndex(n,t,d);var f=[];for(h=0;h<d.length-1;h++)f.push(e.CFF.readDict(n,t+d[h],t+d[h+1]));t+=d[d.length-1];var p=f[0],m=[];t=e.CFF.readIndex(n,t,m);var b=[];for(h=0;h<m.length-1;h++)b.push(s.readASCII(n,t+m[h],m[h+1]-m[h]));if(t+=m[m.length-1],e.CFF.readSubrs(n,t,p),p.CharStrings){t=p.CharStrings,m=[],t=e.CFF.readIndex(n,t,m);var v=[];for(h=0;h<m.length-1;h++)v.push(s.readBytes(n,t+m[h],m[h+1]-m[h]));p.CharStrings=v}if(p.ROS){t=p.FDArray;var y=[];for(t=e.CFF.readIndex(n,t,y),p.FDArray=[],h=0;h<y.length-1;h++){var E=e.CFF.readDict(n,t+y[h],t+y[h+1]);e.CFF._readFDict(n,E,b),p.FDArray.push(E)}t+=y[y.length-1],t=p.FDSelect,p.FDSelect=[];var _=n[t];if(t++,_!=3)throw _;var C=s.readUshort(n,t);for(t+=2,h=0;h<C+1;h++)p.FDSelect.push(s.readUshort(n,t),n[t+2]),t+=3}return p.Encoding&&(p.Encoding=e.CFF.readEncoding(n,p.Encoding,p.CharStrings.length)),p.charset&&(p.charset=e.CFF.readCharset(n,p.charset,p.CharStrings.length)),e.CFF._readFDict(n,p,b),p},e.CFF._readFDict=function(n,t,r){var s;for(var l in t.Private&&(s=t.Private[1],t.Private=e.CFF.readDict(n,s,s+t.Private[0]),t.Private.Subrs&&e.CFF.readSubrs(n,s+t.Private.Subrs,t.Private)),t)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(t[l]=r[t[l]-426+35])},e.CFF.readSubrs=function(n,t,r){var s=e._bin,l=[];t=e.CFF.readIndex(n,t,l);var c,h=l.length;c=h<1240?107:h<33900?1131:32768,r.Bias=c,r.Subrs=[];for(var d=0;d<l.length-1;d++)r.Subrs.push(s.readBytes(n,t+l[d],l[d+1]-l[d]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(n,t){for(var r=0;r<n.charset.length;r++)if(n.charset[r]==t)return r;return-1},e.CFF.glyphBySE=function(n,t){return t<0||t>255?-1:e.CFF.glyphByUnicode(n,e.CFF.tableSE[t])},e.CFF.readEncoding=function(n,t,r){e._bin;var s=[".notdef"],l=n[t];if(t++,l!=0)throw"error: unknown encoding format: "+l;var c=n[t];t++;for(var h=0;h<c;h++)s.push(n[t+h]);return s},e.CFF.readCharset=function(n,t,r){var s=e._bin,l=[".notdef"],c=n[t];if(t++,c==0)for(var h=0;h<r;h++){var d=s.readUshort(n,t);t+=2,l.push(d)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<r;){d=s.readUshort(n,t),t+=2;var f=0;for(c==1?(f=n[t],t++):(f=s.readUshort(n,t),t+=2),h=0;h<=f;h++)l.push(d),d++}}return l},e.CFF.readIndex=function(n,t,r){var s=e._bin,l=s.readUshort(n,t)+1,c=n[t+=2];if(t++,c==1)for(var h=0;h<l;h++)r.push(n[t+h]);else if(c==2)for(h=0;h<l;h++)r.push(s.readUshort(n,t+2*h));else if(c==3)for(h=0;h<l;h++)r.push(16777215&s.readUint(n,t+3*h-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(t+=l*c)-1},e.CFF.getCharString=function(n,t,r){var s=e._bin,l=n[t],c=n[t+1];n[t+2],n[t+3],n[t+4];var h=1,d=null,f=null;l<=20&&(d=l,h=1),l==12&&(d=100*l+c,h=2),21<=l&&l<=27&&(d=l,h=1),l==28&&(f=s.readShort(n,t+1),h=3),29<=l&&l<=31&&(d=l,h=1),32<=l&&l<=246&&(f=l-139,h=1),247<=l&&l<=250&&(f=256*(l-247)+c+108,h=2),251<=l&&l<=254&&(f=256*-(l-251)-c-108,h=2),l==255&&(f=s.readInt(n,t+1)/65535,h=5),r.val=f??"o"+d,r.size=h},e.CFF.readCharString=function(n,t,r){for(var s=t+r,l=e._bin,c=[];t<s;){var h=n[t],d=n[t+1];n[t+2],n[t+3],n[t+4];var f=1,p=null,m=null;h<=20&&(p=h,f=1),h==12&&(p=100*h+d,f=2),h!=19&&h!=20||(p=h,f=2),21<=h&&h<=27&&(p=h,f=1),h==28&&(m=l.readShort(n,t+1),f=3),29<=h&&h<=31&&(p=h,f=1),32<=h&&h<=246&&(m=h-139,f=1),247<=h&&h<=250&&(m=256*(h-247)+d+108,f=2),251<=h&&h<=254&&(m=256*-(h-251)-d-108,f=2),h==255&&(m=l.readInt(n,t+1)/65535,f=5),c.push(m??"o"+p),t+=f}return c},e.CFF.readDict=function(n,t,r){for(var s=e._bin,l={},c=[];t<r;){var h=n[t],d=n[t+1];n[t+2],n[t+3],n[t+4];var f=1,p=null,m=null;if(h==28&&(m=s.readShort(n,t+1),f=3),h==29&&(m=s.readInt(n,t+1),f=5),32<=h&&h<=246&&(m=h-139,f=1),247<=h&&h<=250&&(m=256*(h-247)+d+108,f=2),251<=h&&h<=254&&(m=256*-(h-251)-d-108,f=2),h==255)throw m=s.readInt(n,t+1)/65535,f=5,"unknown number";if(h==30){var b=[];for(f=1;;){var v=n[t+f];f++;var y=v>>4,E=15&v;if(y!=15&&b.push(y),E!=15&&b.push(E),E==15)break}for(var _="",C=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],x=0;x<b.length;x++)_+=C[b[x]];m=parseFloat(_)}h<=21&&(p=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][h],f=1,h==12&&(p=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][d],f=2)),p!=null?(l[p]=c.length==1?c[0]:c,c=[]):c.push(m),t+=f}return l},e.cmap={},e.cmap.parse=function(n,t,r){n=new Uint8Array(n.buffer,t,r),t=0;var s=e._bin,l={};s.readUshort(n,t),t+=2;var c=s.readUshort(n,t);t+=2;var h=[];l.tables=[];for(var d=0;d<c;d++){var f=s.readUshort(n,t);t+=2;var p=s.readUshort(n,t);t+=2;var m=s.readUint(n,t);t+=4;var b="p"+f+"e"+p,v=h.indexOf(m);if(v==-1){var y;v=l.tables.length,h.push(m);var E=s.readUshort(n,m);E==0?y=e.cmap.parse0(n,m):E==4?y=e.cmap.parse4(n,m):E==6?y=e.cmap.parse6(n,m):E==12?y=e.cmap.parse12(n,m):console.debug("unknown format: "+E,f,p,m),l.tables.push(y)}if(l[b]!=null)throw"multiple tables for one platform+encoding";l[b]=v}return l},e.cmap.parse0=function(n,t){var r=e._bin,s={};s.format=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);t+=2,r.readUshort(n,t),t+=2,s.map=[];for(var c=0;c<l-6;c++)s.map.push(n[t+c]);return s},e.cmap.parse4=function(n,t){var r=e._bin,s=t,l={};l.format=r.readUshort(n,t),t+=2;var c=r.readUshort(n,t);t+=2,r.readUshort(n,t),t+=2;var h=r.readUshort(n,t);t+=2;var d=h/2;l.searchRange=r.readUshort(n,t),t+=2,l.entrySelector=r.readUshort(n,t),t+=2,l.rangeShift=r.readUshort(n,t),t+=2,l.endCount=r.readUshorts(n,t,d),t+=2*d,t+=2,l.startCount=r.readUshorts(n,t,d),t+=2*d,l.idDelta=[];for(var f=0;f<d;f++)l.idDelta.push(r.readShort(n,t)),t+=2;for(l.idRangeOffset=r.readUshorts(n,t,d),t+=2*d,l.glyphIdArray=[];t<s+c;)l.glyphIdArray.push(r.readUshort(n,t)),t+=2;return l},e.cmap.parse6=function(n,t){var r=e._bin,s={};s.format=r.readUshort(n,t),t+=2,r.readUshort(n,t),t+=2,r.readUshort(n,t),t+=2,s.firstCode=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);t+=2,s.glyphIdArray=[];for(var c=0;c<l;c++)s.glyphIdArray.push(r.readUshort(n,t)),t+=2;return s},e.cmap.parse12=function(n,t){var r=e._bin,s={};s.format=r.readUshort(n,t),t+=2,t+=2,r.readUint(n,t),t+=4,r.readUint(n,t),t+=4;var l=r.readUint(n,t);t+=4,s.groups=[];for(var c=0;c<l;c++){var h=t+12*c,d=r.readUint(n,h+0),f=r.readUint(n,h+4),p=r.readUint(n,h+8);s.groups.push([d,f,p])}return s},e.glyf={},e.glyf.parse=function(n,t,r,s){for(var l=[],c=0;c<s.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(n,t){var r=e._bin,s=n._data,l=e._tabOffset(s,"glyf",n._offset)+n.loca[t];if(n.loca[t]==n.loca[t+1])return null;var c={};if(c.noc=r.readShort(s,l),l+=2,c.xMin=r.readShort(s,l),l+=2,c.yMin=r.readShort(s,l),l+=2,c.xMax=r.readShort(s,l),l+=2,c.yMax=r.readShort(s,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var h=0;h<c.noc;h++)c.endPts.push(r.readUshort(s,l)),l+=2;var d=r.readUshort(s,l);if(l+=2,s.length-l<d)return null;c.instructions=r.readBytes(s,l,d),l+=d;var f=c.endPts[c.noc-1]+1;for(c.flags=[],h=0;h<f;h++){var p=s[l];if(l++,c.flags.push(p),(8&p)!=0){var m=s[l];l++;for(var b=0;b<m;b++)c.flags.push(p),h++}}for(c.xs=[],h=0;h<f;h++){var v=(2&c.flags[h])!=0,y=(16&c.flags[h])!=0;v?(c.xs.push(y?s[l]:-s[l]),l++):y?c.xs.push(0):(c.xs.push(r.readShort(s,l)),l+=2)}for(c.ys=[],h=0;h<f;h++)v=(4&c.flags[h])!=0,y=(32&c.flags[h])!=0,v?(c.ys.push(y?s[l]:-s[l]),l++):y?c.ys.push(0):(c.ys.push(r.readShort(s,l)),l+=2);var E=0,_=0;for(h=0;h<f;h++)E+=c.xs[h],_+=c.ys[h],c.xs[h]=E,c.ys[h]=_}else{var C;c.parts=[];do{C=r.readUshort(s,l),l+=2;var x={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(x),x.glyphIndex=r.readUshort(s,l),l+=2,1&C){var B=r.readShort(s,l);l+=2;var I=r.readShort(s,l);l+=2}else B=r.readInt8(s,l),l++,I=r.readInt8(s,l),l++;2&C?(x.m.tx=B,x.m.ty=I):(x.p1=B,x.p2=I),8&C?(x.m.a=x.m.d=r.readF2dot14(s,l),l+=2):64&C?(x.m.a=r.readF2dot14(s,l),l+=2,x.m.d=r.readF2dot14(s,l),l+=2):128&C&&(x.m.a=r.readF2dot14(s,l),l+=2,x.m.b=r.readF2dot14(s,l),l+=2,x.m.c=r.readF2dot14(s,l),l+=2,x.m.d=r.readF2dot14(s,l),l+=2)}while(32&C);if(256&C){var k=r.readUshort(s,l);for(l+=2,c.instr=[],h=0;h<k;h++)c.instr.push(s[l]),l++}}return c},e.GDEF={},e.GDEF.parse=function(n,t,r,s){var l=t;t+=4;var c=e._bin.readUshort(n,t);return{glyphClassDef:c===0?null:e._lctf.readClassDef(n,l+c)}},e.GPOS={},e.GPOS.parse=function(n,t,r,s){return e._lctf.parse(n,t,r,s,e.GPOS.subt)},e.GPOS.subt=function(n,t,r,s){var l=e._bin,c=r,h={};if(h.fmt=l.readUshort(n,r),r+=2,t==1||t==2||t==3||t==7||t==8&&h.fmt<=2){var d=l.readUshort(n,r);r+=2,h.coverage=e._lctf.readCoverage(n,d+c)}if(t==1&&h.fmt==1){var f=l.readUshort(n,r);r+=2,f!=0&&(h.pos=e.GPOS.readValueRecord(n,r,f))}else if(t==2&&h.fmt>=1&&h.fmt<=2){f=l.readUshort(n,r),r+=2;var p=l.readUshort(n,r);r+=2;var m=e._lctf.numOfOnes(f),b=e._lctf.numOfOnes(p);if(h.fmt==1){h.pairsets=[];var v=l.readUshort(n,r);r+=2;for(var y=0;y<v;y++){var E=c+l.readUshort(n,r);r+=2;var _=l.readUshort(n,E);E+=2;for(var C=[],x=0;x<_;x++){var B=l.readUshort(n,E);E+=2,f!=0&&(S=e.GPOS.readValueRecord(n,E,f),E+=2*m),p!=0&&(R=e.GPOS.readValueRecord(n,E,p),E+=2*b),C.push({gid2:B,val1:S,val2:R})}h.pairsets.push(C)}}if(h.fmt==2){var I=l.readUshort(n,r);r+=2;var k=l.readUshort(n,r);r+=2;var P=l.readUshort(n,r);r+=2;var D=l.readUshort(n,r);for(r+=2,h.classDef1=e._lctf.readClassDef(n,c+I),h.classDef2=e._lctf.readClassDef(n,c+k),h.matrix=[],y=0;y<P;y++){var U=[];for(x=0;x<D;x++){var S=null,R=null;f!=0&&(S=e.GPOS.readValueRecord(n,r,f),r+=2*m),p!=0&&(R=e.GPOS.readValueRecord(n,r,p),r+=2*b),U.push({val1:S,val2:R})}h.matrix.push(U)}}}else if(t==4&&h.fmt==1)h.markCoverage=e._lctf.readCoverage(n,l.readUshort(n,r)+c),h.baseCoverage=e._lctf.readCoverage(n,l.readUshort(n,r+2)+c),h.markClassCount=l.readUshort(n,r+4),h.markArray=e.GPOS.readMarkArray(n,l.readUshort(n,r+6)+c),h.baseArray=e.GPOS.readBaseArray(n,l.readUshort(n,r+8)+c,h.markClassCount);else if(t==6&&h.fmt==1)h.mark1Coverage=e._lctf.readCoverage(n,l.readUshort(n,r)+c),h.mark2Coverage=e._lctf.readCoverage(n,l.readUshort(n,r+2)+c),h.markClassCount=l.readUshort(n,r+4),h.mark1Array=e.GPOS.readMarkArray(n,l.readUshort(n,r+6)+c),h.mark2Array=e.GPOS.readBaseArray(n,l.readUshort(n,r+8)+c,h.markClassCount);else{if(t==9&&h.fmt==1){var Q=l.readUshort(n,r);r+=2;var O=l.readUint(n,r);if(r+=4,s.ltype==9)s.ltype=Q;else if(s.ltype!=Q)throw"invalid extension substitution";return e.GPOS.subt(n,s.ltype,c+O)}console.debug("unsupported GPOS table LookupType",t,"format",h.fmt)}return h},e.GPOS.readValueRecord=function(n,t,r){var s=e._bin,l=[];return l.push(1&r?s.readShort(n,t):0),t+=1&r?2:0,l.push(2&r?s.readShort(n,t):0),t+=2&r?2:0,l.push(4&r?s.readShort(n,t):0),t+=4&r?2:0,l.push(8&r?s.readShort(n,t):0),t+=8&r?2:0,l},e.GPOS.readBaseArray=function(n,t,r){var s=e._bin,l=[],c=t,h=s.readUshort(n,t);t+=2;for(var d=0;d<h;d++){for(var f=[],p=0;p<r;p++)f.push(e.GPOS.readAnchorRecord(n,c+s.readUshort(n,t))),t+=2;l.push(f)}return l},e.GPOS.readMarkArray=function(n,t){var r=e._bin,s=[],l=t,c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=e.GPOS.readAnchorRecord(n,r.readUshort(n,t+2)+l);d.markClass=r.readUshort(n,t),s.push(d),t+=4}return s},e.GPOS.readAnchorRecord=function(n,t){var r=e._bin,s={};return s.fmt=r.readUshort(n,t),s.x=r.readShort(n,t+2),s.y=r.readShort(n,t+4),s},e.GSUB={},e.GSUB.parse=function(n,t,r,s){return e._lctf.parse(n,t,r,s,e.GSUB.subt)},e.GSUB.subt=function(n,t,r,s){var l=e._bin,c=r,h={};if(h.fmt=l.readUshort(n,r),r+=2,t!=1&&t!=2&&t!=4&&t!=5&&t!=6)return null;if(t==1||t==2||t==4||t==5&&h.fmt<=2||t==6&&h.fmt<=2){var d=l.readUshort(n,r);r+=2,h.coverage=e._lctf.readCoverage(n,c+d)}if(t==1&&h.fmt>=1&&h.fmt<=2){if(h.fmt==1)h.delta=l.readShort(n,r),r+=2;else if(h.fmt==2){var f=l.readUshort(n,r);r+=2,h.newg=l.readUshorts(n,r,f),r+=2*h.newg.length}}else if(t==2&&h.fmt==1){f=l.readUshort(n,r),r+=2,h.seqs=[];for(var p=0;p<f;p++){var m=l.readUshort(n,r)+c;r+=2;var b=l.readUshort(n,m);h.seqs.push(l.readUshorts(n,m+2,b))}}else if(t==4)for(h.vals=[],f=l.readUshort(n,r),r+=2,p=0;p<f;p++){var v=l.readUshort(n,r);r+=2,h.vals.push(e.GSUB.readLigatureSet(n,c+v))}else if(t==5&&h.fmt==2){if(h.fmt==2){var y=l.readUshort(n,r);r+=2,h.cDef=e._lctf.readClassDef(n,c+y),h.scset=[];var E=l.readUshort(n,r);for(r+=2,p=0;p<E;p++){var _=l.readUshort(n,r);r+=2,h.scset.push(_==0?null:e.GSUB.readSubClassSet(n,c+_))}}}else if(t==6&&h.fmt==3){if(h.fmt==3){for(p=0;p<3;p++){f=l.readUshort(n,r),r+=2;for(var C=[],x=0;x<f;x++)C.push(e._lctf.readCoverage(n,c+l.readUshort(n,r+2*x)));r+=2*f,p==0&&(h.backCvg=C),p==1&&(h.inptCvg=C),p==2&&(h.ahedCvg=C)}f=l.readUshort(n,r),r+=2,h.lookupRec=e.GSUB.readSubstLookupRecords(n,r,f)}}else{if(t==7&&h.fmt==1){var B=l.readUshort(n,r);r+=2;var I=l.readUint(n,r);if(r+=4,s.ltype==9)s.ltype=B;else if(s.ltype!=B)throw"invalid extension substitution";return e.GSUB.subt(n,s.ltype,c+I)}console.debug("unsupported GSUB table LookupType",t,"format",h.fmt)}return h},e.GSUB.readSubClassSet=function(n,t){var r=e._bin.readUshort,s=t,l=[],c=r(n,t);t+=2;for(var h=0;h<c;h++){var d=r(n,t);t+=2,l.push(e.GSUB.readSubClassRule(n,s+d))}return l},e.GSUB.readSubClassRule=function(n,t){var r=e._bin.readUshort,s={},l=r(n,t),c=r(n,t+=2);t+=2,s.input=[];for(var h=0;h<l-1;h++)s.input.push(r(n,t)),t+=2;return s.substLookupRecords=e.GSUB.readSubstLookupRecords(n,t,c),s},e.GSUB.readSubstLookupRecords=function(n,t,r){for(var s=e._bin.readUshort,l=[],c=0;c<r;c++)l.push(s(n,t),s(n,t+2)),t+=4;return l},e.GSUB.readChainSubClassSet=function(n,t){var r=e._bin,s=t,l=[],c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=r.readUshort(n,t);t+=2,l.push(e.GSUB.readChainSubClassRule(n,s+d))}return l},e.GSUB.readChainSubClassRule=function(n,t){for(var r=e._bin,s={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var h=r.readUshort(n,t);t+=2,c==1&&h--,s[l[c]]=r.readUshorts(n,t,h),t+=2*s[l[c]].length}return h=r.readUshort(n,t),t+=2,s.subst=r.readUshorts(n,t,2*h),t+=2*s.subst.length,s},e.GSUB.readLigatureSet=function(n,t){var r=e._bin,s=t,l=[],c=r.readUshort(n,t);t+=2;for(var h=0;h<c;h++){var d=r.readUshort(n,t);t+=2,l.push(e.GSUB.readLigature(n,s+d))}return l},e.GSUB.readLigature=function(n,t){var r=e._bin,s={chain:[]};s.nglyph=r.readUshort(n,t),t+=2;var l=r.readUshort(n,t);t+=2;for(var c=0;c<l-1;c++)s.chain.push(r.readUshort(n,t)),t+=2;return s},e.head={},e.head.parse=function(n,t,r){var s=e._bin,l={};return s.readFixed(n,t),t+=4,l.fontRevision=s.readFixed(n,t),t+=4,s.readUint(n,t),t+=4,s.readUint(n,t),t+=4,l.flags=s.readUshort(n,t),t+=2,l.unitsPerEm=s.readUshort(n,t),t+=2,l.created=s.readUint64(n,t),t+=8,l.modified=s.readUint64(n,t),t+=8,l.xMin=s.readShort(n,t),t+=2,l.yMin=s.readShort(n,t),t+=2,l.xMax=s.readShort(n,t),t+=2,l.yMax=s.readShort(n,t),t+=2,l.macStyle=s.readUshort(n,t),t+=2,l.lowestRecPPEM=s.readUshort(n,t),t+=2,l.fontDirectionHint=s.readShort(n,t),t+=2,l.indexToLocFormat=s.readShort(n,t),t+=2,l.glyphDataFormat=s.readShort(n,t),t+=2,l},e.hhea={},e.hhea.parse=function(n,t,r){var s=e._bin,l={};return s.readFixed(n,t),t+=4,l.ascender=s.readShort(n,t),t+=2,l.descender=s.readShort(n,t),t+=2,l.lineGap=s.readShort(n,t),t+=2,l.advanceWidthMax=s.readUshort(n,t),t+=2,l.minLeftSideBearing=s.readShort(n,t),t+=2,l.minRightSideBearing=s.readShort(n,t),t+=2,l.xMaxExtent=s.readShort(n,t),t+=2,l.caretSlopeRise=s.readShort(n,t),t+=2,l.caretSlopeRun=s.readShort(n,t),t+=2,l.caretOffset=s.readShort(n,t),t+=2,t+=8,l.metricDataFormat=s.readShort(n,t),t+=2,l.numberOfHMetrics=s.readUshort(n,t),t+=2,l},e.hmtx={},e.hmtx.parse=function(n,t,r,s){for(var l=e._bin,c={aWidth:[],lsBearing:[]},h=0,d=0,f=0;f<s.maxp.numGlyphs;f++)f<s.hhea.numberOfHMetrics&&(h=l.readUshort(n,t),t+=2,d=l.readShort(n,t),t+=2),c.aWidth.push(h),c.lsBearing.push(d);return c},e.kern={},e.kern.parse=function(n,t,r,s){var l=e._bin,c=l.readUshort(n,t);if(t+=2,c==1)return e.kern.parseV1(n,t-2,r,s);var h=l.readUshort(n,t);t+=2;for(var d={glyph1:[],rval:[]},f=0;f<h;f++){t+=2,r=l.readUshort(n,t),t+=2;var p=l.readUshort(n,t);t+=2;var m=p>>>8;if((m&=15)!=0)throw"unknown kern table format: "+m;t=e.kern.readFormat0(n,t,d)}return d},e.kern.parseV1=function(n,t,r,s){var l=e._bin;l.readFixed(n,t),t+=4;var c=l.readUint(n,t);t+=4;for(var h={glyph1:[],rval:[]},d=0;d<c;d++){l.readUint(n,t),t+=4;var f=l.readUshort(n,t);t+=2,l.readUshort(n,t),t+=2;var p=f>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;t=e.kern.readFormat0(n,t,h)}return h},e.kern.readFormat0=function(n,t,r){var s=e._bin,l=-1,c=s.readUshort(n,t);t+=2,s.readUshort(n,t),t+=2,s.readUshort(n,t),t+=2,s.readUshort(n,t),t+=2;for(var h=0;h<c;h++){var d=s.readUshort(n,t);t+=2;var f=s.readUshort(n,t);t+=2;var p=s.readShort(n,t);t+=2,d!=l&&(r.glyph1.push(d),r.rval.push({glyph2:[],vals:[]}));var m=r.rval[r.rval.length-1];m.glyph2.push(f),m.vals.push(p),l=d}return t},e.loca={},e.loca.parse=function(n,t,r,s){var l=e._bin,c=[],h=s.head.indexToLocFormat,d=s.maxp.numGlyphs+1;if(h==0)for(var f=0;f<d;f++)c.push(l.readUshort(n,t+(f<<1))<<1);if(h==1)for(f=0;f<d;f++)c.push(l.readUint(n,t+(f<<2)));return c},e.maxp={},e.maxp.parse=function(n,t,r){var s=e._bin,l={},c=s.readUint(n,t);return t+=4,l.numGlyphs=s.readUshort(n,t),t+=2,c==65536&&(l.maxPoints=s.readUshort(n,t),t+=2,l.maxContours=s.readUshort(n,t),t+=2,l.maxCompositePoints=s.readUshort(n,t),t+=2,l.maxCompositeContours=s.readUshort(n,t),t+=2,l.maxZones=s.readUshort(n,t),t+=2,l.maxTwilightPoints=s.readUshort(n,t),t+=2,l.maxStorage=s.readUshort(n,t),t+=2,l.maxFunctionDefs=s.readUshort(n,t),t+=2,l.maxInstructionDefs=s.readUshort(n,t),t+=2,l.maxStackElements=s.readUshort(n,t),t+=2,l.maxSizeOfInstructions=s.readUshort(n,t),t+=2,l.maxComponentElements=s.readUshort(n,t),t+=2,l.maxComponentDepth=s.readUshort(n,t),t+=2),l},e.name={},e.name.parse=function(n,t,r){var s=e._bin,l={};s.readUshort(n,t),t+=2;var c=s.readUshort(n,t);t+=2,s.readUshort(n,t);for(var h,d=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=t+=2,p=0;p<c;p++){var m=s.readUshort(n,t);t+=2;var b=s.readUshort(n,t);t+=2;var v=s.readUshort(n,t);t+=2;var y=s.readUshort(n,t);t+=2;var E=s.readUshort(n,t);t+=2;var _=s.readUshort(n,t);t+=2;var C,x=d[y],B=f+12*c+_;if(m==0)C=s.readUnicode(n,B,E/2);else if(m==3&&b==0)C=s.readUnicode(n,B,E/2);else if(b==0)C=s.readASCII(n,B,E);else if(b==1)C=s.readUnicode(n,B,E/2);else if(b==3)C=s.readUnicode(n,B,E/2);else{if(m!=1)throw"unknown encoding "+b+", platformID: "+m;C=s.readASCII(n,B,E),console.debug("reading unknown MAC encoding "+b+" as ASCII")}var I="p"+m+","+v.toString(16);l[I]==null&&(l[I]={}),l[I][x!==void 0?x:y]=C,l[I]._lang=v}for(var k in l)if(l[k].postScriptName!=null&&l[k]._lang==1033)return l[k];for(var k in l)if(l[k].postScriptName!=null&&l[k]._lang==0)return l[k];for(var k in l)if(l[k].postScriptName!=null&&l[k]._lang==3084)return l[k];for(var k in l)if(l[k].postScriptName!=null)return l[k];for(var k in l){h=k;break}return console.debug("returning name table with languageID "+l[h]._lang),l[h]},e["OS/2"]={},e["OS/2"].parse=function(n,t,r){var s=e._bin.readUshort(n,t);t+=2;var l={};if(s==0)e["OS/2"].version0(n,t,l);else if(s==1)e["OS/2"].version1(n,t,l);else if(s==2||s==3||s==4)e["OS/2"].version2(n,t,l);else{if(s!=5)throw"unknown OS/2 table version: "+s;e["OS/2"].version5(n,t,l)}return l},e["OS/2"].version0=function(n,t,r){var s=e._bin;return r.xAvgCharWidth=s.readShort(n,t),t+=2,r.usWeightClass=s.readUshort(n,t),t+=2,r.usWidthClass=s.readUshort(n,t),t+=2,r.fsType=s.readUshort(n,t),t+=2,r.ySubscriptXSize=s.readShort(n,t),t+=2,r.ySubscriptYSize=s.readShort(n,t),t+=2,r.ySubscriptXOffset=s.readShort(n,t),t+=2,r.ySubscriptYOffset=s.readShort(n,t),t+=2,r.ySuperscriptXSize=s.readShort(n,t),t+=2,r.ySuperscriptYSize=s.readShort(n,t),t+=2,r.ySuperscriptXOffset=s.readShort(n,t),t+=2,r.ySuperscriptYOffset=s.readShort(n,t),t+=2,r.yStrikeoutSize=s.readShort(n,t),t+=2,r.yStrikeoutPosition=s.readShort(n,t),t+=2,r.sFamilyClass=s.readShort(n,t),t+=2,r.panose=s.readBytes(n,t,10),t+=10,r.ulUnicodeRange1=s.readUint(n,t),t+=4,r.ulUnicodeRange2=s.readUint(n,t),t+=4,r.ulUnicodeRange3=s.readUint(n,t),t+=4,r.ulUnicodeRange4=s.readUint(n,t),t+=4,r.achVendID=[s.readInt8(n,t),s.readInt8(n,t+1),s.readInt8(n,t+2),s.readInt8(n,t+3)],t+=4,r.fsSelection=s.readUshort(n,t),t+=2,r.usFirstCharIndex=s.readUshort(n,t),t+=2,r.usLastCharIndex=s.readUshort(n,t),t+=2,r.sTypoAscender=s.readShort(n,t),t+=2,r.sTypoDescender=s.readShort(n,t),t+=2,r.sTypoLineGap=s.readShort(n,t),t+=2,r.usWinAscent=s.readUshort(n,t),t+=2,r.usWinDescent=s.readUshort(n,t),t+=2},e["OS/2"].version1=function(n,t,r){var s=e._bin;return t=e["OS/2"].version0(n,t,r),r.ulCodePageRange1=s.readUint(n,t),t+=4,r.ulCodePageRange2=s.readUint(n,t),t+=4},e["OS/2"].version2=function(n,t,r){var s=e._bin;return t=e["OS/2"].version1(n,t,r),r.sxHeight=s.readShort(n,t),t+=2,r.sCapHeight=s.readShort(n,t),t+=2,r.usDefault=s.readUshort(n,t),t+=2,r.usBreak=s.readUshort(n,t),t+=2,r.usMaxContext=s.readUshort(n,t),t+=2},e["OS/2"].version5=function(n,t,r){var s=e._bin;return t=e["OS/2"].version2(n,t,r),r.usLowerOpticalPointSize=s.readUshort(n,t),t+=2,r.usUpperOpticalPointSize=s.readUshort(n,t),t+=2},e.post={},e.post.parse=function(n,t,r){var s=e._bin,l={};return l.version=s.readFixed(n,t),t+=4,l.italicAngle=s.readFixed(n,t),t+=4,l.underlinePosition=s.readShort(n,t),t+=2,l.underlineThickness=s.readShort(n,t),t+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(n,t){var r=n.cmap,s=-1;if(r.p0e4!=null?s=r.p0e4:r.p3e1!=null?s=r.p3e1:r.p1e0!=null?s=r.p1e0:r.p0e3!=null&&(s=r.p0e3),s==-1)throw"no familiar platform and encoding!";var l=r.tables[s];if(l.format==0)return t>=l.map.length?0:l.map[t];if(l.format==4){for(var c=-1,h=0;h<l.endCount.length;h++)if(t<=l.endCount[h]){c=h;break}return c==-1||l.startCount[c]>t?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[t-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:t+l.idDelta[c])}if(l.format==12){if(t>l.groups[l.groups.length-1][1])return 0;for(h=0;h<l.groups.length;h++){var d=l.groups[h];if(d[0]<=t&&t<=d[1])return d[2]+(t-d[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(n,t){var r={cmds:[],crds:[]};if(n.SVG&&n.SVG.entries[t]){var s=n.SVG.entries[t];return s==null?r:(typeof s=="string"&&(s=e.SVG.toPath(s),n.SVG.entries[t]=s),s)}if(n.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:n.CFF.Private?n.CFF.Private.defaultWidthX:0,open:!1},c=n.CFF,h=n.CFF.Private;if(c.ROS){for(var d=0;c.FDSelect[d+2]<=t;)d+=2;h=c.FDArray[c.FDSelect[d+1]].Private}e.U._drawCFF(n.CFF.CharStrings[t],l,c,h,r)}else n.glyf&&e.U._drawGlyf(t,n,r);return r},e.U._drawGlyf=function(n,t,r){var s=t.glyf[n];s==null&&(s=t.glyf[n]=e.glyf._parseGlyf(t,n)),s!=null&&(s.noc>-1?e.U._simpleGlyph(s,r):e.U._compoGlyph(s,t,r))},e.U._simpleGlyph=function(n,t){for(var r=0;r<n.noc;r++){for(var s=r==0?0:n.endPts[r-1]+1,l=n.endPts[r],c=s;c<=l;c++){var h=c==s?l:c-1,d=c==l?s:c+1,f=1&n.flags[c],p=1&n.flags[h],m=1&n.flags[d],b=n.xs[c],v=n.ys[c];if(c==s)if(f){if(!p){e.U.P.moveTo(t,b,v);continue}e.U.P.moveTo(t,n.xs[h],n.ys[h])}else p?e.U.P.moveTo(t,n.xs[h],n.ys[h]):e.U.P.moveTo(t,(n.xs[h]+b)/2,(n.ys[h]+v)/2);f?p&&e.U.P.lineTo(t,b,v):m?e.U.P.qcurveTo(t,b,v,n.xs[d],n.ys[d]):e.U.P.qcurveTo(t,b,v,(b+n.xs[d])/2,(v+n.ys[d])/2)}e.U.P.closePath(t)}},e.U._compoGlyph=function(n,t,r){for(var s=0;s<n.parts.length;s++){var l={cmds:[],crds:[]},c=n.parts[s];e.U._drawGlyf(c.glyphIndex,t,l);for(var h=c.m,d=0;d<l.crds.length;d+=2){var f=l.crds[d],p=l.crds[d+1];r.crds.push(f*h.a+p*h.b+h.tx),r.crds.push(f*h.c+p*h.d+h.ty)}for(d=0;d<l.cmds.length;d++)r.cmds.push(l.cmds[d])}},e.U._getGlyphClass=function(n,t){var r=e._lctf.getInterval(t,n);return r==-1?0:t[r+2]},e.U._applySubs=function(n,t,r,s){for(var l=n.length-t-1,c=0;c<r.tabs.length;c++)if(r.tabs[c]!=null){var h,d=r.tabs[c];if(!d.coverage||(h=e._lctf.coverageIndex(d.coverage,n[t]))!=-1){if(r.ltype==1)n[t],d.fmt==1?n[t]=n[t]+d.delta:n[t]=d.newg[h];else if(r.ltype==4)for(var f=d.vals[h],p=0;p<f.length;p++){var m=f[p],b=m.chain.length;if(!(b>l)){for(var v=!0,y=0,E=0;E<b;E++){for(;n[t+y+(1+E)]==-1;)y++;m.chain[E]!=n[t+y+(1+E)]&&(v=!1)}if(v){for(n[t]=m.nglyph,E=0;E<b+y;E++)n[t+E+1]=-1;break}}}else if(r.ltype==5&&d.fmt==2)for(var _=e._lctf.getInterval(d.cDef,n[t]),C=d.cDef[_+2],x=d.scset[C],B=0;B<x.length;B++){var I=x[B],k=I.input;if(!(k.length>l)){for(v=!0,E=0;E<k.length;E++){var P=e._lctf.getInterval(d.cDef,n[t+1+E]);if(_==-1&&d.cDef[P+2]!=k[E]){v=!1;break}}if(v){var D=I.substLookupRecords;for(p=0;p<D.length;p+=2)D[p],D[p+1]}}}else if(r.ltype==6&&d.fmt==3){if(!e.U._glsCovered(n,d.backCvg,t-d.backCvg.length)||!e.U._glsCovered(n,d.inptCvg,t)||!e.U._glsCovered(n,d.ahedCvg,t+d.inptCvg.length))continue;var U=d.lookupRec;for(B=0;B<U.length;B+=2){_=U[B];var S=s[U[B+1]];e.U._applySubs(n,t+_,S,s)}}}}},e.U._glsCovered=function(n,t,r){for(var s=0;s<t.length;s++)if(e._lctf.coverageIndex(t[s],n[r+s])==-1)return!1;return!0},e.U.glyphsToPath=function(n,t,r){for(var s={cmds:[],crds:[]},l=0,c=0;c<t.length;c++){var h=t[c];if(h!=-1){for(var d=c<t.length-1&&t[c+1]!=-1?t[c+1]:0,f=e.U.glyphToPath(n,h),p=0;p<f.crds.length;p+=2)s.crds.push(f.crds[p]+l),s.crds.push(f.crds[p+1]);for(r&&s.cmds.push(r),p=0;p<f.cmds.length;p++)s.cmds.push(f.cmds[p]);r&&s.cmds.push("X"),l+=n.hmtx.aWidth[h],c<t.length-1&&(l+=e.U.getPairAdjustment(n,h,d))}}return s},e.U.P={},e.U.P.moveTo=function(n,t,r){n.cmds.push("M"),n.crds.push(t,r)},e.U.P.lineTo=function(n,t,r){n.cmds.push("L"),n.crds.push(t,r)},e.U.P.curveTo=function(n,t,r,s,l,c,h){n.cmds.push("C"),n.crds.push(t,r,s,l,c,h)},e.U.P.qcurveTo=function(n,t,r,s,l){n.cmds.push("Q"),n.crds.push(t,r,s,l)},e.U.P.closePath=function(n){n.cmds.push("Z")},e.U._drawCFF=function(n,t,r,s,l){for(var c=t.stack,h=t.nStems,d=t.haveWidth,f=t.width,p=t.open,m=0,b=t.x,v=t.y,y=0,E=0,_=0,C=0,x=0,B=0,I=0,k=0,P=0,D=0,U={val:0,size:0};m<n.length;){e.CFF.getCharString(n,m,U);var S=U.val;if(m+=U.size,S=="o1"||S=="o18")c.length%2!=0&&!d&&(f=c.shift()+s.nominalWidthX),h+=c.length>>1,c.length=0,d=!0;else if(S=="o3"||S=="o23")c.length%2!=0&&!d&&(f=c.shift()+s.nominalWidthX),h+=c.length>>1,c.length=0,d=!0;else if(S=="o4")c.length>1&&!d&&(f=c.shift()+s.nominalWidthX,d=!0),p&&e.U.P.closePath(l),v+=c.pop(),e.U.P.moveTo(l,b,v),p=!0;else if(S=="o5")for(;c.length>0;)b+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,b,v);else if(S=="o6"||S=="o7")for(var R=c.length,Q=S=="o6",O=0;O<R;O++){var G=c.shift();Q?b+=G:v+=G,Q=!Q,e.U.P.lineTo(l,b,v)}else if(S=="o8"||S=="o24"){R=c.length;for(var q=0;q+6<=R;)y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),b=_+c.shift(),v=C+c.shift(),e.U.P.curveTo(l,y,E,_,C,b,v),q+=6;S=="o24"&&(b+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,b,v))}else{if(S=="o11")break;if(S=="o1234"||S=="o1235"||S=="o1236"||S=="o1237")S=="o1234"&&(E=v,_=(y=b+c.shift())+c.shift(),D=C=E+c.shift(),B=C,k=v,b=(I=(x=(P=_+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,y,E,_,C,P,D),e.U.P.curveTo(l,x,B,I,k,b,v)),S=="o1235"&&(y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),P=_+c.shift(),D=C+c.shift(),x=P+c.shift(),B=D+c.shift(),I=x+c.shift(),k=B+c.shift(),b=I+c.shift(),v=k+c.shift(),c.shift(),e.U.P.curveTo(l,y,E,_,C,P,D),e.U.P.curveTo(l,x,B,I,k,b,v)),S=="o1236"&&(y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),D=C=E+c.shift(),B=C,I=(x=(P=_+c.shift())+c.shift())+c.shift(),k=B+c.shift(),b=I+c.shift(),e.U.P.curveTo(l,y,E,_,C,P,D),e.U.P.curveTo(l,x,B,I,k,b,v)),S=="o1237"&&(y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),P=_+c.shift(),D=C+c.shift(),x=P+c.shift(),B=D+c.shift(),I=x+c.shift(),k=B+c.shift(),Math.abs(I-b)>Math.abs(k-v)?b=I+c.shift():v=k+c.shift(),e.U.P.curveTo(l,y,E,_,C,P,D),e.U.P.curveTo(l,x,B,I,k,b,v));else if(S=="o14"){if(c.length>0&&!d&&(f=c.shift()+r.nominalWidthX,d=!0),c.length==4){var Z=c.shift(),Y=c.shift(),j=c.shift(),L=c.shift(),N=e.CFF.glyphBySE(r,j),V=e.CFF.glyphBySE(r,L);e.U._drawCFF(r.CharStrings[N],t,r,s,l),t.x=Z,t.y=Y,e.U._drawCFF(r.CharStrings[V],t,r,s,l)}p&&(e.U.P.closePath(l),p=!1)}else if(S=="o19"||S=="o20")c.length%2!=0&&!d&&(f=c.shift()+s.nominalWidthX),h+=c.length>>1,c.length=0,d=!0,m+=h+7>>3;else if(S=="o21")c.length>2&&!d&&(f=c.shift()+s.nominalWidthX,d=!0),v+=c.pop(),b+=c.pop(),p&&e.U.P.closePath(l),e.U.P.moveTo(l,b,v),p=!0;else if(S=="o22")c.length>1&&!d&&(f=c.shift()+s.nominalWidthX,d=!0),b+=c.pop(),p&&e.U.P.closePath(l),e.U.P.moveTo(l,b,v),p=!0;else if(S=="o25"){for(;c.length>6;)b+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,b,v);y=b+c.shift(),E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),b=_+c.shift(),v=C+c.shift(),e.U.P.curveTo(l,y,E,_,C,b,v)}else if(S=="o26")for(c.length%2&&(b+=c.shift());c.length>0;)y=b,E=v+c.shift(),b=_=y+c.shift(),v=(C=E+c.shift())+c.shift(),e.U.P.curveTo(l,y,E,_,C,b,v);else if(S=="o27")for(c.length%2&&(v+=c.shift());c.length>0;)E=v,_=(y=b+c.shift())+c.shift(),C=E+c.shift(),b=_+c.shift(),v=C,e.U.P.curveTo(l,y,E,_,C,b,v);else if(S=="o10"||S=="o29"){var J=S=="o10"?s:r;if(c.length==0)console.debug("error: empty stack");else{var X=c.pop(),$=J.Subrs[X+J.Bias];t.x=b,t.y=v,t.nStems=h,t.haveWidth=d,t.width=f,t.open=p,e.U._drawCFF($,t,r,s,l),b=t.x,v=t.y,h=t.nStems,d=t.haveWidth,f=t.width,p=t.open}}else if(S=="o30"||S=="o31"){var ne=c.length,se=(q=0,S=="o31");for(q+=ne-(R=-3&ne);q<R;)se?(E=v,_=(y=b+c.shift())+c.shift(),v=(C=E+c.shift())+c.shift(),R-q==5?(b=_+c.shift(),q++):b=_,se=!1):(y=b,E=v+c.shift(),_=y+c.shift(),C=E+c.shift(),b=_+c.shift(),R-q==5?(v=C+c.shift(),q++):v=C,se=!0),e.U.P.curveTo(l,y,E,_,C,b,v),q+=4}else{if((S+"").charAt(0)=="o")throw console.debug("Unknown operation: "+S,n),S;c.push(S)}}}t.x=b,t.y=v,t.nStems=h,t.haveWidth=d,t.width=f,t.open=p};var i=e,a={Typr:i};return o.Typr=i,o.default=a,Object.defineProperty(o,"__esModule",{value:!0}),o}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function wx(){return function(o){var e=Uint8Array,i=Uint16Array,a=Uint32Array,n=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),t=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),r=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(S,R){for(var Q=new i(31),O=0;O<31;++O)Q[O]=R+=1<<S[O-1];var G=new a(Q[30]);for(O=1;O<30;++O)for(var q=Q[O];q<Q[O+1];++q)G[q]=q-Q[O]<<5|O;return[Q,G]},l=s(n,2),c=l[0],h=l[1];c[28]=258,h[258]=28;for(var d=s(t,0)[0],f=new i(32768),p=0;p<32768;++p){var m=(43690&p)>>>1|(21845&p)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,f[p]=((65280&m)>>>8|(255&m)<<8)>>>1}var b=function(S,R,Q){for(var O=S.length,G=0,q=new i(R);G<O;++G)++q[S[G]-1];var Z,Y=new i(R);for(G=0;G<R;++G)Y[G]=Y[G-1]+q[G-1]<<1;{Z=new i(1<<R);var j=15-R;for(G=0;G<O;++G)if(S[G])for(var L=G<<4|S[G],N=R-S[G],V=Y[S[G]-1]++<<N,J=V|(1<<N)-1;V<=J;++V)Z[f[V]>>>j]=L}return Z},v=new e(288);for(p=0;p<144;++p)v[p]=8;for(p=144;p<256;++p)v[p]=9;for(p=256;p<280;++p)v[p]=7;for(p=280;p<288;++p)v[p]=8;var y=new e(32);for(p=0;p<32;++p)y[p]=5;var E=b(v,9),_=b(y,5),C=function(S){for(var R=S[0],Q=1;Q<S.length;++Q)S[Q]>R&&(R=S[Q]);return R},x=function(S,R,Q){var O=R/8|0;return(S[O]|S[O+1]<<8)>>(7&R)&Q},B=function(S,R){var Q=R/8|0;return(S[Q]|S[Q+1]<<8|S[Q+2]<<16)>>(7&R)},I=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],k=function(S,R,Q){var O=new Error(R||I[S]);if(O.code=S,Error.captureStackTrace&&Error.captureStackTrace(O,k),!Q)throw O;return O},P=function(S,R,Q){var O=S.length;if(!O||Q&&!Q.l&&O<5)return R||new e(0);var G=!R||Q,q=!Q||Q.i;Q||(Q={}),R||(R=new e(3*O));var Z,Y=function(we){var ot=R.length;if(we>ot){var $e=new e(Math.max(2*ot,we));$e.set(R),R=$e}},j=Q.f||0,L=Q.p||0,N=Q.b||0,V=Q.l,J=Q.d,X=Q.m,$=Q.n,ne=8*O;do{if(!V){Q.f=j=x(S,L,1);var se=x(S,L+1,3);if(L+=3,!se){var _e=S[(he=((Z=L)/8|0)+(7&Z&&1)+4)-4]|S[he-3]<<8,be=he+_e;if(be>O){q&&k(0);break}G&&Y(N+_e),R.set(S.subarray(he,be),N),Q.b=N+=_e,Q.p=L=8*be;continue}if(se==1)V=E,J=_,X=9,$=5;else if(se==2){var oe=x(S,L,31)+257,ue=x(S,L+10,15)+4,We=oe+x(S,L+5,31)+1;L+=14;for(var Te=new e(We),Se=new e(19),Be=0;Be<ue;++Be)Se[r[Be]]=x(S,L+3*Be,7);L+=3*ue;var Ue=C(Se),ke=(1<<Ue)-1,He=b(Se,Ue);for(Be=0;Be<We;){var he,te=He[x(S,L,ke)];if(L+=15&te,(he=te>>>4)<16)Te[Be++]=he;else{var Ee=0,pe=0;for(he==16?(pe=3+x(S,L,3),L+=2,Ee=Te[Be-1]):he==17?(pe=3+x(S,L,7),L+=3):he==18&&(pe=11+x(S,L,127),L+=7);pe--;)Te[Be++]=Ee}}var Ce=Te.subarray(0,oe),ge=Te.subarray(oe);X=C(Ce),$=C(ge),V=b(Ce,X),J=b(ge,$)}else k(1);if(L>ne){q&&k(0);break}}G&&Y(N+131072);for(var Je=(1<<X)-1,de=(1<<$)-1,xe=L;;xe=L){var Ie=(Ee=V[B(S,L)&Je])>>>4;if((L+=15&Ee)>ne){q&&k(0);break}if(Ee||k(2),Ie<256)R[N++]=Ie;else{if(Ie==256){xe=L,V=null;break}var Oe=Ie-254;if(Ie>264){var it=n[Be=Ie-257];Oe=x(S,L,(1<<it)-1)+c[Be],L+=it}var pt=J[B(S,L)&de],Pe=pt>>>4;if(pt||k(3),L+=15&pt,ge=d[Pe],Pe>3&&(it=t[Pe],ge+=B(S,L)&(1<<it)-1,L+=it),L>ne){q&&k(0);break}G&&Y(N+131072);for(var Ze=N+Oe;N<Ze;N+=4)R[N]=R[N-ge],R[N+1]=R[N+1-ge],R[N+2]=R[N+2-ge],R[N+3]=R[N+3-ge];N=Ze}}Q.l=V,Q.p=xe,Q.b=N,V&&(j=1,Q.m=X,Q.d=J,Q.n=$)}while(!j);return N==R.length?R:function(we,ot,$e){($e==null||$e>we.length)&&($e=we.length);var dt=new(we instanceof i?i:we instanceof a?a:e)($e-ot);return dt.set(we.subarray(ot,$e)),dt}(R,0,N)},D=new e(0),U=typeof TextDecoder<"u"&&new TextDecoder;try{U.decode(D,{stream:!0})}catch{}return o.convert_streams=function(S){var R=new DataView(S),Q=0;function O(){var oe=R.getUint16(Q);return Q+=2,oe}function G(){var oe=R.getUint32(Q);return Q+=4,oe}function q(oe){_e.setUint16(be,oe),be+=2}function Z(oe){_e.setUint32(be,oe),be+=4}for(var Y={signature:G(),flavor:G(),length:G(),numTables:O(),reserved:O(),totalSfntSize:G(),majorVersion:O(),minorVersion:O(),metaOffset:G(),metaLength:G(),metaOrigLength:G(),privOffset:G(),privLength:G()},j=0;Math.pow(2,j)<=Y.numTables;)j++;j--;for(var L=16*Math.pow(2,j),N=16*Y.numTables-L,V=12,J=[],X=0;X<Y.numTables;X++)J.push({tag:G(),offset:G(),compLength:G(),origLength:G(),origChecksum:G()}),V+=16;var $,ne=new Uint8Array(12+16*J.length+J.reduce(function(oe,ue){return oe+ue.origLength+4},0)),se=ne.buffer,_e=new DataView(se),be=0;return Z(Y.flavor),q(Y.numTables),q(L),q(j),q(N),J.forEach(function(oe){Z(oe.tag),Z(oe.origChecksum),Z(V),Z(oe.origLength),oe.outOffset=V,(V+=oe.origLength)%4!=0&&(V+=4-V%4)}),J.forEach(function(oe){var ue,We=S.slice(oe.offset,oe.offset+oe.compLength);if(oe.compLength!=oe.origLength){var Te=new Uint8Array(oe.origLength);ue=new Uint8Array(We,2),P(ue,Te)}else Te=new Uint8Array(We);ne.set(Te,oe.outOffset);var Se=0;(V=oe.outOffset+oe.origLength)%4!=0&&(Se=4-V%4),ne.set(new Uint8Array(Se).buffer,oe.outOffset+oe.origLength),$=V+Se}),se.slice(0,$)},Object.defineProperty(o,"__esModule",{value:!0}),o}({}).convert_streams}function yx(o,e){const i={M:2,L:2,Q:4,C:6,Z:0},a={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},n=1,t=2,r=4,s=8,l=16,c=32;let h;function d(I){if(!h){const k={R:t,L:n,D:r,C:l,U:c,T:s};h=new Map;for(let P in a){let D=0;a[P].split(",").forEach(U=>{let[S,R]=U.split("+");S=parseInt(S,36),R=R?parseInt(R,36):0,h.set(D+=S,k[P]);for(let Q=R;Q--;)h.set(++D,k[P])})}}return h.get(I)||c}const f=1,p=2,m=3,b=4,v=[null,"isol","init","fina","medi"];function y(I){const k=new Uint8Array(I.length);let P=c,D=f,U=-1;for(let S=0;S<I.length;S++){const R=I.codePointAt(S);let Q=d(R)|0,O=f;Q&s||(P&(n|r|l)?Q&(t|r|l)?(O=m,(D===f||D===m)&&k[U]++):Q&(n|c)&&(D===p||D===b)&&k[U]--:P&(t|c)&&(D===p||D===b)&&k[U]--,D=k[S]=O,P=Q,U=S,R>65535&&S++)}return k}function E(I,k){const P=[];for(let U=0;U<k.length;U++){const S=k.codePointAt(U);S>65535&&U++,P.push(o.U.codeToGlyph(I,S))}const D=I.GSUB;if(D){const{lookupList:U,featureList:S}=D;let R;const Q=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,O=[];S.forEach(G=>{if(Q.test(G.tag))for(let q=0;q<G.tab.length;q++){if(O[G.tab[q]])continue;O[G.tab[q]]=!0;const Z=U[G.tab[q]],Y=/^(isol|init|fina|medi)$/.test(G.tag);Y&&!R&&(R=y(k));for(let j=0;j<P.length;j++)(!R||!Y||v[R[j]]===G.tag)&&o.U._applySubs(P,j,Z,U)}})}return P}function _(I,k){const P=new Int16Array(k.length*3);let D=0;for(;D<k.length;D++){const Q=k[D];if(Q===-1)continue;P[D*3+2]=I.hmtx.aWidth[Q];const O=I.GPOS;if(O){const G=O.lookupList;for(let q=0;q<G.length;q++){const Z=G[q];for(let Y=0;Y<Z.tabs.length;Y++){const j=Z.tabs[Y];if(Z.ltype===1){if(o._lctf.coverageIndex(j.coverage,Q)!==-1&&j.pos){R(j.pos,D);break}}else if(Z.ltype===2){let L=null,N=U();if(N!==-1){const V=o._lctf.coverageIndex(j.coverage,k[N]);if(V!==-1){if(j.fmt===1){const J=j.pairsets[V];for(let X=0;X<J.length;X++)J[X].gid2===Q&&(L=J[X])}else if(j.fmt===2){const J=o.U._getGlyphClass(k[N],j.classDef1),X=o.U._getGlyphClass(Q,j.classDef2);L=j.matrix[J][X]}if(L){L.val1&&R(L.val1,N),L.val2&&R(L.val2,D);break}}}}else if(Z.ltype===4){const L=o._lctf.coverageIndex(j.markCoverage,Q);if(L!==-1){const N=U(S),V=N===-1?-1:o._lctf.coverageIndex(j.baseCoverage,k[N]);if(V!==-1){const J=j.markArray[L],X=j.baseArray[V][J.markClass];P[D*3]=X.x-J.x+P[N*3]-P[N*3+2],P[D*3+1]=X.y-J.y+P[N*3+1];break}}}else if(Z.ltype===6){const L=o._lctf.coverageIndex(j.mark1Coverage,Q);if(L!==-1){const N=U();if(N!==-1){const V=k[N];if(C(I,V)===3){const J=o._lctf.coverageIndex(j.mark2Coverage,V);if(J!==-1){const X=j.mark1Array[L],$=j.mark2Array[J][X.markClass];P[D*3]=$.x-X.x+P[N*3]-P[N*3+2],P[D*3+1]=$.y-X.y+P[N*3+1];break}}}}}}}}else if(I.kern&&!I.cff){const G=U();if(G!==-1){const q=I.kern.glyph1.indexOf(k[G]);if(q!==-1){const Z=I.kern.rval[q].glyph2.indexOf(Q);Z!==-1&&(P[G*3+2]+=I.kern.rval[q].vals[Z])}}}}return P;function U(Q){for(let O=D-1;O>=0;O--)if(k[O]!==-1&&(!Q||Q(k[O])))return O;return-1}function S(Q){return C(I,Q)===1}function R(Q,O){for(let G=0;G<3;G++)P[O*3+G]+=Q[G]||0}}function C(I,k){const P=I.GDEF&&I.GDEF.glyphClassDef;return P?o.U._getGlyphClass(k,P):0}function x(...I){for(let k=0;k<I.length;k++)if(typeof I[k]=="number")return I[k]}function B(I){const k=Object.create(null),P=I["OS/2"],D=I.hhea,U=I.head.unitsPerEm,S=x(P&&P.sTypoAscender,D&&D.ascender,U),R={unitsPerEm:U,ascender:S,descender:x(P&&P.sTypoDescender,D&&D.descender,0),capHeight:x(P&&P.sCapHeight,S),xHeight:x(P&&P.sxHeight,S),lineGap:x(P&&P.sTypoLineGap,D&&D.lineGap),supportsCodePoint(Q){return o.U.codeToGlyph(I,Q)>0},forEachGlyph(Q,O,G,q){let Z=0;const Y=1/R.unitsPerEm*O,j=E(I,Q);let L=0;const N=_(I,j);return j.forEach((V,J)=>{if(V!==-1){let X=k[V];if(!X){const{cmds:$,crds:ne}=o.U.glyphToPath(I,V);let se="",_e=0;for(let Te=0,Se=$.length;Te<Se;Te++){const Be=i[$[Te]];se+=$[Te];for(let Ue=1;Ue<=Be;Ue++)se+=(Ue>1?",":"")+ne[_e++]}let be,oe,ue,We;if(ne.length){be=oe=1/0,ue=We=-1/0;for(let Te=0,Se=ne.length;Te<Se;Te+=2){let Be=ne[Te],Ue=ne[Te+1];Be<be&&(be=Be),Ue<oe&&(oe=Ue),Be>ue&&(ue=Be),Ue>We&&(We=Ue)}}else be=ue=oe=We=0;X=k[V]={index:V,advanceWidth:I.hmtx.aWidth[V],xMin:be,yMin:oe,xMax:ue,yMax:We,path:se}}q.call(null,X,Z+N[J*3]*Y,N[J*3+1]*Y,L),Z+=N[J*3+2]*Y,G&&(Z+=G*O)}L+=Q.codePointAt(L)>65535?2:1}),Z}};return R}return function(k){const P=new Uint8Array(k,0,4),D=o._bin.readASCII(P,0,4);if(D==="wOFF")k=e(k);else if(D==="wOF2")throw new Error("woff2 fonts not supported");return B(o.parse(k)[0])}}const _x=As({name:"Typr Font Parser",dependencies:[bx,wx,yx],init(o,e,i){const a=o(),n=e();return i(a,n)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function Cx(){return function(o){var e=function(){this.buckets=new Map};e.prototype.add=function(_){var C=_>>5;this.buckets.set(C,(this.buckets.get(C)||0)|1<<(31&_))},e.prototype.has=function(_){var C=this.buckets.get(_>>5);return C!==void 0&&(C&1<<(31&_))!=0},e.prototype.serialize=function(){var _=[];return this.buckets.forEach(function(C,x){_.push((+x).toString(36)+":"+C.toString(36))}),_.join(",")},e.prototype.deserialize=function(_){var C=this;this.buckets.clear(),_.split(",").forEach(function(x){var B=x.split(":");C.buckets.set(parseInt(B[0],36),parseInt(B[1],36))})};var i=Math.pow(2,8),a=i-1,n=~a;function t(_){var C=function(B){return B&n}(_).toString(16),x=function(B){return(B&n)+i-1}(_).toString(16);return"codepoint-index/plane"+(_>>16)+"/"+C+"-"+x+".json"}function r(_,C){var x=_&a,B=C.codePointAt(x/6|0);return((B=(B||48)-48)&1<<x%6)!=0}function s(_,C){var x;(x=_,x.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(B){return B.split("-").map(function(I){return parseInt(I.trim(),16)})})).forEach(function(B){var I=B[0],k=B[1];k===void 0&&(k=I),C(I,k)})}function l(_,C){s(_,function(x,B){for(var I=x;I<=B;I++)C(I)})}var c={},h={},d=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function p(_){var C=d.get(_);return C||(C=new e,l(_.ranges,function(x){return C.add(x)}),d.set(_,C)),C}var m,b=new Map;function v(_,C,x){return _[C]?C:_[x]?x:function(B){for(var I in B)return I}(_)}function y(_,C){var x=C;if(!_.includes(x)){x=1/0;for(var B=0;B<_.length;B++)Math.abs(_[B]-C)<Math.abs(x-C)&&(x=_[B])}return x}function E(_){return m||(m=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(C){m.add(C)})),m.has(_)}return o.CodePointSet=e,o.clearCache=function(){c={},h={}},o.getFontsForString=function(_,C){C===void 0&&(C={});var x,B=C.lang;B===void 0&&(B=new RegExp("\\p{Script=Hangul}","u").test(x=_)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(x)?"ja":"en");var I=C.category;I===void 0&&(I="sans-serif");var k=C.style;k===void 0&&(k="normal");var P=C.weight;P===void 0&&(P=400);var D=(C.dataUrl||f).replace(/\/$/g,""),U=new Map,S=new Uint8Array(_.length),R={},Q={},O=new Array(_.length),G=new Map,q=!1;function Z(L){var N=b.get(L);return N||(N=fetch(D+"/"+L).then(function(V){if(!V.ok)throw new Error(V.statusText);return V.json().then(function(J){if(!Array.isArray(J)||J[0]!==1)throw new Error("Incorrect schema version; need 1, got "+J[0]);return J[1]})}).catch(function(V){if(D!==f)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+D+'", trying default CDN. '+V.message),q=!0),D=f,b.delete(L),Z(L);throw V}),b.set(L,N)),N}for(var Y=function(L){var N=_.codePointAt(L),V=t(N);O[L]=V,c[V]||G.has(V)||G.set(V,Z(V).then(function(J){c[V]=J})),N>65535&&(L++,j=L)},j=0;j<_.length;j++)Y(j);return Promise.all(G.values()).then(function(){G.clear();for(var L=function(V){var J=_.codePointAt(V),X=null,$=c[O[V]],ne=void 0;for(var se in $){var _e=Q[se];if(_e===void 0&&(_e=Q[se]=new RegExp(se).test(B||"en")),_e){for(var be in ne=se,$[se])if(r(J,$[se][be])){X=be;break}break}}if(!X){e:for(var oe in $)if(oe!==ne){for(var ue in $[oe])if(r(J,$[oe][ue])){X=ue;break e}}}X||(console.debug("No font coverage for U+"+J.toString(16)),X="latin"),O[V]=X,h[X]||G.has(X)||G.set(X,Z("font-meta/"+X+".json").then(function(We){h[X]=We})),J>65535&&(V++,N=V)},N=0;N<_.length;N++)L(N);return Promise.all(G.values())}).then(function(){for(var L,N=null,V=0;V<_.length;V++){var J=_.codePointAt(V);if(N&&(E(J)||p(N).has(J)))S[V]=S[V-1];else{N=h[O[V]];var X=R[N.id];if(!X){var $=N.typeforms,ne=v($,I,"sans-serif"),se=v($[ne],k,"normal"),_e=y((L=$[ne])===null||L===void 0?void 0:L[se],P);X=R[N.id]=D+"/font-files/"+N.id+"/"+ne+"."+se+"."+_e+".woff"}var be=U.get(X);be==null&&(be=U.size,U.set(X,be)),S[V]=be}J>65535&&(V++,S[V]=S[V-1])}return{fontUrls:Array.from(U.keys()),chars:S}})},Object.defineProperty(o,"__esModule",{value:!0}),o}({})}function Ex(o,e){const i=Object.create(null),a=Object.create(null);function n(r,s){const l=c=>{console.error(`Failure loading font ${r}`,c)};try{const c=new XMLHttpRequest;c.open("get",r,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)l(new Error(c.statusText));else if(c.status>0)try{const h=o(c.response);h.src=r,s(h)}catch(h){l(h)}},c.onerror=l,c.send()}catch(c){l(c)}}function t(r,s){let l=i[r];l?s(l):a[r]?a[r].push(s):(a[r]=[s],n(r,c=>{c.src=r,i[r]=c,a[r].forEach(h=>h(c)),delete a[r]}))}return function(r,s,{lang:l,fonts:c=[],style:h="normal",weight:d="normal",unicodeFontsURL:f}={}){const p=new Uint8Array(r.length),m=[];r.length||E();const b=new Map,v=[];if(h!=="italic"&&(h="normal"),typeof d!="number"&&(d=d==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(C=>!C.lang||C.lang.test(l)).reverse(),c.length){let I=0;(function k(P=0){for(let D=P,U=r.length;D<U;D++){const S=r.codePointAt(D);if(I===1&&m[p[D-1]].supportsCodePoint(S)||D>0&&/\s/.test(r[D]))p[D]=p[D-1],I===2&&(v[v.length-1][1]=D);else for(let R=p[D],Q=c.length;R<=Q;R++)if(R===Q){const O=I===2?v[v.length-1]:v[v.length]=[D,D];O[1]=D,I=2}else{p[D]=R;const{src:O,unicodeRange:G}=c[R];if(!G||_(S,G)){const q=i[O];if(!q){t(O,()=>{k(D)});return}if(q.supportsCodePoint(S)){let Z=b.get(q);typeof Z!="number"&&(Z=m.length,m.push(q),b.set(q,Z)),p[D]=Z,I=1;break}}}S>65535&&D+1<U&&(p[D+1]=p[D],D++,I===2&&(v[v.length-1][1]=D))}y()})()}else v.push([0,r.length-1]),y();function y(){if(v.length){const C=v.map(x=>r.substring(x[0],x[1]+1)).join(`
`);e.getFontsForString(C,{lang:l||void 0,style:h,weight:d,dataUrl:f}).then(({fontUrls:x,chars:B})=>{const I=m.length;let k=0;v.forEach(D=>{for(let U=0,S=D[1]-D[0];U<=S;U++)p[D[0]+U]=B[k++]+I;k++});let P=0;x.forEach((D,U)=>{t(D,S=>{m[U+I]=S,++P===x.length&&E()})})})}else E()}function E(){s({chars:p,fonts:m})}function _(C,x){for(let B=0;B<x.length;B++){const[I,k=I]=x[B];if(I<=C&&C<=k)return!0}return!1}}}const xx=As({name:"FontResolver",dependencies:[Ex,_x,Cx],init(o,e,i){return o(e,i())}});function Ix(o,e){const a=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",t=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function r({text:m,lang:b,fonts:v,style:y,weight:E,preResolvedFonts:_,unicodeFontsURL:C},x){const B=({chars:I,fonts:k})=>{let P,D;const U=[];for(let S=0;S<I.length;S++)I[S]!==D?(D=I[S],U.push(P={start:S,end:S,fontObj:k[I[S]]})):P.end=S;x(U)};_?B(_):o(m,B,{lang:b,fonts:v,style:y,weight:E,unicodeFontsURL:C})}function s({text:m="",font:b,lang:v,sdfGlyphSize:y=64,fontSize:E=400,fontWeight:_=1,fontStyle:C="normal",letterSpacing:x=0,lineHeight:B="normal",maxWidth:I=1/0,direction:k,textAlign:P="left",textIndent:D=0,whiteSpace:U="normal",overflowWrap:S="normal",anchorX:R=0,anchorY:Q=0,metricsOnly:O=!1,unicodeFontsURL:G,preResolvedFonts:q=null,includeCaretPositions:Z=!1,chunkedBoundsSize:Y=8192,colorRanges:j=null},L){const N=d(),V={fontLoad:0,typesetting:0};m.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),m=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),E=+E,x=+x,I=+I,B=B||"normal",D=+D,r({text:m,lang:v,style:C,weight:_,fonts:typeof b=="string"?[{src:b}]:b,unicodeFontsURL:G,preResolvedFonts:q},J=>{V.fontLoad=d()-N;const X=isFinite(I);let $=null,ne=null,se=null,_e=null,be=null,oe=null,ue=null,We=null,Te=0,Se=0,Be=U!=="nowrap";const Ue=new Map,ke=d();let He=D,he=0,te=new f;const Ee=[te];J.forEach(de=>{const{fontObj:xe}=de,{ascender:Ie,descender:Oe,unitsPerEm:it,lineGap:pt,capHeight:Pe,xHeight:Ze}=xe;let we=Ue.get(xe);if(!we){const ce=E/it,Ke=B==="normal"?(Ie-Oe+pt)*ce:B*E,un=(Ke-(Ie-Oe)*ce)/2,et=Math.min(Ke,(Ie-Oe)*ce),Ge=(Ie+Oe)/2*ce+et/2;we={index:Ue.size,src:xe.src,fontObj:xe,fontSizeMult:ce,unitsPerEm:it,ascender:Ie*ce,descender:Oe*ce,capHeight:Pe*ce,xHeight:Ze*ce,lineHeight:Ke,baseline:-un-Ie*ce,caretTop:Ge,caretBottom:Ge-et},Ue.set(xe,we)}const{fontSizeMult:ot}=we,$e=m.slice(de.start,de.end+1);let dt,gt;xe.forEachGlyph($e,E,x,(ce,Ke,un,et)=>{Ke+=he,et+=de.start,dt=Ke,gt=ce;const Ge=m.charAt(et),Bt=ce.advanceWidth*ot,mt=te.count;let Fe;if("isEmpty"in ce||(ce.isWhitespace=!!Ge&&new RegExp(n).test(Ge),ce.canBreakAfter=!!Ge&&t.test(Ge),ce.isEmpty=ce.xMin===ce.xMax||ce.yMin===ce.yMax||a.test(Ge)),!ce.isWhitespace&&!ce.isEmpty&&Se++,Be&&X&&!ce.isWhitespace&&Ke+Bt+He>I&&mt){if(te.glyphAt(mt-1).glyphObj.canBreakAfter)Fe=new f,He=-Ke;else for(let Tt=mt;Tt--;)if(Tt===0&&S==="break-word"){Fe=new f,He=-Ke;break}else if(te.glyphAt(Tt).glyphObj.canBreakAfter){Fe=te.splitAt(Tt+1);const _t=Fe.glyphAt(0).x;He-=_t;for(let Ct=Fe.count;Ct--;)Fe.glyphAt(Ct).x-=_t;break}Fe&&(te.isSoftWrapped=!0,te=Fe,Ee.push(te),Te=I)}let rt=te.glyphAt(te.count);rt.glyphObj=ce,rt.x=Ke+He,rt.y=un,rt.width=Bt,rt.charIndex=et,rt.fontData=we,Ge===`
`&&(te=new f,Ee.push(te),He=-(Ke+Bt+x*E)+D)}),he=dt+gt.advanceWidth*ot+x*E});let pe=0;Ee.forEach(de=>{let xe=!0;for(let Ie=de.count;Ie--;){const Oe=de.glyphAt(Ie);xe&&!Oe.glyphObj.isWhitespace&&(de.width=Oe.x+Oe.width,de.width>Te&&(Te=de.width),xe=!1);let{lineHeight:it,capHeight:pt,xHeight:Pe,baseline:Ze}=Oe.fontData;it>de.lineHeight&&(de.lineHeight=it);const we=Ze-de.baseline;we<0&&(de.baseline+=we,de.cap+=we,de.ex+=we),de.cap=Math.max(de.cap,de.baseline+pt),de.ex=Math.max(de.ex,de.baseline+Pe)}de.baseline-=pe,de.cap-=pe,de.ex-=pe,pe+=de.lineHeight});let Ce=0,ge=0;if(R&&(typeof R=="number"?Ce=-R:typeof R=="string"&&(Ce=-Te*(R==="left"?0:R==="center"?.5:R==="right"?1:c(R)))),Q&&(typeof Q=="number"?ge=-Q:typeof Q=="string"&&(ge=Q==="top"?0:Q==="top-baseline"?-Ee[0].baseline:Q==="top-cap"?-Ee[0].cap:Q==="top-ex"?-Ee[0].ex:Q==="middle"?pe/2:Q==="bottom"?pe:Q==="bottom-baseline"?-Ee[Ee.length-1].baseline:c(Q)*pe)),!O){const de=e.getEmbeddingLevels(m,k);$=new Uint16Array(Se),ne=new Uint8Array(Se),se=new Float32Array(Se*2),_e={},ue=[1/0,1/0,-1/0,-1/0],We=[],Z&&(oe=new Float32Array(m.length*4)),j&&(be=new Uint8Array(Se*3));let xe=0,Ie=-1,Oe=-1,it,pt;if(Ee.forEach((Pe,Ze)=>{let{count:we,width:ot}=Pe;if(we>0){let $e=0;for(let et=we;et--&&Pe.glyphAt(et).glyphObj.isWhitespace;)$e++;let dt=0,gt=0;if(P==="center")dt=(Te-ot)/2;else if(P==="right")dt=Te-ot;else if(P==="justify"&&Pe.isSoftWrapped){let et=0;for(let Ge=we-$e;Ge--;)Pe.glyphAt(Ge).glyphObj.isWhitespace&&et++;gt=(Te-ot)/et}if(gt||dt){let et=0;for(let Ge=0;Ge<we;Ge++){let Bt=Pe.glyphAt(Ge);const mt=Bt.glyphObj;Bt.x+=dt+et,gt!==0&&mt.isWhitespace&&Ge<we-$e&&(et+=gt,Bt.width+=gt)}}const ce=e.getReorderSegments(m,de,Pe.glyphAt(0).charIndex,Pe.glyphAt(Pe.count-1).charIndex);for(let et=0;et<ce.length;et++){const[Ge,Bt]=ce[et];let mt=1/0,Fe=-1/0;for(let rt=0;rt<we;rt++)if(Pe.glyphAt(rt).charIndex>=Ge){let Tt=rt,_t=rt;for(;_t<we;_t++){let Ct=Pe.glyphAt(_t);if(Ct.charIndex>Bt)break;_t<we-$e&&(mt=Math.min(mt,Ct.x),Fe=Math.max(Fe,Ct.x+Ct.width))}for(let Ct=Tt;Ct<_t;Ct++){const Wt=Pe.glyphAt(Ct);Wt.x=Fe-(Wt.x+Wt.width-mt)}break}}let Ke;const un=et=>Ke=et;for(let et=0;et<we;et++){const Ge=Pe.glyphAt(et);Ke=Ge.glyphObj;const Bt=Ke.index,mt=de.levels[Ge.charIndex]&1;if(mt){const Fe=e.getMirroredCharacter(m[Ge.charIndex]);Fe&&Ge.fontData.fontObj.forEachGlyph(Fe,0,0,un)}if(Z){const{charIndex:Fe,fontData:rt}=Ge,Tt=Ge.x+Ce,_t=Ge.x+Ge.width+Ce;oe[Fe*4]=mt?_t:Tt,oe[Fe*4+1]=mt?Tt:_t,oe[Fe*4+2]=Pe.baseline+rt.caretBottom+ge,oe[Fe*4+3]=Pe.baseline+rt.caretTop+ge;const Ct=Fe-Ie;Ct>1&&h(oe,Ie,Ct),Ie=Fe}if(j){const{charIndex:Fe}=Ge;for(;Fe>Oe;)Oe++,j.hasOwnProperty(Oe)&&(pt=j[Oe])}if(!Ke.isWhitespace&&!Ke.isEmpty){const Fe=xe++,{fontSizeMult:rt,src:Tt,index:_t}=Ge.fontData,Ct=_e[Tt]||(_e[Tt]={});Ct[Bt]||(Ct[Bt]={path:Ke.path,pathBounds:[Ke.xMin,Ke.yMin,Ke.xMax,Ke.yMax]});const Wt=Ge.x+Ce,Mn=Ge.y+Pe.baseline+ge;se[Fe*2]=Wt,se[Fe*2+1]=Mn;const An=Wt+Ke.xMin*rt,mn=Mn+Ke.yMin*rt,Bn=Wt+Ke.xMax*rt,Sn=Mn+Ke.yMax*rt;An<ue[0]&&(ue[0]=An),mn<ue[1]&&(ue[1]=mn),Bn>ue[2]&&(ue[2]=Bn),Sn>ue[3]&&(ue[3]=Sn),Fe%Y===0&&(it={start:Fe,end:Fe,rect:[1/0,1/0,-1/0,-1/0]},We.push(it)),it.end++;const Ht=it.rect;if(An<Ht[0]&&(Ht[0]=An),mn<Ht[1]&&(Ht[1]=mn),Bn>Ht[2]&&(Ht[2]=Bn),Sn>Ht[3]&&(Ht[3]=Sn),$[Fe]=Bt,ne[Fe]=_t,j){const Xn=Fe*3;be[Xn]=pt>>16&255,be[Xn+1]=pt>>8&255,be[Xn+2]=pt&255}}}}}),oe){const Pe=m.length-Ie;Pe>1&&h(oe,Ie,Pe)}}const Je=[];Ue.forEach(({index:de,src:xe,unitsPerEm:Ie,ascender:Oe,descender:it,lineHeight:pt,capHeight:Pe,xHeight:Ze})=>{Je[de]={src:xe,unitsPerEm:Ie,ascender:Oe,descender:it,lineHeight:pt,capHeight:Pe,xHeight:Ze}}),V.typesetting=d()-ke,L({glyphIds:$,glyphFontIndices:ne,glyphPositions:se,glyphData:_e,fontData:Je,caretPositions:oe,glyphColors:be,chunkedBounds:We,fontSize:E,topBaseline:ge+Ee[0].baseline,blockBounds:[Ce,ge-pe,Ce+Te,ge],visibleBounds:ue,timings:V})})}function l(m,b){s({...m,metricsOnly:!0},v=>{const[y,E,_,C]=v.blockBounds;b({width:_-y,height:C-E})})}function c(m){let b=m.match(/^([\d.]+)%$/),v=b?parseFloat(b[1]):NaN;return isNaN(v)?0:v/100}function h(m,b,v){const y=m[b*4],E=m[b*4+1],_=m[b*4+2],C=m[b*4+3],x=(E-y)/v;for(let B=0;B<v;B++){const I=(b+B)*4;m[I]=y+x*B,m[I+1]=y+x*(B+1),m[I+2]=_,m[I+3]=C}}function d(){return(self.performance||Date).now()}function f(){this.data=[]}const p=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(m){let b=f.flyweight;return b.data=this.data,b.index=m,b},splitAt(m){let b=new f;return b.data=this.data.splice(m*p.length),b}},f.flyweight=p.reduce((m,b,v,y)=>(Object.defineProperty(m,b,{get(){return this.data[this.index*p.length+v]},set(E){this.data[this.index*p.length+v]=E}}),m),{data:null,index:0}),{typeset:s,measure:l}}const Bo=()=>(self.performance||Date).now(),mc=pc();let sp;function Bx(o,e,i,a,n,t,r,s,l,c,h=!0){return h?kx(o,e,i,a,n,t,r,s,l,c).then(null,d=>(sp||(console.warn("WebGL SDF generation failed, falling back to JS",d),sp=!0),lp(o,e,i,a,n,t,r,s,l,c))):lp(o,e,i,a,n,t,r,s,l,c)}const Gl=[],Sx=5;let Dh=0;function sm(){const o=Bo();for(;Gl.length&&Bo()-o<Sx;)Gl.shift()();Dh=Gl.length?setTimeout(sm,0):0}const kx=(...o)=>new Promise((e,i)=>{Gl.push(()=>{const a=Bo();try{mc.webgl.generateIntoCanvas(...o),e({timing:Bo()-a})}catch(n){i(n)}}),Dh||(Dh=setTimeout(sm,0))}),Dx=4,Tx=2e3,ap={};let Mx=0;function lp(o,e,i,a,n,t,r,s,l,c){const h="TroikaTextSDFGenerator_JS_"+Mx++%Dx;let d=ap[h];return d||(d=ap[h]={workerModule:As({name:h,workerId:h,dependencies:[pc,Bo],init(f,p){const m=f().javascript.generate;return function(...b){const v=p();return{textureData:m(...b),timing:p()-v}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),d.requests++,clearTimeout(d.idleTimer),d.workerModule(o,e,i,a,n,t).then(({textureData:f,timing:p})=>{const m=Bo(),b=new Uint8Array(f.length*4);for(let v=0;v<f.length;v++)b[v*4+c]=f[v];return mc.webglUtils.renderImageData(r,b,s,l,o,e,1<<3-c),p+=Bo()-m,--d.requests===0&&(d.idleTimer=setTimeout(()=>{ux(h)},Tx)),{timing:p}})}function Px(o){o._warm||(mc.webgl.isSupported(o),o._warm=!0)}const Qx=mc.webglUtils.resizeWebGLCanvasWithoutClearing,$o={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},Rx=new Rt;function Xo(){return(self.performance||Date).now()}const cp=Object.create(null);function am(o,e){o=Lx({},o);const i=Xo(),{defaultFontURL:a}=$o,n=[];if(a&&n.push({label:"default",src:up(a)}),o.font&&n.push({label:"user",src:up(o.font)}),o.font=n,o.text=""+o.text,o.sdfGlyphSize=o.sdfGlyphSize||$o.sdfGlyphSize,o.unicodeFontsURL=o.unicodeFontsURL||$o.unicodeFontsURL,o.colorRanges!=null){let p={};for(let m in o.colorRanges)if(o.colorRanges.hasOwnProperty(m)){let b=o.colorRanges[m];typeof b!="number"&&(b=Rx.set(b).getHex()),p[m]=b}o.colorRanges=p}Object.freeze(o);const{textureWidth:t,sdfExponent:r}=$o,{sdfGlyphSize:s}=o,l=t/s*4;let c=cp[s];if(!c){const p=document.createElement("canvas");p.width=t,p.height=s*256/l,c=cp[s]={glyphCount:0,sdfGlyphSize:s,sdfCanvas:p,sdfTexture:new ga(p,void 0,void 0,void 0,bn,bn),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,Ux(c)}const{sdfTexture:h,sdfCanvas:d}=c;um(o).then(p=>{const{glyphIds:m,glyphFontIndices:b,fontData:v,glyphPositions:y,fontSize:E,timings:_}=p,C=[],x=new Float32Array(m.length*4);let B=0,I=0;const k=Xo(),P=v.map(Q=>{let O=c.glyphsByFont.get(Q.src);return O||c.glyphsByFont.set(Q.src,O=new Map),O});m.forEach((Q,O)=>{const G=b[O],{src:q,unitsPerEm:Z}=v[G];let Y=P[G].get(Q);if(!Y){const{path:J,pathBounds:X}=p.glyphData[q][Q],$=Math.max(X[2]-X[0],X[3]-X[1])/s*($o.sdfMargin*s+.5),ne=c.glyphCount++,se=[X[0]-$,X[1]-$,X[2]+$,X[3]+$];P[G].set(Q,Y={path:J,atlasIndex:ne,sdfViewBox:se}),C.push(Y)}const{sdfViewBox:j}=Y,L=y[I++],N=y[I++],V=E/Z;x[B++]=L+j[0]*V,x[B++]=N+j[1]*V,x[B++]=L+j[2]*V,x[B++]=N+j[3]*V,m[O]=Y.atlasIndex}),_.quads=(_.quads||0)+(Xo()-k);const D=Xo();_.sdf={};const U=d.height,S=Math.ceil(c.glyphCount/l),R=Math.pow(2,Math.ceil(Math.log2(S*s)));R>U&&(console.info(`Increasing SDF texture size ${U}->${R}`),Qx(d,t,R),h.dispose()),Promise.all(C.map(Q=>lm(Q,c,o.gpuAccelerateSDF).then(({timing:O})=>{_.sdf[Q.atlasIndex]=O}))).then(()=>{C.length&&!c.contextLost&&(cm(c),h.needsUpdate=!0),_.sdfTotal=Xo()-D,_.total=Xo()-i,e(Object.freeze({parameters:o,sdfTexture:h,sdfGlyphSize:s,sdfExponent:r,glyphBounds:x,glyphAtlasIndices:m,glyphColors:p.glyphColors,caretPositions:p.caretPositions,chunkedBounds:p.chunkedBounds,ascender:p.ascender,descender:p.descender,lineHeight:p.lineHeight,capHeight:p.capHeight,xHeight:p.xHeight,topBaseline:p.topBaseline,blockBounds:p.blockBounds,visibleBounds:p.visibleBounds,timings:p.timings}))})}),Promise.resolve().then(()=>{c.contextLost||Px(d)})}function lm({path:o,atlasIndex:e,sdfViewBox:i},{sdfGlyphSize:a,sdfCanvas:n,contextLost:t},r){if(t)return Promise.resolve({timing:-1});const{textureWidth:s,sdfExponent:l}=$o,c=Math.max(i[2]-i[0],i[3]-i[1]),h=Math.floor(e/4),d=h%(s/a)*a,f=Math.floor(h/(s/a))*a,p=e%4;return Bx(a,a,o,i,c,l,n,d,f,p,r)}function Ux(o){const e=o.sdfCanvas;e.addEventListener("webglcontextlost",i=>{console.log("Context Lost",i),i.preventDefault(),o.contextLost=!0}),e.addEventListener("webglcontextrestored",i=>{console.log("Context Restored",i),o.contextLost=!1;const a=[];o.glyphsByFont.forEach(n=>{n.forEach(t=>{a.push(lm(t,o,!0))})}),Promise.all(a).then(()=>{cm(o),o.sdfTexture.needsUpdate=!0})})}function Fx({font:o,characters:e,sdfGlyphSize:i},a){let n=Array.isArray(e)?e.join(`
`):""+e;am({font:o,sdfGlyphSize:i,text:n},a)}function Lx(o,e){for(let i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);return o}let Bl;function up(o){return Bl||(Bl=typeof document>"u"?{}:document.createElement("a")),Bl.href=o,Bl.href}function cm(o){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:i}=o,{width:a,height:n}=e,t=o.sdfCanvas.getContext("webgl");let r=i.image.data;(!r||r.length!==a*n*4)&&(r=new Uint8Array(a*n*4),i.image={width:a,height:n,data:r},i.flipY=!1,i.isDataTexture=!0),t.readPixels(0,0,a,n,t.RGBA,t.UNSIGNED_BYTE,r)}}const Ox=As({name:"Typesetter",dependencies:[Ix,xx,jg],init(o,e,i){return o(e,i())}}),um=As({name:"Typesetter",dependencies:[Ox],init(o){return function(e){return new Promise(i=>{o.typeset(e,i)})}},getTransferables(o){const e=[];for(let i in o)o[i]&&o[i].buffer&&e.push(o[i].buffer);return e}});um.onMainThread;const hp={};function Gx(o){let e=hp[o];return e||(e=hp[o]=new _r(1,1,o,o).translate(.5,.5,0)),e}const Nx="aTroikaGlyphBounds",dp="aTroikaGlyphIndex",zx="aTroikaGlyphColor";class Hx extends zh{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Xr,this.boundingBox=new gn}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let i=Gx(e);["position","normal","uv"].forEach(a=>{this.attributes[a]=i.attributes[a].clone()}),this.setIndex(i.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,i,a,n,t){this.updateAttributeData(Nx,e,4),this.updateAttributeData(dp,i,1),this.updateAttributeData(zx,t,3),this._blockBounds=a,this._chunkedBounds=n,this.instanceCount=i.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:i,boundingBox:a}=this;if(i){const{PI:n,floor:t,min:r,max:s,sin:l,cos:c}=Math,h=n/2,d=n*2,f=Math.abs(i),p=e[0]/f,m=e[2]/f,b=t((p+h)/d)!==t((m+h)/d)?-f:r(l(p)*f,l(m)*f),v=t((p-h)/d)!==t((m-h)/d)?f:s(l(p)*f,l(m)*f),y=t((p+n)/d)!==t((m+n)/d)?f*2:s(f-c(p)*f,f-c(m)*f);a.min.set(b,e[1],i<0?-y:0),a.max.set(v,e[3],i<0?0:y)}else a.min.set(e[0],e[1],0),a.max.set(e[2],e[3],0);a.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let i=this.getAttribute(dp).count,a=this._chunkedBounds;if(a)for(let n=a.length;n--;){i=a[n].end;let t=a[n].rect;if(t[1]<e.w&&t[3]>e.y&&t[0]<e.z&&t[2]>e.x)break}this.instanceCount=i}updateAttributeData(e,i,a){const n=this.getAttribute(e);i?n&&n.array.length===i.length?(n.array.set(i),n.needsUpdate=!0):(this.setAttribute(e,new $l(i,a)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(e)}}const Vx=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,jx=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,qx=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Wx=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Kx(o){const e=kh(o,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new lt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new ri(0,0,0,0)},uTroikaClipRect:{value:new ri(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new lt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Rt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Wp},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Vx,vertexTransform:jx,fragmentDefs:qx,fragmentColorTransform:Wx,customRewriter({vertexShader:i,fragmentShader:a}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(a)&&(a=a.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(i)||(i=i.replace(om,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:i,fragmentShader:a}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const hd=new Tn({color:16777215,side:Oi,transparent:!0}),fp=8421504,Ap=new Lt,Sl=new ie,qu=new ie,Zs=[],Yx=new ie,Wu="+x+y";function pp(o){return Array.isArray(o)?o[0]:o}let hm=()=>{const o=new Re(new _r(1,1),hd);return hm=()=>o,o},dm=()=>{const o=new Re(new _r(1,1,32,1),hd);return dm=()=>o,o};const Xx={type:"syncstart"},Jx={type:"synccomplete"},fm=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Zx=fm.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Am=class extends Re{constructor(){const e=new Hx;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=fp,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=Wu,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(Xx),am({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},i=>{this._isSyncing=!1,this._textRenderInfo=i,this.geometry.updateGlyphs(i.glyphBounds,i.glyphAtlasIndices,i.blockBounds,i.chunkedBounds,i.glyphColors);const a=this._queuedSyncs;a&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{a.forEach(n=>n&&n())})),this.dispatchEvent(Jx),e&&e()})))}onBeforeRender(e,i,a,n,t,r){this.sync(),t.isTroikaTextMaterial&&this._prepareForRender(t)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return Kx(e)}get material(){let e=this._derivedMaterial;const i=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=hd.clone());if((!e||!e.isDerivedFrom(i))&&(e=this._derivedMaterial=this.createDerivedMaterial(i),i.addEventListener("dispose",function a(){i.removeEventListener("dispose",a),e.dispose()})),this.hasOutline()){let a=e._outlineMtl;return a||(a=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),a.isTextOutlineMaterial=!0,a.depthWrite=!1,a.map=null,e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),a.dispose()})),[a,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return pp(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return pp(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const i=e.isTextOutlineMaterial,a=e.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:s,blockBounds:l}=n;a.uTroikaSDFTexture.value=s,a.uTroikaSDFTextureSize.value.set(s.image.width,s.image.height),a.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,a.uTroikaSDFExponent.value=n.sdfExponent,a.uTroikaTotalBounds.value.fromArray(l),a.uTroikaUseGlyphColors.value=!i&&!!n.glyphColors;let c=0,h=0,d=0,f,p,m,b=0,v=0;if(i){let{outlineWidth:E,outlineOffsetX:_,outlineOffsetY:C,outlineBlur:x,outlineOpacity:B}=this;c=this._parsePercent(E)||0,h=Math.max(0,this._parsePercent(x)||0),f=B,b=this._parsePercent(_)||0,v=this._parsePercent(C)||0}else d=Math.max(0,this._parsePercent(this.strokeWidth)||0),d&&(m=this.strokeColor,a.uTroikaStrokeColor.value.set(m??fp),p=this.strokeOpacity,p==null&&(p=1)),f=this.fillOpacity;a.uTroikaEdgeOffset.value=c,a.uTroikaPositionOffset.value.set(b,v),a.uTroikaBlurRadius.value=h,a.uTroikaStrokeWidth.value=d,a.uTroikaStrokeOpacity.value=p,a.uTroikaFillOpacity.value=f??1,a.uTroikaCurveRadius.value=this.curveRadius||0;let y=this.clipRect;if(y&&Array.isArray(y)&&y.length===4)a.uTroikaClipRect.value.fromArray(y);else{const E=(this.fontSize||.1)*100;a.uTroikaClipRect.value.set(l[0]-E,l[1]-E,l[2]+E,l[3]+E)}this.geometry.applyClipRect(a.uTroikaClipRect.value)}a.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const t=i?this.outlineColor||0:this.color;if(t==null)delete e.color;else{const s=e.hasOwnProperty("color")?e.color:e.color=new Rt;(t!==s._input||typeof t=="object")&&s.set(s._input=t)}let r=this.orientation||Wu;if(r!==e._orientation){let s=a.uTroikaOrient.value;r=r.replace(/[^-+xyz]/g,"");let l=r!==Wu&&r.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,h,d,f]=l;Sl.set(0,0,0)[h]=c==="-"?1:-1,qu.set(0,0,0)[f]=d==="-"?-1:1,Ap.lookAt(Yx,Sl.cross(qu),qu),s.setFromMatrix4(Ap)}else s.identity();e._orientation=r}}_parsePercent(e){if(typeof e=="string"){let i=e.match(/^(-?[\d.]+)%$/),a=i?parseFloat(i[1]):NaN;e=(isNaN(a)?0:a/100)*this.fontSize}return e}localPositionToTextCoords(e,i=new lt){i.copy(e);const a=this.curveRadius;return a&&(i.x=Math.atan2(e.x,Math.abs(a)-Math.abs(e.z))*Math.abs(a)),i}worldPositionToTextCoords(e,i=new lt){return Sl.copy(e),this.localPositionToTextCoords(this.worldToLocal(Sl),i)}raycast(e,i){const{textRenderInfo:a,curveRadius:n}=this;if(a){const t=a.blockBounds,r=n?dm():hm(),s=r.geometry,{position:l,uv:c}=s.attributes;for(let h=0;h<c.count;h++){let d=t[0]+c.getX(h)*(t[2]-t[0]);const f=t[1]+c.getY(h)*(t[3]-t[1]);let p=0;n&&(p=n-Math.cos(d/n)*n,d=Math.sin(d/n)*n),l.setXYZ(h,d,f,p)}s.boundingSphere=this.geometry.boundingSphere,s.boundingBox=this.geometry.boundingBox,r.matrixWorld=this.matrixWorld,r.material.side=this.material.side,Zs.length=0,r.raycast(e,Zs);for(let h=0;h<Zs.length;h++)Zs[h].object=this,i.push(Zs[h])}}copy(e){const i=this.geometry;return super.copy(e),this.geometry=i,Zx.forEach(a=>{this[a]=e[a]}),this}clone(){return new this.constructor().copy(this)}};fm.forEach(o=>{const e="_private_"+o;Object.defineProperty(Am.prototype,o,{get(){return this[e]},set(i){i!==this[e]&&(this[e]=i,this._needsSync=!0)}})});new gn;new Rt;function rS(o,e){st(e,!0);let i=z(e,"font",3,null),a=z(e,"characters",3,null),n=z(e,"sdfGlyphSize",3,null),t=z(e,"ref",15),r=xt(e,["$$slots","$$events","$$legacy","font","characters","sdfGlyphSize","ref","onsync","children"]);const s=new Am,{invalidate:l}=wt(),c=async()=>{await Kp(),s.sync(()=>{var f;l(),(f=e.onsync)==null||f.call(e)})},h=["text","anchorX","anchorY","curveRadius","direction","font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","textAlign","textIndent","whiteSpace","material","color","depthOffset","clipRect","glyphGeometryDetail","sdfGlyphSize","outlineWidth","outlineColor","outlineOpacity","outlineBlur","outlineOffsetX","outlineOffsetY","strokeWidth","strokeColor","strokeOpacity","fillOpacity","characters","colorRanges"];nn(()=>h.map(f=>r[f]),()=>{c()});const d=Er();Ae(()=>{d(new Promise(f=>Fx({font:i(),characters:a(),sdfGlyphSize:n()},f)))}),qe(o,yt({is:s},()=>r,{get font(){return i()},get characters(){return a()},get sdfGlyphSize(){return n()},get ref(){return t()},set ref(f){t(f)},children:(f,p)=>{var m=tt(),b=ze(m);ut(b,()=>e.children??ht,()=>({ref:s})),Le(f,m)},$$slots:{default:!0}})),at()}const wo=new Map,$x={audioListeners:wo,addAudioListener:(o,e="default")=>{if(wo.has(e)){console.warn(`An AudioListener with the id "${e}" has already been added, aborting.`);return}wo.set(e,o)},removeAudioListener:(o="default")=>{if(!wo.has(o)){console.warn(`No AudioListener with the id "${o}" found, aborting.`);return}wo.delete(o)},getAudioListener:(o="default")=>{if(!wo.has(o)){console.warn(`No AudioListener with the id "${o}" found, aborting.`);return}return wo.get(o)}};function vc(){return Oh("threlte-audio",$x)}function oS(o,e){st(e,!0);let i=z(e,"ref",15),a=xt(e,["$$slots","$$events","$$legacy","id","masterVolume","ref","children"]);const n=new H0,t=n.context,r=()=>n.context.resume();Ae(()=>{e.masterVolume!==void 0&&n.setMasterVolume(e.masterVolume)});const{addAudioListener:s,removeAudioListener:l}=vc();return s(n,e.id),di(()=>{l(e.id)}),qe(o,yt({is:n},()=>a,{get ref(){return i()},set ref(c){i(c)},children:(c,h)=>{var d=tt(),f=ze(d);ut(f,()=>e.children??ht,()=>({ref:n})),Le(c,d)},$$slots:{default:!0}})),at({audioContext:t,resumeContext:r})}const pm=(o,e={})=>{const i=ln(!1),a=ln(!1),n=ln(!1);let t=!1;const r=Ca(V0),s=async v=>{var y,E;i.set(!1);try{if(typeof v=="string"){const _=await r.load(v,{onProgress(C){var x;(x=e.onprogress)==null||x.call(e,C)}});o.setBuffer(_)}else v instanceof AudioBuffer?o.setBuffer(v):v instanceof HTMLMediaElement?o.setMediaElementSource(v):v instanceof AudioBufferSourceNode?o.setNodeSource(v):v instanceof MediaStream&&o.setMediaStreamSource(v);i.set(!0),(y=e.onload)==null||y.call(e,o.buffer)}catch(_){(E=e.onerror)==null||E.call(e,_)}},l=v=>{o.setVolume(v??1)},c=v=>{o.setPlaybackRate(v??1)},h=async v=>{if(!i.current){n.set(!0);return}if(!(o.context.state!=="running"&&(await o.context.resume(),t)))return o.play(v)},d=()=>o.pause(),f=()=>o.source?o.stop():o,p=v=>{a.set(v??!1)},m=v=>{o.source&&o.detune&&o.setDetune(v??0)},b=v=>{o.setLoop(v??!1)};return ii([i,a,n],([v,y,E])=>{if(!v){o.isPlaying&&f();return}(y||E)&&h()}),di(()=>{try{t=!0,f()}catch(v){console.warn("Error while destroying audio",v)}}),{setVolume:l,setSrc:s,setPlaybackRate:c,setAutoPlay:p,setDetune:m,setLoop:b,play:h,pause:d,stop:f}};function sS(o,e){st(e,!0);let i=z(e,"ref",15),a=xt(e,["$$slots","$$events","$$legacy","src","id","volume","playbackRate","autoplay","detune","loop","ref","children"]);const{getAudioListener:n}=vc(),t=n(e.id);if(!t)throw new Error(`No Audiolistener with id ${e.id} found.`);const r=new j0(t),{setAutoPlay:s,setDetune:l,setLoop:c,setPlaybackRate:h,setSrc:d,setVolume:f,...p}=pm(r,a),m=p.pause,b=p.play,v=p.stop;return Et(()=>s(e.autoplay)),Et(()=>void d(e.src)),Et(()=>f(e.volume)),Et(()=>h(e.playbackRate)),Et(()=>c(e.loop)),Et(()=>l(e.detune)),qe(o,yt({is:r},()=>a,{get ref(){return i()},set ref(y){i(y)},children:(y,E)=>{var _=tt(),C=ze(_);ut(C,()=>e.children??ht,()=>({ref:r})),Le(y,_)},$$slots:{default:!0}})),at({pause:m,play:b,stop:v})}function aS(o,e){st(e,!0);let i=z(e,"ref",15),a=xt(e,["$$slots","$$events","$$legacy","src","id","volume","playbackRate","autoplay","detune","loop","directionalCone","refDistance","rolloffFactor","distanceModel","maxDistance","ref","children"]);const{getAudioListener:n}=vc(),t=n(e.id);if(!t)throw new Error(`No Audiolistener with id ${e.id} found.`);const r=new q0(t);Et(()=>{e.refDistance!==void 0&&r.setRefDistance(e.refDistance),e.rolloffFactor!==void 0&&r.setRolloffFactor(e.rolloffFactor),e.distanceModel!==void 0&&r.setDistanceModel(e.distanceModel),e.maxDistance!==void 0&&r.setMaxDistance(e.maxDistance),e.directionalCone!==void 0&&r.setDirectionalCone(e.directionalCone.coneInnerAngle,e.directionalCone.coneOuterAngle,e.directionalCone.coneOuterGain)});const{setAutoPlay:s,setDetune:l,setLoop:c,setPlaybackRate:h,setSrc:d,setVolume:f,...p}=pm(r,a),m=p.pause,b=p.play,v=p.stop;return Et(()=>s(e.autoplay)),Et(()=>void d(e.src)),Et(()=>f(e.volume)),Et(()=>h(e.playbackRate)),Et(()=>c(e.loop)),Et(()=>l(e.detune)),qe(o,yt({is:r},()=>a,{get ref(){return i()},set ref(y){i(y)},children:(y,E)=>{var _=tt(),C=ze(_);ut(C,()=>e.children??ht,()=>({ref:r})),Le(y,_)},$$slots:{default:!0}})),at({pause:m,play:b,stop:v})}function lS(o,e){const{getAudioListener:i}=vc();if(typeof o=="function"){const n=i(e);if(!n)throw new Error("No AudioListener found.");return o({listener:n,context:n.context})}const a=i(o);if(!a)throw new Error("No AudioListener found.");return{listener:a,context:a.context}}const eI=o=>{const{camera:e}=wt();let i=o.current.clientWidth,a=o.current.clientHeight;const n=new ResizeObserver(([t])=>{i=t.contentRect.width,a=t.contentRect.height});return ii(o,t=>(t&&n.observe(t),()=>{t&&n.unobserve(t)})),(t,r)=>{r.pointer.update(s=>(s.set(t.offsetX/i*2-1,-(t.offsetY/a)*2+1),s)),r.raycaster.setFromCamera(r.pointer.current,e.current)}},gm=Symbol("interactivity-context"),tI=()=>Cr(gm),nI=o=>{const e=ln((o==null?void 0:o.target)??Yb().dom),i={enabled:ln((o==null?void 0:o.enabled)??!0),pointer:ln(new lt),pointerOverTarget:ln(!1),lastEvent:void 0,raycaster:new ic,initialClick:[0,0],initialHits:[],hovered:new Map,interactiveObjects:[],target:e,handlers:new WeakMap,compute:(o==null?void 0:o.compute)??eI(e),filter:o==null?void 0:o.filter,addInteractiveObject:(a,n)=>{i.interactiveObjects.indexOf(a)>-1||(i.handlers.set(a,n),i.interactiveObjects.push(a))},removeInteractiveObject:a=>{const n=i.interactiveObjects.indexOf(a);i.interactiveObjects.splice(n,1),i.handlers.delete(a)}};return Do(gm,i),i},mm=()=>{const o=tI();if(!o)throw new Error("No interactivity context found. Did you forget to implement interactivity()?");return o},gp=["onclick","oncontextmenu","ondblclick","onwheel","onpointerup","onpointerdown","onpointerover","onpointerout","onpointerenter","onpointerleave","onpointermove","onpointermissed"],iI=()=>{us("interactivity",o=>{if(!Nt(o.ref,"Object3D")||!Object.entries(o.props).some(([n,t])=>t!==void 0&&gp.includes(n)))return;const{addInteractiveObject:i,removeInteractiveObject:a}=mm();return nn.pre(()=>[o.ref],([n])=>(i(n,o.props),()=>{a(n)})),{pluginProps:gp}})};function mp(o){return`${(o.eventObject||o.object).uuid}/${o.index}${o.instanceId}`}const vp=[["click",!1],["contextmenu",!1],["dblclick",!1],["wheel",!1],["pointerdown",!0],["pointerup",!0],["pointerleave",!0],["pointerenter",!0],["pointermove",!0],["pointercancel",!0]],rI=o=>{const{handlers:e}=mm(),i=c=>{const h=c.offsetX-o.initialClick[0],d=c.offsetY-o.initialClick[1];return Math.round(Math.hypot(h,d))},a=c=>{var h,d;for(const f of o.hovered.values())if(c.length===0||!c.some(p=>p.object===f.object&&p.index===f.index&&p.instanceId===f.instanceId)){const{eventObject:p}=f;o.hovered.delete(mp(f));const m=e.get(p);if(m){const b={...f,intersections:c};(h=m.onpointerout)==null||h.call(m,b),(d=m.onpointerleave)==null||d.call(m,b)}}},n=()=>{if(!o.enabled.current)return[];const c=[],h=o.raycaster.intersectObjects(o.interactiveObjects,!0),d=o.filter===void 0?h:o.filter(h,o);for(const f of d){let p=f.object;for(;p;)e.has(p)&&c.push({...f,eventObject:p}),p=p.parent}return c},t=(c,h)=>{var d,f;for(const p of h)(f=(d=e.get(p))==null?void 0:d.onpointermissed)==null||f.call(d,c)},r=c=>c==="pointerleave"||c==="pointercancel"?()=>{o.pointerOverTarget.set(!1),a([])}:c==="pointerenter"?()=>{o.pointerOverTarget.set(!0)}:h=>{var v,y,E,_;const d=c==="pointermove",f=c==="click"||c==="contextmenu"||c==="dblclick";o.compute(h,o);const p=n(),m=f?i(h):0;c==="pointerdown"&&(o.initialClick=[h.offsetX,h.offsetY],o.initialHits=p.map(C=>C.eventObject)),f&&p.length===0&&m<=2&&t(h,o.interactiveObjects),d&&a(p);let b=!1;e:for(const C of p){const x={stopped:b,...C,intersections:p,stopPropagation(){if(b=!0,x.stopped=!0,o.hovered.size>0&&Array.from(o.hovered.values()).some(I=>I.eventObject===C.eventObject)){const I=p.slice(0,p.indexOf(C));a([...I,C])}},camera:o.raycaster.camera,delta:m,nativeEvent:h,pointer:o.pointer.current,ray:o.raycaster.ray},B=e.get(C.eventObject);if(!B)return;if(d){if(B.onpointerover||B.onpointerenter||B.onpointerout||B.onpointerleave){const I=mp(x),k=o.hovered.get(I);k?k.stopped&&x.stopPropagation():(o.hovered.set(I,x),(v=B.onpointerover)==null||v.call(B,x),(y=B.onpointerenter)==null||y.call(B,x))}(E=B.onpointermove)==null||E.call(B,x)}else B[`on${c}`]?(!f||o.initialHits.includes(C.eventObject))&&(t(h,o.interactiveObjects.filter(I=>!o.initialHits.includes(I))),(_=B[`on${c}`])==null||_.call(B,x)):f&&o.initialHits.includes(C.eventObject)&&t(h,o.interactiveObjects.filter(I=>!o.initialHits.includes(I)));if(b)break e}},s=c=>{vp.forEach(([h])=>{c.removeEventListener(h,r(h))})},l=c=>{vp.forEach(([h,d])=>{c.addEventListener(h,r(h),{passive:d})})};ii(o.target,c=>(c&&l(c),()=>{c&&s(c)}))},cS=o=>{const e=nI(o);return iI(),rI(e),e},oI=()=>{us("layers",o=>{if(!Nt(o.ref,"Object3D"))return;const e=Cr("threlte-layers-context"),i=Qe(()=>o.props.layers??(e==null?void 0:e.layers)),a=Qe(()=>H(i)?{layers:H(i)}:void 0);Do("threlte-layers-context",H(a));const n=(t,r)=>{if(r==="all")t.layers.enableAll();else if(r==="none")t.layers.disableAll();else if(Array.isArray(r))for(let s=0;s<32;s+=1){const l=s;r.includes(l)?t.layers.enable(s):t.layers.disable(s)}else r!==void 0&&t.layers.set(r)};return nn.pre(()=>[o.ref,H(i)],([t,r])=>{Nt(t,"Object3D")&&n(t,r)}),{pluginProps:["layers"]}})},uS=o=>{Do("threlte-layers-context",{layers:(o==null?void 0:o.defaultLayers)??0}),oI()};var sI=Object.defineProperty,aI=(o,e,i)=>e in o?sI(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i,jt=(o,e,i)=>(aI(o,typeof e!="symbol"?e+"":e,i),i);const vm=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Th(o){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function i(a,n){let t=xn[n];return t?Th(t):a}return o.replace(e,i)}const Gn=[];for(let o=0;o<256;o++)Gn[o]=(o<16?"0":"")+o.toString(16);function lI(){const o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,a=Math.random()*4294967295|0;return(Gn[o&255]+Gn[o>>8&255]+Gn[o>>16&255]+Gn[o>>24&255]+"-"+Gn[e&255]+Gn[e>>8&255]+"-"+Gn[e>>16&15|64]+Gn[e>>24&255]+"-"+Gn[i&63|128]+Gn[i>>8&255]+"-"+Gn[i>>16&255]+Gn[i>>24&255]+Gn[a&255]+Gn[a>>8&255]+Gn[a>>16&255]+Gn[a>>24&255]).toUpperCase()}const yo=Object.assign||function(){let o=arguments[0];for(let e=1,i=arguments.length;e<i;e++){let a=arguments[e];if(a)for(let n in a)Object.prototype.hasOwnProperty.call(a,n)&&(o[n]=a[n])}return o},cI=Date.now(),bp=new WeakMap,wp=new Map;let uI=1e10;function Kl(o,e){const i=AI(e);let a=bp.get(o);if(a||bp.set(o,a=Object.create(null)),a[i])return new a[i];const n=`_onBeforeCompile${i}`,t=function(c,h){o.onBeforeCompile.call(this,c,h);const d=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let f=wp[d];if(!f){const p=hI(this,c,e,i);f=wp[d]=p}c.vertexShader=f.vertexShader,c.fragmentShader=f.fragmentShader,yo(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-cI}}),this[n]&&this[n](c)},r=function(){return s(e.chained?o:o.clone())},s=function(c){const h=Object.create(c,l);return Object.defineProperty(h,"baseMaterial",{value:o}),Object.defineProperty(h,"id",{value:uI++}),h.uuid=lI(),h.uniforms=yo({},c.uniforms,e.uniforms),h.defines=yo({},c.defines,e.defines),h.defines[`TROIKA_DERIVED_MATERIAL_${i}`]="",h.extensions=yo({},c.extensions,e.extensions),h._listeners=void 0,h},l={constructor:{value:r},isDerivedMaterial:{value:!0},type:{get:()=>o.type,set:c=>{o.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const h=this.baseMaterial;return c===h||h.isDerivedMaterial&&h.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return o.customProgramCacheKey()+"|"+i}},onBeforeCompile:{get(){return t},set(c){this[n]=c}},copy:{writable:!0,configurable:!0,value:function(c){return o.copy.call(this,c),!o.isShaderMaterial&&!o.isDerivedMaterial&&(yo(this.extensions,c.extensions),yo(this.defines,c.defines),yo(this.uniforms,hs.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new o.constructor;return s(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=Kl(o.isDerivedMaterial?o.getDepthMaterial():new sc({depthPacking:nc}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=Kl(o.isDerivedMaterial?o.getDistanceMaterial():new Vh,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:h}=this;c&&c.dispose(),h&&h.dispose(),o.dispose.call(this)}}};return a[i]=r,new r}function hI(o,{vertexShader:e,fragmentShader:i},a,n){let{vertexDefs:t,vertexMainIntro:r,vertexMainOutro:s,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:h,fragmentMainOutro:d,fragmentColorTransform:f,customRewriter:p,timeUniform:m}=a;if(t=t||"",r=r||"",s=s||"",c=c||"",h=h||"",d=d||"",(l||p)&&(e=Th(e)),(f||p)&&(i=i.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),i=Th(i)),p){let b=p({vertexShader:e,fragmentShader:i});e=b.vertexShader,i=b.fragmentShader}if(f){let b=[];i=i.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,v=>(b.push(v),"")),d=`${f}
${b.join(`
`)}
${d}`}if(m){const b=`
uniform float ${m};
`;t=b+t,c=b+c}return l&&(e=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${e}
`,t=`${t}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,r=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${r}
`,e=e.replace(/\b(position|normal|uv)\b/g,(b,v,y,E)=>/\battribute\s+vec[23]\s+$/.test(E.substr(0,y))?v:`troika_${v}_${n}`),o.map&&o.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),e=yp(e,n,t,r,s),i=yp(i,n,c,h,d),{vertexShader:e,fragmentShader:i}}function yp(o,e,i,a,n){return(a||n||i)&&(o=o.replace(vm,`
${i}
void troikaOrigMain${e}() {`),o+=`
void main() {
  ${a}
  troikaOrigMain${e}();
  ${n}
}`),o}function dI(o,e){return o==="uniforms"?void 0:typeof e=="function"?e.toString():e}let fI=0;const _p=new Map;function AI(o){const e=JSON.stringify(o,dI);let i=_p.get(e);return i==null&&_p.set(e,i=++fI),i}const pI={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function gI(o){let e=pI[o.type];return e?ra[e]:o}function Cp(o){let e=/\buniform\s+(int|float|vec[234]|mat[34])\s+([A-Za-z_][\w]*)/g,i=Object.create(null),a;for(;(a=e.exec(o))!==null;)i[a[2]]=a[1];return i}function mI(o){let e=[],i="";const a=Kl(o,{chained:!0,customRewriter({vertexShader:t,fragmentShader:r}){let s=[],l=[],c=[],h=Cp(t),d=Cp(r);return e.forEach(f=>{let p=h[f],m=d[f];const b=p||m;if(b){const v=new RegExp(`\\buniform\\s+${b}\\s+${f}\\s*;`,"g"),y=new RegExp(`\\b${f}\\b`,"g"),E=`troika_attr_${f}`,_=`troika_vary_${f}`;if(s.push(`attribute ${b} ${E};`),p&&(t=t.replace(v,""),t=t.replace(y,E)),m){r=r.replace(v,""),r=r.replace(y,_);let C=`varying ${m} ${_};`;s.push(C),c.push(C),l.push(`${_} = ${E};`)}}}),t=`${s.join(`
`)}
${t.replace(vm,`
$&
${l.join(`
`)}`)}`,c.length&&(r=`${c.join(`
`)}
${r}`),{vertexShader:t,fragmentShader:r}}});a.setUniformNames=function(t){e=t||[];const r=e.sort().join("|");r!==i&&(i=r,this.needsUpdate=!0)};const n=a.customProgramCacheKey();return a.customProgramCacheKey=function(){return n+"|"+i},a.isInstancedUniformsMaterial=!0,a}class vI extends Zl{constructor(e,i,a){super(e,i,a),this._maxCount=a,this._instancedUniformNames=[]}get geometry(){let e=this._derivedGeometry;const i=this._baseGeometry;return(!e||e.baseGeometry!==i)&&(e=this._derivedGeometry=Object.create(i),e.baseGeometry=i,e.attributes=Object.create(i.attributes),i.addEventListener("dispose",function a(){i.removeEventListener("dispose",a),e.dispose()})),e}set geometry(e){this._baseGeometry=e}get material(){let e=this._derivedMaterial;const i=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=new Tn);return(!e||e.baseMaterial!==i)&&(e=this._derivedMaterial=mI(i),i.addEventListener("dispose",function a(){i.removeEventListener("dispose",a),e.dispose()})),e.setUniformNames(this._instancedUniformNames),e}set material(e){if(Array.isArray(e))throw new Error("InstancedUniformsMesh does not support multiple materials");for(;e&&e.isInstancedUniformsMaterial;)e=e.baseMaterial;this._baseMaterial=e}get customDepthMaterial(){return this.material.getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return this.material.getDistanceMaterial()}set customDistanceMaterial(e){}setUniformAt(e,i,a){const n=this.geometry.attributes,t=`troika_attr_${e}`;let r=n[t];if(!r){const s=bI(this._baseMaterial,e),l=wI(s);if(r=n[t]=new $l(new Float32Array(l*this._maxCount),l),s!==null)for(let c=0;c<this._maxCount;c++)Ep(r,c,s);this._instancedUniformNames=[...this._instancedUniformNames,e]}Ep(r,i,a),r.needsUpdate=!0}unsetUniform(e){this.geometry.deleteAttribute(`troika_attr_${e}`),this._instancedUniformNames=this._instancedUniformNames.filter(i=>i!==e)}}function Ep(o,e,i){let a=o.itemSize;a===1?o.setX(e,i):a===2?o.setXY(e,i.x,i.y):a===3?i.isColor?o.setXYZ(e,i.r,i.g,i.b):o.setXYZ(e,i.x,i.y,i.z):a===4?o.setXYZW(e,i.x,i.y,i.z,i.w):i.toArray?i.toArray(o.array,e*a):o.set(i,e*a)}function bI(o,e){let i=o.uniforms;return i&&i[e]||(i=gI(o).uniforms,i&&i[e])?i[e].value:null}function wI(o){return o==null?0:typeof o=="number"?1:o.isVector2?2:o.isVector3||o.isColor?3:o.isVector4||o.isQuaternion?4:o.elements?o.elements.length:Array.isArray(o)?o.length:0}const yI=(o,e)=>{const i=o.split(`
`),a=/vMapUv|vAlphaMapUv|vNormalMapUv/g;return i.map(n=>!n.includes("varying")&&!n.includes("uniform")?n.replace(a,e):n).join(`
`)},_I=(o,e)=>{const i={USE_UV:""};return e&&(i.TRI_GEOMETRY=""),Kl(o,{defines:i,uniforms:{animationData:{value:null},animationDataSize:{value:0},billboarding:{value:0},flipX:{value:0},flipY:{value:0},spritesheetData:{value:null},dataSize:{value:new lt(0,0)},tint:{value:new ri(0,0,0,0)}},vertexDefs:`
    uniform float billboarding;
    flat varying int vId;
    `,vertexMainOutro:`
    vId = gl_InstanceID;
    if(billboarding == 1.){
      vec3 instancePosition = vec3(instanceMatrix[3]);
      vec3 instanceScale = vec3(length(instanceMatrix[0]), length(instanceMatrix[1]), length(instanceMatrix[2]));

      vec3 cameraRight_worldspace = vec3(modelViewMatrix[0][0], modelViewMatrix[1][0], modelViewMatrix[2][0]);
      vec3 cameraUp_worldspace = vec3(modelViewMatrix[0][1], modelViewMatrix[1][1], modelViewMatrix[2][1]);

      vec3 vertexPosition_worldspace = instancePosition
        + cameraRight_worldspace * position.x * instanceScale.x
        + cameraUp_worldspace * position.y * instanceScale.y;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition_worldspace, 1.0);
    }
    `,customRewriter:({vertexShader:a,fragmentShader:n})=>(n=n.replace("void main() {",`void main() {
      float y = float(vId / animationDataSize) / float(animationDataSize);
      float x = mod(float(vId),float(animationDataSize)) / float(animationDataSize);

      float spritesheetFrameId = texture2D(animationData, vec2(x,y)).r;

			// x,y,w,h
			vec4 frameMeta = readData(spritesheetFrameId, 0.f);

			vec2 fSize = frameMeta.zw;
			vec2 fOffset = vec2(frameMeta.xy);

      vec2 transformedPlaneUv = vUv + vec2(0.,0.);

      // todo  == 1. caused a flickering bug. look into Precision/interpolation?
      if(flipX > 0.){
        transformedPlaneUv.x = 1. - transformedPlaneUv.x;
      }
      if(flipY > 0.){
        transformedPlaneUv.y = 1. - transformedPlaneUv.y;
      }

			vec2 spriteUv = fSize * transformedPlaneUv + fOffset ;

      #ifdef TRI_GEOMETRY
        // Shift UVs if mesh uses triangle geometry
        // TODO optimize ugly math
        if(vUv.y>0.5 || vUv.x<0.25 || vUv.x>0.75){
          discard;
        }

        vec2 zoomCenter = vec2(fSize.x * 0.5,0.) + fOffset;
        float zoomFactor = 2.;
        vec2 shiftedUV = spriteUv - zoomCenter;
        shiftedUV *= zoomFactor;
        shiftedUV += zoomCenter;
        spriteUv = shiftedUV;
      #endif



			`),n=`
			
			uniform sampler2D animationData;
      uniform int animationDataSize;
			uniform sampler2D spritesheetData;
      uniform float startTime;
			uniform float time;
			uniform float flipX;
			uniform float flipY;
			uniform vec2 dataSize;
      uniform vec4 tint;

      flat varying int vId;
			
			
			vec4 readData(float col, float row) {
				float wStep = 1.f / dataSize.x;
				float wHalfStep = wStep * 0.5f;
				float hStep = 1.f / dataSize.y;
				float hHalfStep = 1.f / dataSize.y * 0.5f;
				return texture2D(spritesheetData, vec2(col * wStep + wHalfStep, row * hStep + hHalfStep));
			}

      vec2 zoomUV(vec2 uv, vec2 zoomCenter, float zoomFactor) {
        // Shift UVs so that the zoom center is the origin
        vec2 shiftedUV = uv - zoomCenter;

        // Scale (zoom) the UV coordinates
        shiftedUV *= zoomFactor;

        // Shift back
        shiftedUV += zoomCenter;

        return shiftedUV;
    }
			
			${n}
			`,n=n.replace("vec4 sampledDiffuseColor = texture2D( map, vMapUv );",`
        vec4 sampledDiffuseColor = texture2D( map, vMapUv );
        if(tint.w == 1.){
          vec3 hue_term = 1.0 - min(abs(vec3(tint.x) - vec3(0,2.0,1.0)), 1.0);
          hue_term.x = 1.0 - dot(hue_term.yz, vec2(1));
          vec3 res = vec3(dot(sampledDiffuseColor.xyz, hue_term.xyz), dot(sampledDiffuseColor.xyz, hue_term.zxy), dot(sampledDiffuseColor.xyz, hue_term.yzx));
          res = mix(vec3(dot(res, vec3(0.2, 0.5, 0.3))), res, tint.y);
          res = res * tint.z;

          sampledDiffuseColor = vec4(res, sampledDiffuseColor.a);
        }

        // sampledDiffuseColor = vec4(texture2D(animationData, vUv).rgb, 1.);
      `),n=yI(n,"spriteUv"),{vertexShader:a,fragmentShader:n})})},CI=o=>{const e=[],i=[],a={},n=[],t=o.meta.size.w,r=o.meta.size.h,s=[o.meta.size.w,o.meta.size.h];for(const l in o.frames){const c=o.frames[l];e.push([c.frame.x/t,c.frame.y/r,c.frame.w/t,c.frame.h/r]),i.push(c.duration)}for(const l of o.meta.frameTags){a[l.name]=[];for(let c=l.from;c<=l.to;c++)a[l.name].push([c,i[c]]);n.push(a[l.name].length)}return{frames:e,animations:a,sheetSize:s,animationLengths:n}},EI=o=>{const{frames:e,animationLengths:i,animations:a}=o,n=Math.max(e.length,i.length,...Object.values(a).map(p=>p.length)),t=2+Object.values(a).length,r=e.flat().concat(new Array((n-e.length)*4).fill(0)),s=i.map(p=>[p,0,0,0]).flat().concat(new Array((n-i.length)*4).fill(0)),l=[],c=new Map;for(let p=0;p<Object.keys(a).length;p++){const m=Object.keys(a)[p];c.set(m,p);const b=a[m].map(v=>[...v,0,0]).flat().concat(new Array((n-a[m].length)*4).fill(0));l.push(...b)}const h=[...r,...s,...l],d=new Float32Array(h);d.set(h);const f=new Kr(d,n,t,ni,fn);return f.type=fn,f.minFilter=wn,f.magFilter=wn,f.wrapS=pa,f.wrapT=ir,f.needsUpdate=!0,{dataTexture:f,dataWidth:n,dataHeight:t,animMap:c}},xI=()=>{const o=new hi,e=new Float32Array([0,1,0,-1,-1,0,1,-1,0]);o.setAttribute("position",new Mt(e,3));const i=new Float32Array([.5,1,0,0,1,0]);return o.setAttribute("uv",new Mt(i,2)),o.computeVertexNormals(),o},II=new Ia(-1,1,1,-1,0,1);class BI extends hi{constructor(){super(),this.setAttribute("position",new cs([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new cs([0,2,0,0,2,0],2))}}const SI=new BI;class kI{constructor(e){this._mesh=new Re(SI,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,II)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class DI{constructor(e,i,a){this.variables=[],this.currentTextureIndex=0;let n=fn;const t={passThruTexture:{value:null}},r=c(d(),t),s=new kI(r);this.setDataType=function(f){return n=f,this},this.addVariable=function(f,p,m){const b=this.createShaderMaterial(p),v={name:f,initialValueTexture:m,material:b,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:wn,magFilter:wn};return this.variables.push(v),v},this.setVariableDependencies=function(f,p){f.dependencies=p},this.init=function(){if(a.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let f=0;f<this.variables.length;f++){const p=this.variables[f];p.renderTargets[0]=this.createRenderTarget(e,i,p.wrapS,p.wrapT,p.minFilter,p.magFilter),p.renderTargets[1]=this.createRenderTarget(e,i,p.wrapS,p.wrapT,p.minFilter,p.magFilter),this.renderTexture(p.initialValueTexture,p.renderTargets[0]),this.renderTexture(p.initialValueTexture,p.renderTargets[1]);const m=p.material,b=m.uniforms;if(p.dependencies!==null)for(let v=0;v<p.dependencies.length;v++){const y=p.dependencies[v];if(y.name!==p.name){let E=!1;for(let _=0;_<this.variables.length;_++)if(y.name===this.variables[_].name){E=!0;break}if(!E)return"Variable dependency not found. Variable="+p.name+", dependency="+y.name}b[y.name]={value:null},m.fragmentShader=`
uniform sampler2D `+y.name+`;
`+m.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){const f=this.currentTextureIndex,p=this.currentTextureIndex===0?1:0;for(let m=0,b=this.variables.length;m<b;m++){const v=this.variables[m];if(v.dependencies!==null){const y=v.material.uniforms;for(let E=0,_=v.dependencies.length;E<_;E++){const C=v.dependencies[E];y[C.name].value=C.renderTargets[f].texture}}this.doRenderTarget(v.material,v.renderTargets[p])}this.currentTextureIndex=p},this.getCurrentRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){s.dispose();const f=this.variables;for(let p=0;p<f.length;p++){const m=f[p];m.initialValueTexture&&m.initialValueTexture.dispose();const b=m.renderTargets;for(let v=0;v<b.length;v++)b[v].dispose()}};function l(f){f.defines.resolution="vec2( "+e.toFixed(1)+", "+i.toFixed(1)+" )"}this.addResolutionDefine=l;function c(f,p){p=p||{};const m=new Gi({name:"GPUComputationShader",uniforms:p,vertexShader:h(),fragmentShader:f});return l(m),m}this.createShaderMaterial=c,this.createRenderTarget=function(f,p,m,b,v,y){return f=f||e,p=p||i,m=m||pa,b=b||pa,v=v||wn,y=y||wn,new Hl(f,p,{wrapS:m,wrapT:b,minFilter:v,magFilter:y,format:ni,type:n,depthBuffer:!1})},this.createTexture=function(){const f=new Float32Array(e*i*4),p=new Kr(f,e,i,ni,fn);return p.needsUpdate=!0,p},this.renderTexture=function(f,p){t.passThruTexture.value=f,this.doRenderTarget(r,p),t.passThruTexture.value=null},this.doRenderTarget=function(f,p){const m=a.getRenderTarget(),b=a.xr.enabled,v=a.shadowMap.autoUpdate;a.xr.enabled=!1,a.shadowMap.autoUpdate=!1,s.material=f,a.setRenderTarget(p),s.render(a),s.material=r,a.xr.enabled=b,a.shadowMap.autoUpdate=v,a.setRenderTarget(m)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}}const TI=`
  #include <common>
  uniform sampler2D instructionsTexture;

  uniform sampler2D spritesheetData;
  uniform vec2 dataSize;
  uniform float fps;
  uniform float deltaTime;

  // read spritesheet metadata
  vec4 readData(float col, float row, sampler2D tex) {
    float wStep = 1.f / dataSize.x;
    float wHalfStep = wStep * 0.5f;
    float hStep = 1.f / dataSize.y;
    float hHalfStep = 1.f / dataSize.y * 0.5f;
    return texture2D(spritesheetData, vec2(col * wStep + wHalfStep, row * hStep + hHalfStep));
  }



  void main()	{

    // OUTPUT FROM THIS SHADER
    // progressValue.r - picked animation frame
    // progressValue.g - previous progress state (for pause, reverse & pingpong consistency)
    // progressValue.b - not used yet
    // progressValue.a - previous animationID

    vec2 cellSize = 1.0 / resolution.xy;
    vec2 uv = gl_FragCoord.xy * cellSize;


    vec4 progressValue = texture2D( progress, uv );

    vec4 instructions = texture2D( instructionsTexture, uv);

    // FREEZE FRAME - return to save calculations?
    if(instructions.a >=10.){
      progressValue.r = instructions.a - 10.;
      progressValue.a = instructions.x;
      progressValue.g = progressValue.g;
      gl_FragColor = progressValue;
      return;
    }


    progressValue.b = 0.;

    // todo shouldn't be rounding here, pick
    float animationId = round(instructions.x);

    float offset = instructions.g;

    float animLength = readData(animationId, 1.f, spritesheetData).r;
    float totalTime = animLength / fps;

    // new delta is % of animation
    float newProgress = deltaTime / totalTime;
    // add new delta to saved progress
    float frameTimedId = mod(progressValue.g + newProgress, 1.);
    // frameTimedId = 0.;
    // float frameTimedId = progressValue.g;
    // save for use in next frame



    float playMode = mod(instructions.b, 10.);

    // forward
    if(playMode == 0.){
      frameTimedId = progressValue.g + newProgress;
    }
    // reverse
    if(playMode == 1.){
      frameTimedId = progressValue.g - newProgress;
    }
    // 2 - pause - do nothing
    if(playMode == 2.){
      frameTimedId = progressValue.g;
    }

    // //todo pingpong
    // if(playMode == 3.){
    // }

    // loop (play once over 10.)
    if(instructions.b < 10.){
      frameTimedId = mod(frameTimedId, 1.);
    }

    // todo This could be optional and user would reset manually,
    // todo allowing for consistent movement across multiple animations
    // todo for example - running steps being syncec
    // start anim from beginning if animationID changes
    if(progressValue.a != instructions.x){
      frameTimedId = 0.;
    }

    float frameId = floor(animLength * frameTimedId);
    float spritesheetFrameId = readData(frameId, 2.f + animationId, spritesheetData).r;



    // Picked sprite frame that goes to material
    progressValue.r = spritesheetFrameId;

    progressValue.a = instructions.x;
    progressValue.g = frameTimedId;

    gl_FragColor = progressValue;
  }
`,MI=(o=512)=>{const e=new Float32Array(o**2*4);for(let a=0;a<o**2*4;a++)e[a]=0;const i=new Kr(e,o,o,ni,fn);return i.minFilter=wn,i.magFilter=wn,i.wrapS=pa,i.wrapT=ir,i.needsUpdate=!0,i},PI=o=>{if(o<=0)return 1;let e=1;for(;e<o;)e<<=1;return e},QI=(o,e)=>{const i=PI(Math.sqrt(e)),a=new DI(i,i,o),n=a.createTexture(),t=a.addVariable("progress",TI,n),r=MI(i);t.material.uniforms.instructionsTexture={value:r},t.material.uniforms.spritesheetData={value:null},t.material.uniforms.fps={value:0},t.material.uniforms.deltaTime={value:0},t.material.uniforms.dataSize={value:new lt},a.setVariableDependencies(t,[t]);const s=a.init();s!==null&&console.error(s);let l=!1;return{gpuCompute:a,animationRunner:t,progressDataTexture:r,utils:{updateAnimationAt:(c,h)=>{const d=c*4;r.image.data[d]=h,l=!0},updateOffsetAt:(c,h)=>{const d=c*4;r.image.data[d+1]=h,l=!0},updatePlaymodeAt:(c,h)=>{const d=c*4;r.image.data[d+2]=h,l=!0},updateFrameAt:(c,h)=>{const d=c*4;r.image.data[d+3]=h+10,l=!0}},update:()=>{l&&(r.needsUpdate=!0,l=!1),a.compute()}}};class RI{constructor(){jt(this,"_previousTime"),jt(this,"_currentTime"),jt(this,"_startTime"),jt(this,"_delta"),jt(this,"_elapsed"),jt(this,"_timescale"),jt(this,"_useFixedDelta"),jt(this,"_fixedDelta"),jt(this,"_usePageVisibilityAPI"),jt(this,"_pageVisibilityHandler"),this._previousTime=0,this._currentTime=0,this._startTime=Ku(),this._delta=0,this._elapsed=0,this._timescale=1,this._useFixedDelta=!1,this._fixedDelta=16.67,this._usePageVisibilityAPI=typeof document<"u"&&document.hidden!==void 0,this._usePageVisibilityAPI===!0&&(this._pageVisibilityHandler=UI.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disableFixedDelta(){return this._useFixedDelta=!1,this}dispose(){return this._usePageVisibilityAPI===!0&&document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this}enableFixedDelta(){return this._useFixedDelta=!0,this}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getFixedDelta(){return this._fixedDelta/1e3}getTimescale(){return this._timescale}reset(){return this._currentTime=Ku()-this._startTime,this}setFixedDelta(e){return this._fixedDelta=e*1e3,this}setTimescale(e){return this._timescale=e,this}update(){return this._useFixedDelta===!0?this._delta=this._fixedDelta:(this._previousTime=this._currentTime,this._currentTime=Ku()-this._startTime,this._delta=this._currentTime-this._previousTime),this._delta*=this._timescale,this._elapsed+=this._delta,this}}function Ku(){return(typeof performance>"u"?Date:performance).now()}function UI(){document.hidden===!1&&this.reset()}const Yu={FORWARD:0,REVERSE:1,PAUSE:2,PINGPONG:3};class FI extends vI{constructor(e,i,a,n={geometry:"quad"}){let t;n.geometry||(n.geometry="quad"),n.geometry==="tri"&&(t=xI()),n.geometry==="quad"&&(t=new _r(1,1)),n.geometry&&typeof n.geometry!="string"&&(t=n.geometry);const r=_I(e,(n==null?void 0:n.geometry)==="tri");super(t,r,i),jt(this,"_spriteMaterial"),jt(this,"_spritesheet"),jt(this,"_animationMap"),jt(this,"_fps",15),jt(this,"_timer"),jt(this,"compute"),this.instanceMatrix.clearUpdateRanges(),this.instanceMatrix.addUpdateRange(0,i*16),this.instanceColor&&(this.instanceColor.clearUpdateRanges(),this.instanceColor.addUpdateRange(0,i*3)),this.compute=QI(a,i),this._spriteMaterial=r,n.spritesheet&&this.updateSpritesheet(n.spritesheet),this._timer=new RI,this._animationMap=new Map,this._spriteMaterial.uniforms.animationData.value=this.compute.gpuCompute.getCurrentRenderTarget(this.compute.animationRunner).texture,this._spriteMaterial.uniforms.animationDataSize.value=this.compute.progressDataTexture.image.width}updateSpritesheet(e){const{dataTexture:i,dataWidth:a,dataHeight:n,animMap:t}=EI(e);this._spriteMaterial.uniforms.spritesheetData.value=i,this._spriteMaterial.uniforms.dataSize.value.x=a,this._spriteMaterial.uniforms.dataSize.value.y=n,this.compute.animationRunner.material.uniforms.dataSize.value=new lt(a,n),this.compute.animationRunner.material.uniforms.spritesheetData.value=i,this._animationMap=t}get spritesheet(){return this._spritesheet}set spritesheet(e){this.updateSpritesheet(e),this._spritesheet=e}get animationMap(){return this._animationMap}get animation(){return{setAt:(e,i)=>{this.compute.utils.updateAnimationAt(e,this._animationMap.get(i)||0)}}}get frame(){return{setAt:(e,i,a)=>{var n;let t=i;a&&(t=(n=this.spritesheet)==null?void 0:n.animations[a][i][0]),this.compute.utils.updateFrameAt(e,t)},unsetAt:e=>{this.compute.utils.updateFrameAt(e,-10)},unsetAll:()=>{for(let e=0;e<this.count;e++)this.compute.utils.updateFrameAt(e,-10)}}}get playmode(){return{setAt:(e,i)=>{this.compute.utils.updatePlaymodeAt(e,Yu[i])},setAll:e=>{for(let i=0;i<this.count;i++){const a=this.compute.progressDataTexture.image.data[i*4+2]>=10?10:0;this.compute.utils.updatePlaymodeAt(i,a+Yu[e])}}}}get billboarding(){return{setAt:(e,i)=>{this.setUniformAt("billboarding",e,i?1:0)},setAll:e=>{this._spriteMaterial.uniforms.billboarding.value=e?1:0},unsetAll:()=>{this.unsetUniform("billboarding")}}}get offset(){return{setAt:(e,i)=>{this.compute.utils.updateOffsetAt(e,i)},randomizeAll:(e=1)=>{for(let i=0;i<this.count;i++)this.compute.utils.updateOffsetAt(i,Math.random()*e)}}}get loop(){return{setAt:(e,i)=>{const a=this.compute.progressDataTexture.image.data[e*4+2]%10;this.compute.utils.updatePlaymodeAt(e,a+(i?0:10))},setAll:e=>{for(let i=0;i<this.count;i++){const a=this.compute.progressDataTexture.image.data[i*4+2]%10;this.compute.utils.updatePlaymodeAt(i,a+(e?0:10))}}}}get flipX(){return{setAt:(e,i)=>{this.setUniformAt("flipX",e,i?1:0)},setGlobal:e=>{this._spriteMaterial.uniforms.flipX.value=e?1:0},unsetAll:()=>{this.unsetUniform("flipX")}}}get flipY(){return{setAt:(e,i)=>{this.setUniformAt("flipY",e,i?1:0)},setGlobal:e=>{this._spriteMaterial.uniforms.flipY.value=e?1:0},unsetAll:()=>{this.unsetUniform("flipY")}}}play(e,i=!0,a="FORWARD"){return{at:n=>{this.compute.utils.updateAnimationAt(n,this._animationMap.get(e)||0),this.compute.utils.updatePlaymodeAt(n,Yu[a]+(i?0:10))}}}get hueShift(){const e=new ri;return{setGlobal:i=>{i?e.set(i.h,i.s,i.v,1):e.setW(0),this._spriteMaterial.uniforms.tint.value=e}}}get fps(){return this._fps}set fps(e){this._fps=e,this.compute.animationRunner.material.uniforms.fps.value=e}update(){this._timer.update();const e=this._timer.getDelta();this.compute.animationRunner.material.uniforms.deltaTime.value=e,this.compute.update()}}function LI(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var dd={exports:{}};dd.exports=bc;dd.exports.default=bc;function bc(o,e,i){i=i||2;var a=e&&e.length,n=a?e[0]*i:o.length,t=bm(o,0,n,i,!0),r=[];if(!t||t.next===t.prev)return r;var s,l,c,h,d,f,p;if(a&&(t=HI(o,e,t,i)),o.length>80*i){s=c=o[0],l=h=o[1];for(var m=i;m<n;m+=i)d=o[m],f=o[m+1],d<s&&(s=d),f<l&&(l=f),d>c&&(c=d),f>h&&(h=f);p=Math.max(c-s,h-l),p=p!==0?32767/p:0}return ba(t,r,i,s,l,p,0),r}function bm(o,e,i,a,n){var t,r;if(n===Qh(o,e,i,a)>0)for(t=e;t<i;t+=a)r=xp(t,o[t],o[t+1],r);else for(t=i-a;t>=e;t-=a)r=xp(t,o[t],o[t+1],r);return r&&wc(r,r.next)&&(ya(r),r=r.next),r}function ko(o,e){if(!o)return o;e||(e=o);var i=o,a;do if(a=!1,!i.steiner&&(wc(i,i.next)||an(i.prev,i,i.next)===0)){if(ya(i),i=e=i.prev,i===i.next)break;a=!0}else i=i.next;while(a||i!==e);return e}function ba(o,e,i,a,n,t,r){if(o){!r&&t&&KI(o,a,n,t);for(var s=o,l,c;o.prev!==o.next;){if(l=o.prev,c=o.next,t?GI(o,a,n,t):OI(o)){e.push(l.i/i|0),e.push(o.i/i|0),e.push(c.i/i|0),ya(o),o=c.next,s=c.next;continue}if(o=c,o===s){r?r===1?(o=NI(ko(o),e,i),ba(o,e,i,a,n,t,2)):r===2&&zI(o,e,i,a,n,t):ba(ko(o),e,i,a,n,t,1);break}}}}function OI(o){var e=o.prev,i=o,a=o.next;if(an(e,i,a)>=0)return!1;for(var n=e.x,t=i.x,r=a.x,s=e.y,l=i.y,c=a.y,h=n<t?n<r?n:r:t<r?t:r,d=s<l?s<c?s:c:l<c?l:c,f=n>t?n>r?n:r:t>r?t:r,p=s>l?s>c?s:c:l>c?l:c,m=a.next;m!==e;){if(m.x>=h&&m.x<=f&&m.y>=d&&m.y<=p&&os(n,s,t,l,r,c,m.x,m.y)&&an(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function GI(o,e,i,a){var n=o.prev,t=o,r=o.next;if(an(n,t,r)>=0)return!1;for(var s=n.x,l=t.x,c=r.x,h=n.y,d=t.y,f=r.y,p=s<l?s<c?s:c:l<c?l:c,m=h<d?h<f?h:f:d<f?d:f,b=s>l?s>c?s:c:l>c?l:c,v=h>d?h>f?h:f:d>f?d:f,y=Mh(p,m,e,i,a),E=Mh(b,v,e,i,a),_=o.prevZ,C=o.nextZ;_&&_.z>=y&&C&&C.z<=E;){if(_.x>=p&&_.x<=b&&_.y>=m&&_.y<=v&&_!==n&&_!==r&&os(s,h,l,d,c,f,_.x,_.y)&&an(_.prev,_,_.next)>=0||(_=_.prevZ,C.x>=p&&C.x<=b&&C.y>=m&&C.y<=v&&C!==n&&C!==r&&os(s,h,l,d,c,f,C.x,C.y)&&an(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=b&&_.y>=m&&_.y<=v&&_!==n&&_!==r&&os(s,h,l,d,c,f,_.x,_.y)&&an(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;C&&C.z<=E;){if(C.x>=p&&C.x<=b&&C.y>=m&&C.y<=v&&C!==n&&C!==r&&os(s,h,l,d,c,f,C.x,C.y)&&an(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function NI(o,e,i){var a=o;do{var n=a.prev,t=a.next.next;!wc(n,t)&&wm(n,a,a.next,t)&&wa(n,t)&&wa(t,n)&&(e.push(n.i/i|0),e.push(a.i/i|0),e.push(t.i/i|0),ya(a),ya(a.next),a=o=t),a=a.next}while(a!==o);return ko(a)}function zI(o,e,i,a,n,t){var r=o;do{for(var s=r.next.next;s!==r.prev;){if(r.i!==s.i&&JI(r,s)){var l=ym(r,s);r=ko(r,r.next),l=ko(l,l.next),ba(r,e,i,a,n,t,0),ba(l,e,i,a,n,t,0);return}s=s.next}r=r.next}while(r!==o)}function HI(o,e,i,a){var n=[],t,r,s,l,c;for(t=0,r=e.length;t<r;t++)s=e[t]*a,l=t<r-1?e[t+1]*a:o.length,c=bm(o,s,l,a,!1),c===c.next&&(c.steiner=!0),n.push(XI(c));for(n.sort(VI),t=0;t<n.length;t++)i=jI(n[t],i);return i}function VI(o,e){return o.x-e.x}function jI(o,e){var i=qI(o,e);if(!i)return e;var a=ym(i,o);return ko(a,a.next),ko(i,i.next)}function qI(o,e){var i=e,a=o.x,n=o.y,t=-1/0,r;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var s=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=a&&s>t&&(t=s,r=i.x<i.next.x?i:i.next,s===a))return r}i=i.next}while(i!==e);if(!r)return null;var l=r,c=r.x,h=r.y,d=1/0,f;i=r;do a>=i.x&&i.x>=c&&a!==i.x&&os(n<h?a:t,n,c,h,n<h?t:a,n,i.x,i.y)&&(f=Math.abs(n-i.y)/(a-i.x),wa(i,o)&&(f<d||f===d&&(i.x>r.x||i.x===r.x&&WI(r,i)))&&(r=i,d=f)),i=i.next;while(i!==l);return r}function WI(o,e){return an(o.prev,o,e.prev)<0&&an(e.next,o,o.next)<0}function KI(o,e,i,a){var n=o;do n.z===0&&(n.z=Mh(n.x,n.y,e,i,a)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==o);n.prevZ.nextZ=null,n.prevZ=null,YI(n)}function YI(o){var e,i,a,n,t,r,s,l,c=1;do{for(i=o,o=null,t=null,r=0;i;){for(r++,a=i,s=0,e=0;e<c&&(s++,a=a.nextZ,!!a);e++);for(l=c;s>0||l>0&&a;)s!==0&&(l===0||!a||i.z<=a.z)?(n=i,i=i.nextZ,s--):(n=a,a=a.nextZ,l--),t?t.nextZ=n:o=n,n.prevZ=t,t=n;i=a}t.nextZ=null,c*=2}while(r>1);return o}function Mh(o,e,i,a,n){return o=(o-i)*n|0,e=(e-a)*n|0,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,o|e<<1}function XI(o){var e=o,i=o;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==o);return i}function os(o,e,i,a,n,t,r,s){return(n-r)*(e-s)>=(o-r)*(t-s)&&(o-r)*(a-s)>=(i-r)*(e-s)&&(i-r)*(t-s)>=(n-r)*(a-s)}function JI(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!ZI(o,e)&&(wa(o,e)&&wa(e,o)&&$I(o,e)&&(an(o.prev,o,e.prev)||an(o,e.prev,e))||wc(o,e)&&an(o.prev,o,o.next)>0&&an(e.prev,e,e.next)>0)}function an(o,e,i){return(e.y-o.y)*(i.x-e.x)-(e.x-o.x)*(i.y-e.y)}function wc(o,e){return o.x===e.x&&o.y===e.y}function wm(o,e,i,a){var n=Dl(an(o,e,i)),t=Dl(an(o,e,a)),r=Dl(an(i,a,o)),s=Dl(an(i,a,e));return!!(n!==t&&r!==s||n===0&&kl(o,i,e)||t===0&&kl(o,a,e)||r===0&&kl(i,o,a)||s===0&&kl(i,e,a))}function kl(o,e,i){return e.x<=Math.max(o.x,i.x)&&e.x>=Math.min(o.x,i.x)&&e.y<=Math.max(o.y,i.y)&&e.y>=Math.min(o.y,i.y)}function Dl(o){return o>0?1:o<0?-1:0}function ZI(o,e){var i=o;do{if(i.i!==o.i&&i.next.i!==o.i&&i.i!==e.i&&i.next.i!==e.i&&wm(i,i.next,o,e))return!0;i=i.next}while(i!==o);return!1}function wa(o,e){return an(o.prev,o,o.next)<0?an(o,e,o.next)>=0&&an(o,o.prev,e)>=0:an(o,e,o.prev)<0||an(o,o.next,e)<0}function $I(o,e){var i=o,a=!1,n=(o.x+e.x)/2,t=(o.y+e.y)/2;do i.y>t!=i.next.y>t&&i.next.y!==i.y&&n<(i.next.x-i.x)*(t-i.y)/(i.next.y-i.y)+i.x&&(a=!a),i=i.next;while(i!==o);return a}function ym(o,e){var i=new Ph(o.i,o.x,o.y),a=new Ph(e.i,e.x,e.y),n=o.next,t=e.prev;return o.next=e,e.prev=o,i.next=n,n.prev=i,a.next=i,i.prev=a,t.next=a,a.prev=t,a}function xp(o,e,i,a){var n=new Ph(o,e,i);return a?(n.next=a.next,n.prev=a,a.next.prev=n,a.next=n):(n.prev=n,n.next=n),n}function ya(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Ph(o,e,i){this.i=o,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}bc.deviation=function(o,e,i,a){var n=e&&e.length,t=n?e[0]*i:o.length,r=Math.abs(Qh(o,0,t,i));if(n)for(var s=0,l=e.length;s<l;s++){var c=e[s]*i,h=s<l-1?e[s+1]*i:o.length;r-=Math.abs(Qh(o,c,h,i))}var d=0;for(s=0;s<a.length;s+=3){var f=a[s]*i,p=a[s+1]*i,m=a[s+2]*i;d+=Math.abs((o[f]-o[m])*(o[p+1]-o[f+1])-(o[f]-o[p])*(o[m+1]-o[f+1]))}return r===0&&d===0?0:Math.abs((d-r)/r)};function Qh(o,e,i,a){for(var n=0,t=e,r=i-a;t<i;t+=a)n+=(o[r]-o[t])*(o[t+1]+o[r+1]),r=t;return n}bc.flatten=function(o){for(var e=o[0][0].length,i={vertices:[],holes:[],dimensions:e},a=0,n=0;n<o.length;n++){for(var t=0;t<o[n].length;t++)for(var r=0;r<e;r++)i.vertices.push(o[n][t][r]);n>0&&(a+=o[n-1].length,i.holes.push(a))}return i};var e2=dd.exports;const t2=LI(e2);new lt;new lt;function n2(o,e){var i=o%e,a=Math.floor(o/e);return[i,a]}function i2(o,e,i){for(var a=0,n=0;a<o.length;a+=e,n++)o.set(i([o[a],o[a+1]],n),a);return o}function r2(o,e,i,a){var n=i.x-a.x,t=o.x-e.x,r=i.y-a.y,s=o.y-e.y,l=t*r-s*n;if(l==0)throw new Error("Number of intersection points is zero or infinity.");var c=o.x*e.y-o.y*e.x,h=i.x*a.y-i.y*a.x,d=(c*n-t*h)/l,f=(c*r-s*h)/l,p={x:d,y:f};return p}function o2(o){for(var e=0,i=0,a=o.length;i<a;i++){var n=o[i].x,t=o[i==o.length-1?0:i+1].y,r=o[i==o.length-1?0:i+1].x,s=o[i].y;e+=n*t*.5,e-=r*s*.5}return Math.abs(e)}function s2([o,e,i]){return Math.abs((o.x*(e.y-i.y)+e.x*(i.y-o.y)+i.x*(o.y-e.y))/2)}function a2(o,e=8){const i=o.slice();let a=0;for(;i.length>e&&a<1e3;){a++;let n=1/0,t=null;for(let r=0;r<=i.length-1;r++){const s=i.length,l=[r,(r+1)%s,(r+2)%s,(r+3)%s],c=i[l[0]],h=i[l[1]],d=i[l[2]],f=i[l[3]];try{const p=r2(c,h,d,f),m=s2([p,h,d]);m<n&&(n=m,t={point:p,area:m,indicesToRemove:[l[1],l[2]]})}catch(p){console.log(p)}}if(t){const r=t.indicesToRemove[0],s=t.indicesToRemove[1];s>r?(i.splice(s,1),i.splice(r,1)):(i.splice(r,1),i.splice(s,1)),i.splice(Math.min(r,s),0,t.point)}}return i}var Rh;(o=>{function e(n){let t=n.slice();return t.sort(o.POINT_COMPARATOR),o.makeHullPresorted(t)}o.makeHull=e;function i(n){if(n.length<=1)return n.slice();let t=[];for(let s=0;s<n.length;s++){const l=n[s];for(;t.length>=2;){const c=t[t.length-1],h=t[t.length-2];if((c.x-h.x)*(l.y-h.y)>=(c.y-h.y)*(l.x-h.x))t.pop();else break}t.push(l)}t.pop();let r=[];for(let s=n.length-1;s>=0;s--){const l=n[s];for(;r.length>=2;){const c=r[r.length-1],h=r[r.length-2];if((c.x-h.x)*(l.y-h.y)>=(c.y-h.y)*(l.x-h.x))r.pop();else break}r.push(l)}return r.pop(),t.length==1&&r.length==1&&t[0].x==r[0].x&&t[0].y==r[0].y?t:t.concat(r)}o.makeHullPresorted=i;function a(n,t){return n.x<t.x?-1:n.x>t.x?1:n.y<t.y?-1:n.y>t.y?1:0}o.POINT_COMPARATOR=a})(Rh||(Rh={}));function l2(o,e){const i=new Float32Array(o);for(let a=0;a<o;a++)i[a*3]=e[0],i[a*3+1]=e[1],i[a*3+2]=e[2];return i}function c2(o,e,i=()=>Math.random()){const a=e+1,n=new Float32Array(o.length/e*a);for(let t=0;t<o.length;t+=e){let r=t/e*a;n[r]=o[t],n[r+1]=o[t+1],n[r+2]=i(r)}return n}function u2(o){const e=new Float32Array(o.length*2);for(let i=0;i<o.length;i++)e[i*2]=o[i].x,e[i*2+1]=o[i].y;return e}function h2(o,e,i){const a=[],n=o%(e*4)/4,t=Math.floor(o/(e*4)),r=t-1,s=t+1,l=n-1,c=n+1;return r>=0?a.push(r*e+n):a.push(null),s<i?a.push(s*e+n):a.push(null),l>=0?a.push(t*e+l):a.push(null),c<e?a.push(t*e+c):a.push(null),a}const d2=o=>(...e)=>e[3]/255>0,f2={threshold:.01,slices:[1,1],indices:[0,0],scale:1,filter:d2};class A2{constructor(e,i,a){jt(this,"points",[]),jt(this,"data",{areaReduction:0}),jt(this,"debug",!0),jt(this,"index"),jt(this,"positions"),jt(this,"uv"),jt(this,"defaultSettings",f2),jt(this,"settings"),this.vertices=a,this.settings={...this.defaultSettings,...i};const{slices:n}=this.settings,t=p2("bvc-image",e.width,e.height);this.points=this.getPoints(e,t);let r=Rh.makeHull(this.points);const s=a2(r,a),l=s.map(f=>{let p=g2(f,[e.width,e.height],n);return p.y=-1*p.y,p}),{scale:c}=this.settings;this.data.areaReduction=1-o2(s)/(e.width/n[0]*(e.height/n[1]))*c;const h=u2(l),d=t2(h,null,2);this.positions=c2(h,2,()=>0),this.index=Uint32Array.from(d),this.uv=i2(h.slice(0),2,f=>{let p=f[0]+.5;p=p/this.settings.slices[0]+1/this.settings.slices[0]*this.settings.indices[0];let m=f[1]+.5;return m=m/this.settings.slices[1]+1-1/this.settings.slices[1]*(this.settings.indices[1]+1),[p,m]})}getImageData(e,i){const a=i.getContext("2d");a.drawImage(e,0,0);const[n,t]=this.settings.indices,[r,s]=this.settings.slices,l=i.width/r,c=i.height/s;return a.getImageData(l*n,c*t,l,c)}getPoints(e,i){const a=this.getImageData(e,i),n=a.data,t=[],r=this.settings.filter(this.settings.threshold),s=l=>l!==null&&r(n[l*4],n[l*4+1],n[l*4+2],n[l*4+3]);for(let l=0;l<n.length;l+=4)if(r(n[l+0],n[l+1],n[l+2],n[l+3])){if(h2(l,i.width,i.height).every(s))continue;const[c,h]=n2(l/4,a.width);t.push({x:c,y:h})}return t}}const p2=(o="debug-canvas",e,i)=>{const a=document.querySelector(`#${o}`)||document.createElement("canvas");return a.id=o,a.width=e,a.height=i,a.id=o,a},g2=(o,e,i)=>({x:(o.x-e[0]/(2*i[0]))/(e[0]/i[0]),y:(o.y-e[1]/(2*i[1]))/(e[1]/i[1])}),m2={threshold:.01,slices:[1,1],indices:[1,1]};class v2 extends hi{constructor(e,i=8,a=.01,n=[1,1],t=[0,0]){super(),jt(this,"image"),jt(this,"vertices",8),jt(this,"settings",m2),this.vertices=i,this.settings={...this.settings,threshold:a,slices:n,indices:t},this.image="image"in e?e.image:e,this.build()}build(){const e=new A2(this.image,this.settings,this.vertices),i=e.positions.length,a=new Mt(e.index,1),n=new Mt(e.positions,3),t=new Mt(l2(i,[0,0,1]),3),r=new Mt(e.uv,2);this.userData.reduction=e.data.areaReduction,this.setIndex(a),this.setAttribute("position",n),this.setAttribute("normal",t),this.setAttribute("uv",r)}}const b2=()=>new w2;class w2{constructor(){jt(this,"animations"),this.animations=[]}add(e,i,a){const n={name:"",imageUrl:e};return Array.isArray(a)?n.multiAnimations=a:n.name=a,i.type=="rowColumn"&&(n.auto={type:"rowColumn",width:i.width,height:i.height}),i.type=="frameSize"&&(n.auto={type:"frameSize",width:i.width,height:i.height}),this.animations.push(n),this}async build(e={}){const i=new W0,a={frames:[],animations:{},sheetSize:[0,0],animationLengths:[]};let n=new ga;const t=[];let r=0,s=0;for(const b of this.animations){const v=await i.loadAsync(b.imageUrl),y=v.width,E=v.height;r=Math.max(r,y),s+=E,t.push({img:v,w:y,h:E})}const l=document.createElement("canvas");l.width=r,l.height=s;const c=l.getContext("2d");let h=0;for(const{img:b,h:v}of t)c==null||c.drawImage(b,0,h,b.width,b.height),h+=v;n=new ma(l),n.needsUpdate=!0;let d=0,f=0,p=0,m=64;for(const b of this.animations){const v=t[d];let y=0;if(b.auto){let E=0,_=0;b.auto.type=="frameSize"&&(_=v.w/b.auto.width,E=v.h/b.auto.height),b.auto.type=="rowColumn"&&(_=b.auto.width,E=b.auto.height);const C=v.w/_,x=v.h/E;y=E*_,b.multiAnimations||(a.animations[b.name]=[]);const B=new Map;for(let I=0;I<E;I++){p+=x;for(let k=0;k<_;k++){if(a.frames.push([v.w/_*k/r,1-p/s,C/r,x/s]),b.multiAnimations){const P=I*_+k;B.set(P,f)}else a.animations[b.name].push([f,1]);f++}}if(b.multiAnimations)for(const I of b.multiAnimations){a.animations[I.name]=[],a.animationLengths.push(I.frameRange[1]-I.frameRange[0]+1);for(let k=I.frameRange[0];k<=I.frameRange[1];k++)a.animations[I.name].push([B.get(k),1])}else a.animationLengths.push(y)}d++}if(n.matrixAutoUpdate=!1,n.generateMipmaps=!1,n.premultiplyAlpha=!1,n.wrapS=n.wrapT=ir,n.magFilter=n.minFilter=wn,n.colorSpace=vi,a.sheetSize=[r,s],e.makeSlimGeometry){const b=document.createElement("canvas");b.width=m,b.height=m;const v=b.getContext("2d"),y=r/m,E=s/m;for(let x=0;x<y;x++)for(let B=0;B<E;B++){const I=x*m,k=B*m;v==null||v.drawImage(l,I,k,m,m,0,0,m,m)}const _=new ma(b);_.magFilter=n.minFilter=wn,_.colorSpace=vi;const C=new v2(_,e.slimOptions?e.slimOptions.vertices:8,e.slimOptions?e.slimOptions.alphaThreshold:0);return{spritesheet:a,texture:n,geometry:C}}return{spritesheet:a,texture:n}}}function y2(o,e){st(e,!0);let i=z(e,"id",3,0),a=z(e,"position",19,()=>[0,0,0]),n=z(e,"scale",19,()=>[1,1]);const{updatePosition:t,sprite:r}=Cr("instanced-sprite-ctx");Ae(()=>{a()!==void 0&&t(i(),a(),n())}),Ae(()=>{e.animationName!==void 0&&r.animation.setAt(i(),e.animationName)}),Ae(()=>{e.playmode!==void 0&&r.playmode.setAt(i(),e.playmode)}),Ae(()=>{e.billboarding!==void 0&&r.billboarding.setAt(i(),e.billboarding)}),Ae(()=>{e.offset!==void 0&&r.offset.setAt(i(),e.offset)}),Ae(()=>{e.loop!==void 0&&r.loop.setAt(i(),e.loop)}),Ae(()=>{e.flipX!==void 0&&r.flipX.setAt(i(),e.flipX)}),Ae(()=>{e.flipY!==void 0&&r.flipY.setAt(i(),e.flipY)}),Ae(()=>{e.frameId!==void 0&&r.frame.setAt(i(),e.frameId,e.animationName)}),at()}function hS(o,e){st(e,!0);let i=z(e,"autoUpdate",3,!0),a=z(e,"baseMaterial",3,Tn),n=z(e,"fps",3,15),t=z(e,"playmode",3,"FORWARD"),r=z(e,"count",3,1e3),s=z(e,"alphaTest",3,.1),l=z(e,"transparent",3,!0),c=z(e,"randomPlaybackOffset",3,!1),h=z(e,"ref",15),d=xt(e,["$$slots","$$events","$$legacy","autoUpdate","baseMaterial","fps","billboarding","playmode","count","alphaTest","transparent","hueShift","randomPlaybackOffset","spritesheet","ref","children"]);const f=new(a())({transparent:l(),alphaTest:s(),side:Oi}),{renderer:p}=wt(),m=new FI(f,r(),p),b=wr(new Map);Ae(()=>{e.spritesheet&&(m.spritesheet=e.spritesheet.spritesheet,b.set(m.animationMap),m.material.map=e.spritesheet.texture,m.material.needsUpdate=!0)}),Ae(()=>{m.material.alphaTest=s()}),Ae(()=>{m.material.transparent=l()}),Ae(()=>{m.fps=n()}),Ae(()=>m.hueShift.setGlobal(e.hueShift)),Ae(()=>{if(e.billboarding===void 0){m.billboarding.unsetAll();return}else m.billboarding.setAll(e.billboarding)}),Ae(()=>{if(t()===void 0){m.playmode.setAll("PAUSE");return}else m.playmode.setAll(t())});let v=Ti(!1);Ae(()=>{if(H(v)===!1&&c()&&m.offset.randomizeAll(c()===!0?100:c()),H(v)===!0&&!c())for(let C=0;C<r();C++)m.offset.setAt(C,0);rn(v,er(!!c()))});let y=!1;const E=new Lt,_=(C,x,B=[1,1])=>{E.makeScale(B[0],B[1],1),E.setPosition(...x),m.setMatrixAt(C,E),y=!0};Do("instanced-sprite-ctx",{sprite:m,count:r(),animationMap:b,updatePosition:_}),zt(()=>{i()&&m.update(),y&&(m.instanceMatrix.needsUpdate=!0,y=!1)}),m.update(),qe(o,yt({is:m,frustumCulled:!1},()=>d,{get ref(){return h()},set ref(C){h(C)},children:(C,x)=>{var B=tt(),I=ze(B);ut(I,()=>e.children??ht,()=>({Instance:y2})),Le(C,B)},$$slots:{default:!0}})),at()}const _2=()=>Cr("instanced-sprite-ctx"),C2=o=>{const e=b2(),i=[];for(const{url:t,type:r,width:s,height:l,animations:c}of o){for(const h of c)i.push(h.name);e.add(t,{type:r,width:s,height:l},c)}return{spritesheet:e.build(),useInstancedSprite:_2}},E2=(o,e)=>{const i=new ec().load(e,n=>{n.matrixAutoUpdate=!1,n.generateMipmaps=!1,n.premultiplyAlpha=!1,n.wrapS=i.wrapT=ir,n.magFilter=i.minFilter=wn,n.colorSpace=vi,n.needsUpdate=!0});return(async()=>{const t=await(await fetch(o)).json();return{spritesheet:CI(t),texture:i}})()},dS={from:C2,fromAseprite:E2};export{SB as Align,$2 as AnimatedSpriteMaterial,KB as AsciiRenderer,sS as Audio,oS as AudioListener,GB as BakeShadows,DB as Billboard,kB as CSM,fB as ContactShadows,VB as CubeCamera,AB as CubeEnvironment,NB as Detailed,eB as Edges,pB as Environment,TB as FakeGlowMaterial,iB as Float,rB as GLTF,dB as Gizmo,vB as Grid,tB as HTML,nB as HUD,mB as ImageMaterial,m_ as Instance,f_ as InstancedMesh,CB as InstancedMeshes,hS as InstancedSprite,jB as LinearGradientTexture,OB as Mask,zB as MeshDiscardMaterial,xB as MeshLineGeometry,IB as MeshLineMaterial,PB as MeshRefractionMaterial,yB as OrbitControls,LB as Outlines,FB as PerfMonitor,tS as Portal,nS as PortalTarget,aS as PositionalAudio,qB as RadialGradientTexture,HB as Resize,bB as RoundedBoxGeometry,BB as Sky,EB as SoftShadows,MB as Stars,ZB as Suspense,rS as Text,QB as Text3DGeometry,_B as TrackballControls,wB as TransformControls,WB as View,gB as VirtualEnvironment,dS as buildSpritesheet,XB as createTransition,JB as global,cS as interactivity,uS as layers,Z2 as meshBounds,$B as onReveal,eS as onSuspend,YB as transitions,lS as useAudioListener,z2 as useCursor,H2 as useDraco,K2 as useFBO,Y2 as useGamepad,Rw as useGltf,q2 as useGltfAnimations,_2 as useInstancedSprite,mm as useInteractivity,j2 as useKtx2,X2 as useMask,V2 as useMeshopt,W2 as useProgress,Er as useSuspense,fg as useTexture,vc as useThrelteAudio,J2 as useViewport};
